!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RecordPlayer=t():e.RecordPlayer=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=320)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(80),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){e.exports={default:n(151),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(39),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){"use strict";t.__esModule=!0;var r=o(n(107)),a=o(n(83)),i=o(n(39));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},function(e,t,n){e.exports={default:n(164),__esModule:!0}},function(e,t,n){var r=n(11),a=n(5),i=n(19),o=n(20),s=n(24),u=function(e,t,n){var c,l,d,h=e&u.F,f=e&u.G,p=e&u.S,v=e&u.P,y=e&u.B,g=e&u.W,m=f?a:a[t]||(a[t]={}),w=m.prototype,b=f?r:p?r[t]:(r[t]||{}).prototype;for(c in f&&(n=t),n)(l=!h&&b&&void 0!==b[c])&&s(m,c)||(d=l?b[c]:n[c],m[c]=f&&"function"!=typeof b[c]?n[c]:y&&l?i(d,r):g&&b[c]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):v&&"function"==typeof d?i(Function.call,d):d,v&&((m.virtual||(m.virtual={}))[c]=d,e&u.R&&w&&!w[c]&&o(w,c,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(0)),a=u(n(1)),i=u(n(39)),o=n(54),s=n(193);function u(e){return e&&e.__esModule?e:{default:e}}var c=void 0,l={type:"",boardName:"whiteboard",pageIndex:"0",dependOn:void 0,timestamp:0},d=!1;function h(e,t,n,r){var a=!1;return l.pageIndex!==n||l.boardName!==r?a=!0:l.inProgress?(e!==l.type||(void 0===t?"undefined":(0,i.default)(t))!==(0,i.default)(l.dependOn)||"string"==typeof t&&t!==l.dependOn||Array.isArray(t)&&Array.isArray(l.dependOn)&&t.join(",")!==l.dependOn.join(",")||d||["undo","redo","image"].includes(e))&&(a=!0):a=!0,a}var f=function(){function e(t){(0,r.default)(this,e),this.type="base",this.app=t,this.opsManager=t.opsManager,this.registerHooks()}return(0,a.default)(e,[{key:"registerHooks",value:function(){}},{key:"eventsToListen",value:function(){return{exec:{value:!1,information:{args:"",message:"执行"+this.type+"事件"}},activate:{value:!1,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"execCommand",value:function(){console.warn("白板--\x3e","若设置了exec为true，请继承execCommand函数，并作出对应的处理。")}},{key:"afterActivate",value:function(){}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"opIdForseen",value:function(e,t){return h(e,t,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName)?this.opsManager.currPage.getNextOpId():this.opsManager.currPage.getOpId()}},{key:"dispatch",value:function(e){if(e.hasOwnProperty("type"))if(o.globalSnapshotTypes.indexOf(e.type)>-1)this.dispatchGlobalAction(e);else if("page"===e.type)this.dispatchPageAction(e);else if("board"===e.type)this.dispatchBoardAction(e);else{var t=this.app.room.boards[this.app.room.currIndex],n=(new Date).valueOf(),r=void 0;if(e.reuseOpType)r=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType;else{var a=h(e.type,e.dependOn,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName);d=!1,l={type:e.type,dependOn:e.dependOn,timestamp:n,pageIndex:this.opsManager.currPage.pageIndex,boardName:this.opsManager.currPage.boardName,inProgress:e.inProgress},a&&this.opsManager.currPage.prepareNewOpId(),r=this.opsManager.currPage.getOpId()}var i={category:"inPageOp",board:this.app.room.currIndex,page:t.currIndex,time:n,uid:this.app.account,opId:r,data:e};this.app.room.dispatch(i)}else{var s={opId:this.opsManager.currPage.getOpId(),data:e};this.app.room.dispatch(s)}}},{key:"dispatchFromPage",value:function(e,t){var n=(new Date).valueOf();t.prepareNewOpId();var r={category:"inPageOp",board:t.boardName,page:Number(t.pageIndex),time:n,uid:this.app.account,opId:t.getOpId(),data:e};l={type:e.type,dependOn:e.dependOn,timestamp:n,pageIndex:t.pageIndex,boardName:t.boardName,inProgress:e.inProgress},this.app.room.dispatch(r)}},{key:"dispatchPageAction",value:function(e){var t=(new Date).valueOf(),n={category:"pageOp",board:this.app.room.currIndex,time:t,uid:this.app.account,opId:(0,s.v4)(),data:e};this.app.room.dispatch(n)}},{key:"dispatchBoardAction",value:function(e){var t={category:"boardOp",time:(new Date).valueOf(),uid:this.app.account,opId:(0,s.v4)(),data:e};this.app.room.dispatch(t)}},{key:"dispatchGlobalAction",value:function(e){var t=void 0,n=(new Date).valueOf();e.reuseOpType?(t=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType):(c&&!d||(c=(0,s.v4)(),d=!1),t=c);var r={category:"globalOp",time:n,uid:this.app.account,opId:t,data:e};this.app.room.dispatch(r)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=this.app.dispatcher).emit.apply(t,[e].concat(r))}},{key:"draw",value:function(e,t,n){console.warn("白板--\x3e","请实现"+this.type+"子类中draw函数。")}},{key:"preview",value:function(e,t,n){this.draw(e,t,n)}},{key:"hide",value:function(e,t,n){}},{key:"mergePartial",value:function(e,t){return t.hasOwnProperty("category")?t:e}},{key:"beginBatch",value:function(){d=!0}},{key:"isKeyDown",value:function(e){return this.app.container.isKeyDown(e)}},{key:"getOpTypeByOpId",value:function(e){return this.opsManager.drawOpsOfPage.hasOwnProperty(e)?this.opsManager.drawOpsOfPage[e].data.type:void 0}},{key:"isMouseDown",get:function(){return this.app.container.isMouseDown}},{key:"opsOfPage",get:function(){return this.opsManager.currPage.opQueue}},{key:"drawOpsOfPage",get:function(){return this.opsManager.drawOpsOfPage}}]),e}();t.default=f},function(e,t,n){!function(){"use strict";function t(e,t){var n,r,a,i,o=I;for(i=arguments.length;i-- >2;)A.push(arguments[i]);for(t&&null!=t.children&&(A.length||A.push(t.children),delete t.children);A.length;)if((r=A.pop())&&void 0!==r.pop)for(i=r.length;i--;)A.push(r[i]);else"boolean"==typeof r&&(r=null),(a="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r+="":"string"!=typeof r&&(a=!1)),a&&n?o[o.length-1]+=r:o===I?o=[r]:o.push(r),n=a;var s=new C;return s.nodeName=e,s.children=o,s.attributes=null==t?void 0:t,s.key=null==t?void 0:t.key,void 0!==O.vnode&&O.vnode(s),s}function n(e,t){for(var n in t)e[n]=t[n];return e}function r(e,t){e&&("function"==typeof e?e(t):e.current=t)}function a(e){!e.__d&&(e.__d=!0)&&1==E.push(e)&&(O.debounceRendering||P)(i)}function i(){for(var e;e=E.pop();)e.__d&&k(e)}function o(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&s(e,t.nodeName):n||e._componentConstructor===t.nodeName}function s(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function u(e){var t=n({},e.attributes);t.children=e.children;var r=e.nodeName.defaultProps;if(void 0!==r)for(var a in r)void 0===t[a]&&(t[a]=r[a]);return t}function c(e){var t=e.parentNode;t&&t.removeChild(e)}function l(e,t,n,a,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)r(n,null),r(a,e);else if("class"!==t||i)if("style"===t){if(a&&"string"!=typeof a&&"string"!=typeof n||(e.style.cssText=a||""),a&&"object"==typeof a){if("string"!=typeof n)for(var o in n)o in a||(e.style[o]="");for(var o in a)e.style[o]="number"==typeof a[o]&&!1===T.test(o)?a[o]+"px":a[o]}}else if("dangerouslySetInnerHTML"===t)a&&(e.innerHTML=a.__html||"");else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),a?n||e.addEventListener(t,d,s):e.removeEventListener(t,d,s),(e.__l||(e.__l={}))[t]=a}else if("list"!==t&&"type"!==t&&!i&&t in e){try{e[t]=null==a?"":a}catch(e){}null!=a&&!1!==a||"spellcheck"==t||e.removeAttribute(t)}else{var u=i&&t!==(t=t.replace(/^xlink:?/,""));null==a||!1===a?u?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof a&&(u?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),a):e.setAttribute(t,a))}else e.className=a||""}function d(e){return this.__l[e.type](O.event&&O.event(e)||e)}function h(){for(var e;e=D.shift();)O.afterMount&&O.afterMount(e),e.componentDidMount&&e.componentDidMount()}function f(e,t,n,r,a,i){R++||(N=null!=a&&void 0!==a.ownerSVGElement,z=null!=e&&!("__preactattr_"in e));var o=p(e,t,n,r,i);return a&&o.parentNode!==a&&a.appendChild(o),--R||(z=!1,i||h()),o}function p(e,t,n,r,a){var i=e,o=N;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||a)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),y(e,!0))),i.__preactattr_=!0,i;var u=t.nodeName;if("function"==typeof u)return x(e,t,n,r);if(N="svg"===u||"foreignObject"!==u&&N,u+="",(!e||!s(e,u))&&(i=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.__n=e,n}(u,N),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),y(e,!0)}var c=i.firstChild,l=i.__preactattr_,d=t.children;if(null==l){l=i.__preactattr_={};for(var h=i.attributes,f=h.length;f--;)l[h[f].name]=h[f].value}return!z&&d&&1===d.length&&"string"==typeof d[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=d[0]&&(c.nodeValue=d[0]):(d&&d.length||null!=c)&&v(i,d,n,r,z||null!=l.dangerouslySetInnerHTML),m(i,t.attributes,l),N=o,i}function v(e,t,n,r,a){var i,s,u,l,d,h=e.childNodes,f=[],v={},g=0,m=0,w=h.length,b=0,_=t?t.length:0;if(0!==w)for(var k=0;k<w;k++){var x=h[k],M=x.__preactattr_;null!=(S=_&&M?x._component?x._component.__k:M.key:null)?(g++,v[S]=x):(M||(void 0!==x.splitText?!a||x.nodeValue.trim():a))&&(f[b++]=x)}if(0!==_)for(k=0;k<_;k++){var S;if(d=null,null!=(S=(l=t[k]).key))g&&void 0!==v[S]&&(d=v[S],v[S]=void 0,g--);else if(m<b)for(i=m;i<b;i++)if(void 0!==f[i]&&o(s=f[i],l,a)){d=s,f[i]=void 0,i===b-1&&b--,i===m&&m++;break}d=p(d,l,n,r),u=h[k],d&&d!==e&&d!==u&&(null==u?e.appendChild(d):d===u.nextSibling?c(u):e.insertBefore(d,u))}if(g)for(var k in v)void 0!==v[k]&&y(v[k],!1);for(;m<=b;)void 0!==(d=f[b--])&&y(d,!1)}function y(e,t){var n=e._component;n?M(n):(null!=e.__preactattr_&&r(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||c(e),g(e))}function g(e){for(e=e.lastChild;e;){var t=e.previousSibling;y(e,!0),e=t}}function m(e,t,n){var r;for(r in n)t&&null!=t[r]||null==n[r]||l(e,r,n[r],n[r]=void 0,N);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||l(e,r,n[r],n[r]=t[r],N)}function w(e,t,n){var r,a=j.length;for(e.prototype&&e.prototype.render?(r=new e(t,n),S.call(r,t,n)):((r=new S(t,n)).constructor=e,r.render=b);a--;)if(j[a].constructor===e)return r.__b=j[a].__b,j.splice(a,1),r;return r}function b(e,t,n){return this.constructor(e,n)}function _(e,t,n,i,o){e.__x||(e.__x=!0,e.__r=t.ref,e.__k=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i)),i&&i!==e.context&&(e.__c||(e.__c=e.context),e.context=i),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&!1===O.syncComponentUpdates&&e.base?a(e):k(e,1,o)),r(e.__r,e))}function k(e,t,r,a){if(!e.__x){var i,o,s,c=e.props,l=e.state,d=e.context,p=e.__p||c,v=e.__s||l,g=e.__c||d,m=e.base,b=e.__b,x=m||b,S=e._component,C=!1,A=g;if(e.constructor.getDerivedStateFromProps&&(l=n(n({},l),e.constructor.getDerivedStateFromProps(c,l)),e.state=l),m&&(e.props=p,e.state=v,e.context=g,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,l,d)?C=!0:e.componentWillUpdate&&e.componentWillUpdate(c,l,d),e.props=c,e.state=l,e.context=d),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!C){i=e.render(c,l,d),e.getChildContext&&(d=n(n({},d),e.getChildContext())),m&&e.getSnapshotBeforeUpdate&&(A=e.getSnapshotBeforeUpdate(p,v));var I,P,T=i&&i.nodeName;if("function"==typeof T){var E=u(i);(o=S)&&o.constructor===T&&E.key==o.__k?_(o,E,1,d,!1):(I=o,e._component=o=w(T,E,d),o.__b=o.__b||b,o.__u=e,_(o,E,0,d,!1),k(o,1,r,!0)),P=o.base}else s=x,(I=S)&&(s=e._component=null),(x||1===t)&&(s&&(s._component=null),P=f(s,i,d,r||!m,x&&x.parentNode,!0));if(x&&P!==x&&o!==S){var N=x.parentNode;N&&P!==N&&(N.replaceChild(P,x),I||(x._component=null,y(x,!1)))}if(I&&M(I),e.base=P,P&&!a){for(var z=e,j=e;j=j.__u;)(z=j).base=P;P._component=z,P._componentConstructor=z.constructor}}for(!m||r?D.push(e):C||(e.componentDidUpdate&&e.componentDidUpdate(p,v,A),O.afterUpdate&&O.afterUpdate(e));e.__h.length;)e.__h.pop().call(e);R||a||h()}}function x(e,t,n,r){for(var a=e&&e._component,i=a,o=e,s=a&&e._componentConstructor===t.nodeName,c=s,l=u(t);a&&!c&&(a=a.__u);)c=a.constructor===t.nodeName;return a&&c&&(!r||a._component)?(_(a,l,3,n,r),e=a.base):(i&&!s&&(M(i),e=o=null),a=w(t.nodeName,l,n),e&&!a.__b&&(a.__b=e,o=null),_(a,l,1,n,r),e=a.base,o&&e!==o&&(o._component=null,y(o,!1))),e}function M(e){O.beforeUnmount&&O.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?M(n):t&&(null!=t.__preactattr_&&r(t.__preactattr_.ref,null),e.__b=t,c(t),j.push(e),g(t)),r(e.__r,null)}function S(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{},this.__h=[]}var C=function(){},O={},A=[],I=[],P="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,T=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,E=[],D=[],R=0,N=!1,z=!1,j=[];n(S.prototype,{setState:function(e,t){this.__s||(this.__s=this.state),this.state=n(n({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this.__h.push(t),a(this)},forceUpdate:function(e){e&&this.__h.push(e),k(this,2)},render:function(){}});var L={h:t,createElement:t,cloneElement:function(e,r){return t(e.nodeName,n(n({},e.attributes),r),arguments.length>2?[].slice.call(arguments,2):e.children)},createRef:function(){return{}},Component:S,render:function(e,t,n){return f(n,e,{},!1,t,!1)},rerender:i,options:O};e.exports=L}()},function(e,t,n){var r=n(67)("wks"),a=n(52),i=n(11).Symbol,o="function"==typeof i;(e.exports=function(e){return r[e]||(r[e]=o&&i[e]||(o?i:a)("Symbol."+e))}).store=r},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){e.exports={default:n(134),__esModule:!0}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(23)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(18),a=n(87),i=n(64),o=Object.defineProperty;t.f=n(14)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),a)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){e.exports={default:n(132),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.momentum=t.getLineFromPointsY=t.getVerticalLineY=t.getXFromCoefAndOffset=t.getLineCoef=t.getArrowPoints=void 0,t.distSqrt=a,t.dist=i,t.rectCollide=function(e,t){return!(e.sx>t.sx+t.w||e.sx+e.w<t.sx||e.sy>t.sy+t.h||e.sy+e.h<t.sy)},t.pointCollideWithPoint=function(e,t,n){return a(e,t)<=n*n},t.pointCollideWithLine=function(e,t,n,r){return i(e,t)+i(e,n)-i(t,n)<=r},t.pointInRect=function(e,t){return t[0]>e.sx&&t[0]<e.sx+e.w&&t[1]>e.sy&&t[1]<e.sy+e.h},t.getTransformedBoundary=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{factor:1,coordinate:0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},i=r.factor*(e.sx-r.coordinate)+r.coordinate,o=a.factor*(e.sy-a.coordinate)+a.coordinate;i+=t||0,o+=n||0;var s=e.w*r.factor,u=e.h*a.factor;s<0&&(i+=s,s=-s);u<0&&(o+=u,u=-u);return{sx:i,sy:o,w:s,h:u}},t.getTransformedPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{factor:1,coordinate:0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},i=r.factor*(e[0]-r.coordinate)+r.coordinate,o=a.factor*(e[1]-a.coordinate)+a.coordinate;return[i+=t||0,o+=n||0]},t.combineBoundary=function(e,t){var n=(0,r.min)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),a=(0,r.min)(e.sy,t.sy,e.sy+e.h,t.sy+t.h),i=(0,r.max)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),o=(0,r.max)(e.sy,t.sy,e.sy+e.h,t.sy+t.h);return{sx:n,sy:a,w:i-n,h:o-a}},t.getBoundaryBoxFromTwoPoints=function(e,t){var n=(0,r.min)(e[0],t[0]),a=(0,r.max)(e[0],t[0]),i=(0,r.min)(e[1],t[1]),o=(0,r.max)(e[1],t[1]);return{sx:n,sy:i,w:a-n,h:o-i}};var r=n(139);function a(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function i(e,t){return Math.sqrt(a(e,t))}t.getArrowPoints=function(e,t){var n=5*e,r=2*e,a=o(t),i=t[1][0]-t[0][0]>0?s(t[1],a,n):2*t[1][0]-s(t[1],a,n),l=t[1][0]-t[0][0]==0?t[1][1]+(t[1][1]-t[0][1]>0?n:-n):c(t,i),d=s(t[1],-1/a,r),h=t[1][1]-t[0][1]==0?t[1][1]-r:u(t[1],a,d),f=2*t[1][0]-s(t[1],-1/a,r);return[[i,l],[d,h],[f,t[1][1]-t[0][1]==0?t[1][1]+r:u(t[1],a,f)]]};var o=t.getLineCoef=function(e){return(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0},s=t.getXFromCoefAndOffset=function(e,t,n){return Math.sqrt(Math.pow(n,2)/(Math.pow(t,2)+1))+e[0]},u=t.getVerticalLineY=function(e,t,n){return(e[0]-n)/t+e[1]},c=t.getLineFromPointsY=function(e,t){return Math.max(-1e6,(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0)*(t-e[0][0])+e[0][1]};t.momentum=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}},function(e,t,n){var r=n(13);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(49);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(15),a=n(36);e.exports=n(14)?function(e,t,n){return r.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var a=(o=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),i=r.sources.map((function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"}));return[n].concat(i).concat([a]).join("\n")}var o;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},a=0;a<this.length;a++){var i=this[a][0];null!=i&&(r[i]=!0)}for(a=0;a<e.length;a++){var o=e[a];null!=o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var r,a,i={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=r.apply(this,arguments)),a}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},u=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=s.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),c=null,l=0,d=[],h=n(171);function f(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=i[r.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](r.parts[o]);for(;o<r.parts.length;o++)a.parts.push(w(r.parts[o],t))}else{var s=[];for(o=0;o<r.parts.length;o++)s.push(w(r.parts[o],t));i[r.id]={id:r.id,refs:1,parts:s}}}}function p(e,t){for(var n=[],r={},a=0;a<e.length;a++){var i=e[a],o=t.base?i[0]+t.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}function v(e,t){var n=u(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=d[d.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var a=u(e.insertAt.before,n);n.insertBefore(t,a)}}function y(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return m(t,e.attrs),v(e,t),t}function m(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function w(e,t){var n,r,a,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var o=l++;n=c||(c=g(t)),r=k.bind(null,n,o,!1),a=k.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),v(e,t),t}(t),r=M.bind(null,n,t),a=function(){y(n),n.href&&URL.revokeObjectURL(n.href)}):(n=g(t),r=x.bind(null,n),a=function(){y(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else a()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return f(n,t),function(e){for(var r=[],a=0;a<n.length;a++){var o=n[a];(s=i[o.id]).refs--,r.push(s)}e&&f(p(e,t),t);for(a=0;a<r.length;a++){var s;if(0===(s=r[a]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete i[s.id]}}}};var b,_=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function k(e,t,n,r){var a=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=_(t,a);else{var i=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function x(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function M(e,t,n){var r=n.css,a=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&a;(t.convertToAbsoluteUrls||i)&&(r=h(r)),a&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var o=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(62);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(65),a=n(62);e.exports=function(e){return r(a(e))}},function(e,t,n){"use strict";var r=d(n(47)),a=d(n(59)),i=d(n(83)),o=d(n(12)),s=d(n(6)),u=d(n(39)),c=d(n(0)),l=d(n(1));function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t){(0,c.default)(this,e),Array.isArray(t)||(t=[]),this._args=t,this.taps=[],this.interceptors=[],this.call=this._call,this.promise=this._promise,this.callAsync=this._callAsync,this._x=void 0}return(0,l.default)(e,[{key:"compile",value:function(e){throw new Error("Abstract: should be overriden")}},{key:"_createCall",value:function(e){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:e})}},{key:"tap",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tap(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"sync",fn:t},e)).name||""===e.name)throw new Error("Missing name for tap");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapAsync",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapAsync(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"async",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapAsync");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapPromise",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapPromise(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"promise",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapPromise");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"_runRegisterInterceptors",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=(0,o.default)(this.interceptors);!(t=(a=i.next()).done);t=!0){var s=a.value;if(s.register){var u=s.register(e);void 0!==u&&(e=u)}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}return e}},{key:"withOptions",value:function(e){var t=function(t){return(0,s.default)({},e,"string"==typeof t?{name:t}:t)};e=(0,s.default)({},e,this._withOptions);var n=this._withOptionsBase||this,r=(0,i.default)(n);return r.tapAsync=function(e,r){return n.tapAsync(t(e),r)},r.tap=function(e,r){return n.tap(t(e),r)},r.tapPromise=function(e,r){return n.tapPromise(t(e),r)},r._withOptions=e,r._withOptionsBase=n,r}},{key:"isUsed",value:function(){return this.taps.length>0||this.interceptors.length>0}},{key:"intercept",value:function(e){if(this._resetCompilation(),this.interceptors.push((0,s.default)({},e)),e.register)for(var t=0;t<this.taps.length;t++)this.taps[t]=e.register(this.taps[t])}},{key:"_resetCompilation",value:function(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}},{key:"_insert",value:function(e){this._resetCompilation();var t=void 0;"string"==typeof e.before?t=new a.default([e.before]):Array.isArray(e.before)&&(t=new a.default(e.before));var n=0;"number"==typeof e.stage&&(n=e.stage);for(var r=this.taps.length;r>0;){r--;var i=this.taps[r];this.taps[r+1]=i;var o=i.stage||0;if(t){if(t.has(i.name)){t.delete(i.name);continue}if(t.size>0)continue}if(!(o>n)){r++;break}}this.taps[r]=e}}]),e}();function f(e,t){return function(){return this[e]=this._createCall(t),this[e].apply(this,arguments)}}(0,r.default)(h.prototype,{_call:{value:f("call","sync"),configurable:!0,writable:!0},_promise:{value:f("promise","promise"),configurable:!0,writable:!0},_callAsync:{value:f("callAsync","async"),configurable:!0,writable:!0}}),e.exports=h},,function(e,t,n){e.exports={default:n(199),__esModule:!0}},function(e,t,n){"use strict";var r=n(120)(!0);n(63)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t){e.exports={}},function(e,t,n){"use strict";t.__esModule=!0;var r=i(n(208)),a=i(n(12));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(e);!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";var r=o(n(12)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this.config=t,this.options=void 0,this._args=void 0}return(0,i.default)(e,[{key:"create",value:function(e){this.init(e);var t=void 0;switch(this.options.type){case"sync":t=new Function(this.args(),'"use strict";\n'+this.header()+this.content({onError:function(e){return"throw "+e+";\n"},onResult:function(e){return"return "+e+";\n"},resultReturns:!0,onDone:function(){return""},rethrowIfPossible:!0}));break;case"async":t=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.content({onError:function(e){return"_callback("+e+");\n"},onResult:function(e){return"_callback(null, "+e+");\n"},onDone:function(){return"_callback();\n"}}));break;case"promise":var n=!1,r=this.content({onError:function(e){return n=!0,"_error("+e+");\n"},onResult:function(e){return"_resolve("+e+");\n"},onDone:function(){return"_resolve();\n"}}),a="";a+='"use strict";\n',a+="return new Promise((_resolve, _reject) => {\n",n&&(a+="var _sync = true;\n",a+="function _error(_err) {\n",a+="if(_sync)\n",a+="_resolve(Promise.resolve().then(() => { throw _err; }));\n",a+="else\n",a+="_reject(_err);\n",a+="};\n"),a+=this.header(),a+=r,n&&(a+="_sync = false;\n"),a+="});\n",t=new Function(this.args(),a)}return this.deinit(),t}},{key:"setup",value:function(e,t){e._x=t.taps.map((function(e){return e.fn}))}},{key:"init",value:function(e){this.options=e,this._args=e.args.slice()}},{key:"deinit",value:function(){this.options=void 0,this._args=void 0}},{key:"header",value:function(){var e="";this.needContext()?e+="var _context = {};\n":e+="var _context;\n",e+="var _x = this._x;\n",this.options.interceptors.length>0&&(e+="var _taps = this.taps;\n",e+="var _interceptors = this.interceptors;\n");for(var t=0;t<this.options.interceptors.length;t++){var n=this.options.interceptors[t];n.call&&(e+=this.getInterceptor(t)+".call("+this.args({before:n.context?"_context":void 0})+");\n")}return e}},{key:"needContext",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=(0,r.default)(this.options.taps);!(e=(a=i.next()).done);e=!0){if(a.value.context)return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"callTap",value:function(e,t){for(var n=t.onError,r=t.onResult,a=t.onDone,i=t.rethrowIfPossible,o="",s=!1,u=0;u<this.options.interceptors.length;u++){var c=this.options.interceptors[u];c.tap&&(s||(o+="var _tap"+e+" = "+this.getTap(e)+";\n",s=!0),o+=this.getInterceptor(u)+".tap("+(c.context?"_context, ":"")+"_tap"+e+");\n")}o+="var _fn"+e+" = "+this.getTapFn(e)+";\n";var l=this.options.taps[e];switch(l.type){case"sync":i||(o+="var _hasError"+e+" = false;\n",o+="try {\n"),o+=r?"var _result"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n":"_fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",i||(o+="} catch(_err) {\n",o+="_hasError"+e+" = true;\n",o+=n("_err"),o+="}\n",o+="if(!_hasError"+e+") {\n"),r&&(o+=r("_result"+e)),a&&(o+=a()),i||(o+="}\n");break;case"async":var d="";d+=r?"(_err"+e+", _result"+e+") => {\n":"_err"+e+" => {\n",d+="if(_err"+e+") {\n",d+=n("_err"+e),d+="} else {\n",r&&(d+=r("_result"+e)),a&&(d+=a()),d+="}\n",d+="}",o+="_fn"+e+"("+this.args({before:l.context?"_context":void 0,after:d})+");\n";break;case"promise":o+="var _hasResult"+e+" = false;\n",o+="var _promise"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",o+="if (!_promise"+e+" || !_promise"+e+".then)\n",o+="  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise"+e+" + ')');\n",o+="_promise"+e+".then(_result"+e+" => {\n",o+="_hasResult"+e+" = true;\n",r&&(o+=r("_result"+e)),a&&(o+=a()),o+="}, _err"+e+" => {\n",o+="if(_hasResult"+e+") throw _err"+e+";\n",o+=n("_err"+e),o+="});\n"}return o}},{key:"callTapsSeries",value:function(e){var t=this,n=e.onError,r=e.onResult,a=e.resultReturns,i=e.onDone,o=e.doneReturns,s=e.rethrowIfPossible;if(0===this.options.taps.length)return i();for(var u=this.options.taps.findIndex((function(e){return"sync"!==e.type})),c=a||o||!1,l="",d=i,h=function(e){var a=e;d!==i&&"sync"!==t.options.taps[a].type&&(l+="function _next"+a+"() {\n",l+=d(),l+="}\n",d=function(){return(c?"return ":"")+"_next"+a+"();\n"});var o=d,h=function(e){return e?"":i()},f=t.callTap(a,{onError:function(e){return n(a,e,o,h)},onResult:r&&function(e){return r(a,e,o,h)},onDone:!r&&o,rethrowIfPossible:s&&(u<0||a<u)});d=function(){return f}},f=this.options.taps.length-1;f>=0;f--)h(f);return l+=d()}},{key:"callTapsLooping",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;if(0===this.options.taps.length)return n();var a=this.options.taps.every((function(e){return"sync"===e.type})),i="";a||(i+="var _looper = () => {\n",i+="var _loopAsync = false;\n"),i+="var _loop;\n",i+="do {\n",i+="_loop = false;\n";for(var o=0;o<this.options.interceptors.length;o++){var s=this.options.interceptors[o];s.loop&&(i+=this.getInterceptor(o)+".loop("+this.args({before:s.context?"_context":void 0})+");\n")}return i+=this.callTapsSeries({onError:t,onResult:function(e,t,n,r){var i="";return i+="if("+t+" !== undefined) {\n",i+="_loop = true;\n",a||(i+="if(_loopAsync) _looper();\n"),i+=r(!0),i+="} else {\n",i+=n(),i+="}\n"},onDone:n&&function(){var e="";return e+="if(!_loop) {\n",e+=n(),e+="}\n"},rethrowIfPossible:r&&a}),i+="} while(_loop);\n",a||(i+="_loopAsync = true;\n",i+="};\n",i+="_looper();\n"),i}},{key:"callTapsParallel",value:function(e){var t=this,n=e.onError,r=e.onResult,a=e.onDone,i=e.rethrowIfPossible,o=e.onTap,s=void 0===o?function(e,t){return t()}:o;if(this.options.taps.length<=1)return this.callTapsSeries({onError:n,onResult:r,onDone:a,rethrowIfPossible:i});var u="";u+="do {\n",u+="var _counter = "+this.options.taps.length+";\n",a&&(u+="var _done = () => {\n",u+=a(),u+="};\n");for(var c=function(e){var o=function(){return a?"if(--_counter === 0) _done();\n":"--_counter;"},c=function(e){return e||!a?"_counter = 0;\n":"_counter = 0;\n_done();\n"};u+="if(_counter <= 0) break;\n",u+=s(e,(function(){return t.callTap(e,{onError:function(t){var r="";return r+="if(_counter > 0) {\n",r+=n(e,t,o,c),r+="}\n"},onResult:r&&function(t){var n="";return n+="if(_counter > 0) {\n",n+=r(e,t,o,c),n+="}\n"},onDone:!r&&function(){return o()},rethrowIfPossible:i})}),o,c)},l=0;l<this.options.taps.length;l++)c(l);return u+="} while(false);\n"}},{key:"args",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.before,n=e.after,r=this._args;return t&&(r=[t].concat(r)),n&&(r=r.concat(n)),0===r.length?"":r.join(", ")}},{key:"getTapFn",value:function(e){return"_x["+e+"]"}},{key:"getTap",value:function(e){return"_taps["+e+"]"}},{key:"getInterceptor",value:function(e){return"_interceptors["+e+"]"}}]),e}();e.exports=s},function(e,t){!function(n){"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=n()}((function(){return function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return a(t[o][1][e]||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,a="~";function i(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new o(n,r||e,i),u=a?a+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(a=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=a?a+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o},c.prototype.listenerCount=function(e){var t=a?a+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,r,i,o){var s=a?a+e:e;if(!this._events[s])return!1;var u,c=this._events[s],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(f=1,u=new Array(l-1);f<l;f++)u[f-1]=arguments[f];c.fn.apply(c.context,u)}else for(var d,h=c.length,f=0;f<h;f++)switch(c[f].once&&this.removeListener(e,c[f].fn,void 0,!0),l){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,t);break;case 3:c[f].fn.call(c[f].context,t,n);break;case 4:c[f].fn.call(c[f].context,t,n,r);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c[f].fn.apply(c[f].context,u)}return!0},c.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,r){var i=a?a+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||u(this,i);else{for(var s=0,c=[],l=o.length;s<l;s++)(o[s].fn!==t||r&&!o[s].once||n&&o[s].context!==n)&&c.push(o[s]);c.length?this._events[i]=1===c.length?c[0]:c:u(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=a,c.EventEmitter=c,void 0!==t&&(t.exports=c)},{}]},{},[1])(1)}))},function(e,t,n){e.exports={default:n(140),__esModule:!0}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(89),a=n(68);e.exports=Object.keys||function(e){return r(e,a)}},function(e,t,n){n(124);for(var r=n(11),a=n(20),i=n(31),o=n(10)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<s.length;u++){var c=s[u],l=r[c],d=l&&l.prototype;d&&!d[o]&&a(d,o,c),i[c]=i.Array}},function(e,t,n){"use strict";t.__esModule=!0;var r=o(n(153)),a=o(n(81)),i="function"==typeof a.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof a.default&&"symbol"===i(r.default)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":void 0===e?"undefined":i(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(0)),a=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var o=new(function(){function e(){(0,r.default)(this,e),this.strokeColor="rgb(0,0,0)",this.pointsPerBatch=1,this.strokeWidth=5,this.momentum=.35}return(0,a.default)(e,[{key:"setStrokeColor",value:function(e){this.strokeColor=e}},{key:"setStrokeWidth",value:function(e){this.strokeWidth=e}}]),e}());t.default=o},function(e,t){e.exports=!0},function(e,t,n){var r=n(15).f,a=n(24),i=n(10)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){var r=n(19),a=n(92),i=n(93),o=n(18),s=n(51),u=n(69),c={},l={};(t=e.exports=function(e,t,n,d,h){var f,p,v,y,g=h?function(){return e}:u(e),m=r(n,d,t?2:1),w=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(i(g)){for(f=s(e.length);f>w;w++)if((y=t?m(o(p=e[w])[0],p[1]):m(e[w]))===c||y===l)return y}else for(v=g.call(e);!(p=v.next()).done;)if((y=a(v,m,p.value,t))===c||y===l)return y}).BREAK=c,t.RETURN=l},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(101),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hideToast=t.showToast=void 0;var r=i(n(35)),a=i(n(176));function i(e){return e&&e.__esModule?e:{default:e}}t.showToast=function(e){var t=e.msg,n=e.time,i=void 0===n?2:n,o=e.type,s=void 0===o?"info":o,u=e.top,c=void 0===u?30:u,l={message:t.constructor===String?t:(0,r.default)(t),time:i,type:s,top:c};a.default.show(l)},t.hideToast=function(){a.default.hide()}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){e.exports={default:n(216),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertToCameraBoundSnapshot=void 0;var r=c(n(2)),a=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=c(n(8));function c(e){return e&&e.__esModule?e:{default:e}}t.convertToCameraBoundSnapshot=function(e,t){var n=e.getNextCameraBound(t);return(n.width>1e5||n.height>1e5)&&(n.width>n.height?(n.height=1e5*n.height/n.width,n.width=1e5):(n.width=1e5*n.width/n.height,n.height=1e5)),0!==n.width&&0!==n.height||(n.width=1e3,n.height=1e3),{type:"camera-bound",boundary:n,skipUndo:!0,animate:t.animate,reuseOpType:"camera-bound"}};var l=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="camera-bound",e.description="视角位置",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"camera-bound:send":{value:this.sendCameraBound.bind(this),information:{args:"boundary: {centerX: number, centerY: number, width: number, width: number}, animate: boolean",message:"发送当前用户的camera-bound，常用于主播同步自己的camera-bound"}}}}},{key:"sendCameraBound",value:function(e,t){this.dispatch({type:"camera-bound",boundary:e,skipUndo:!0,animate:t,reuseOpType:"camera-bound"})}}]),t}(u.default);t.default=l},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(18),a=n(96),i=n(68),o=n(66)("IE_PROTO"),s=function(){},u=function(){var e,t=n(75)("iframe"),r=i.length;for(t.style.display="none",n(97).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[i[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:a(n,t)}},function(e,t,n){var r=n(61),a=Math.min;e.exports=function(e){return e>0?a(r(e),9007199254740991):0}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.snapshotOutOfNormalFlowTypes=["background","pan","zoom","mouse-pointer","select","laser","camera-bound"],t.globalSnapshotTypes=["camera-bound"],t.cameraSnapshotTypes=["pan","zoom","camera-bound","reset-camera","fit-to-content","fit-to-doc","resize-camera"]},function(e,t,n){e.exports=n(277)},function(e,t){},function(e,t,n){var r=n(46),a=n(10)("toStringTag"),i="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?n:i?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,n){var r=n(7),a=n(5),i=n(23);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*i((function(){n(1)})),"Object",o)}},function(e,t,n){e.exports={default:n(141),__esModule:!0}},function(e,t,n){var r=n(52)("meta"),a=n(13),i=n(24),o=n(15).f,s=0,u=Object.isExtensible||function(){return!0},c=!n(23)((function(){return u(Object.preventExtensions({}))})),l=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!i(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&d.NEED&&u(e)&&!i(e,r)&&l(e),e}}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";var r=n(41),a=n(7),i=n(88),o=n(20),s=n(31),u=n(121),c=n(42),l=n(90),d=n(10)("iterator"),h=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,p,v,y,g){u(n,t,p);var m,w,b,_=function(e){if(!h&&e in S)return S[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",x="values"==v,M=!1,S=e.prototype,C=S[d]||S["@@iterator"]||v&&S[v],O=C||_(v),A=v?x?_("entries"):O:void 0,I="Array"==t&&S.entries||C;if(I&&(b=l(I.call(new e)))!==Object.prototype&&b.next&&(c(b,k,!0),r||"function"==typeof b[d]||o(b,d,f)),x&&C&&"values"!==C.name&&(M=!0,O=function(){return C.call(this)}),r&&!g||!h&&!M&&S[d]||o(S,d,O),s[t]=O,s[k]=f,v)if(m={values:x?O:_("values"),keys:y?O:_("keys"),entries:A},g)for(w in m)w in S||i(S,w,m[w]);else a(a.P+a.F*(h||M),t,m);return m}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(46);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(67)("keys"),a=n(52);e.exports=function(e){return r[e]||(r[e]=a(e))}},function(e,t,n){var r=n(5),a=n(11),i=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(41)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(57),a=n(10)("iterator"),i=n(31);e.exports=n(5).getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||i[r(e)]}},function(e,t,n){t.f=n(10)},function(e,t,n){var r=n(11),a=n(5),i=n(41),o=n(70),s=n(15).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=i?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawUserName=t.roundRect=t.arrayDeduce=t.idsChanged=t.snapshotSelectable=t.findOpsUnderMouse=t.findOpsUnderRect=void 0;var r=s(n(12)),a=s(n(16)),i=s(n(32)),o=n(17);function s(e){return e&&e.__esModule?e:{default:e}}t.findOpsUnderRect=function(e,t){if(0===e.length)return[];var n=(0,o.getBoundaryBoxFromTwoPoints)(e[0],e[e.length-1]),r=[];for(var a in t){var i=t[a];if(i.data.boundary&&c(i)){var s=(0,o.getTransformedBoundary)(i.data.boundary,i.data.dx,i.data.dy,i.data.scaleX,i.data.scaleY);(0,o.rectCollide)(s,n)&&r.push(a)}}return r},t.findOpsUnderMouse=function(e,t,n){if(0===e.length)return[];for(var r=(0,o.getBoundaryBoxFromTwoPoints)(e[0],e[e.length-1]),s=(0,i.default)(e[e.length-1],2),u=s[0],l=s[1],d=(0,a.default)(t),h=d.length-1;h>=0;h--){var f=t[d[h]],p=n.opMap[f.data.type];if(f.data.boundary&&c(f)){var v=(0,o.getTransformedBoundary)(f.data.boundary,f.data.dx,f.data.dy,f.data.scaleX,f.data.scaleY);if((0,o.rectCollide)(v,r)){if(!p||!("ifMouseOnOp"in p))return[d[h]];if(p.ifMouseOnOp(f,u,l))return[d[h]]}}}return[]};var u=["mouse-pointer","eraser"],c=t.snapshotSelectable=function(e){return!u.includes(e.data.type)&&!e.data.locked},l=(t.idsChanged=function(e,t){if(e.length!==t.length)return!0;var n=!0,a=!1,i=void 0;try{for(var o,s=(0,r.default)(e);!(n=(o=s.next()).done);n=!0){var u=o.value;if(-1===t.indexOf(u))return!0}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return!1},t.arrayDeduce=function(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var s,u=(0,r.default)(e);!(a=(s=u.next()).done);a=!0){var c=s.value;-1===t.indexOf(c)&&n.push(c)}}catch(e){i=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw o}}return n},t.roundRect=function(e,t,n,r,a,i,o){e.beginPath(),e.moveTo(t+i,n),e.lineTo(t+r-i,n),e.quadraticCurveTo(t+r,n,t+r,n+i),e.lineTo(t+r,n+a-i),e.quadraticCurveTo(t+r,n+a,t+r-i,n+a),e.lineTo(t+i,n+a),e.quadraticCurveTo(t,n+a,t,n+a-i),e.lineTo(t,n+i),e.quadraticCurveTo(t,n,t+i,n),e.closePath(),"stroke"===o?e.stroke():e.fill()});t.drawUserName=function(e){var t=e.ctx,n=e.account,r=e.scale,a=e.px,i=e.py,o=e.bgColor,s=e.fontSize,u=void 0===s?24:s,c=e.textPadding,d=void 0===c?15:c,h=e.rectMarginBottom,f=void 0===h?15:h,p=e.radius,v=void 0===p?10:p,y=(u+12)/r;d/=r,f/=r,u/=r,v/=r;var g="white"===o||"rgb(255,255,255)"===o?"black":"white";t.beginPath(),t.font=u+"px Arial";var m=t.measureText(n).width;t.fillStyle=o,l(t,a-m/2-d,i-f-y,m+2*d,y,v,"fill"),t.fillStyle=g,t.textAlign="left",t.textBaseline="middle",t.fillText(n,a-m/2,i-f-y/2)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.shouldDispatch=function(e){var t=e.vision.mode;return"broadcaster"===t||"freeObserver"===t}},function(e,t,n){var r=n(13),a=n(11).document,i=r(a)&&r(a.createElement);e.exports=function(e){return i?a.createElement(e):{}}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(20);e.exports=function(e,t,n){for(var a in t)n&&e[a]?e[a]=t[a]:r(e,a,t[a]);return e}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(196),i=(r=a)&&r.__esModule?r:{default:r};var o={mouse:(0,i.default)("mouse"),h5:(0,i.default)("h5"),package:(0,i.default)("package"),shape:(0,i.default)("shape"),user:(0,i.default)("user"),command:(0,i.default)("command"),image:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new Image;n.onload=function(){var r=["font-size: 14px;","padding: "+n.height/2+"px "+n.width/2+"px;","background: url("+e+") no-repeat;","background-size: contain;"].join(" ");console.log(t+"%c ",r)},n.src=e},m:{adapter:(0,i.default)("adapter"),worker:(0,i.default)("worker"),containermanager:(0,i.default)("containermanager"),shapemanager:(0,i.default)("shapemanager"),usermanager:(0,i.default)("usermanager"),syncmanager:(0,i.default)("syncmanager")},log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)};localStorage.getItem("debugMouse")||(o.mouse=function(){}),t.default=o},function(e,t,n){e.exports={default:n(130),__esModule:!0}},function(e,t,n){e.exports={default:n(155),__esModule:!0}},function(e,t,n){var r=n(53),a=n(36),i=n(26),o=n(64),s=n(24),u=n(87),c=Object.getOwnPropertyDescriptor;t.f=n(14)?c:function(e,t){if(e=i(e),t=o(t,!0),u)try{return c(e,t)}catch(e){}if(s(e,t))return a(!r.f.call(e,t),e[t])}},function(e,t,n){e.exports={default:n(162),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(12)),a=p(n(233)),i=p(n(2)),o=p(n(0)),s=p(n(1)),u=p(n(3)),c=p(n(4)),l=n(17),d=n(139),h=p(n(8)),f=p(n(40));function p(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="",e.shouldSaniteEp=!1,e.movedDuringMouseDown=!1,e.points=[],e.momentumPoints=[],e.supportFill=!1,e.isFill=!1,e.sampleSeq=0,e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return this.supportFill?(0,a.default)({activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}},this.type+":isFill",{value:this.setIsFill.bind(this),information:{args:"isFill: boolean",message:"设置是否为填充"}}):{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handleMouseMove",value:function(e,t,r){if(this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(168)+") -1 17, auto":document.body.style.cursor="auto",this.isMouseDown){t=Number(t.toFixed(1)),r=Number(r.toFixed(1)),this.points.push([t,r]);var a=(0,l.momentum)(this.histPoint,[t,r],f.default.momentum);this.histPoint=[Number(a[0].toFixed(2)),Number(a[1].toFixed(2))],this.momentumPoints.push(this.histPoint),this.movedDuringMouseDown=!0,this.sampleSeq%f.default.pointsPerBatch==0&&this.dispatch(this.getSnapshot(!0)),this.sampleSeq+=1}}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.points=[[t,n]],this.momentumPoints=[[t,n]],this.histPoint=[t,n],this.movedDuringMouseDown=!1,this.sampleSeq=0}},{key:"handleMouseUp",value:function(e,t,n){if(this.isMouseDown&&this.movedDuringMouseDown){t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.points.push([t,n]);var r=(0,l.momentum)(this.histPoint,[t,n],f.default.momentum);this.histPoint=[Number(r[0].toFixed(2)),Number(r[1].toFixed(2))],this.momentumPoints.push(this.histPoint),this.dispatch(this.getSnapshot(!1)),this.points=[]}}},{key:"getBoundaryRectOfFreeDraw",value:function(){var e=this.momentumPoints;if(0===e.length)throw new Error("涂鸦没有记录任何数据");var t=e[0][0],n=e[0][1],a=t,i=n,o=!0,s=!1,u=void 0;try{for(var c,l=(0,r.default)(e);!(o=(c=l.next()).done);o=!0){var h=c.value;t=(0,d.min)(h[0],t),n=(0,d.min)(h[1],n),a=(0,d.max)(h[0],a),i=(0,d.max)(h[1],i)}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}return{sx:t,sy:n,w:a-t,h:i-n}}},{key:"getBoundaryRectOfLine",value:function(){var e=(0,d.min)(this.sp[0],this.ep[0]),t=(0,d.min)(this.sp[1],this.ep[1]);return{sx:e,sy:t,w:(0,d.max)(this.sp[0],this.ep[0])-e,h:(0,d.max)(this.sp[1],this.ep[1])-t}}},{key:"sanityEp",value:function(e){return e[0]-this.sp[0]>=0&&e[0]-this.sp[0]<1&&(e[0]=this.sp[0]+1),e[1]-this.sp[1]>=0&&e[1]-this.sp[1]<1&&(e[1]=this.sp[1]+1),e}},{key:"setIsFill",value:function(e){this.isFill=e}},{key:"lineWidth",get:function(){return Number(f.default.strokeWidth)}},{key:"color",get:function(){return f.default.strokeColor}},{key:"sp",get:function(){return this.points[0]}},{key:"ep",get:function(){var e=this.points[this.points.length-1];return this.shouldSaniteEp&&(e=this.sanityEp(e)),e}}]),t}(h.default);t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(12)),a=f(n(2)),i=f(n(0)),o=f(n(1)),s=f(n(3)),u=f(n(4)),c=n(17),l=f(n(170)),d=f(n(40)),h=n(73);function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="select",e.lineWidth=0,e.fillColor="rgba(230, 100, 100, 0.4)",e.eleContainerColor="rgb(0, 0, 0)",e.eleContainerWidth=2,e.eleContainerPadding=3,e.activate=!1,e.selectedOpIds=[],e.inProgressSelectedOpIds=[],e.description="选择操作工具。\n首先使用op:select:activate设置画布为选择模式。通过。然后画布会监听鼠标动作，生成选择框。具体用法如下：",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getSelectedIds",value:function(){return this.selectedOpIds.slice()}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"select:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置选择框线段宽度"}},"select:fill:color":{value:this.setFillColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:stroke:color":{value:this.setStrokeColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:eleContainer:color":{value:this.setEleContainerColor.bind(this),information:{args:"color: ColorString",message:"设置被选中元素包含盒颜色"}},"select:eleContainer:width":{value:this.setEleContainerWidth.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒线段宽度"}},"select:eleContainerPadding":{value:this.setEleContainerPadding.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒的padding"}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this)),this.opsManager.hooks.pageChange.tap("pageChange",this.handlePageChange.bind(this))}},{key:"handlePageChange",value:function(e){e.uid===this.app.account&&this.selectedOpIds.length>0&&this.dispatch(this.getSnapshot([]))}},{key:"handleOpChange",value:function(e){var t;"select"!==e&&"select"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&this.dispatch(this.getSnapshot([])),this.beginBatch()}},{key:"postMouseUp",value:function(e){this.dispatch(this.getSnapshot(e)),this.lastSelectedOpIds=e}},{key:"postClick",value:function(e){if(0===e.length&&(new Date).valueOf()-this.opsManager.opMap.text.blurAt<100)return;this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return{type:"select",sp:this.sp,ep:this.ep,inProgress:!1,selectedOpIds:e.slice(),reuseOpType:"select",skipUndo:!0,color:d.default.strokeColor,nickname:this.app.nickname}}},{key:"draw",value:function(e,t){var n=e.data.color?e.data.color:"rgb(0,0,0)";this.drawSelectBox(e,t);var r=this.drawSelectedElementBox(e,t,n);if(!e.data.inProgress&&e.uid!==this.app.account&&Array.isArray(r)&&1===r.length){var a=r[0].sx+r[0].w/2,i=r[0].sy;(0,h.drawUserName)({ctx:t,account:e.data.nickname?e.data.nickname:e.uid,scale:this.app.camera.scale,px:a,py:i,bgColor:n,fontSize:16,textPadding:8,radius:6})}}},{key:"drawSelectBox",value:function(e,t){var n=e.data,r=void 0,a=void 0;if(Array.isArray(n.points)&&n.points.length>=2?(r=n.points[0],a=n.points[n.points.length-1]):n.sp&&n.ep&&(n.sp[0]===n.ep[0]&&n.sp[1]===n.ep[1]||(r=n.sp,a=n.ep)),n.inProgress&&r&&a){var i=(0,c.getBoundaryBoxFromTwoPoints)(r,a),o=i.sx,s=i.sy,u=i.w,l=i.h;t.beginPath(),this.strokeColor&&this.lineWidth&&(t.strokeStyle=this.strokeColor,t.lineWidth=this.lineWidth,t.strokeRect(o,s,u,l)),this.fillColor&&(t.fillStyle=this.fillColor,t.fillRect(o,s,u,l))}}},{key:"drawSelectedElementBox",value:function(e,n,a){var i=this,o=e.data,s=o.selectedOpIds.filter((function(e){return i.drawOpsOfPage[e]})),u=this.eleContainerPadding;if(0!==s.length){var l=s.map((function(e){var t=i.drawOpsOfPage[e];return(0,c.getTransformedBoundary)(t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)}));o.inProgress||(l=[l.reduce((function(e,t){return(0,c.combineBoundary)(e,t)}))]),n.strokeStyle=a,n.fillStyle=a,n.lineWidth=this.eleContainerWidth;var d=5/this.app.camera.scale,h=!0,f=!1,p=void 0;try{for(var v,y=(0,r.default)(l);!(h=(v=y.next()).done);h=!0){var g=v.value;n.beginPath(),n.strokeRect(g.sx-u,g.sy-u,g.w+2*u,g.h+2*u),!o.inProgress&&this.opsManager.currOp instanceof t&&(n.fillRect(g.sx-u-d/2,g.sy-u-d/2,d,d),n.fillRect(g.sx+g.w+u-d/2,g.sy+g.h+u-d/2,d,d),n.fillRect(g.sx+g.w+u-d/2,g.sy-u-d/2,d,d),n.fillRect(g.sx-u-d/2,g.sy+g.h+u-d/2,d,d))}}catch(e){f=!0,p=e}finally{try{!h&&y.return&&y.return()}finally{if(f)throw p}}return l}}},{key:"setSelectedOpIds",value:function(e){this.selectedOpIds.join(",")!==e.join(",")&&(this.emit("event:appState:change","selectChange",this.selectedOpIds.slice(),e.slice()),this.opsManager.hooks.selectChange.call(this.selectedOpIds.slice(),e.slice()),this.selectedOpIds=e,this.dispatch(this.getSnapshot(e.slice())))}},{key:"setInProgressSelectedOpIds",value:function(e){this.inProgressSelectedOpIds=e.slice()}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setFillColor",value:function(e){this.fillColor=e}},{key:"setStrokeColor",value:function(e){this.strokeColor=e}},{key:"setEleContainerColor",value:function(e){this.eleContainerColor=e}},{key:"setEleContainerWidth",value:function(e){this.eleContainerWidth=e}},{key:"setEleContainerPadding",value:function(e){this.eleContainerPadding=e}}]),t}(l.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FONTSIZE=void 0;var r=o(n(6)),a=o(n(16)),i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}t.DEFAULT_FONTSIZE=32;t.default=function e(t){var n=this;(0,i.default)(this,e),this.setAppConfig=function(e){var t;if(0===(0,a.default)(e).length)console.error("白板--\x3e","调用了setAppConfig, 但传入的参数为空",e);else for(var i in e)n.config.hasOwnProperty(i)?"canvas_bg_color"===i&&(n.config.canvas_bg_color=e.canvas_bg_color,n.app.container.setBackgroundColor(),null===(t=n.app.previewFactory)||void 0===t||t.setBackgroundColor()):(console.error("白板--\x3e","setAppConfig传入的参数键值"+i+"不是有效的配置项"),console.error("白板--\x3e","目前支持的配置项有："+(0,a.default)(n.config)));(0,r.default)(n.config,e)},this.getAppConfig=function(){return n.config},this.app=t,this.config={canvas_bg_color:"#f5f5f7"}}},function(e,t,n){e.exports=!n(14)&&!n(23)((function(){return 7!=Object.defineProperty(n(75)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){e.exports=n(20)},function(e,t,n){var r=n(24),a=n(26),i=n(122)(!1),o=n(66)("IE_PROTO");e.exports=function(e,t){var n,s=a(e),u=0,c=[];for(n in s)n!=o&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~i(c,n)||c.push(n));return c}},function(e,t,n){var r=n(24),a=n(25),i=n(66)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(18);e.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&r(i.call(e)),t}}},function(e,t,n){var r=n(31),a=n(10)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||i[a]===e)}},function(e,t,n){var r=n(46);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(89),a=n(68).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,a)}},function(e,t,n){var r=n(15),a=n(18),i=n(37);e.exports=n(14)?Object.defineProperties:function(e,t){a(e);for(var n,o=i(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(11).document;e.exports=r&&r.documentElement},function(e,t,n){"use strict";var r=n(49);function a(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new a(e)}},function(e,t,n){"use strict";var r=n(11),a=n(5),i=n(15),o=n(14),s=n(10)("species");e.exports=function(e){var t="function"==typeof a[e]?a[e]:r[e];o&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(10)("iterator"),a=!1;try{var i=[7][r]();i.return=function(){a=!0},Array.from(i,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var i=[7],o=i[r]();o.next=function(){return{done:n=!0}},i[r]=function(){return o},e(i)}catch(e){}return n}},function(e,t,n){e.exports={default:n(136),__esModule:!0}},function(e,t,n){"use strict";var r=n(15).f,a=n(50),i=n(77),o=n(19),s=n(76),u=n(43),c=n(63),l=n(91),d=n(99),h=n(14),f=n(60).fastKey,p=n(78),v=h?"_s":"size",y=function(e,t){var n,r=f(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){s(e,l,t,"_i"),e._t=t,e._i=a(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&u(r,n,e[c],e)}));return i(l.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=p(this,t),r=y(n,e);if(r){var a=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=a),a&&(a.p=i),n._f==r&&(n._f=a),n._l==r&&(n._l=i),n[v]--}return!!r},forEach:function(e){p(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(p(this,t),e)}}),h&&r(l.prototype,"size",{get:function(){return p(this,t)[v]}}),l},def:function(e,t,n){var r,a,i=y(e,t);return i?i.v=n:(e._l=i={i:a=f(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=i),r&&(r.n=i),e[v]++,"F"!==a&&(e._i[a]=i)),e},getEntry:y,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),d(t)}}},function(e,t,n){"use strict";var r=n(11),a=n(7),i=n(60),o=n(23),s=n(20),u=n(77),c=n(43),l=n(76),d=n(13),h=n(42),f=n(15).f,p=n(143)(0),v=n(14);e.exports=function(e,t,n,y,g,m){var w=r[e],b=w,_=g?"set":"add",k=b&&b.prototype,x={};return v&&"function"==typeof b&&(m||k.forEach&&!o((function(){(new b).entries().next()})))?(b=t((function(t,n){l(t,b,e,"_c"),t._c=new w,null!=n&&c(n,g,t[_],t)})),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in k)||m&&"clear"==e||s(b.prototype,e,(function(n,r){if(l(this,b,e),!t&&m&&!d(n))return"get"==e&&void 0;var a=this._c[e](0===n?0:n,r);return t?this:a}))})),m||f(b.prototype,"size",{get:function(){return this._c.size}})):(b=y.getConstructor(t,e,g,_),u(b.prototype,n),i.NEED=!0),h(b,e),x[e]=b,a(a.G+a.W+a.F,x),m||y.setStrong(b,e,g),b}},function(e,t,n){var r=n(57),a=n(147);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return a(this)}}},function(e,t,n){"use strict";var r=n(7);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var r=n(7),a=n(49),i=n(19),o=n(43);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,s,u=arguments[1];return a(this),(t=void 0!==u)&&a(u),null==e?new this:(n=[],t?(r=0,s=i(u,arguments[2],2),o(e,!1,(function(e){n.push(s(e,r++))}))):o(e,!1,n.push,n),new this(n))}})}},function(e,t,n){e.exports={default:n(159),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PlatformArray=["android","ios","pc","mac","pad","web"],t.TouchPlatformArray=["android","ios","pad"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelectedOpIds=t.opNeedRefresh=t.transformOp=void 0;var r,a=n(12),i=(r=a)&&r.__esModule?r:{default:r};t.transformOp=function(e,t,n){var r=e.opsManager.opMap[n.data.type];return"transformOp"in r?r.transformOp(t,n):t},t.opNeedRefresh=function(e){return"text"!==e.data.type&&((!["pen","select","laser","pen-arrow","line","line-arrow","rect","ellipse","text"].includes(e.data.type)||!e.data.inProgress)&&"mouse-pointer"!==e.data.type)},t.getSelectedOpIds=function(e){var t=[],n=e.lastSelectOfUser[e.app.account];if(n)for(var r in t=n.data.selectedOpIds.slice(),e.lastSelectOfUser)if(e.lastSelectOfUser[r].time>n.time){var a=e.lastSelectOfUser[r].data.selectedOpIds.slice(),o=!0,s=!1,u=void 0;try{for(var c,l=(0,i.default)(a);!(o=(c=l.next()).done);o=!0){var d=c.value,h=t.indexOf(d);-1!==h&&t.splice(h,1)}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}}return t=t.filter((function(t){return e.drawOpQueue.hasOwnProperty(t)&&!e.drawOpQueue[t].data.locked}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.transitionToCameraBound=function(e,t,n){var a=t,i=e.centerX,o=e.centerY,s=e.width,u=e.height,c=e.app.isRecordPlayer?1:15;r({total:c,worker:function(t){var n=(t+1)/c;e.setCameraBound({centerX:a.centerX*n+i*(1-n),centerY:a.centerY*n+o*(1-n),width:a.width*n+s*(1-n),height:a.height*n+u*(1-n)})},callback:n})};var r=t.animate=function(e){cancelAnimationFrame(void 0),a(0,e)},a=function e(t,n){t>=n.total?"function"==typeof n.callback&&n.callback():requestAnimationFrame((function(){n.worker(t),e(t+1,n)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.WActions=void 0;!function(e){e[e.VERSION=0]="VERSION",e[e.START=1]="START",e[e.MOVE=2]="MOVE",e[e.END=3]="END",e[e.REVOKE=4]="REVOKE",e[e.SERIAL=5]="SERIAL",e[e.CLEAR=6]="CLEAR",e[e.CLEAR_ACK=7]="CLEAR_ACK",e[e.SYNC_REQUEST=8]="SYNC_REQUEST",e[e.SYNC=9]="SYNC",e[e.SYNC_PREPARE=10]="SYNC_PREPARE",e[e.SYNC_PREPARE_ACK=11]="SYNC_PREPARE_ACK",e[e.LASER_PEN=12]="LASER_PEN",e[e.LASER_PEN_END=13]="LASER_PEN_END",e[e.FILE=14]="FILE",e[e.REDO=15]="REDO",e[e.CALIBRATE=16]="CALIBRATE",e[e.TEXT=17]="TEXT"}(r||(t.WActions=r={}));t.StateRelatedActions=[r.CALIBRATE,r.FILE];var a=t.WB_MODE=void 0;!function(e){e[e.readonly=-1]="readonly",e[e.draw=1]="draw"}(a||(t.WB_MODE=a={}));var i=t.WB_TOOL=void 0;!function(e){e[e.flag=-1]="flag",e[e.free=1]="free",e[e.line=2]="line",e[e.rect=3]="rect",e[e.solidRect=4]="solidRect",e[e.roundRect=5]="roundRect",e[e.solidRoundRect=6]="solidRoundRect",e[e.circle=7]="circle",e[e.solidCircle=8]="solidCircle",e[e.ellipse=9]="ellipse",e[e.solidEllipse=10]="solidEllipse",e[e.fill=11]="fill",e[e.text=12]="text",e[e.erase=13]="erase"}(i||(t.WB_TOOL=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VersionAction=t.TextAction=t.CalibrateAction=t.RedoAction=t.FileAction=t.LaserPenEndAction=t.LaserPenAction=t.SyncPrepareAckAction=t.SyncPrepareAction=t.SyncAction=t.SyncRequestAction=t.ClearAckAction=t.ClearAction=t.SerialAction=t.RevokeAction=t.EndAction=t.MoveAction=t.StartAction=void 0;var r=h(n(44)),a=h(n(6)),i=h(n(2)),o=h(n(1)),s=h(n(3)),u=h(n(4)),c=h(n(0)),l=h(n(35)),d=n(111);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){return 0===e||e<0?"0":1===e||e>1?"1":e.toFixed(4).slice(2)},p=function(e){return"0"===e?0:"1"===e?1:parseFloat("0."+e)},v=function(e,t){return"string"==typeof e?e:(0,l.default)(e,t).replace(/;/gm,"；").replace(/,/gm,"，").replace(/:/gm,"¦")},y=function(e){var t=e.replace(/；/gm,";").replace(/，/gm,",").replace(/¦/gm,":");return JSON.parse(t)},g=function e(){(0,c.default)(this,e)},m=t.StartAction=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.x=e,r.y=n,r.TYPE=d.WActions.START,r}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=f(this.x),t=f(this.y);return this.TYPE+":"+e+","+t}}],[{key:"fromString",value:function(e){var n=e.split(",");return new t(p(n[0]),p(n[1]))}}]),t}(g);t.MoveAction=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.x=e,r.y=n,r.TYPE=d.WActions.MOVE,r}return(0,u.default)(t,e),(0,o.default)(t,null,[{key:"fromString",value:function(e){var n=e.split(",");return new t(p(n[0]),p(n[1]))}}]),t}(m),t.EndAction=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.x=e,r.y=n,r.TYPE=d.WActions.END,r}return(0,u.default)(t,e),(0,o.default)(t,null,[{key:"fromString",value:function(e){var n=e.split(",");return new t(p(n[0]),p(n[1]))}}]),t}(m),t.RevokeAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.REVOKE,e.TYPE=d.WActions.REVOKE,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(g),t.SerialAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SERIAL,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(g),t.ClearAction=function(e){function t(e){(0,c.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.TYPE=d.WActions.CLEAR,Array.isArray(e)?n.accounts=e:n.accounts=e?[e]:[],n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=v(this.accounts);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){return new t(y(e))}}]),t}(g),t.ClearAckAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.CLEAR_ACK,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return this.TYPE+":"}}],[{key:"fromString",value:function(e){return new t}}]),t}(g),t.SyncRequestAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SYNC_REQUEST,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(g),t.SyncAction=function(e){function t(e){(0,c.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.sync=e,n.TYPE=d.WActions.SYNC,n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=this.sync,t=v(e);return this.TYPE+":"+t}}],[{key:"fromString",value:function(e){return new t(y(e))}}]),t}(g),t.SyncPrepareAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SYNC_PREPARE,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=v(this,[""]);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){return new t}}]),t}(g),t.SyncPrepareAckAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.SYNC_PREPARE_ACK,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return this.TYPE+":"}}],[{key:"fromString",value:function(e){return new t}}]),t}(g),t.LaserPenAction=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.x=e,r.y=n,r.TYPE=d.WActions.LASER_PEN,r}return(0,u.default)(t,e),(0,o.default)(t,null,[{key:"fromString",value:function(e){var n=e.split(",");return new t(+n[0],+n[1])}}]),t}(m),t.LaserPenEndAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.LASER_PEN_END,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return this.TYPE+":"}}],[{key:"fromString",value:function(e){return new t}}]),t}(g);(t.FileAction=function(e){function t(e){(0,c.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.file=e,n.TYPE=d.WActions.FILE,n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=this.file,t=void 0;return t="img"===e.type?"0":"h5"===e.type?"1":"-1",this.TYPE+":"+(e.docId||"")+","+(e.currentPage||"")+","+(e.pageCount||"")+","+t+","+(e.url||"")+","+(e.urlStr||"")+","+(e.h5Cmd||"")}}],[{key:"fromString",value:function(e){var n=e.split(","),r=void 0;return r="0"===n[3]?"img":"1"===n[3]?"h5":"clear",new t({docId:n[0]||"",currentPage:parseInt(n[1]||"1"),pageCount:parseInt(n[2]||"1"),type:r||"img",url:n[4]||"",urlStr:n[5]||"",h5Cmd:n[6]||""})}},{key:"immuteUpdate",value:function(e,n){var r={},a={};return t.PROPS.forEach((function(t){var i=e[t],o=n[t];void 0===o||""===o?r[t]=i:o!==i?(a[t]=o,r[t]=o):r[t]=i})),[r,a]}}]),t}(g)).PROPS=["docId","currentPage","pageCount","type","url","urlStr","h5Cmd"];t.RedoAction=function(e){function t(){(0,c.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.TYPE=d.WActions.REDO,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){return""+this.TYPE}}],[{key:"fromString",value:function(e){return new t}}]),t}(g);var w=t.CalibrateAction=function(e){function t(e){(0,c.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.TYPE=d.WActions.CALIBRATE,(0,a.default)(n,e),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=v(this,t.PROPS);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){return new t(y(e))}}]),t}(g);w.USER_PROPS=["mode","tool","size","color","fontsize","isMouseDown","keyDown","flagPos"],w.PROPS=[].concat((0,r.default)(w.USER_PROPS),["altKey","shiftKey","which","ctrlKey"],["ownerCanvasHeight","ownerCanvasWidth"]),(t.TextAction=function(e){function t(e,n,r){(0,c.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return a.x=e,a.y=n,a.text=r,a.TYPE=d.WActions.TEXT,a}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=v(this,t.PROPS);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){var n=y(e);return new t(n.x,n.y,n.text)}}]),t}(g)).PROPS=["x","y","text"],(t.VersionAction=function(e){function t(e){var n=e.ver,r=e.account,a=e.gzip;(0,c.default)(this,t);var o=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return o.TYPE=d.WActions.VERSION,o.ver=n,o.account=r,o.gzip=a,o}return(0,u.default)(t,e),(0,o.default)(t,[{key:"toString",value:function(){var e=v(this,t.PROPS);return this.TYPE+":"+e}}],[{key:"fromString",value:function(e){var n=y(e);return new t({ver:n.ver,account:n.account,gzip:n.gzip})}}]),t}(g)).PROPS=["ver","account","gzip"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=function(e,t,n){e.addEventListener(t,n)},t.off=function(e,t,n){e.removeEventListener(t,n)}},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,d=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&f())}function f(){if(!l){var e=s(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(11),a=n(24),i=n(14),o=n(7),s=n(88),u=n(60).KEY,c=n(23),l=n(67),d=n(42),h=n(52),f=n(10),p=n(70),v=n(71),y=n(156),g=n(94),m=n(18),w=n(13),b=n(25),_=n(26),k=n(64),x=n(36),M=n(50),S=n(116),C=n(82),O=n(72),A=n(15),I=n(37),P=C.f,T=A.f,E=S.f,D=r.Symbol,R=r.JSON,N=R&&R.stringify,z=f("_hidden"),j=f("toPrimitive"),L={}.propertyIsEnumerable,B=l("symbol-registry"),F=l("symbols"),U=l("op-symbols"),W=Object.prototype,H="function"==typeof D&&!!O.f,Y=r.QObject,Q=!Y||!Y.prototype||!Y.prototype.findChild,Z=i&&c((function(){return 7!=M(T({},"a",{get:function(){return T(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=P(W,t);r&&delete W[t],T(e,t,n),r&&e!==W&&T(W,t,r)}:T,X=function(e){var t=F[e]=M(D.prototype);return t._k=e,t},K=H&&"symbol"==typeof D.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof D},V=function(e,t,n){return e===W&&V(U,t,n),m(e),t=k(t,!0),m(n),a(F,t)?(n.enumerable?(a(e,z)&&e[z][t]&&(e[z][t]=!1),n=M(n,{enumerable:x(0,!1)})):(a(e,z)||T(e,z,x(1,{})),e[z][t]=!0),Z(e,t,n)):T(e,t,n)},G=function(e,t){m(e);for(var n,r=y(t=_(t)),a=0,i=r.length;i>a;)V(e,n=r[a++],t[n]);return e},q=function(e){var t=L.call(this,e=k(e,!0));return!(this===W&&a(F,e)&&!a(U,e))&&(!(t||!a(this,e)||!a(F,e)||a(this,z)&&this[z][e])||t)},J=function(e,t){if(e=_(e),t=k(t,!0),e!==W||!a(F,t)||a(U,t)){var n=P(e,t);return!n||!a(F,t)||a(e,z)&&e[z][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=E(_(e)),r=[],i=0;n.length>i;)a(F,t=n[i++])||t==z||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===W,r=E(n?U:_(e)),i=[],o=0;r.length>o;)!a(F,t=r[o++])||n&&!a(W,t)||i.push(F[t]);return i};H||(s((D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===W&&t.call(U,n),a(this,z)&&a(this[z],e)&&(this[z][e]=!1),Z(this,e,x(1,n))};return i&&Q&&Z(W,e,{configurable:!0,set:t}),X(e)}).prototype,"toString",(function(){return this._k})),C.f=J,A.f=V,n(95).f=S.f=$,n(53).f=q,O.f=ee,i&&!n(41)&&s(W,"propertyIsEnumerable",q,!0),p.f=function(e){return X(f(e))}),o(o.G+o.W+o.F*!H,{Symbol:D});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)f(te[ne++]);for(var re=I(f.store),ae=0;re.length>ae;)v(re[ae++]);o(o.S+o.F*!H,"Symbol",{for:function(e){return a(B,e+="")?B[e]:B[e]=D(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){Q=!0},useSimple:function(){Q=!1}}),o(o.S+o.F*!H,"Object",{create:function(e,t){return void 0===t?M(e):G(M(e),t)},defineProperty:V,defineProperties:G,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var ie=c((function(){O.f(1)}));o(o.S+o.F*ie,"Object",{getOwnPropertySymbols:function(e){return O.f(b(e))}}),R&&o(o.S+o.F*(!H||c((function(){var e=D();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],a=1;arguments.length>a;)r.push(arguments[a++]);if(n=t=r[1],(w(t)||void 0!==e)&&!K(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!K(t))return t}),r[1]=t,N.apply(R,r)}}),D.prototype[j]||n(20)(D.prototype,j,D.prototype.valueOf),d(D,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},function(e,t,n){var r=n(26),a=n(95).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==i.call(e)?function(e){try{return a(e)}catch(e){return o.slice()}}(e):a(r(e))}},function(e,t,n){e.exports={default:n(178),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=t.pako=void 0;var r=i(n(29)),a=n(284);function i(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;if(!e)return o.INVALID;var n=void 0;if(16===t){var r=+e;return r<0?(n=s(r),console.log("hex2rgb",r,n),n):((n=r.toString(16)).length<3&&(n=("000"+n).slice(-3)),n.length>3&&n.length<6&&(n=("000"+n).slice(-6)),n="#"+n)}return 10===t?(n=e.replace(/#/gi,""),n=parseInt("0x"+n),isNaN(n)?o.INVALID:""+n):o.INVALID}function s(e){var t=e>>8&255,n=255&e,r=(e>>16&255).toString(16),a=t.toString(16),i=n.toString(16);return console.log("rgb",r,a,i),"#"+("0"+r).slice(-2)+("0"+a).slice(-2)+("0"+i).slice(-2)}Object.defineProperty(t,"pako",{enumerable:!0,get:function(){return i(a).default}}),t.formatColor=o,t.hex2rgb=s,t.getKiloBytes=function(e){if("number"==typeof e)return 2*e/1024;if("string"==typeof e)return 2*e.length/1024;return 0},t.sign=function(e){return e?e<0?-1:1:0},o.INVALID="++bad-color++";t.sleep=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return new r.default((function(t){setTimeout(t,e)}))}},,function(e,t,n){var r=n(61),a=n(62);e.exports=function(e){return function(t,n){var i,o,s=String(a(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(i=s.charCodeAt(u))<55296||i>56319||u+1===c||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):i:e?s.slice(u,u+2):o-56320+(i-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(50),a=n(36),i=n(42),o={};n(20)(o,n(10)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(o,{next:a(1,n)}),i(e,t+" Iterator")}},function(e,t,n){var r=n(26),a=n(51),i=n(123);e.exports=function(e){return function(t,n,o){var s,u=r(t),c=a(u.length),l=i(o,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(61),a=Math.max,i=Math.min;e.exports=function(e,t){return(e=r(e))<0?a(e+t,0):i(e,t)}},function(e,t,n){"use strict";var r=n(125),a=n(91),i=n(31),o=n(26);e.exports=n(63)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t,n){var r=n(18),a=n(49),i=n(10)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[i])?t:a(n)}},function(e,t,n){var r,a,i,o=n(19),s=n(201),u=n(97),c=n(75),l=n(11),d=l.process,h=l.setImmediate,f=l.clearImmediate,p=l.MessageChannel,v=l.Dispatch,y=0,g={},m=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},w=function(e){m.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++y]=function(){s("function"==typeof e?e:Function(e),t)},r(y),y},f=function(e){delete g[e]},"process"==n(46)(d)?r=function(e){d.nextTick(o(m,e,1))}:v&&v.now?r=function(e){v.now(o(m,e,1))}:p?(i=(a=new p).port2,a.port1.onmessage=w,r=o(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",w,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),m.call(e)}}:function(e){setTimeout(o(m,e,1),0)}),e.exports={set:h,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(18),a=n(13),i=n(98);e.exports=function(e,t){if(r(e),a(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){n(131);var r=n(5).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(7);r(r.S+r.F*!n(14),"Object",{defineProperty:n(15).f})},function(e,t,n){n(133),e.exports=n(5).Object.keys},function(e,t,n){var r=n(25),a=n(37);n(58)("keys",(function(){return function(e){return a(r(e))}}))},function(e,t,n){n(38),n(30),e.exports=n(135)},function(e,t,n){var r=n(18),a=n(69);e.exports=n(5).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){n(30),n(137),e.exports=n(5).Array.from},function(e,t,n){"use strict";var r=n(19),a=n(7),i=n(25),o=n(92),s=n(93),u=n(51),c=n(138),l=n(69);a(a.S+a.F*!n(100)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,a,d,h=i(e),f="function"==typeof this?this:Array,p=arguments.length,v=p>1?arguments[1]:void 0,y=void 0!==v,g=0,m=l(h);if(y&&(v=r(v,p>2?arguments[2]:void 0,2)),null==m||f==Array&&s(m))for(n=new f(t=u(h.length));t>g;g++)c(n,g,y?v(h[g],g):h[g]);else for(d=m.call(h),n=new f;!(a=d.next()).done;g++)c(n,g,y?o(d,v,[a.value,g],!0):a.value);return n.length=g,n}})},function(e,t,n){"use strict";var r=n(15),a=n(36);e.exports=function(e,t,n){t in e?r.f(e,t,a(0,n)):e[t]=n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.min=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.min(e,t)}))},t.max=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.max(e,t)}))}},function(e,t,n){var r=n(5),a=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},function(e,t,n){n(56),n(30),n(38),n(142),n(146),n(148),n(149),e.exports=n(5).Set},function(e,t,n){"use strict";var r=n(102),a=n(78);e.exports=n(103)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(a(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){var r=n(19),a=n(65),i=n(25),o=n(51),s=n(144);e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,d=6==e,h=5==e||d,f=t||s;return function(t,s,p){for(var v,y,g=i(t),m=a(g),w=r(s,p,3),b=o(m.length),_=0,k=n?f(t,b):u?f(t,0):void 0;b>_;_++)if((h||_ in m)&&(y=w(v=m[_],_,g),e))if(n)k[_]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return _;case 2:k.push(v)}else if(l)return!1;return d?-1:c||l?l:k}}},function(e,t,n){var r=n(145);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(13),a=n(94),i=n(10)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),r(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var r=n(7);r(r.P+r.R,"Set",{toJSON:n(104)("Set")})},function(e,t,n){var r=n(43);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){n(105)("Set")},function(e,t,n){n(106)("Set")},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(27),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.resultReturns,a=e.onDone,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onResult:function(e,t,r){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+r()+"}\n"},resultReturns:r,onDone:a,rethrowIfPossible:i})}}]),t}(n(33))),d=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncBailHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncBailHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){n(152),e.exports=n(5).Object.getPrototypeOf},function(e,t,n){var r=n(25),a=n(90);n(58)("getPrototypeOf",(function(){return function(e){return a(r(e))}}))},function(e,t,n){e.exports={default:n(154),__esModule:!0}},function(e,t,n){n(30),n(38),e.exports=n(70).f("iterator")},function(e,t,n){n(115),n(56),n(157),n(158),e.exports=n(5).Symbol},function(e,t,n){var r=n(37),a=n(72),i=n(53);e.exports=function(e){var t=r(e),n=a.f;if(n)for(var o,s=n(e),u=i.f,c=0;s.length>c;)u.call(e,o=s[c++])&&t.push(o);return t}},function(e,t,n){n(71)("asyncIterator")},function(e,t,n){n(71)("observable")},function(e,t,n){n(160),e.exports=n(5).Object.setPrototypeOf},function(e,t,n){var r=n(7);r(r.S,"Object",{setPrototypeOf:n(161).set})},function(e,t,n){var r=n(13),a=n(18),i=function(e,t){if(a(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(19)(Function.call,n(82).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return i(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:i}},function(e,t,n){n(163);var r=n(5).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){var r=n(7);r(r.S,"Object",{create:n(50)})},function(e,t,n){n(165),e.exports=n(5).Object.assign},function(e,t,n){var r=n(7);r(r.S+r.F,"Object",{assign:n(166)})},function(e,t,n){"use strict";var r=n(14),a=n(37),i=n(72),o=n(53),s=n(25),u=n(65),c=Object.assign;e.exports=!c||n(23)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=s(e),c=arguments.length,l=1,d=i.f,h=o.f;c>l;)for(var f,p=u(arguments[l++]),v=d?a(p).concat(d(p)):a(p),y=v.length,g=0;y>g;)f=v[g++],r&&!h.call(p,f)||(n[f]=p[f]);return n}:c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(44)),a=f(n(6)),i=f(n(2)),o=f(n(0)),s=f(n(1)),u=f(n(3)),c=f(n(4)),l=n(17),d=f(n(84)),h=f(n(40));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="pen",e.description="涂鸦操作工具。\n首先使用op:pen:activate设置画布为涂鸦模式。通过op:pen:lineWidth, op:pen:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t=this.momentumPoints,n={boundary:this.getBoundaryRect()},r=this.opsManager.currPage.getOpId(),i=this.app.room.opIdSnapshotMap[r];return i&&i.snapshot.hasOwnProperty("category")?this.sampleSeq>0&&e?(0,a.default)((0,a.default)({},n),{points:t.slice(t.length-h.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,a.default)((0,a.default)({},n),{points:t.slice(t.length-h.default.pointsPerBatch),total:t.length,inProgress:e}):(0,a.default)((0,a.default)({},n),{type:this.type,points:t.slice(),color:this.color,lineWidth:this.lineWidth,total:t.length,inProgress:e}):(0,a.default)((0,a.default)({},n),{type:this.type,points:t.slice(),color:this.color,lineWidth:this.lineWidth,inProgress:e,total:t.length})}},{key:"getBoundaryRect",value:function(){return this.getBoundaryRectOfFreeDraw()}},{key:"draw",value:function(e,t){var n=e.data,a=n.points;t.beginPath();var i=(0,l.getTransformedPoint)(a[0],n.dx,n.dy,n.scaleX,n.scaleY);t.moveTo.apply(t,(0,r.default)(i));for(var o=1;o<a.length;o++){var s=(0,l.getTransformedPoint)(a[o],n.dx,n.dy,n.scaleX,n.scaleY);t.lineTo.apply(t,(0,r.default)(s))}t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke()}},{key:"ifMouseOnOp",value:function(e,t,n){var a=this.app.container.ctx,i=e.data,o=i.points;a.beginPath(),a.moveTo.apply(a,(0,r.default)((0,l.getTransformedPoint)(o[0],i.dx,i.dy,i.scaleX,i.scaleY)));for(var s=1;s<o.length;s++)a.lineTo.apply(a,(0,r.default)((0,l.getTransformedPoint)(o[s],i.dx,i.dy,i.scaleX,i.scaleY)));return a.lineWidth=i.lineWidth+20,a.strokeStyle="rgba(0,0,0,0)",a.stroke(),a.isPointInStroke(t,n)}},{key:"mergePartial",value:function(e,t){var n=this._mergePartial(e,t);return n.data.points.length!==n.data.total&&console.warn("merge ........",e,t),n}},{key:"_mergePartial",value:function(e,t){try{var n=t.data.total-e.data.total;if(0===n)return(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)((0,a.default)({},e.data),t.data),{points:e.data.points})});if(n<0)return e;if(n<=t.data.points.length){var r=t.data.points.length-n;return(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)((0,a.default)({},e.data),t.data),{points:e.data.points.concat(t.data.points.slice(r))})})}return console.warn("白板--\x3e mergePartial error",e,t),e}catch(n){return console.warn("白板--\x3e mergePartial error",e,t),e}}}]),t}(d.default);t.default=p},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMi41Mzg2IDIuNDYwMzRDMTMuMTUyNCAxLjg0NjU2IDE0LjE0NzUgMS44NDY1NSAxNC43NjEzIDIuNDYwMzRMMTcuNTM5NyA1LjIzODcxQzE4LjE1MzQgNS44NTI0OSAxOC4xNTM0IDYuODQ3NjIgMTcuNTM5NyA3LjQ2MTRMNy44MDEyMiAxNy4xOTk4QzcuNTQyMjIgMTcuNDU4OCA3LjIwMDkgMTcuNjE5MiA2LjgzNjIyIDE3LjY1MzRMMy4xODEyNyAxNy45OTUyQzIuNTA3MTMgMTguMDU4MiAxLjk0MTc2IDE3LjQ5MjkgMi4wMDQ4MSAxNi44MTg3TDIuMzQ2NjQgMTMuMTYzOEMyLjM4MDc1IDEyLjc5OTEgMi41NDExNSAxMi40NTc4IDIuODAwMTUgMTIuMTk4OEwxMi41Mzg2IDIuNDYwMzRaTTEzLjkyNzggMy4yOTM4NUMxMy43NzQzIDMuMTQwNCAxMy41MjU2IDMuMTQwNCAxMy4zNzIxIDMuMjkzODVMMy42MzM2NiAxMy4wMzIzQzMuNTY4OTEgMTMuMDk3IDMuNTI4ODEgMTMuMTgyNCAzLjUyMDI4IDEzLjI3MzVMMy4xODk0OSAxNi44MTA1TDYuNzI2NDYgMTYuNDc5N0M2LjgxNzYzIDE2LjQ3MTIgNi45MDI5NiAxNi40MzExIDYuOTY3NyAxNi4zNjYzTDE2LjcwNjIgNi42Mjc4OUMxNi44NTk2IDYuNDc0NDUgMTYuODU5NiA2LjIyNTY2IDE2LjcwNjIgNi4wNzIyMkwxMy45Mjc4IDMuMjkzODVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjYyMjQgOS41NDUxOEwxMC40NTQ4IDUuMzc3NjJMMTEuMjg4MyA0LjU0NDExTDE1LjQ1NTkgOC43MTE2N0wxNC42MjI0IDkuNTQ1MThaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(44)),a=d(n(6)),i=d(n(2)),o=d(n(0)),s=d(n(1)),u=d(n(3)),c=d(n(4)),l=n(17);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="line",e.description="绘制线段。\n首先使用op:line:activate设置画布为线段模式。通过op:line:lineWidth, op:line:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t={boundary:this.getBoundaryRect()};return(0,a.default)((0,a.default)({},t),{type:this.type,sp:this.sp,ep:this.ep,color:this.color,lineWidth:this.lineWidth,inProgress:e})}},{key:"getBoundaryRect",value:function(){return this.getBoundaryRectOfLine()}},{key:"draw",value:function(e,t){var n=e.data,a=this.getStartEndPointFromSnapshot(n),i=a.sp,o=a.ep;t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(i,n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(o,n.dx,n.dy,n.scaleX,n.scaleY))),t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke()}},{key:"ifMouseOnOp",value:function(e,t,n){var a=this.app.container.ctx,i=e.data,o=this.getStartEndPointFromSnapshot(i),s=o.sp,u=o.ep;return a.beginPath(),a.moveTo.apply(a,(0,r.default)((0,l.getTransformedPoint)(s,i.dx,i.dy,i.scaleX,i.scaleY))),a.lineTo.apply(a,(0,r.default)((0,l.getTransformedPoint)(u,i.dx,i.dy,i.scaleX,i.scaleY))),a.strokeStyle="rgba(0,0,0,0)",a.lineWidth=i.lineWidth+20,a.stroke(),a.isPointInStroke(t,n)}},{key:"getStartEndPointFromSnapshot",value:function(e){var t=void 0,n=void 0;return Array.isArray(e.points)?(t=e.points[0],n=e.points[e.points.length-1]):(t=e.sp,n=e.ep),{sp:t,ep:n}}}]),t}(d(n(84)).default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(8)),c=n(73),l=d(n(40));function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.points=[],e.lastSelectedOpIds=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"postMouseUp",value:function(e){}},{key:"postClick",value:function(e){}},{key:"postMouseMove",value:function(e,t){}},{key:"handleMouseDown",value:function(e,t,n){this.dispatch(this.getSelectionSnapshot(!1,[])),this.points=[[t,n]];var r=(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);this.dispatch(this.getSelectionSnapshot(!0,r)),this.lastSelectedOpIds=r}},{key:"handleMouseMove",value:function(e,t,n){this.isMouseDown?this.points.push([t,n]):this.points=[[t,n]];var r=void 0;if(this.isMouseDown)r=(0,c.findOpsUnderRect)(this.points,this.drawOpsOfPage),this.dispatch(this.getSelectionSnapshot(!0,r));else{var a=(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);r=(0,c.arrayDeduce)(a,this.opsManager.selectedOpIds),(0,c.idsChanged)(r,this.lastSelectedOpIds)&&this.dispatch(this.getSelectionSnapshot(!0,r,!0))}this.lastSelectedOpIds=r,this.postMouseMove(e,r)}},{key:"handleMouseUp",value:function(e,t,n){if(this.isMouseDown){var r=this.isMouseDown?(0,c.findOpsUnderRect)(this.points,this.drawOpsOfPage):(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);this.postMouseUp(r)}}},{key:"handleClick",value:function(e,t,n){this.points=[[t,n]];var r=(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);this.postClick(r)}},{key:"getSelectionSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{type:"select",sp:this.sp,ep:this.ep,inProgress:e,selectedOpIds:t.slice(),reuseOpType:n?"select-hover":"select",skipUndo:!0,color:l.default.strokeColor,nickname:this.app.nickname}}},{key:"sp",get:function(){return this.points.length>0?this.points[0]:void 0}},{key:"ep",get:function(){return this.points.length>0?this.points[this.points.length-1]:void 0}}]),t}(u.default);t.default=h},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var a,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(a=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(a)+")")}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBackgroundImagePorperPosition=t.getImageProperPosition=t.draw=t.addImage=void 0;var r=n(173),a=(t.addImage=function(e,t,n){var a=e.app.room.currBoard,i=e.opsManager.currPage;if(n&&n.hasOwnProperty("pageIndex")){var o=a.pageNames[n.pageIndex];a.pages.hasOwnProperty(o)&&(i=a.pages[o])}if((0,r.resourceLoaded)(t)){var s=(0,r.getResource)(t),u=(null==n?void 0:n.width)?n.width:s.width,c=(null==n?void 0:n.height)?n.height:s.height;e.dispatchImage(t,u,c,i)}else(null==n?void 0:n.width)&&(null==n?void 0:n.height)?e.dispatchImage(t,null==n?void 0:n.width,null==n?void 0:n.height,i):(i.addWaitingResource(t),(0,r.fetchResource)(t,(function(r){var a=(null==n?void 0:n.width)?n.width:r.width,o=(null==n?void 0:n.height)?n.height:r.height;e.dispatchImage(t,a,o,i),i.removeWaitingResource(t)})))},t.draw=function(e,t,n,i){var o=i.page,s=i.div,u=i.preview,c=i.id;if((0,r.resourceLoaded)(t)&&!u&&s&&c){var l=s.querySelector("[id='image-"+c+"']");l||((l="background"===i.type?(0,r.getResource)(t):(0,r.getResource)(t).cloneNode(!0)).id="image-"+c,l.style.userSelect="none",l.style.pointerEvents="none",l.style.position="absolute",l.style.imageRendering="-webkit-optimize-contrast",s.appendChild(l)),l.width=n.w,l.height=n.h,l.style.left=n.sx+"px",l.style.top=n.sy+"px";var d=a(n,i.page.app.camera);l.style.clipPath=d?"inset("+d.top+"px "+d.right+"px "+d.bottom+"px "+d.left+"px)":"none"}else(0,r.resourceLoaded)(t)?e.drawImage((0,r.getResource)(t),n.sx,n.sy,n.w,n.h):(0,r.resourceLoaded)("imageLoading")&&e.drawImage((0,r.getResource)("imageLoading"),n.sx+5,n.sy+5,Math.max(0,n.w-10),Math.max(0,n.h-10));(0,r.resourceLoaded)(t)||(o.addWaitingResource(t),(0,r.fetchResource)(t,(function(){o.removeWaitingResource(t)})))},function(e,t){var n=e.sx,r=e.sy,a=n+e.w,i=r+e.h,o=t.getContainerWorldRect(),s=Math.max(0,o.centerX-o.width/2-n),u=Math.max(0,a-(o.centerX+o.width/2)),c=Math.max(0,o.centerY-o.height/2-r),l=Math.max(0,i-(o.centerY+o.height/2));return s>0||u>0||c>0||l>0?{left:s,right:u,top:c,bottom:l}:null});t.getImageProperPosition=function(e,t,n){var r=e.app.container.width,a=e.app.container.height;return t>r&&n<a?(n=n*r/t,t=r):t<r&&n>a?(t=t*a/n,n=a):t>r&&n>a&&(t/n>r/a?(n=n*r/t,t=r):(t=t*a/n,n=a)),t/=e.app.camera.scale,n/=e.app.camera.scale,{sx:e.app.camera.centerX-t/2,sy:e.app.camera.centerY-n/2,width:t,height:n}},t.getBackgroundImagePorperPosition=function(e,t,n){return{sx:-t/2,sy:-n/2,width:t,height:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getResource=t.resourceLoaded=t.fetchResource=void 0;var r=i(n(12)),a=i(n(251));function i(e){return e&&e.__esModule?e:{default:e}}var o={},s={},u={},c=t.fetchResource=function(e,t){o.hasOwnProperty(e)||(o[e]=new Image,o[e].crossOrigin="Anonymous",o[e].src=e),"function"==typeof t&&l(e,t)},l=function(e,t){s[e]=s[e]||[],s[e].push(t);var n=o[e];n.onload=function(){var t=s[e]||[],a=!0,i=!1,o=void 0;try{for(var u,c=(0,r.default)(t);!(a=(u=c.next()).done);a=!0){(0,u.value)(n)}}catch(e){i=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw o}}},n.onerror=function(){if(u[e]||(u[e]=0),u[e]<10){delete o[e],delete s[e];var n=2e3*(u[e]+1);setTimeout((function(){console.log("白板--\x3e 图片加载失败，第"+u[e]+"次重新加载: "+e),c(e,t)}),n)}u[e]+=1}};t.resourceLoaded=function(e){var t=o[e];return t&&t.complete&&t.width>0&&t.height>0},t.getResource=function(e){return o[e]};o.imageLoading=new Image,o.imageLoading.src=a.default,o.imageLoading.setAttribute("crossorigin","anonymous")},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEuNDQyMjkiIHdpZHRoPSI4LjM4OTY3IiBoZWlnaHQ9IjE0LjY4MTkiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSAxMiAxLjQ0MjI5KSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuNTg0NSA4Ljg1Nzc5TDEwLjUxNjkgMTQuNzkwMiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuMjI0NjQgMTcuNjgxOEgxNS43NjA0IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(0)),a=o(n(1)),i=o(n(177));function o(e){return e&&e.__esModule?e:{default:e}}var s=void 0,u=function(){function e(){(0,r.default)(this,e)}return(0,a.default)(e,null,[{key:"createInstance",value:function(){return this._instance=this._instance||new i.default,this._instance}},{key:"show",value:function(e){var t=this,n=e.time,r=void 0===n?3:n;this._instance||this.createInstance(),this._instance.show(e),s&&clearTimeout(s),r&&(s=setTimeout((function(){t.hide()}),1e3*r))}},{key:"hide",value:function(){s&&clearTimeout(s),this._instance&&this._instance.hide()}},{key:"destory",value:function(){this._instance&&(this._instance.destroy(),this._instance=null)}}]),e}();t.default=u,u._instance=null},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(117)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}n(181);var s=function(){function e(){(0,a.default)(this,e),this.toastDiv=document.createElement("div"),this.toastDiv.className="whiteboard-toast",this.toastDiv.onclick=this.hide.bind(this),document.body.appendChild(this.toastDiv)}return(0,i.default)(e,[{key:"show",value:function(e){var t=this.toastDiv;t.style.display="block","warn"===e.type?(t.style.color="#8a6d3b",t.style.backgroundColor="#fcf8e3",t.style.borderColor="#faebcc"):"info"===e.type?(t.style.color="#31708f",t.style.backgroundColor="#d9edf7",t.style.borderColor="#bce8f1"):"error"===e.type?(t.style.color="#a94442",t.style.backgroundColor="#f2dede",t.style.borderColor="#ebccd1"):(t.style.color="#3c763d",t.style.backgroundColor="#dff0d8",t.style.borderColor="#d6e9c6"),(0,r.default)(e.top)&&(t.style.top=e.top+"px"),t.innerHTML=e.message}},{key:"hide",value:function(){this.toastDiv&&(this.toastDiv.style.display="none")}},{key:"destroy",value:function(){this.toastDiv&&(document.body.removeChild(this.toastDiv),this.toastDiv=null)}}]),e}();t.default=s},function(e,t,n){n(179),e.exports=n(5).Number.isInteger},function(e,t,n){var r=n(7);r(r.S,"Number",{isInteger:n(180)})},function(e,t,n){var r=n(13),a=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&a(e)===e}},function(e,t,n){var r=n(182);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(22)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(21)(!1)).push([e.i,".whiteboard-toast {\n    display: none;\n    position: fixed;\n    left: 50%;\n    transform: translate(-50%);\n    top: 200px;\n    padding: 8px 15px;\n    margin-bottom: 20px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    color: #3c763d;\n    background-color: #dff0d8;\n    border-color: #d6e9c6;\n    z-index: 100;\n}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"subMany",value:function(e){for(var t in e)this.on(t,e[t])}},{key:"destroy",value:function(){var e=this;this.eventNames().forEach((function(t){e.removeAllListeners(t)}))}}]),t}(u(n(34)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),a=s(n(1)),i=s(n(185)),o=n(187);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,n){(0,r.default)(this,e),this.pages={},this.pageNames=[],this.newPageIndex=1,this.app=t,this.dispatch=t.dispatcher,this.boardName=n,this.pages={0:new i.default(t,n,"0")},this.pageNames=["0"],this.currIndex=0}return(0,a.default)(e,[{key:"getCurrPageIndex",value:function(){return this.pageNames.indexOf(this.currIndex.toString())}},{key:"getPageBuiltInIndex",value:function(e){return Number(this.pageNames[e])}},{key:"addOpInBoard",value:function(e){var t=e.data,n=t.action,r=t.page,a=t.insertAfter;"add"===n&&(0,o.addPage)(this,a,e),"goto"===n&&(0,o.gotoPage)(this,r,e),"delete"===n&&(0,o.deletePage)(this,r,e),this.app.opsManager.hooks.addOpHook.call(e,!0)}},{key:"currPage",get:function(){return this.pages[this.currIndex]}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(0)),a=d(n(1)),i=n(173),o=n(193),s=n(186),u=n(272),c=n(109),l=n(273);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t,n,a){(0,r.default)(this,e),this.drawOpQueue={},this.hiddenOpQueue={},this.lastSelectOfUser={},this.lastInProgressSelectOfUser={},this.lastInProgressSnapshotOfUser={},this.lastMousePointerOfUser={},this.blockedResourceList=[],this._currOpId=(0,o.v4)(),this._nextOpId=(0,o.v4)(),this.app=t,this.opsManager=t.opsManager,this.boardName=n,this.pageIndex=a,window.page=this}return(0,a.default)(e,[{key:"prepareNewOpId",value:function(){this._currOpId=this._nextOpId,this._nextOpId=(0,o.v4)()}},{key:"getOpId",value:function(){return this.app.account+"-"+this._currOpId}},{key:"getNextOpId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?(this.prepareNewOpId(),this.getOpId()):this.app.account+"-"+this._nextOpId}},{key:"addWaitingResource",value:function(e){this.blockedResourceList.includes(e)||(0,i.resourceLoaded)(e)||this.blockedResourceList.push(e)}},{key:"removeWaitingResource",value:function(e){var t=this.blockedResourceList.indexOf(e);if(t>-1&&(this.blockedResourceList.splice(t,1),!this.blocked&&(this.app.opsManager.hooks.pageReady.call(this.boardName,this.pageIndex),this.isCurrPage)))return this.refresh()}},{key:"addOpInPage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"none"===e.opId?(console.error("白板--\x3e","snapshot no opid",e),!1):(this.lastInProgressSnapshotOfUser.hasOwnProperty(e.uid)&&!["mouse-pointer"].includes(e.data.type)&&(e.data.inProgress&&e.opId===this.lastInProgressSnapshotOfUser[e.uid].snapshot.opId||delete this.lastInProgressSnapshotOfUser[e.uid]),(0,c.opNeedRefresh)(e)&&this.calcDrawOpQueue(),this.app.room.isReceivingBatchSnapshots||((0,c.opNeedRefresh)(e)?(["undo","redo","clear"].includes(e.data.type)&&this.cleanNonCanvasElements(!1),t&&this.boardName===this.app.room.currIndex&&this.pageIndex===this.app.room.currBoard.currIndex.toString()&&this.refresh()):(0,l.addIncrementSnapshot)(this,e)),this.opsManager.hooks.addOpHook.call(e),(0,c.opNeedRefresh)(e))}},{key:"calcDrawOpQueue",value:function(){(0,u.calcDrawOpQueue)(this,this.app.room.isReceivingBatchSnapshots)}},{key:"cleanNonCanvasElements",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,s.cleanNonCanvasElements)(this,e)}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.refresh)(this,e)}},{key:"opQueue",get:function(){var e=this.app.room;try{return e.boardOps[this.boardName].pages[this.pageIndex].inPageSnapshotIds.map((function(t){return e.opIdSnapshotMap[t].snapshot}))}catch(e){return[]}}},{key:"isCurrPage",get:function(){return this.app.room.currBoard.currPage===this}},{key:"ctx",get:function(){return this.app.container.ctx}},{key:"frontCtx",get:function(){return this.app.container.frontCtx}},{key:"laserCtx",get:function(){return this.app.container.laserCtx}},{key:"width",get:function(){return this.app.container.width}},{key:"height",get:function(){return this.app.container.height}},{key:"blocked",get:function(){return this.blockedResourceList.length>0}}]),e}();t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawInProgressSnapshots=t.drawText=t.refresh=t.cleanNonCanvasElements=void 0;var r,a=n(16),i=(r=a)&&r.__esModule?r:{default:r};t.cleanNonCanvasElements=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.app.container&&e.app.container.imageEl&&(e.app.container.imageEl.innerHTML=""),e.app.container&&e.app.container.domEl&&(e.app.container.domEl.innerHTML=""),t&&e.app.container&&e.app.container.backgroundEl&&(e.app.container.backgroundEl.innerHTML="")},t.refresh=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.ctx,r=t.preview,a=t.cleanNonCanvasElements;n||(n=e.ctx);var i=r?n:e.frontCtx;if(e.opsManager.hooks.refresh.call(),a&&e.cleanNonCanvasElements(),n.save(),n.clearRect(0,0,e.width,e.height),e.app.camera.convertCanvas(n),r||(i.save(),e.laserCtx.save(),i.clearRect(0,0,e.width,e.height),e.laserCtx.clearRect(0,0,e.width,e.height),e.app.camera.convertCanvas(i),e.app.camera.convertCanvas(e.laserCtx)),e.backgroundSnapshot&&!r?e.opsManager.draw(e.backgroundSnapshot,n,{div:e.app.container.backgroundEl,page:e}):e.backgroundSnapshot&&e.opsManager.preview(e.backgroundSnapshot,n,{page:e}),o(e,i),r||s(e,e.laserCtx),r)for(var u in e.drawOpQueue)e.opsManager.preview(e.drawOpQueue[u],n,{page:e});else{for(var c in e.drawOpQueue){var l="image"===e.drawOpQueue[c].data.type?e.app.container.imageEl:e.app.container.domEl;e.opsManager.draw(e.drawOpQueue[c],n,{div:l,page:e})}for(var d in e.hiddenOpQueue){var h="image"===e.hiddenOpQueue[d].data.type?e.app.container.imageEl:e.app.container.domEl;e.opsManager.hide(e.hiddenOpQueue[d],n,h)}}n.restore(),e.frontCtx.restore(),r||e.laserCtx.restore()},t.drawText=function(e,t,n){(n=n||e.frontCtx).save(),e.app.camera.convertCanvas(n),e.opsManager.draw(t,n,{div:e.app.container.domEl,page:e}),n.restore()},t.drawInProgressSnapshots=function(e){e.laserCtx.save(),e.frontCtx.save(),e.laserCtx.clearRect(0,0,e.width,e.height),e.frontCtx.clearRect(0,0,e.width,e.height),e.app.camera.convertCanvas(e.laserCtx),e.app.camera.convertCanvas(e.frontCtx),(0,i.default)(e.lastInProgressSnapshotOfUser).map((function(t){return e.lastInProgressSnapshotOfUser[t]})).sort((function(e,t){return e.beginAt-t.beginAt})).forEach((function(t){e.opsManager.draw(t.snapshot,e.frontCtx,{div:e.app.container.domEl,page:e})})),o(e,e.frontCtx),s(e,e.laserCtx),e.laserCtx.restore(),e.frontCtx.restore()};var o=function(e,t){for(var n in e.lastSelectOfUser)e.opsManager.draw(e.lastSelectOfUser[n],t);for(var r in e.lastInProgressSelectOfUser)e.opsManager.draw(e.lastInProgressSelectOfUser[r],t)},s=function(e,t){for(var n in e.lastMousePointerOfUser){var r=e.lastMousePointerOfUser[n];e.opsManager.draw(r,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deletePage=t.gotoPage=t.addPage=void 0;var r=i(n(16)),a=i(n(185));function i(e){return e&&e.__esModule?e:{default:e}}t.addPage=function(e,t,n){e.pages[e.currIndex].cleanNonCanvasElements(),e.pages[e.newPageIndex]=new a.default(e.app,e.boardName,e.newPageIndex.toString()),t=void 0===t?e.pageNames.length-1:t,e.pageNames.splice(t+1,0,e.newPageIndex.toString()),e.app.room.isReceivingBatchSnapshots||(e.pages[e.newPageIndex].calcDrawOpQueue(),e.pages[e.newPageIndex].refresh()),e.currIndex=e.newPageIndex,e.newPageIndex+=1,e.app.opsManager.hooks.pageChange.call(n)},t.gotoPage=function(e,t,n){if(!e.pages.hasOwnProperty(t))throw new Error("跳转至不存在的页面");e.pages[e.currIndex].cleanNonCanvasElements(),e.currIndex=Number(t),e.app.opsManager.hooks.pageChange.call(n),e.app.room.isReceivingBatchSnapshots||(e.pages[t].calcDrawOpQueue(),e.pages[t].refresh())},t.deletePage=function(e,t,n){if(e.pages.hasOwnProperty(t))if(1===(0,r.default)(e.pages).length)console.error("白板--\x3e","不能删除最后一页");else{e.pages[e.currIndex].cleanNonCanvasElements(),delete e.pages[t];var a=e.pageNames.indexOf(t.toString());-1!==a&&e.pageNames.splice(a,1);var i=a;a===e.pageNames.length&&(i=a-1),e.currIndex=Number((0,r.default)(e.pages)[i]),e.app.opsManager.hooks.pageChange.call(n),e.app.room.isReceivingBatchSnapshots||(e.pages[e.currIndex].calcDrawOpQueue(),e.pages[e.currIndex].refresh())}else console.error("白板--\x3e","删除页面:"+t+", 但是页面不存在")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getCameraBoundFromGlobalOp=function(e,t){var n=e.app.camera,r=e.app.vision;if("camera-bound"===t.data.type){if(n.cameraBoundByUser[t.uid]=t.data.boundary,"freeObserver"===r.mode&&t.uid===e.app.account)return t.data.boundary;if("broadcaster"===r.mode&&t.uid===e.app.account)return t.data.boundary;if("follower"===r.mode&&t.uid===r.broadcaster)return t.data.boundary;if("follower"===r.mode&&t.uid===e.app.account)return t.data.boundary}return null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(35)),a=s(n(16)),i=s(n(6)),o=s(n(39));function s(e){return e&&e.__esModule?e:{default:e}}t.default={isUndefined:function(e){return void 0===e},isDOM:function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,o.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,o.default)(e))&&1===e.nodeType&&"string"==typeof e.nodeName},isValidString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isValidArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isValidHexColor:function(e){return/^#[0-9abcdef]{6}$/gi.test(e)},isObject:function(e){return"object"===(void 0===e?"undefined":(0,o.default)(e))},isValidObject:function(e){if("object"!==(void 0===e?"undefined":(0,o.default)(e)))return!1;if(e=(0,i.default)({},e),a.default&&0===(0,a.default)(e).length)return!1;try{return"{}"!==(0,r.default)(e)}catch(e){return!1}},validate:function(e,t,n){var i=this,o=[];(0,a.default)(n).map((function(e){var a=n[e],s=t[e];if(i.isUndefined(s))a.isRequire&&o.push({key:e,message:e+" is required"});else{switch(a.type.toLowerCase()){case"dom":i.isDOM(s)||o.push({key:e,message:"Expected dom, but get other type"});break;case"string":i.isValidString(s)||o.push({key:e,message:"Expected string, but get other type"});break;case"boolean":i.isBoolean(s)||o.push({key:e,message:"Expected boolean, but get other type"});break;case"function":i.isFunction(s)||o.push({key:e,message:"Expected function, but get other type"});break;case"number":i.isNumber(s)||o.push({key:e,message:"Expected number, but get other type"});break;case"object":i.isObject(s)||o.push({key:e,message:"Expected object, but get other type"});break;case"array":i.isValidArray(s)||o.push({key:e,message:"Expected array, but get other type"});break;default:o.push({key:e,message:e+"的类型未知: "+a.type.toLowerCase()})}a.enum&&!a.enum.includes(s)&&o.push({key:e,message:"Expected "+e+" to be one of "+(0,r.default)(a.enum)+", but it is not"})}})),o.length>0&&(console.error("白板--\x3e",e+"参数异常"),console.error("白板--\x3e","错误信息：",o),console.error("白板--\x3e","参数为：",t))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(34);var i=new((r=a)&&r.__esModule?r:{default:r}).default;t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLineStyle=u,t.setpixelated=c,t.setCavansStyleSize=function(e,t,n){var r=e.canvas;r.style.width=t+"px",r.style.height=n+"px"},t.setCanvasPropSize=function(e,t){var n=e.canvas,r=!1;0!=n.width&&0!=n.height||(r=!0);var a=document.createElement("canvas").getContext("2d");r||(a.canvas.width=n.width,a.canvas.height=n.height,c(a),u(a),a.drawImage(n,0,0,n.width,n.height));n.width=t.width,n.height=t.height,u(e),c(e),r||(c(a),e.drawImage(a.canvas,0,0,n.width,n.height))},t.applyCanvasLayout=function(e,t){var n=t.paddingLeft,r=t.paddingTop;e.style.left=n+"px",e.style.top=r+"px"},t.clearCtx=l,t.free=function(e,t,n,r,a,i){if(e.fillStyle=a,e.strokeStyle=a,e.beginPath(),t.x===r.x&&t.y===r.y)return void e.lineTo(t.x,t.y);e.moveTo(t.x,t.y),e.quadraticCurveTo(n.x,n.y,r.x,r.y),e.stroke(),s("free")},t.line=function(e,t,n,r){i.default.log("line",arguments),e.fillStyle=r,e.strokeStyle=r,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke(),s("line")},t.rect=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments[5];a?(e.fillStyle=i,e.fillRect(t.x,t.y,n,r)):e.strokeRect(t.x,t.y,n,r)},t.roundRect=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments[6],s=t.x,u=t.y,c=n<0?-a:a,l=r<0?-a:a;e.beginPath(),e.moveTo(s+c,u),e.lineTo(s+n-c,u),e.quadraticCurveTo(s+n,u,s+n,u+l),e.lineTo(s+n,u+r-l),e.quadraticCurveTo(s+n,u+r,s+n-c,u+r),e.lineTo(s+c,u+r),e.quadraticCurveTo(s,u+r,s,u+r-l),e.lineTo(s,u+l),e.quadraticCurveTo(s,u,s+c,u),e.stroke(),i&&(e.fillStyle=o,e.fill())},t.circle=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments[4];a&&(e.strokeStyle=a);e.beginPath(),e.arc(t.x,t.y,n,0,2*Math.PI),r&&(e.fillStyle=a,e.fill());e.stroke()},t.ellipse=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments[5];i&&(e.strokeStyle=i);e.beginPath(),e.ellipse(t.x,t.y,n,r,0,0,2*Math.PI),a&&(e.fillStyle=i,e.fill());e.stroke()},t.fill=function(e,t,n,a){var o=Math.round(t.x),s=Math.round(t.y);e.save(),e.beginPath();var h=e.getImageData(0,0,Math.round(e.canvas.width),Math.round(e.canvas.height)),f=h.height,p=h.width;a&&(a.ctx.canvas.width=p,a.ctx.canvas.height=f,c(a.ctx),u(a.ctx));var v=n||e.strokeStyle,y=parseInt(v.substr(1,2),16),g=parseInt(v.substr(3,2),16),m=(255<<24|parseInt(v.substr(5,2),16)<<16|g<<8|y)>>>0,w=[o,s],b=a.ctx.createImageData(p,f),_=new Uint32Array(b.data.buffer),k=new Uint32Array(h.data.buffer),x=k[s*p+o];if(0==(16777215&(x^m))&&x>>>24==m>>>24)return;var M=16777215&x,S=(255&M)>>>0,C=(65280&M)>>>8,O=(16711680&M)>>>16,A=(4278190080&x)>>>24,I=d(S-15),P=d(C-15),T=d(O-15),E=d(S+15),D=d(C+15),R=d(O+15),N=[w],z=void 0,j=p-1,L=f-1;function B(e){if(e===x)return!0;var t=(4278190080&e)>>>24;if(A<10&&0===t)return!0;var n=(16777215&e)>>>0,r=(255&n)>>>0,a=(65280&n)>>>8,i=(16711680&n)>>>16;return r>=I&&r<=E&&a>=P&&a<=D&&i>=T&&i<=R&&Math.abs(A-t)<10}var F={},U=new r.Coord(Math.round(p),Math.round(f)),W=new r.Coord(0,0),H=function(e,t){return t*p+e},Y=function(e,t){return k[H(e,t)]};for(;z=N.pop();){for(var Q=z[0],Z=z[1];--Z>=0&&B(Y(Q,Z)););Z++;for(var X=!1,K=!1;Z++<L&&B(Y(Q,Z));){U.topLeft(Q,Z),W.bottomRight(Q+1,Z+1);var V=H(Q,Z);k[V]=m,_[V]=m,F[V]=!0,Q>0&&!F[V-1]&&(B(k[V-1])?X||(N.push([Q-1,Z]),X=!0):X&&(X=!1)),Q<j&&!F[V+1]&&(B(k[V+1])?K||(F[V+1]||N.push([Q+1,Z]),K=!0):K&&(K=!1))}}var G=r.Coord.areaSize(U,W);i.default.log("fill area is ",G),i.default.log("fill corner is ",U,W),a.corner=[U,W],a.ctx.putImageData(b,0,0);var q=a.ctx.getImageData(U.x,U.y,G.width,G.height);i.default.log(q),a.ctx.canvas.height=q.height,a.ctx.canvas.width=q.width,c(a.ctx),u(a.ctx),a.ctx.putImageData(q,0,0),console.log("shape:",a.ctx.canvas.toDataURL()),l(e),i.default.image(e.canvas.toDataURL(),"ctx.canvas"),i.default.image(a.ctx.canvas.toDataURL(),"shape.ctx"),e.putImageData(h,0,0),console.error(a.ctx.canvas.toDataURL()),i.default.image(e.canvas.toDataURL(),"final"),a.ctx.beginPath(),e.restore()},t.text=function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments[5],o=t.x,s=t.y;e.beginPath(),e.moveTo(o,s),e.font=r+'px "微软雅黑",Arial',e.textBaseline="top",e.textAlign="left",a?(e.fillStyle=i,e.fillText(n,o,s)):e.strokeText(n,o,s);e.beginPath()};var r=n(198),a=o(n(196)),i=o(n(79));function o(e){return e&&e.__esModule?e:{default:e}}var s=(0,a.default)("DrawWorker/CanvasHelper");function u(e){e.lineCap="round",e.lineJoin="round"}function c(e){null!==e&&(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1)}function l(e){e.clearRect(-40,-40,e.canvas.width+80,e.canvas.height+80)}function d(e){return e<0?0:e>255?255:e}},,function(e,t,n){"use strict";var r;n.r(t),n.d(t,"v1",(function(){return v})),n.d(t,"v3",(function(){return S})),n.d(t,"v4",(function(){return C})),n.d(t,"v5",(function(){return I})),n.d(t,"NIL",(function(){return P})),n.d(t,"version",(function(){return T})),n.d(t,"validate",(function(){return s})),n.d(t,"stringify",(function(){return h})),n.d(t,"parse",(function(){return y}));var a=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(a)}var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var s=function(e){return"string"==typeof e&&o.test(e)},u=[],c=0;c<256;++c)u.push((c+256).toString(16).substr(1));var l,d,h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n},f=0,p=0;var v=function(e,t,n){var r=t&&n||0,a=t||new Array(16),o=(e=e||{}).node||l,s=void 0!==e.clockseq?e.clockseq:d;if(null==o||null==s){var u=e.random||(e.rng||i)();null==o&&(o=l=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==s&&(s=d=16383&(u[6]<<8|u[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:p+1,y=c-f+(v-p)/1e4;if(y<0&&void 0===e.clockseq&&(s=s+1&16383),(y<0||c>f)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=c,p=v,d=s;var g=(1e4*(268435455&(c+=122192928e5))+v)%4294967296;a[r++]=g>>>24&255,a[r++]=g>>>16&255,a[r++]=g>>>8&255,a[r++]=255&g;var m=c/4294967296*1e4&268435455;a[r++]=m>>>8&255,a[r++]=255&m,a[r++]=m>>>24&15|16,a[r++]=m>>>16&255,a[r++]=s>>>8|128,a[r++]=255&s;for(var w=0;w<6;++w)a[r+w]=o[w];return t||h(a)};var y=function(e){if(!s(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};var g=function(e,t,n){function r(e,r,a,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=y(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(r),o.set(e,r.length),(o=n(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,a){i=i||0;for(var s=0;s<16;++s)a[i+s]=o[s];return a}return h(o)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r};function m(e){return 14+(e+64>>>9<<4)+1}function w(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function b(e,t,n,r,a,i){return w((o=w(w(t,e),w(r,i)))<<(s=a)|o>>>32-s,n);var o,s}function _(e,t,n,r,a,i,o){return b(t&n|~t&r,e,t,a,i,o)}function k(e,t,n,r,a,i,o){return b(t&r|n&~r,e,t,a,i,o)}function x(e,t,n,r,a,i,o){return b(t^n^r,e,t,a,i,o)}function M(e,t,n,r,a,i,o){return b(n^(t|~r),e,t,a,i,o)}var S=g("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r=0;r<n;r+=8){var a=e[r>>5]>>>r%32&255,i=parseInt("0123456789abcdef".charAt(a>>>4&15)+"0123456789abcdef".charAt(15&a),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var n=1732584193,r=-271733879,a=-1732584194,i=271733878,o=0;o<e.length;o+=16){var s=n,u=r,c=a,l=i;n=_(n,r,a,i,e[o],7,-680876936),i=_(i,n,r,a,e[o+1],12,-389564586),a=_(a,i,n,r,e[o+2],17,606105819),r=_(r,a,i,n,e[o+3],22,-1044525330),n=_(n,r,a,i,e[o+4],7,-176418897),i=_(i,n,r,a,e[o+5],12,1200080426),a=_(a,i,n,r,e[o+6],17,-1473231341),r=_(r,a,i,n,e[o+7],22,-45705983),n=_(n,r,a,i,e[o+8],7,1770035416),i=_(i,n,r,a,e[o+9],12,-1958414417),a=_(a,i,n,r,e[o+10],17,-42063),r=_(r,a,i,n,e[o+11],22,-1990404162),n=_(n,r,a,i,e[o+12],7,1804603682),i=_(i,n,r,a,e[o+13],12,-40341101),a=_(a,i,n,r,e[o+14],17,-1502002290),r=_(r,a,i,n,e[o+15],22,1236535329),n=k(n,r,a,i,e[o+1],5,-165796510),i=k(i,n,r,a,e[o+6],9,-1069501632),a=k(a,i,n,r,e[o+11],14,643717713),r=k(r,a,i,n,e[o],20,-373897302),n=k(n,r,a,i,e[o+5],5,-701558691),i=k(i,n,r,a,e[o+10],9,38016083),a=k(a,i,n,r,e[o+15],14,-660478335),r=k(r,a,i,n,e[o+4],20,-405537848),n=k(n,r,a,i,e[o+9],5,568446438),i=k(i,n,r,a,e[o+14],9,-1019803690),a=k(a,i,n,r,e[o+3],14,-187363961),r=k(r,a,i,n,e[o+8],20,1163531501),n=k(n,r,a,i,e[o+13],5,-1444681467),i=k(i,n,r,a,e[o+2],9,-51403784),a=k(a,i,n,r,e[o+7],14,1735328473),r=k(r,a,i,n,e[o+12],20,-1926607734),n=x(n,r,a,i,e[o+5],4,-378558),i=x(i,n,r,a,e[o+8],11,-2022574463),a=x(a,i,n,r,e[o+11],16,1839030562),r=x(r,a,i,n,e[o+14],23,-35309556),n=x(n,r,a,i,e[o+1],4,-1530992060),i=x(i,n,r,a,e[o+4],11,1272893353),a=x(a,i,n,r,e[o+7],16,-155497632),r=x(r,a,i,n,e[o+10],23,-1094730640),n=x(n,r,a,i,e[o+13],4,681279174),i=x(i,n,r,a,e[o],11,-358537222),a=x(a,i,n,r,e[o+3],16,-722521979),r=x(r,a,i,n,e[o+6],23,76029189),n=x(n,r,a,i,e[o+9],4,-640364487),i=x(i,n,r,a,e[o+12],11,-421815835),a=x(a,i,n,r,e[o+15],16,530742520),r=x(r,a,i,n,e[o+2],23,-995338651),n=M(n,r,a,i,e[o],6,-198630844),i=M(i,n,r,a,e[o+7],10,1126891415),a=M(a,i,n,r,e[o+14],15,-1416354905),r=M(r,a,i,n,e[o+5],21,-57434055),n=M(n,r,a,i,e[o+12],6,1700485571),i=M(i,n,r,a,e[o+3],10,-1894986606),a=M(a,i,n,r,e[o+10],15,-1051523),r=M(r,a,i,n,e[o+1],21,-2054922799),n=M(n,r,a,i,e[o+8],6,1873313359),i=M(i,n,r,a,e[o+15],10,-30611744),a=M(a,i,n,r,e[o+6],15,-1560198380),r=M(r,a,i,n,e[o+13],21,1309151649),n=M(n,r,a,i,e[o+4],6,-145523070),i=M(i,n,r,a,e[o+11],10,-1120210379),a=M(a,i,n,r,e[o+2],15,718787259),r=M(r,a,i,n,e[o+9],21,-343485551),n=w(n,s),r=w(r,u),a=w(a,c),i=w(i,l)}return[n,r,a,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(m(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}));var C=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return h(r)};function O(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function A(e,t){return e<<t|e>>>32-t}var I=g("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var a=0;a<r.length;++a)e.push(r.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,o=Math.ceil(i/16),s=new Array(o),u=0;u<o;++u){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=e[64*u+4*l]<<24|e[64*u+4*l+1]<<16|e[64*u+4*l+2]<<8|e[64*u+4*l+3];s[u]=c}s[o-1][14]=8*(e.length-1)/Math.pow(2,32),s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<o;++d){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=s[d][f];for(var p=16;p<80;++p)h[p]=A(h[p-3]^h[p-8]^h[p-14]^h[p-16],1);for(var v=n[0],y=n[1],g=n[2],m=n[3],w=n[4],b=0;b<80;++b){var _=Math.floor(b/20),k=A(v,5)+O(_,y,g,m)+w+t[_]+h[b]>>>0;w=m,m=g,g=A(y,30)>>>0,y=v,v=k}n[0]=n[0]+v>>>0,n[1]=n[1]+y>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+w>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),P="00000000-0000-0000-0000-000000000000";var T=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},a=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<i;u=r[++n])v(u)||!b(u)?o+=" "+u:o+=" "+s(u);return o},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var a=!1;return function(){if(!a){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),a=!0}return n.apply(this,arguments)}};var i,o={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&x(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var a=n.inspect(r,e);return g(a)||(a=l(e,a,r)),a}var i=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(y(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,n);if(i)return i;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),k(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return d(n);if(0===o.length){if(x(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(w(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(_(n))return e.stylize(Date.prototype.toString.call(n),"date");if(k(n))return d(n)}var c,b="",M=!1,S=["{","}"];(f(n)&&(M=!0,S=["[","]"]),x(n))&&(b=" [Function"+(n.name?": "+n.name:"")+"]");return w(n)&&(b=" "+RegExp.prototype.toString.call(n)),_(n)&&(b=" "+Date.prototype.toUTCString.call(n)),k(n)&&(b=" "+d(n)),0!==o.length||M&&0!=n.length?r<0?w(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=M?function(e,t,n,r,a){for(var i=[],o=0,s=t.length;o<s;++o)A(t,String(o))?i.push(h(e,t,n,r,String(o),!0)):i.push("");return a.forEach((function(a){a.match(/^\d+$/)||i.push(h(e,t,n,r,a,!0))})),i}(e,n,r,s,o):o.map((function(t){return h(e,n,r,s,t,M)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,b,S)):S[0]+b+S[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,a,i){var o,s,u;if((u=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),A(r,a)||(o="["+a+"]"),s||(e.seen.indexOf(u.value)<0?(s=v(n)?l(e,u.value,null):l(e,u.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),m(o)){if(i&&a.match(/^\d+$/))return s;(o=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function g(e){return"string"==typeof e}function m(e){return void 0===e}function w(e){return b(e)&&"[object RegExp]"===M(e)}function b(e){return"object"==typeof e&&null!==e}function _(e){return b(e)&&"[object Date]"===M(e)}function k(e){return b(e)&&("[object Error]"===M(e)||e instanceof Error)}function x(e){return"function"==typeof e}function M(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(m(i)&&(i=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(i)){var r=e.pid;o[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else o[n]=function(){};return o[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=v,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=w,t.isObject=b,t.isDate=_,t.isError=k,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(214);var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),C[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",O(),t.format.apply(t,arguments))},t.inherits=n(215),t._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(I&&e[I]){var t;if("function"!=typeof(t=e[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,I,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),a=[],i=0;i<arguments.length;i++)a.push(arguments[i]);a.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,a)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),I&&Object.defineProperty(t,I,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=I,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var a=n.pop();if("function"!=typeof a)throw new TypeError("The last argument must be of type Function");var i=this,o=function(){return a.apply(i,arguments)};t.apply(this,n).then((function(t){e.nextTick(o,null,t)}),(function(t){e.nextTick(P,t,o)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(114))},function(e,t,n){e.exports={default:n(227),__esModule:!0}},function(e,t,n){"use strict";(function(t){void 0===t||"renderer"===t.type||!0===t.browser||t.__nwjs?e.exports=n(333):e.exports=n(335)}).call(this,n(114))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.packBulk=function(e){var t=e.map((function(e){return u(e)})).join(";")+";";return i.default.m.syncmanager("packBulk anyAction",t),t},t.pack=u,t.unpackBulk=function(e){var t=[];return e.split(";").forEach((function(e){var n=c(e);n&&t.push(n)})),t},t.unpack=c;var r,a=n(79),i=(r=a)&&r.__esModule?r:{default:r},o=n(111),s=n(112);function u(e,t){return i.default.m.syncmanager("pack anyAction",e),console.assert(void 0!==e.action,"ooops"),e.action.toString()}function c(e){if(e){var t=e.indexOf(":");i.default.m.syncmanager("unpack command ",e);var n=void 0,r=void 0;switch(-1==t?(n=+e,r=""):(n=+e.slice(0,t),r=e.slice(t+1,e.length)),i.default.command("unpack",e),n){case o.WActions.START:return s.StartAction.fromString(r);case o.WActions.MOVE:return s.MoveAction.fromString(r);case o.WActions.END:return s.EndAction.fromString(r);case o.WActions.REVOKE:return s.RevokeAction.fromString(r);case o.WActions.SERIAL:return s.SerialAction.fromString(r);case o.WActions.CLEAR:return s.ClearAction.fromString(r);case o.WActions.CLEAR_ACK:return s.ClearAckAction.fromString(r);case o.WActions.LASER_PEN:return s.LaserPenAction.fromString(r);case o.WActions.SYNC_REQUEST:return s.SyncRequestAction.fromString(r);case o.WActions.SYNC:return s.SyncAction.fromString(r);case o.WActions.SYNC_PREPARE:return s.SyncPrepareAction.fromString(r);case o.WActions.SYNC_PREPARE_ACK:return s.SyncPrepareAckAction.fromString(r);case o.WActions.LASER_PEN_END:return s.LaserPenEndAction.fromString(r);case o.WActions.FILE:return s.FileAction.fromString(r);case o.WActions.REDO:return s.RedoAction.fromString(r);case o.WActions.CALIBRATE:return s.CalibrateAction.fromString(r);case o.WActions.TEXT:return s.TextAction.fromString(r);case o.WActions.VERSION:return s.VersionAction.fromString(r);default:}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Coord=void 0;var r=i(n(0)),a=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var o=/\(x:([.\d]+),y:([.\d]+)\)/,s=function(){function e(t,n){(0,r.default)(this,e),this.x=t||0,this.y=n||0}return(0,a.default)(e,[{key:"destroy",value:function(){}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toString",value:function(){return"(x:"+this.x.toFixed(8)+",y:"+this.y.toFixed(8)+")"}},{key:"toCoord",value:function(e,t){return new u(this.x*e,this.y*t)}},{key:"copy",value:function(e){this.x=e.x,this.y=e.y}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"topLeft",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t<this.x&&(this.x=t),n<this.y&&(this.y=n)):t instanceof e&&this.topLeft(t.x,t.y),this}},{key:"bottomRight",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t>this.x&&(this.x=t),n>this.y&&(this.y=n)):t instanceof e&&this.bottomRight(t.x,t.y),this}}],[{key:"fromString",value:function(t){var n=o.exec(t);return n?new e(+n[1],+n[2]):new e(0,0)}},{key:"middle",value:function(t,n){return new e((t.x+n.x)/2,(t.y+n.y)/2)}},{key:"areaSize",value:function(e,t){return{width:Math.ceil(Math.abs(e.x-t.x)),height:Math.ceil(Math.abs(e.y-t.y))}}},{key:"clone",value:function(t){return new e(t.x,t.y)}}]),e}();t.default=s;var u=t.Coord=function(){function e(t,n){(0,r.default)(this,e),this.x=t,this.y=n}return(0,a.default)(e,[{key:"destroy",value:function(){}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toPoint",value:function(e,t){return new s(this.x/e,this.y/t)}},{key:"copy",value:function(e){this.x=e.x,this.y=e.y}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"topLeft",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t<this.x&&(this.x=t),n<this.y&&(this.y=n)):t instanceof e&&this.topLeft(t.x,t.y),this}},{key:"bottomRight",value:function(t,n){return"number"==typeof t&&"number"==typeof n?(t>this.x&&(this.x=t),n>this.y&&(this.y=n)):t instanceof e&&this.bottomRight(t.x,t.y),this}}],[{key:"fromString",value:function(t,n,r){var a=o.exec(t);return a?new e(Math.round(+a[1]*n),Math.round(+a[2]*r)):new e(0,0)}},{key:"middle",value:function(t,n){return new e((t.x+n.x)/2,(t.y+n.y)/2)}},{key:"areaSize",value:function(e,t){return{width:Math.ceil(Math.abs(e.x-t.x)),height:Math.ceil(Math.abs(e.y-t.y))}}},{key:"clone",value:function(t){return new e(t.x,t.y)}}]),e}()},function(e,t,n){n(56),n(30),n(38),n(200),n(204),n(205),e.exports=n(5).Promise},function(e,t,n){"use strict";var r,a,i,o,s=n(41),u=n(11),c=n(19),l=n(57),d=n(7),h=n(13),f=n(49),p=n(76),v=n(43),y=n(126),g=n(127).set,m=n(202)(),w=n(98),b=n(128),_=n(203),k=n(129),x=u.TypeError,M=u.process,S=M&&M.versions,C=S&&S.v8||"",O=u.Promise,A="process"==l(M),I=function(){},P=a=w.f,T=!!function(){try{var e=O.resolve(1),t=(e.constructor={})[n(10)("species")]=function(e){e(I,I)};return(A||"function"==typeof PromiseRejectionEvent)&&e.then(I)instanceof t&&0!==C.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),E=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},D=function(e,t){if(!e._n){e._n=!0;var n=e._c;m((function(){for(var r=e._v,a=1==e._s,i=0,o=function(t){var n,i,o,s=a?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(a||(2==e._h&&z(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),o=!0)),n===t.promise?c(x("Promise-chain cycle")):(i=E(n))?i.call(n,u,c):u(n)):c(r)}catch(e){l&&!o&&l.exit(),c(e)}};n.length>i;)o(n[i++]);e._c=[],e._n=!1,t&&!e._h&&R(e)}))}},R=function(e){g.call(u,(function(){var t,n,r,a=e._v,i=N(e);if(i&&(t=b((function(){A?M.emit("unhandledRejection",a,e):(n=u.onunhandledrejection)?n({promise:e,reason:a}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",a)})),e._h=A||N(e)?2:1),e._a=void 0,i&&t.e)throw t.v}))},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},z=function(e){g.call(u,(function(){var t;A?M.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},j=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),D(t,!0))},L=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw x("Promise can't be resolved itself");(t=E(e))?m((function(){var r={_w:n,_d:!1};try{t.call(e,c(L,r,1),c(j,r,1))}catch(e){j.call(r,e)}})):(n._v=e,n._s=1,D(n,!1))}catch(e){j.call({_w:n,_d:!1},e)}}};T||(O=function(e){p(this,O,"Promise","_h"),f(e),r.call(this);try{e(c(L,this,1),c(j,this,1))}catch(e){j.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(77)(O.prototype,{then:function(e,t){var n=P(y(this,O));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=A?M.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&D(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new r;this.promise=e,this.resolve=c(L,e,1),this.reject=c(j,e,1)},w.f=P=function(e){return e===O||e===o?new i(e):a(e)}),d(d.G+d.W+d.F*!T,{Promise:O}),n(42)(O,"Promise"),n(99)("Promise"),o=n(5).Promise,d(d.S+d.F*!T,"Promise",{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!T),"Promise",{resolve:function(e){return k(s&&this===o?O:this,e)}}),d(d.S+d.F*!(T&&n(100)((function(e){O.all(e).catch(I)}))),"Promise",{all:function(e){var t=this,n=P(t),r=n.resolve,a=n.reject,i=b((function(){var n=[],i=0,o=1;v(e,!1,(function(e){var s=i++,u=!1;n.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,n[s]=e,--o||r(n))}),a)})),--o||r(n)}));return i.e&&a(i.v),n.promise},race:function(e){var t=this,n=P(t),r=n.reject,a=b((function(){v(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return a.e&&r(a.v),n.promise}})},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(11),a=n(127).set,i=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(46)(o);e.exports=function(){var e,t,n,c=function(){var r,a;for(u&&(r=o.domain)&&r.exit();e;){a=e.fn,e=e.next;try{a()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(c)};else if(!i||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(c)}}else n=function(){a.call(r,c)};else{var d=!0,h=document.createTextNode("");new i(c).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(r){var a={fn:r,next:void 0};t&&(t.next=a),e||(e=a,n()),t=a}}},function(e,t,n){var r=n(11).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(7),a=n(5),i=n(11),o=n(126),s=n(129);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,a.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){"use strict";var r=n(7),a=n(98),i=n(128);r(r.S,"Promise",{try:function(e){var t=a.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var r=_(n(16)),a=_(n(0)),i=_(n(1)),o=_(n(207)),s=_(n(211)),u=_(n(183)),c=_(n(271)),l=_(n(275)),d=n(108),h=_(n(276)),f=_(n(86)),p=_(n(279)),v=_(n(189)),y=_(n(280)),g=_(n(40)),m=_(n(281)),w=_(n(282)),b=n(45);function _(e){return e&&e.__esModule?e:{default:e}}var k=function(){function e(t){(0,a.default)(this,e),this.isRecordPlayer=!1,this.editEnabled=!1,this.cameraTransformEnabled=!0,this.showCursor=!1,this.isConnected=!1,this.account=t.account,this.nickname=t.nickname?t.nickname:t.account,this.platform=t.platform,this.nim=t.nim,this.simulator=new m.default(this),this.configInstance=new f.default(this),this.dispatcher=new u.default,this.opsManager=new s.default(this),this.opsManager.extendDefaultOps(),this.dataHub=new l.default(this,t.connector),this.container=new o.default(this),this.room=new c.default(this,this.dataHub),this.container.addOpsManager(this.opsManager),this.opsManager.addContainer(this.container),this.camera=new p.default(this),this.vision=new w.default(this),this.isRecordPlayer=!!t.isRecordPlayer,t.isRecordPlayer||(this.previewFactory=new h.default(this)),t.isRecordPlayer&&(this.player=new y.default(this)),this.setContainer(t.container)}return(0,i.default)(e,[{key:"getStrokeWidth",value:function(){return g.default.strokeWidth}},{key:"getColor",value:function(){return g.default.strokeColor}},{key:"getRedoCount",value:function(){return this.opsManager.opMap.redo.getCount()}},{key:"getUndoCount",value:function(){return this.opsManager.opMap.undo.getCount()}},{key:"isClearAvailable",value:function(){return this.opsManager.opMap.clear.isAvailable()}},{key:"getSelectedIds",value:function(){return this.opsManager.opMap.select.getSelectedIds()}},{key:"getZoomFactor",value:function(){return this.camera.zoomFactor}},{key:"getCameraBound",value:function(){return this.camera.getContainerWorldRect()}},{key:"setAppConfig",value:function(e){this.configInstance.setAppConfig(e)}},{key:"setContainer",value:function(e){e.innerHTML="",this.container.appendTo(e)}},{key:"readyToSyncData",value:function(){console.warn("白板--\x3e","drawPlugin.readyToSyncData"),document.body.style.cursor="auto",this.dataHub.sendSyncRequest()}},{key:"setIsConnected",value:function(e){this.isConnected=e,this.isConnected||(document.body.style.cursor="auto")}},{key:"resetState",value:function(){this.room.reset(),this.dataHub.reset()}},{key:"addImage",value:function(e){console.warn("白板--\x3e","drawPlugin.addImage",e),v.default.validate("drawPlugin.addImage",e,{url:{type:"string",isRequire:!0},width:{type:"number"},height:{type:"number"}}),this.emit("op:image:upload",e.url,{width:e.width,height:e.height})}},{key:"setPageBackground",value:function(e){console.warn("白板--\x3e","drawPlugin.setPageBackground",e),v.default.validate("drawPlugin.setPageBackground",e,{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}}),this.emit("op:background:imageUpload",e.url,{width:e.width,height:e.height,pageIndex:e.pageIndex})}},{key:"hasBackground",value:function(){return!!this.room.currBoard.currPage.backgroundSnapshot}},{key:"addDoc",value:function(e){console.warn("白板--\x3e","drawPlugin.addDoc",e),v.default.validate("drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0},params:{type:"array",isRequire:!0}});for(var t=0;t<e.params.length;t++)v.default.validate("drawPlugin.addDoc opt.params["+t+"]",e.params[t],{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});if(0===e.params.length)throw new Error("addDoc参数中params的数组长度必须大于0");var n=e.docName,a=e.params,i=(0,r.default)(this.room.boards).filter((function(e){return e.startsWith(n)})).length;0===i?this.addBoard(n,a.length):this.addBoard(n+"-"+i,a.length);for(var o=0;o<a.length;o++)this.setPageBackground({url:a[o].url,width:a[o].width,height:a[o].height,pageIndex:o})}},{key:"setTool",value:function(e){this.emit("op:"+e+":activate")}},{key:"setFontsize",value:function(e){this.emit("op:text:fontsize",e)}},{key:"setColor",value:function(e){console.warn("白板--\x3e","drawPlugin.setColor",e),g.default.setStrokeColor(e),this.emit("event:appState:change","renderColor",e)}},{key:"setShapeFill",value:function(e,t){if(t)if("rect"===t)this.emit("op:rect:isFill",e);else{if("ellipse"!==t)throw new Error("尝试设置图形是否填充，但是图形找不到: "+t);this.emit("op:ellipse:isFill",e)}else this.emit("op:rect:isFill",e),this.emit("op:ellipse:isFill",e)}},{key:"setStrokeWidth",value:function(e){console.warn("白板--\x3e","drawPlugin.setStrokeWidth",e),g.default.setStrokeWidth(e),this.emit("event:appState:change","renderWidth",e)}},{key:"setShowCursor",value:function(e){console.warn("白板--\x3e","drawPlugin.setShowCursor",e),this.showCursor=e}},{key:"enableDraw",value:function(e){console.warn("白板--\x3e","drawPlugin.enableDraw",e),v.default.validate("drawPlugin.enableDraw",{editEnabled:e},{editEnabled:{type:"boolean",isRequire:!0}}),e||(document.body.style.cursor="auto"),this.editEnabled=e,this.emit("event:editable:change",this.editable)}},{key:"enableCameraTransform",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("白板--\x3e","drawPlugin.enableCameraTransform",e),this.cameraTransformEnabled=e}},{key:"resetCamera",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("白板--\x3e","drawPlugin.resetCamera"),"follower"===this.vision.mode?(0,b.showToast)({msg:"你当前处于视角跟随状态",type:"info"}):this.emit("op:reset-camera:exec",e)}},{key:"setCameraBound",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.warn("白板--\x3e","drawPlugin.setCameraBound boundary: ",e,"animate: ",t),v.default.validate("drawPlugin.setCameraBound",e,{centerX:{type:"number",isRequire:!0},centerY:{type:"number",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}}),this.emit("op:camera-bound:send",e,t)}},{key:"fitToContent",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("白板--\x3e","drawPlugin.fitToContent"),"follower"===this.vision.mode?(0,b.showToast)({msg:"你当前处于视角跟随状态",type:"info"}):this.emit("op:fit-to-content:exec",e)}},{key:"fitToDoc",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("白板--\x3e","drawPlugin.fitToDoc"),"follower"===this.vision.mode?(0,b.showToast)({msg:"你当前处于视角跟随状态",type:"info"}):this.emit("op:fit-to-doc:exec",e)}},{key:"zoomIn",value:function(){console.warn("白板--\x3e","drawPlugin.zoomIn"),"follower"===this.vision.mode?(0,b.showToast)({msg:"你当前处于视角跟随状态",type:"info"}):this.emit("op:zoom:in")}},{key:"zoomOut",value:function(){console.warn("白板--\x3e","drawPlugin.zoomOut"),"follower"===this.vision.mode?(0,b.showToast)({msg:"你当前处于视角跟随状态",type:"info"}):this.emit("op:zoom:out")}},{key:"zoomTo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.warn("白板--\x3e","drawPlugin.zoomTo: ",e," animate: ",t),"follower"===this.vision.mode?(0,b.showToast)({msg:"你当前处于视角跟随状态",type:"info"}):this.emit("op:zoom:to",e,t)}},{key:"undo",value:function(){console.warn("白板--\x3e","drawPlugin.undo"),this.emit("op:undo:exec")}},{key:"redo",value:function(){console.warn("白板--\x3e","drawPlugin.redo"),this.emit("op:redo:exec")}},{key:"clear",value:function(){console.warn("白板--\x3e","drawPlugin.clear"),this.emit("op:clear:exec")}},{key:"duplicate",value:function(){console.warn("白板--\x3e","drawPlugin.duplicate"),this.emit("op:duplicate:exec")}},{key:"deleteSelectedElements",value:function(){console.warn("白板--\x3e","drawPlugin.deleteSelectedElements"),this.emit("op:delete:exec")}},{key:"addPage",value:function(e){console.warn("白板--\x3e","drawPlugin.addPage, insertAfter",e),this.emit("op:page:add",e)}},{key:"deletePage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);console.warn("白板--\x3e","drawPlugin.deletePage: ",e,"builtInIndex",t),this.emit("op:page:delete",t)}},{key:"gotoPage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);console.warn("白板--\x3e","drawPlugin.gotoPage: ",e,"buildInIndex",t),this.emit("op:page:goto",t)}},{key:"gotoFirstPage",value:function(){this.room.currBoard.getCurrPageIndex()>0&&this.gotoPage(0)}},{key:"gotoPrevPage",value:function(){var e=this.room.currBoard.getCurrPageIndex();e>0&&this.gotoPage(e-1)}},{key:"gotoNextPage",value:function(){var e=this.room.currBoard,t=e.getCurrPageIndex();t<e.pageNames.length-1&&this.gotoPage(t+1)}},{key:"gotoLastPage",value:function(){var e=this.room.currBoard;e.getCurrPageIndex()<e.pageNames.length-1&&this.gotoPage(e.pageNames.length-1)}},{key:"gotoBoard",value:function(e){v.default.validate("drawPlugin.gotoBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),console.warn("白板--\x3e","drawPlugin.gotoBoard:",e),this.emit("op:board:goto",e)}},{key:"addBoard",value:function(e,t){v.default.validate("drawPlugin.addBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),console.warn("白板--\x3e","drawPlugin.addBoard, boardName:",e," pageCount:",t),this.emit("op:board:add",e,t)}},{key:"deleteBoard",value:function(e){v.default.validate("drawPlugin.deleteBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),console.warn("白板--\x3e","drawPlugin.deleteBoard: ",e),this.emit("op:board:delete",e)}},{key:"getPageInfos",value:function(){return{pageNames:this.opsManager.currBoard.pageNames.slice(),currPage:this.opsManager.currBoard.currIndex}}},{key:"getBoardInfos",value:function(){return{boardNames:(0,r.default)(this.room.boards),currBoard:this.room.currIndex}}},{key:"getPreviewsOfBoard",value:function(e){return this.previewFactory?this.previewFactory.getPreviewsOfBoard(e):[]}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=this.dispatcher).emit.apply(t,[e].concat(r))}},{key:"on",value:function(e,t){this.dispatcher.on(e,t)}},{key:"off",value:function(e,t){this.dispatcher.off(e,t)}},{key:"getOpDoc",value:function(e){return this.opsManager.getOpDoc(e)}},{key:"getCurrTool",value:function(){var e;return null===(e=this.opsManager.currOp)||void 0===e?void 0:e.type}},{key:"destroy",value:function(){console.warn("白板--\x3e","drawPlugin.destroy"),this.dispatcher.destroy(),this.container.destroy(),document.body.style.cursor="auto"}},{key:"addRecordData",value:function(e){var t;null===(t=this.player)||void 0===t||t.addRecordData(e)}},{key:"seekTo",value:function(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e)}},{key:"setViewer",value:function(e){var t;null===(t=this.player)||void 0===t||t.setViewer(e)}},{key:"setSelfAsBroadcaster",value:function(){console.warn("白板--\x3e","drawPlugin.setSelfAsBroadcaster"),this.vision.setSelfAsBroadcaster()}},{key:"unsetSelfAsBroadcaster",value:function(){console.warn("白板--\x3e","drawPlugin.unsetSelfAsBroadcaster"),this.vision.unsetSelfAsBroadcaster()}},{key:"setSelfAsFollower",value:function(){console.warn("白板--\x3e","drawPlugin.setSelfAsFollower"),this.vision.setSelfAsFollower()}},{key:"setSelfAsFreeObserver",value:function(){console.warn("白板--\x3e","drawPlugin.setSelfAsFreeObserver"),this.vision.setSelfAsFreeObserver()}},{key:"exportAsImage",value:function(){console.warn("白板--\x3e","drawPlugin.exportAsImage");var e=this.previewFactory.generatePreview({pageIndex:this.room.currBoard.currIndex.toString(),boardName:this.room.currIndex,state:"ready"}),t=document.createElement("a");t.href=e;var n="whiteboard"===this.room.currBoard.boardName?"白板":this.room.currBoard.boardName,r=this.room.currBoard.currPage.pageIndex,a=this.room.currBoard.pageNames.indexOf(r);t.download=n+"-"+(a+1)+".png",t.click()}},{key:"setMemberList",value:function(e){this.emit("event:member:change",e.slice())}},{key:"ifDeviceSupportOrientation",get:function(){return d.TouchPlatformArray.includes(this.platform.toLowerCase())}},{key:"editable",get:function(){return this.editEnabled&&!this.dataHub.isSynchronizing&&this.isConnected}},{key:"appConfig",get:function(){return this.configInstance.getAppConfig()}}]),e}(),x={getInstance:function(e){return console.warn("白板--\x3e","DrawPlugin.getInstance arguments:",e),v.default.validate("DrawPlugin.instance",e,{account:{type:"string",isRequire:!0},nickname:{type:"string",isRequire:!1},container:{type:"dom",isRequire:!0},platform:{type:"string",isRequire:!0,enum:d.PlatformArray},connector:{type:"object",isRequire:!0},nim:{type:"object",isRequire:!0}}),new k(e)}};t.App=k,t.default=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(32)),a=l(n(44)),i=l(n(12)),o=l(n(0)),s=l(n(1)),u=n(113),c=n(17);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){var n=this;(0,o.default)(this,e),this.elInitW=1920,this.elInitH=1080,this.isLandscape=!1,this.elesToResize=[],this.top=0,this.left=0,this.keyPressed={},this.maybeClick=!1,this.mouseEventCache=[],this.isMouseDown=!1,this.sx=0,this.sy=0,this.lastMx=0,this.lastMy=0,this.lastClientX=0,this.lastClientY=0,this._resize=function(e){var t,r=n.el.getBoundingClientRect();n.containerRect=r,n.app.ifDeviceSupportOrientation&&(n.isLandscape=r.width>r.height);var a=!0,o=!1,s=void 0;try{for(var u,c=(0,i.default)(n.elesToResize);!(a=(u=c.next()).done);a=!0){var l=u.value;l instanceof HTMLCanvasElement?(l.width=r.width,l.height=r.height):(l.style.width=r.width+"px",l.style.height=r.height+"px")}}catch(e){o=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}n.top=r.top,n.left=r.left,n.setElePosition(n.backgroundEl,"fixed"),n.setElePosition(n.imageEl,"fixed"),n.setElePosition(n.domEl,"fixed"),n.setElePosition(n.textAreaEl,"fixed"),n.dispatcher.emit("container:resize"),n.ctx.lineCap="round",n.ctx.lineJoin="round",n.frontCtx.lineCap="round",n.frontCtx.lineJoin="round",n.laserCtx.lineCap="round",n.laserCtx.lineJoin="round",null===(t=n.opsManager)||void 0===t||t.resize(e,r.width,r.height)},this.getEventClientPos=function(e){var t=void 0,r=void 0;return e instanceof MouseEvent?(t=e.clientX,r=e.clientY):(t=e.touches[0].clientX,r=e.touches[0].clientY),t-=n.left,r-=n.top,[].concat((0,a.default)(n.app.camera.convertToPointInWorld(t,r)),[t,r])},this._contextmenu=function(e){e.preventDefault()},this._mousedown=function(e){if(!n.isMouseDown){var t=n.getEventClientPos(e),a=(0,r.default)(t,4),i=a[0],o=a[1],s=a[2],u=a[3];n.lastMx=i,n.lastMy=o,n.lastClientX=s,n.lastClientY=u,n.isMouseDown=!0,n.maybeClick=!0,n.sx=i,n.sy=o,n.mouseEventCache.push({type:"mousedown",args:[e,n.sx,n.sy,s,u]}),n.mouseEmitTimer=setTimeout((function(){n.maybeClick=!1,n._emitMouseEvents()}),150)}},this._mousemove=function(e){var t,a=n.getEventClientPos(e),i=(0,r.default)(a,4),o=i[0],s=i[1],u=i[2],l=i[3];n.lastMx=o,n.lastMy=s,n.lastClientX=u,n.lastClientY=l,n.maybeClick&&(n.maybeClick=(0,c.distSqrt)([o,s],[n.sx,n.sy])<=5),n.maybeClick?n.mouseEventCache.push({type:"mousemove",args:[e,o,s,u,l]}):(n.mouseEmitTimer&&(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n._emitMouseEvents()),null===(t=n.opsManager)||void 0===t||t.mousemove(e,o,s,u,l))},this._mouseup=function(e){var t,r,a=[n.lastMx,n.lastMy,n.lastClientX,n.lastClientY],i=a[0],o=a[1],s=a[2],u=a[3];n.maybeClick?(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n.mouseEventCache=[],n.maybeClick=!1,null===(r=n.opsManager)||void 0===r||r.click(e,i,o,s,u)):(n.mouseEmitTimer&&(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n._emitMouseEvents()),n.mouseEventCache=[],null===(t=n.opsManager)||void 0===t||t.mouseup(e,i,o,s,u)),n.isMouseDown=!1},this._mouseleave=function(e){var t,a=n.getEventClientPos(e),i=(0,r.default)(a,4),o=i[0],s=i[1],u=i[2],c=i[3];null===(t=n.opsManager)||void 0===t||t.mouseleave(e,o,s,u,c)},this._mousewheel=function(e){var t,a=n.getEventClientPos(e),i=(0,r.default)(a,4),o=i[0],s=i[1],u=i[2],c=i[3];null===(t=n.opsManager)||void 0===t||t.mousewheel(e,o,s,u,c)},this._keyup=function(e){var t,r=e.key.toLocaleLowerCase();null===(t=n.opsManager)||void 0===t||t.keyup(e),n.keyPressed[r]=!1},this._keydown=function(e){var t,r=e.key.toLocaleLowerCase();n.keyPressed[r]=!0,null===(t=n.opsManager)||void 0===t||t.keydown(e)},this.app=t,this.dispatcher=t.dispatcher,this.el=document.createElement("div"),this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%",this.setBackgroundColor(),this.backgroundEl=this.setupDivElement("bg-el"),this.imageEl=this.setupDivElement("image-el");var s=this.setupCanvasElement("bg-canvas");this.canvas=s.canvas,this.ctx=s.ctx,s=this.setupCanvasElement("front-canvas"),this.frontCanvas=s.canvas,this.frontCtx=s.ctx,this.domEl=this.setupDivElement("dom-el"),this.textAreaEl=this.setupDivElement("toolbar-el"),s=this.setupCanvasElement("laser-canvas"),this.laserCanvas=s.canvas,this.laserCtx=s.ctx,setTimeout((function(){n._resize()})),this._bindEvents()}return(0,s.default)(e,[{key:"setBackgroundColor",value:function(){this.el.style.backgroundColor=this.app.appConfig.canvas_bg_color}},{key:"appendTo",value:function(e){e.appendChild(this.el),this._resize(),this.dispatcher.emit("container:set")}},{key:"addOpsManager",value:function(e){this.opsManager=e}},{key:"isKeyDown",value:function(e){return this.keyPressed.hasOwnProperty(e)&&this.keyPressed[e]}},{key:"isTargetOnContainer",value:function(e){var t;return e===this.el||(null==e?void 0:e.parentNode)===this.el||(null===(t=null==e?void 0:e.parentNode)||void 0===t?void 0:t.parentNode)===this.el}},{key:"setupDivElement",value:function(e){var t=document.createElement("div");return t.style.transformOrigin="left top",t.className=e,this.el.appendChild(t),t}},{key:"setupCanvasElement",value:function(e){var t=document.createElement("canvas");this.setElePosition(t),t.className=e,t.style.pointerEvents="none";var n=t.getContext("2d");return this.el.appendChild(t),this.elesToResize.push(t),{canvas:t,ctx:n}}},{key:"_bindEvents",value:function(){window.addEventListener("scroll",this._resize),window.addEventListener("resize",this._resize),window.addEventListener("orientationchange",this._resize),(0,u.on)(this.el,"mousedown",this._mousedown),(0,u.on)(this.el,"mouseleave",this._mouseleave),(0,u.on)(window.document,"mousemove",this._mousemove),(0,u.on)(window.document,"mouseup",this._mouseup),(0,u.on)(window.document,"mousewheel",this._mousewheel),(0,u.on)(this.el,"touchstart",this._mousedown),(0,u.on)(this.el,"touchmove",this._mousemove),(0,u.on)(this.el,"touchend",this._mouseup),(0,u.on)(window.document,"keyup",this._keyup),(0,u.on)(window.document,"keydown",this._keydown),(0,u.on)(document.body,"contextmenu",this._contextmenu)}},{key:"destroy",value:function(){window.removeEventListener("scroll",this._resize),window.removeEventListener("resize",this._resize),window.removeEventListener("orientationchange",this._resize),(0,u.off)(this.el,"mousedown",this._mousedown),(0,u.off)(this.el,"mouseleave",this._mouseleave),(0,u.off)(window.document,"mousemove",this._mousemove),(0,u.off)(window.document,"mouseup",this._mouseup),(0,u.off)(window.document,"mousewheel",this._mousewheel),(0,u.off)(this.el,"touchstart",this._mousedown),(0,u.off)(this.el,"touchmove",this._mousemove),(0,u.off)(this.el,"touchend",this._mouseup),(0,u.off)(window.document,"keyup",this._keyup),(0,u.off)(window.document,"keydown",this._keydown),(0,u.off)(document.body,"contextmenu",this._contextmenu)}},{key:"setElePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"absolute";"absolute"===t?(e.style.position=t,e.style.left="0px",e.style.right="0px",e.style.top="0px",e.style.bottom="0px"):(e.style.position="fixed",e.style.left=this.left+"px",e.style.width=this.width+"px",e.style.top=this.top+"px",e.style.height=this.height+"px")}},{key:"_emitMouseEvents",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=(0,i.default)(this.mouseEventCache);!(e=(r=o.next()).done);e=!0){var s,u=r.value;(s=this.opsManager)[u.type].apply(s,(0,a.default)(u.args))}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this.mouseEventCache=[]}},{key:"width",get:function(){return this.containerRect?this.containerRect.width:this.canvas.width}},{key:"height",get:function(){return this.containerRect?this.containerRect.height:this.canvas.height}}]),e}();t.default=d},function(e,t,n){e.exports={default:n(209),__esModule:!0}},function(e,t,n){n(38),n(30),e.exports=n(210)},function(e,t,n){var r=n(57),a=n(10)("iterator"),i=n(31);e.exports=n(5).isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||i.hasOwnProperty(r(t))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=B(n(35)),a=B(n(0)),i=B(n(1)),o=n(54),s=n(212),u=B(n(167)),c=B(n(169)),l=B(n(85)),d=B(n(234)),h=B(n(235)),f=B(n(236)),p=B(n(237)),v=B(n(238)),y=B(n(239)),g=B(n(240)),m=B(n(241)),w=B(n(242)),b=B(n(243)),_=B(n(249)),k=B(n(250)),x=B(n(252)),M=B(n(253)),S=B(n(256)),C=B(n(257)),O=B(n(258)),A=B(n(259)),I=B(n(260)),P=B(n(261)),T=B(n(262)),E=B(n(263)),D=B(n(264)),R=B(n(265)),N=B(n(268)),z=B(n(269)),j=B(n(270)),L=B(n(48));function B(e){return e&&e.__esModule?e:{default:e}}var F=function(){function e(t){(0,a.default)(this,e),this.currOp=null,this.opMap={},this.app=t,this.dispatcher=t.dispatcher,this.hooks={mousedown:new s.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseup:new s.SyncBailHook(["event","mx","my","clientX","clientY"]),mousemove:new s.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseleave:new s.SyncBailHook(["event","mx","my","clientX","clientY"]),mousewheel:new s.SyncBailHook(["event","mx","my","clientX","clientY"]),resize:new s.SyncBailHook(["event","width","height"]),click:new s.SyncBailHook(["event","mx","my","clientX","clientY"]),keyup:new s.SyncBailHook(["event"]),keydown:new s.SyncBailHook(["event"]),addOpHook:new s.SyncHook(["snapshot","isNew"]),refresh:new s.SyncHook([]),opChange:new s.SyncHook(["type"]),selectChange:new s.SyncHook(["prevSelectedOpIds","selectedOpIds"]),pageChange:new s.SyncHook(["snapshot"]),boardChange:new s.SyncHook([]),pageReady:new s.SyncHook(["boardName, pageIndex"])}}return(0,i.default)(e,[{key:"extendDefaultOps",value:function(){this.extendOp(R.default),this.extendOp(u.default),this.extendOp(S.default),this.extendOp(C.default),this.extendOp(c.default),this.extendOp(m.default),this.extendOp(w.default),this.extendOp(b.default),this.extendOp(A.default),this.extendOp(l.default),this.extendOp(h.default),this.extendOp(d.default),this.extendOp(f.default),this.extendOp(M.default),this.extendOp(p.default),this.extendOp(v.default),this.extendOp(y.default),this.extendOp(g.default),this.extendOp(O.default),this.extendOp(_.default),this.extendOp(x.default),this.extendOp(k.default),this.extendOp(P.default),this.extendOp(I.default),this.extendOp(T.default),this.extendOp(E.default),this.extendOp(D.default),this.extendOp(N.default),this.extendOp(L.default),this.extendOp(z.default),this.extendOp(j.default),this.setCurrOp("pen")}},{key:"addContainer",value:function(e){this.container=e}},{key:"extendOp",value:function(e){var t,n,r=this,a=new e(this.app);this.opMap[a.type]=a;var i=a.eventsToListen();if((null===(t=i.activate)||void 0===t?void 0:t.value)&&(null===(n=i.exec)||void 0===n?void 0:n.value))return console.log("白板--\x3e","操作不能同时设置activate和exec为true。操作不同同时为命令类操作，及状态类操作");for(var o in i.activate&&i.activate.value?this.dispatcher.on("op:"+a.type+":activate",(function(){r.setCurrOp(a.type)&&r.currOp.afterActivate()})):i.exec&&i.exec.value&&this.dispatcher.on("op:"+a.type+":exec",a.execCommand.bind(a)),i)"activate"!==o&&"exec"!==o&&this.dispatcher.on("op:"+o,i[o].value)}},{key:"getOpDoc",value:function(e){var t=[];if(void 0!==e)t=this._getOpDoc(e);else{for(var n in this.opMap)(t=t.concat(this._getOpDoc(n))).push("*************************************");t.push("全局事件\n\n用法：app.on('event:add:snapshot', (data: {local: boolean, snapshot: IOPSnapshot}) => {})\n作用： 接收到新的快照时发送此事件\n"),t.push("*************************************")}return t.join("\n\n")}},{key:"_getOpDoc",value:function(e){var t=[];if(this.opMap.hasOwnProperty(e)){var n=this.opMap[e];n.description&&t.push(n.description);var r=n.eventsToListen();for(var a in r){var i=r[a].information,o="op:"+a;"activate"!==a&&"exec"!==a||(o="op:"+n.type+":"+a),t.push("用法：app.emit('"+o+"'"+(i.args.length>0?", "+i.args:"")+")\n作用："+i.message)}}else console.log("白板--\x3e","op:"+e+"不存在!!!!!!");return t}},{key:"setCurrOp",value:function(e){var t;return console.log("白板--\x3e","设置当前op为："+e),(null===(t=this.currOp)||void 0===t?void 0:t.type)!==e&&(document.body.style.cursor="default",this.hooks.opChange.call(e),this.currOp=this.opMap[e],this.app.emit("event:appState:change","currTool",e),!0)}},{key:"currOpIsCamera",value:function(){var e;return this.currOp&&-1!==o.cameraSnapshotTypes.indexOf(null===(e=this.currOp)||void 0===e?void 0:e.type)}},{key:"resize",value:function(e,t,n){this.hooks.resize.call(e,t,n)||this.currOp&&"handleResize"in this.currOp&&this.currOp.handleResize(e,t,n)}},{key:"mousedown",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousedown.call(e,t,n,r,a)||this.currOp&&"handleMouseDown"in this.currOp&&this.currOp.handleMouseDown(e,t,n,r,a))}},{key:"mouseup",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mouseup.call(e,t,n,r,a)||this.currOp&&"handleMouseUp"in this.currOp&&this.currOp.handleMouseUp(e,t,n,r,a))}},{key:"mouseleave",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mouseleave.call(e,t,n,r,a)||this.currOp&&"handleMouseLeave"in this.currOp&&this.currOp.handleMouseLeave(e,t,n,r,a))}},{key:"mousewheel",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousewheel.call(e,t,n,r,a)||this.currOp&&"handleMouseWheel"in this.currOp&&this.currOp.handleMouseWheel(e,t,n,r,a))}},{key:"mousemove",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousemove.call(e,t,n,r,a)||this.currOp&&"handleMouseMove"in this.currOp&&this.currOp.handleMouseMove(e,t,n,r,a))}},{key:"click",value:function(e,t,n,r,a){this.app.editable&&(this.hooks.click.call(e,t,n,r,a)||this.currOp&&"handleClick"in this.currOp&&this.currOp.handleClick(e,t,n,r,a))}},{key:"keyup",value:function(e){this.app.editable&&(this.hooks.keyup.call(e)||this.currOp&&"handleKeyUp"in this.currOp&&this.currOp.handleKeyUp(e))}},{key:"keydown",value:function(e){this.app.editable&&(this.hooks.keydown.call(e)||this.currOp&&"handleKeyDown"in this.currOp&&this.currOp.handleKeyDown(e))}},{key:"draw",value:function(e,t,n){try{var r=e.data.type;this.opMap[r]&&this.opMap[r].draw(e,t,n)}catch(e){console.error("opsManager.draw error",e)}}},{key:"preview",value:function(e,t,n){try{var r=e.data.type;this.opMap[r].preview(e,t,n)}catch(e){console.error("opsManager.preview error",e)}}},{key:"hide",value:function(e,t,n){try{var r=e.data.type;this.opMap[r]&&this.opMap[r].hide(e,t,n)}catch(e){console.error("opsManager.hide error",e)}}},{key:"mergePartial",value:function(e,t){var n=e.data.type;return this.opMap[n]?this.opMap[n].mergePartial(e,t):(console.error("找不到type为"+n+"的教具类型",(0,r.default)(e)),e)}},{key:"mergeTwoPartial",value:function(e,t){var n={opId:e.opId,data:e.data};for(var r in t.data)Array.isArray(t.data[r])&&Array.isArray(n.data[r])?n.data[r]=n.data[r].concat(t.data[r]):n.data[r]=t.data[r];return n}},{key:"resetUndoRedoCount",value:function(){this.opMap.undo.resetCount(),this.opMap.redo.resetCount()}},{key:"currPage",get:function(){return this.currBoard.pages[this.currBoard.currIndex]}},{key:"currBoard",get:function(){return this.app.room.boards[this.app.room.currIndex]}},{key:"drawOpsOfPage",get:function(){return this.currPage.drawOpQueue||{}}},{key:"selectOp",get:function(){return this.opMap.select}},{key:"selectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.selectedOpIds}},{key:"inProgressSelectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.inProgressSelectedOpIds}}]),e}();t.default=F},function(e,t,n){"use strict";t.__esModule=!0,t.Tapable=n(213),t.SyncHook=n(218),t.SyncBailHook=n(150),t.SyncWaterfallHook=n(219),t.SyncLoopHook=n(220),t.AsyncParallelHook=n(221),t.AsyncParallelBailHook=n(222),t.AsyncSeriesHook=n(223),t.AsyncSeriesBailHook=n(224),t.AsyncSeriesWaterfallHook=n(225),t.HookMap=n(226),t.MultiHook=n(232)},function(e,t,n){"use strict";var r=i(n(59)),a=i(n(12));function i(e){return e&&e.__esModule?e:{default:e}}var o=n(194),s=n(150);function u(){var e=this;this._pluginCompat=new s(["options"]),this._pluginCompat.tap({name:"Tapable camelCase",stage:100},(function(e){e.names.add(e.name.replace(/[- ]([a-z])/g,(function(e,t){return t.toUpperCase()})))})),this._pluginCompat.tap({name:"Tapable this.hooks",stage:200},(function(t){var n=void 0,r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(t.names);!(r=(s=u.next()).done);r=!0){var c=s.value;if(void 0!==(n=e.hooks[c]))break}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}if(void 0!==n){var l={name:t.fn.name||"unnamed compat plugin",stage:t.stage||0};return t.async?n.tapAsync(l,t.fn):n.tap(l,t.fn),!0}}))}e.exports=u,u.addCompatLayer=function(e){u.call(e),e.plugin=u.prototype.plugin,e.apply=u.prototype.apply},u.prototype.plugin=o.deprecate((function(e,t){if(Array.isArray(e))e.forEach((function(e){this.plugin(e,t)}),this);else if(!this._pluginCompat.call({name:e,fn:t,names:new r.default([e])}))throw new Error("Plugin could not be registered at '"+e+"'. Hook was not found.\nBREAKING CHANGE: There need to exist a hook at 'this.hooks'. To create a compatibility layer for this hook, hook into 'this._pluginCompat'.")}),"Tapable.plugin is deprecated. Use new API on `.hooks` instead"),u.prototype.apply=o.deprecate((function(){for(var e=0;e<arguments.length;e++)arguments[e].apply(this)}),"Tapable.apply is deprecated. Call apply on the plugin directly instead")},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){n(217);var r=n(5).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,n){var r=n(7);r(r.S+r.F*!n(14),"Object",{defineProperties:n(96)})},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(27),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:r})}}]),t}(n(33))),d=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(27),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,r=e.onResult,a=e.resultReturns,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,t){return n(t)},onResult:function(e,n,r){var a="";return a+="if("+n+" !== undefined) {\n",a+=t._args[0]+" = "+n+";\n",a+="}\n",a+=r()},onDone:function(){return r(t._args[0])},doneReturns:a,rethrowIfPossible:i})}}]),t}(n(33))),d=function(e){function t(e){(0,a.default)(this,t);var n=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncWaterfallHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncWaterfallHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(27),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;return this.callTapsLooping({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:r})}}]),t}(n(33))),d=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncLoopHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncLoopHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=c(n(47)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(27),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsParallel({onError:function(e,n,r,a){return t(n)+a(!0)},onDone:n})}}]),t}(n(33))),h=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(h.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=h},function(e,t,n){"use strict";var r=c(n(47)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(27),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.onDone,a="";return a+="var _results = new Array("+this.options.taps.length+");\n",a+="var _checkDone = () => {\n",a+="for(var i = 0; i < _results.length; i++) {\n",a+="var item = _results[i];\n",a+="if(item === undefined) return false;\n",a+="if(item.result !== undefined) {\n",a+=n("item.result"),a+="return true;\n",a+="}\n",a+="if(item.error) {\n",a+=t("item.error"),a+="return true;\n",a+="}\n",a+="}\n",a+="return false;\n",a+="}\n",a+=this.callTapsParallel({onError:function(e,t,n,r){var a="";return a+="if("+e+" < _results.length && ((_results.length = "+(e+1)+"), (_results["+e+"] = { error: "+t+" }), _checkDone())) {\n",a+=r(!0),a+="} else {\n",a+=n(),a+="}\n"},onResult:function(e,t,n,r){var a="";return a+="if("+e+" < _results.length && ("+t+" !== undefined && (_results.length = "+(e+1)+"), (_results["+e+"] = { result: "+t+" }), _checkDone())) {\n",a+=r(!0),a+="} else {\n",a+=n(),a+="}\n"},onTap:function(e,t,n,r){var a="";return e>0&&(a+="if("+e+" >= _results.length) {\n",a+=n(),a+="} else {\n"),a+=t(),e>0&&(a+="}\n"),a},onDone:r})}}]),t}(n(33))),h=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(h.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=h},function(e,t,n){"use strict";var r=c(n(47)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(27),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsSeries({onError:function(e,n,r,a){return t(n)+a(!0)},onDone:n})}}]),t}(n(33))),h=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(h.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=h},function(e,t,n){"use strict";var r=c(n(47)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(27),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.resultReturns,a=e.onDone;return this.callTapsSeries({onError:function(e,n,r,a){return t(n)+a(!0)},onResult:function(e,t,r){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+r()+"}\n"},resultReturns:r,onDone:a})}}]),t}(n(33))),h=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(h.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=h},function(e,t,n){"use strict";var r=c(n(47)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(27),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,r=e.onResult;e.onDone;return this.callTapsSeries({onError:function(e,t,r,a){return n(t)+a(!0)},onResult:function(e,n,r){var a="";return a+="if("+n+" !== undefined) {\n",a+=t._args[0]+" = "+n+";\n",a+="}\n",a+=r()},onDone:function(){return r(t._args[0])}})}}]),t}(n(33))),h=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(h.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=h},function(e,t,n){"use strict";var r=s(n(6)),a=s(n(195)),i=s(n(0)),o=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,i.default)(this,e),this._map=new a.default,this._factory=t,this._interceptors=[]}return(0,o.default)(e,[{key:"get",value:function(e){return this._map.get(e)}},{key:"for",value:function(e){var t=this.get(e);if(void 0!==t)return t;for(var n=this._factory(e),r=this._interceptors,a=0;a<r.length;a++)n=r[a].factory(e,n);return this._map.set(e,n),n}},{key:"intercept",value:function(e){this._interceptors.push((0,r.default)({factory:function(e,t){return t}},e))}},{key:"tap",value:function(e,t,n){return this.for(e).tap(t,n)}},{key:"tapAsync",value:function(e,t,n){return this.for(e).tapAsync(t,n)}},{key:"tapPromise",value:function(e,t,n){return this.for(e).tapPromise(t,n)}}]),e}();e.exports=u},function(e,t,n){n(56),n(30),n(38),n(228),n(229),n(230),n(231),e.exports=n(5).Map},function(e,t,n){"use strict";var r=n(102),a=n(78);e.exports=n(103)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(a(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(a(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(7);r(r.P+r.R,"Map",{toJSON:n(104)("Map")})},function(e,t,n){n(105)("Map")},function(e,t,n){n(106)("Map")},function(e,t,n){"use strict";var r=o(n(12)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}n(27);var s=function(){function e(t){(0,a.default)(this,e),this.hooks=t}return(0,i.default)(e,[{key:"tap",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=(0,r.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tap(e,t)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}}},{key:"tapAsync",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=(0,r.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tapAsync(e,t)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}}},{key:"tapPromise",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=(0,r.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tapPromise(e,t)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}}},{key:"isUsed",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=(0,r.default)(this.hooks);!(e=(a=i.next()).done);e=!0){if(a.value.isUsed())return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"intercept",value:function(e){var t=!0,n=!1,a=void 0;try{for(var i,o=(0,r.default)(this.hooks);!(t=(i=o.next()).done);t=!0){i.value.intercept(e)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}}},{key:"withOptions",value:function(t){return new e(this.hooks.map((function(e){return e.withOptions(t)})))}}]),e}();e.exports=s},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(80),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(e,t,n){return t in e?(0,i.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(6)),a=f(n(2)),i=f(n(0)),o=f(n(1)),s=f(n(3)),u=f(n(4)),c=f(n(8)),l=n(17),d=n(73),h=f(n(85));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="move",e.points=[],e.activate=!1,e.description="移动操作工具。内部使用，不提供对外接口",e.idsBeenMoved=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("MousedownPlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseup.tap("MouseupPlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof h.default){if(this.activate)return this.points.push([t,n]),this.dispatch(this.getSnapshot(!0,this.idsBeenMoved)),!0;if(!this.isMouseDown&&"nwse-resize"!==document.body.style.cursor&&"nesw-resize"!==document.body.style.cursor)if(this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds)||this.opsManager.inProgressSelectedOpIds.length>0)document.body.style.cursor="move";else{var r=(0,d.findOpsUnderMouse)([[t,n]],this.drawOpsOfPage,this.opsManager);(0,d.arrayDeduce)(r,this.opsManager.selectedOpIds.concat(this.opsManager.inProgressSelectedOpIds)).length>0?document.body.style.cursor="move":document.body.style.cursor="default"}}}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof h.default){var r=this.mouseInSelectedEleBoundary(t,n,this.opsManager.inProgressSelectedOpIds),a=this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds);if(r){var i=this.opsManager.inProgressSelectedOpIds.slice();return this.dispatch(this.opsManager.selectOp.getSnapshot(i)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=i.slice(),this.points=[[t,n]],this.activate=!0,!0}if(a)return this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=this.opsManager.selectedOpIds,this.points=[[t,n]],this.activate=!0,!0;var o=(0,d.findOpsUnderMouse)([[t,n]],this.drawOpsOfPage,this.opsManager);if(o.length>0)return this.dispatch(this.opsManager.selectOp.getSnapshot(o)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=o.slice(),this.points=[[t,n]],this.activate=!0,!0}this.activate=!1}},{key:"handleMouseUp",value:function(e,t,n){if(this.activate)return this.activate=!1,this.points.push([t,n]),this.dispatch(this.getSnapshot(!1,this.idsBeenMoved)),!0}},{key:"getSnapshot",value:function(e,t){return{type:this.type,sp:this.points[0],ep:this.points[this.points.length-1],selectedOpIds:t.slice(),dependOn:t.slice(),inProgress:e}}},{key:"mouseInSelectedEleBoundary",value:function(e,t,n){var r=this;if(0===(n=n.filter((function(e){return r.drawOpsOfPage.hasOwnProperty(e)}))).length)return!1;var a=this.opsManager.selectOp.eleContainerPadding,i=n.map((function(e){var t=r.drawOpsOfPage[e];return(0,l.getTransformedBoundary)(t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,l.combineBoundary)(e,t)}));return(0,l.pointInRect)({sx:i.sx-a,sy:i.sy-a,w:i.w+2*a,h:i.h+2*a},[e,t])}},{key:"transformOp",value:function(e,t){var n=t.data,a=void 0,i=void 0;Array.isArray(n.points)?(a=n.points[n.points.length-1][0]-n.points[0][0],i=n.points[n.points.length-1][1]-n.points[0][1]):(a=n.ep[0]-n.sp[0],i=n.ep[1]-n.sp[1]);var o=(0,r.default)({},e.data,{dx:a+(e.data.dx||0),dy:i+(e.data.dy||0),inProgress:n.inProgress});return(0,r.default)({},e,{data:o})}}]),t}(c.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(6)),a=p(n(32)),i=p(n(2)),o=p(n(0)),s=p(n(1)),u=p(n(3)),c=p(n(4)),l=p(n(8)),d=p(n(85)),h=n(17),f=n(108);function p(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="scale",e.coordinateX=0,e.coordinateY=0,e.boundaryW=1,e.boundaryH=1,e.activate=!1,e.idsBeenScaled=[],e.description="缩放操作工具。内部使用，不提供对外接口",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MouseMovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mousedown.tap("MouseMovePlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mouseup.tap("MouseMovePlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof d.default){var r=this.mousePosTest(t,n);if(document.body.style.cursor=r.cursorSuggestion,!0===r.value)return this.beginBatch(),this.activate=!0,this.coordinateX=r.coordinateX,this.coordinateY=r.coordinateY,this.boundaryW=0===r.w?1:r.w,this.boundaryH=0===r.h?1:r.h,this.idsBeenScaled=this.opsManager.selectedOpIds.slice(),!0}this.activate=!1}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof d.default){if(this.activate)return this.scaleInfo={scaleX:{coordinate:this.coordinateX,factor:(t-this.coordinateX)/this.boundaryW},scaleY:{coordinate:this.coordinateY,factor:(n-this.coordinateY)/this.boundaryH}},this.dispatch(this.getSnapshot(!0,this.idsBeenScaled)),!0;if(this.opsManager.currOp instanceof d.default&&!this.isMouseDown&&this.opsManager.currOp.selectedOpIds.length>0){var r=this.mousePosTest(t,n);document.body.style.cursor=r.cursorSuggestion}else document.body.style.cursor="default"}}},{key:"handleMouseUp",value:function(e,t,n){if(this.activate)return this.activate=!1,this.dispatch(this.getSnapshot(!1,this.idsBeenScaled)),this.scaleInfo=void 0,!0}},{key:"mousePosTest",value:function(e,t){var n=this,r=this.opsManager.selectedOpIds;if(0===(r=r.filter((function(e){return n.drawOpsOfPage.hasOwnProperty(e)}))).length)return{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:1,h:1};var a=this.opsManager.selectedOpIds.map((function(e){var t=n.drawOpsOfPage[e];return(0,h.getTransformedBoundary)(t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,h.combineBoundary)(e,t)})),i=15;return f.TouchPlatformArray.includes(this.app.platform)&&(i*=2.2),i*=Math.max(1/this.app.camera.zoomFactor,1),(0,h.pointCollideWithPoint)([e,t],[a.sx,a.sy],i)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:a.sx+a.w,coordinateY:a.sy+a.h,w:-a.w,h:-a.h}:(0,h.pointCollideWithPoint)([e,t],[a.sx+a.w,a.sy],i)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:a.sx,coordinateY:a.sy+a.h,w:a.w,h:-a.h}:(0,h.pointCollideWithPoint)([e,t],[a.sx,a.sy+a.h],i)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:a.sx+a.w,coordinateY:a.sy,w:-a.w,h:a.h}:(0,h.pointCollideWithPoint)([e,t],[a.sx+a.w,a.sy+a.h],i)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:a.sx,coordinateY:a.sy,w:a.w,h:a.h}:{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:a.w,h:a.h}}},{key:"getSnapshot",value:function(e,t){return{type:this.type,inProgress:e,scaleInfo:this.scaleInfo,selectedOpIds:t.slice(),dependOn:t.slice()}}},{key:"getScaleParameterBySnapshot",value:function(e){var t=e.data,n=1,r=1,a=0,i=0,o=void 0,s=(o=Array.isArray(t.scaleList)?t.scaleList[t.scaleList.length-1]:t.scaleInfo).scaleX.factor,u=o.scaleY.factor;return n*=s,r*=u,{dx:a=s*(a-o.scaleX.coordinate)+o.scaleX.coordinate,dy:i=u*(i-o.scaleY.coordinate)+o.scaleY.coordinate,factorX:n,factorY:r}}},{key:"transformOp",value:function(e,t){var n,i,o=t.data,s=(null===(n=e.data.scaleX)||void 0===n?void 0:n.factor)||1,u=(null===(i=e.data.scaleY)||void 0===i?void 0:i.factor)||1,c=s,l=u,d=e.data.boundary.sx,f=e.data.boundary.sy,p=(0,h.getTransformedPoint)([d,f],e.data.dx,e.data.dy,e.data.scaleX,e.data.scaleY),v=(0,a.default)(p,2),y=v[0],g=v[1],m=void 0,w=(m=Array.isArray(o.scaleList)?o.scaleList[o.scaleList.length-1]:o.scaleInfo).scaleX.factor,b=m.scaleY.factor;if(c*=w,l*=b,"text"===e.data.type){var _=Math.abs(c)/2+Math.abs(l)/2;w=(c*=_/Math.abs(c))/s,b=(l*=_/Math.abs(l))/u}var k=(y=w*(y-m.scaleX.coordinate)+m.scaleX.coordinate)-c*d,x=(g=b*(g-m.scaleY.coordinate)+m.scaleY.coordinate)-l*f,M=(0,r.default)({},e.data,{scaleX:{factor:c,coordinate:0},scaleY:{factor:l,coordinate:0},dx:k,dy:x});return"text"!==e.data.type||(M.fontSize=Math.abs(e.data.fontSize*c/s)),(0,r.default)({},e,{data:M})}}]),t}(l.default);t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(6)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="delete",e.description="删除元素。",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"删除当前选中的元素"}}}}},{key:"handleKeyDown",value:function(e){var t=e.key.toLocaleLowerCase();if(["backspace","delete"].includes(t))return this.execCommand(),!0}},{key:"execCommand",value:function(){this.opsManager.selectedOpIds.length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type,deleteOpIds:this.opsManager.selectedOpIds.slice(),dependOn:this.opsManager.selectedOpIds.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{hidden:!0});return(0,r.default)({},e,{data:n})}}]),t}(c(n(8)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(59)),a=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),c=d(n(8)),l=n(54);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="undo",e.description="撤销操作",e.idsCouldUndo=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getCount",value:function(){return this.idsCouldUndo.length}},{key:"registerHooks",value:function(){this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"z"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldUndo=[],this.emit("event:appState:change","undoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldUndo=[];else{if(e.data.skipUndo||e.data.inProgress||l.snapshotOutOfNormalFlowTypes.includes(e.data.type))return;if("undo"===e.data.type){var t=this.idsCouldUndo.indexOf(e.data.undoOpId);-1!==t&&this.idsCouldUndo.splice(t,1)}else"undo"!==e.data.type&&(this.idsCouldUndo.includes(e.opId)||this.idsCouldUndo.push(e.opId))}this.emit("event:appState:change","undoCount",this.idsCouldUndo.length)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldUndo.length&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",n=new r.default,a=e.length-1;a>=0;a--){var i=e[a],o=i.data.inProgress||i.data.skipUndo||l.snapshotOutOfNormalFlowTypes.includes(i.data.type);if("undo"!==i.data.type&&!o&&!n.has(i.opId)){t=i.opId;break}"undo"===i.data.type&&n.add(i.data.undoOpId)}return{type:this.type,undoOpId:t}}}]),t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),a=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(8)),c=n(54);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="redo",e.description="重做操作",e.idsCouldRedo=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getCount",value:function(){return this.idsCouldRedo.length}},{key:"registerHooks",value:function(){this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"y"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldRedo=[],this.emit("event:appState:change","redoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldRedo=[];else{if(e.data.inProgress||e.data.skipUndo||c.snapshotOutOfNormalFlowTypes.includes(e.data.type))return;if("redo"===e.data.type){var t=this.idsCouldRedo.indexOf(e.data.redoOpId);-1!==t&&this.idsCouldRedo.splice(t,1)}else"undo"===e.data.type?this.idsCouldRedo.includes(e.opId)||this.idsCouldRedo.push(e.opId):this.idsCouldRedo=[]}this.emit("event:appState:change","redoCount",this.idsCouldRedo.length)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldRedo.length&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",n=0,r=e.length-1;r>=0;r--){var a=e[r];if("undo"===a.data.type&&0===n){t=a.opId;break}"undo"===a.data.type?n--:"redo"===a.data.type?n++:a.data.skipUndo||c.snapshotOutOfNormalFlowTypes.includes(a.data.type)||console.warn("白板--\x3e","redo操作之前有非undo操作。请查看具体细节",e)}return{type:this.type,redoOpId:t}}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(16)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="clear",e.description="清空操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"isAvailable",value:function(){return(0,r.default)(this.drawOpsOfPage).length>0}},{key:"registerHooks",value:function(){this.opsManager.hooks.refresh.tap("RefreshPlugin",this.onRefresh.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){(0,r.default)(this.drawOpsOfPage).length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"onRefresh",value:function(){var e=(0,r.default)(this.drawOpsOfPage).length>0;this.emit("event:appState:change","clearAvailable",e)}}]),t}(c(n(8)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="eraser",e.eraserColor="rgba(230, 100, 100, .4)",e.width=20,e.points=[],e.description="橡皮擦。\n首先使用op:eraser:activate设置画布为橡皮擦模式。具体用法如下：",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"eraser:width":{value:this.setWidth.bind(this),information:{args:"width: number",message:"设置橡皮擦宽度"}},"eraser:color":{value:this.setColor.bind(this),information:{args:"color: Color",message:"设置橡皮擦聚光灯颜色"}}}}},{key:"handleMouseMove",value:function(e,t,n){this.isMouseDown&&(this.points.push([t,n]),this.dispatch(this.getSnapshot()))}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.points=[],this.points.push([t,n])}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&(this.dispatch(this.getSnapshot()),this.points=[])}},{key:"getSnapshot",value:function(){return{type:this.type,points:this.points.slice(),width:this.width}}},{key:"draw",value:function(e,t){t.save(),t.fillStyle="rgb(0, 0, 0)";var n=e.data.points;t.beginPath(),t.globalCompositeOperation="destination-out";for(var r=1;r<n.length;r++)t.moveTo(n[r][0],n[r][1]),t.arc(n[r][0],n[r][1],this.width,0,2*Math.PI,!0);t.fill(),t.restore(),this.drawEraserSignpost(t)}},{key:"drawEraserSignpost",value:function(e){this.opsManager.currOp instanceof t&&this.isMouseDown&&(e.beginPath(),e.arc(this.points[this.points.length-1][0],this.points[this.points.length-1][1],this.width,0,2*Math.PI,!0),e.fillStyle=this.eraserColor,e.fill())}},{key:"setWidth",value:function(e){this.width=e}},{key:"setColor",value:function(e){this.eraserColor=e}}]),t}(u(n(8)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(6)),a=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4)),c=n(17);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="rect",e.isFill=!1,e.supportFill=!0,e.shouldSaniteEp=!0,e.description="绘制矩形。\n首先使用op:rect:activate设置画布为矩形模式。通过op:rect:lineWidth, op:rect:stroke, op:rect:fill设置矩形的宽度和颜色。然后画布会监听鼠标动作，生成矩形。具体用法如下：",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getSnapshot",value:function(e){var t={boundary:this.getBoundaryRect()};return(0,r.default)((0,r.default)({},t),{type:this.type,sp:this.sp,ep:this.ep,stroke:this.isFill?void 0:this.color,fill:this.isFill?this.color:void 0,lineWidth:this.lineWidth,inProgress:e})}},{key:"getBoundaryRect",value:function(){return this.getBoundaryRectOfLine()}},{key:"draw",value:function(e,t){var n=e.data,r=(0,c.getTransformedPoint)(n.sp,n.dx,n.dy,n.scaleX,n.scaleY),a=(0,c.getTransformedPoint)(n.ep,n.dx,n.dy,n.scaleX,n.scaleY);t.beginPath(),t.rect(r[0],r[1],a[0]-r[0],a[1]-r[1]),n.stroke&&(t.strokeStyle=n.stroke,t.lineWidth=n.lineWidth,t.stroke()),n.fill&&(t.fillStyle=n.fill,t.fill())}}]),t}(l(n(84)).default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(6)),a=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4)),c=n(17);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="ellipse",e.isFill=!1,e.supportFill=!0,e.shouldSaniteEp=!0,e.description="绘制椭圆形。\n首先使用op:ellipse:activate设置画布为椭圆形模式。通过op:ellipse:lineWidth, op:ellipse:stroke, op:ellipse:fill设置椭圆形的宽度和颜色。然后画布会监听鼠标动作，生成椭圆形。具体用法如下：",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getSnapshot",value:function(e){var t={boundary:this.getBoundaryRect()};return(0,r.default)((0,r.default)({},t),{type:this.type,sp:this.sp,ep:this.ep,stroke:this.isFill?void 0:this.color,fill:this.isFill?this.color:void 0,lineWidth:this.lineWidth,inProgress:e})}},{key:"getBoundaryRect",value:function(){return this.getBoundaryRectOfLine()}},{key:"draw",value:function(e,t){var n=e.data,r=(0,c.getTransformedPoint)(n.sp,n.dx,n.dy,n.scaleX,n.scaleY),a=(0,c.getTransformedPoint)(n.ep,n.dx,n.dy,n.scaleX,n.scaleY),i=r[0]/2+a[0]/2,o=r[1]/2+a[1]/2,s=Math.abs(a[0]-r[0])/2,u=Math.abs(a[1]-r[1])/2;t.beginPath(),t.ellipse(i,o,s,u,0,0,2*Math.PI,!0),n.stroke&&(t.strokeStyle=n.stroke,t.lineWidth=n.lineWidth,t.stroke()),n.fill&&(t.fillStyle=n.fill,t.fill())}},{key:"ifMouseOnOp",value:function(e,t,n){var r=this.app.container.ctx,a=e.data,i=(0,c.getTransformedPoint)(a.sp,a.dx,a.dy,a.scaleX,a.scaleY),o=(0,c.getTransformedPoint)(a.ep,a.dx,a.dy,a.scaleX,a.scaleY),s=i[0]/2+o[0]/2,u=i[1]/2+o[1]/2,l=Math.abs(o[0]-i[0])/2,d=Math.abs(o[1]-i[1])/2;return r.beginPath(),r.ellipse(s,u,l,d,0,0,2*Math.PI,!0),r.fillStyle="rgba(0,0,0,0)",r.fill(),r.isPointInPath(t,n)}}]),t}(l(n(84)).default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=v(n(6)),a=v(n(2)),i=v(n(0)),o=v(n(1)),s=v(n(3)),u=v(n(4)),c=v(n(8)),l=n(17),d=v(n(85)),h=n(244),f=v(n(245)),p=n(86);function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));n.type="text",n.dependOn=void 0,n.blurAt=0,n.color="black",n.text="",n.textBeforeEdit="",n.fontSize=p.DEFAULT_FONTSIZE,n.isFocus=!1,n.isNewText=!0,n.description="绘制文字\n首先使用op:text:activate设置画布为文字模式。通过op:text:color, op:text:fontSize, 设置文字的颜色和字体大小。然后画布会监听鼠标动作，生成文本框。具体用法如下：",n.handleTextAreaChange=function(e){var t=e.target.value;t.endsWith("\n")&&(t+="\n"),n.text=t,n.pre.innerText=t||" ",(0,h.setElementsSize)(n.textAreaContainer,n.textArea,n.pre,n.fontSize),n.dispatch(n.getSnapshot(!0))},n.handleTextAreaBlur=function(e){setTimeout((function(){var e=n.opIdToDraw;n.dispatch(n.getSnapshot(!1,n.text===n.textBeforeEdit)),n.isFocus=!1,n.text=" ",(0,h.clearTextArea)(n.textAreaContainer,n.textArea),n.blurAt=(new Date).valueOf(),n.opsManager.setCurrOp("select"),n.opsManager.selectOp.dispatch(n.opsManager.selectOp.getSnapshot([e]))}),0)},n.registerToolbar(new f.default);var r=(0,h.createElements)(),o=r.textAreaContainer,u=r.textArea,c=r.pre;return n.textAreaContainer=o,n.textArea=u,n.pre=c,n.app.on("container:set",(function(){n.app.container.textAreaEl.appendChild(o),n.app.container.textAreaEl.appendChild(c)})),n.app.on("container:resize",(function(){var e;null===(e=n.toolbar)||void 0===e||e.resize(1/n.app.camera.scale)})),n.textArea.oninput=n.handleTextAreaChange,n.textArea.onblur=n.handleTextAreaBlur,(0,h.setElementsSize)(n.textAreaContainer,n.textArea,n.pre,n.fontSize),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.click.tap("ClickPlugin",this.handleClickExistText.bind(this)),this.opsManager.hooks.selectChange.tap("SelectChangePlugin",this.handleSelectChange.bind(this))}},{key:"getIdPrefix",value:function(e,t){return(e+"-"+t).replace(/[\W_]+/g,"-")}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"register:toolbar":{value:this.registerToolbar.bind(this),information:{args:"toolbar: IToolbar",message:"自定义工具栏"}},"text:color":{value:this.setColor.bind(this),information:{args:"color: string",message:"设置文本颜色"}},"text:fontsize":{value:this.setFontSize.bind(this),information:{args:"size: number",message:"设置矩形边框颜色"}}}}},{key:"handleSelectChange",value:function(e,t){var n,r,a=1===e.length&&"text"===this.getOpTypeByOpId(e[0])?e[0]:void 0,i=1===t.length&&"text"===this.getOpTypeByOpId(t[0])?t[0]:void 0;if(a!==i&&i&&this.opsManager.currOp instanceof d.default){var o=this.drawOpsOfPage[i].data,s=(0,l.getTransformedBoundary)(o.boundary,o.dx,o.dy,o.scaleX,o.scaleY);return this.color=o.color,this.fontSize=o.fontSize,this.text=o.text,this.isFocus=!1,(0,h.clearTextArea)(this.textAreaContainer,this.textArea),this.isNewText=!1,this.lastSnapshotData=o,this.dependOn=i,null===(n=this.toolbar)||void 0===n?void 0:n.show({left:s.sx,top:s.sy,container:this.app.container.textAreaEl,fontSize:o.fontSize,scale:1/this.app.camera.scale,color:o.color})}null===(r=this.toolbar)||void 0===r||r.hide()}},{key:"handleClickExistText",value:function(e,t,n){var a,i;if(this.opsManager.currOp instanceof d.default){var o=this.detectIfClickOnText(t,n);if(o){this.opsManager.selectedOpIds.length>0&&this.opsManager.currOp.dispatch(this.opsManager.currOp.getSnapshot([])),this.opsManager.setCurrOp("text");var s=document.getElementById(this.getIdPrefix(o.board,o.page.toString())+"-"+o.opId+"-pre");null===(a=null==s?void 0:s.parentNode)||void 0===a||a.removeChild(s);var u=o.data;this.isFocus=!0,this.isNewText=!1,this.lastSnapshotData=u,this.dependOn=o.opId,this.text=u.text,this.textBeforeEdit=this.text,this.textArea.value=this.text,this.pre.innerText=this.text,this.fontSize=u.fontSize,this.color=u.color;var c=(0,l.getTransformedBoundary)(u.boundary,u.dx,u.dy,u.scaleX,u.scaleY);return(0,h.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,(0,r.default)({fontSize:u.fontSize,color:u.color},c)),null===(i=this.toolbar)||void 0===i||i.show({left:c.sx,top:c.sy,container:this.app.container.textAreaEl,fontSize:u.fontSize,scale:1/this.app.camera.scale,color:u.color}),this.textArea.focus(),this.beginBatch(),!0}}}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.handleClick(e,t,n)}},{key:"handleMouseMove",value:function(e){this.isFocus?document.body.style.cursor="auto":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="text":document.body.style.cursor="auto"}},{key:"handleClick",value:function(e,t,n){var r;this.isFocus||(this.isNewText=!0,this.isFocus=!0,this.dependOn=void 0,this.text=" ",this.textBeforeEdit=this.text,this.pre.innerText=this.text,(0,h.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,{fontSize:this.fontSize,color:this.color,sx:t,sy:n}),this.beginBatch(),null===(r=this.toolbar)||void 0===r||r.show({left:t,top:n,container:this.app.container.textAreaEl,fontSize:this.fontSize,scale:1/this.app.camera.scale,color:this.color}),this.textArea.focus())}},{key:"getSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.isNewText?{boundary:this.getBoundaryRect(this.isNewText),type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,inProgress:e,skipUndo:e||t}:{type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,boundary:this.getBoundaryRect(this.isNewText),dependOn:this.dependOn,inProgress:e,skipUndo:e||t}}},{key:"getBoundaryRect",value:function(e){var t=this.workingPre.getBoundingClientRect(),n=t.width,r=t.height;n/=this.app.camera.scale,r/=this.app.camera.scale;var a=void 0;if(e){var i=t.x-this.app.container.left,o=t.y-this.app.container.top;a=this.app.camera.convertToPointInWorld(i,o)}else{var s=this.lastSnapshotData,u=(0,l.getTransformedBoundary)(s.boundary,s.dx,s.dy,s.scaleX,s.scaleY);a=[u.sx,u.sy]}return{sx:a[0],sy:a[1],w:n,h:r}}},{key:"draw",value:function(e,t,n){var r=n.div,a=e.opId===this.dependOn||e.opId===this.opIdToDraw;if(!this.isFocus||!a){var i=this.app.room.currIndex,o=this.app.room.currBoard.currIndex,s=this.getIdPrefix(i,o.toString())+"-"+e.opId+"-pre";if(!r.querySelector("[id='"+s+"']")){var u=document.createElement("pre");u.id=s,r.appendChild(u)}var c=r.querySelector("[id='"+s+"']");c?this.drawSnapshot(e.data,c,e.opId):console.error("白板--\x3e","找不到id为: "+s+" 的pre")}}},{key:"preview",value:function(e,t){var n=e.data,r=(0,l.getTransformedBoundary)(n.boundary,n.dx,n.dy,n.scaleX,n.scaleY),a=r.sx,i=r.sy,o=h.PADDING*n.fontSize/p.DEFAULT_FONTSIZE;t.save(),t.fillStyle=n.color,t.font=n.fontSize+"px sans-serif",t.textAlign="left",t.textBaseline="top",t.fillText(n.text,a+o,i+o),t.restore()}},{key:"hide",value:function(e,t,n){var r,a=document.getElementById(this.getIdPrefix(e.board,e.page.toString())+"-"+e.opId+"-pre");null===(r=null==a?void 0:a.parentNode)||void 0===r||r.removeChild(a)}},{key:"drawSnapshot",value:function(e,t,n){var r,a,i,o=(0,l.getTransformedBoundary)(e.boundary,e.dx,e.dy,e.scaleX,e.scaleY),s=o.sx,u=o.sy;(0,h.drawTextSnapshot)(t,{text:e.text,sx:s,sy:u,fontSize:e.fontSize,color:e.color}),1===this.opsManager.selectedOpIds.length&&this.opsManager.selectedOpIds[0]===n&&(this.fontSize=e.fontSize,this.color=e.color,null===(r=this.toolbar)||void 0===r||r.setFontsize(e.fontSize),null===(a=this.toolbar)||void 0===a||a.setColor(e.color),null===(i=this.toolbar)||void 0===i||i.updatePosition({left:s,top:u}))}},{key:"detectIfClickOnText",value:function(e,t){for(var n in this.drawOpsOfPage)if("text"===this.drawOpsOfPage[n].data.type){var r=this.drawOpsOfPage[n].data,a=(0,l.getTransformedBoundary)(r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);if((0,l.pointInRect)(a,[e,t]))return this.drawOpsOfPage[n]}}},{key:"setFontSize",value:function(e){this.fontSize!==e&&(this.fontSize=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,this.text=this.lastSnapshotData.text,(0,h.setElementsSize)(this.textAreaContainer,this.textArea,this.workingPre,this.fontSize),this.dispatch(this.getSnapshot(!1)))}},{key:"setColor",value:function(e){this.color!==e&&(this.color=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,this.text=this.lastSnapshotData.text,this.dispatch(this.getSnapshot(!1)))}},{key:"registerToolbar",value:function(e){this.toolbar=e,this.toolbar.onFontSizeChange(this.setFontSize.bind(this)),this.toolbar.onColorChange(this.setColor.bind(this))}},{key:"transformOp",value:function(e,t){var n=t.data,a=(0,r.default)({},e.data);for(var i in n)"dependOn"!==i&&(a[i]=n[i]);return a.dx=0,a.dy=0,a.scaleX={coordinate:0,factor:1},a.scaleY={coordinate:0,factor:1},(0,r.default)({},e,{data:a})}},{key:"opIdToDraw",get:function(){return this.isNewText?this.opIdForseen(this.type,this.dependOn):this.dependOn}},{key:"workingPre",get:function(){if(this.isFocus)return this.pre;var e=this.app.room.currIndex,t=this.app.room.currBoard.currIndex.toString();return document.getElementById(this.getIdPrefix(e,t)+"-"+this.dependOn+"-pre")}}]),t}(c.default);t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PADDING=t.MIN_WIDTH=void 0,t.createElements=function(){var e=document.createElement("textarea"),t=document.createElement("pre"),n=document.createElement("div");return n.style.position="absolute",n.style.display="none",n.style.outline="1px dashed black",e.style.resize="none",e.style.overflow="hidden",e.style["white-space"]="nowrap",e.style.background="transparent",e.style.fontFamily="monospace",e.style.fontSize=r.DEFAULT_FONTSIZE+"px",e.style.transformOrigin="left top",e.style.padding=i+"px",e.style.border="none",e.style.outline="none",e.style.boxSizing="content-box",t.style.width="fit-content",t.style.position="absolute",t.style.userSelect="none",t.style.pointerEvents="none",t.style.visibility="hidden",t.style.fontFamily="monospace",t.style.fontSize=r.DEFAULT_FONTSIZE+"px",t.style.transformOrigin="left top",t.style.padding=i+"px",t.style.margin="0",t.style.boxSizing="border-box",n.appendChild(e),{textAreaContainer:n,textArea:e,pre:t}},t.setElementsStyle=function(e,t,n,s){e.style.display="block",e.style.left=s.sx+"px",e.style.top=s.sy+"px",n.style.left=s.sx+"px",n.style.top=s.sy+"px",t.style.color=s.color,t.style.width=(s.w||a)*r.DEFAULT_FONTSIZE/s.fontSize-2*i+"px",t.style.height=(s.h||s.fontSize+12)*r.DEFAULT_FONTSIZE/s.fontSize-2*i+"px",o(e,t,n,s.fontSize)},t.setElementsSize=o,t.drawTextSnapshot=function(e,t){e.innerText=t.text,e.style.color=t.color,e.style.left=t.sx+"px",e.style.top=t.sy+"px",e.style.position="absolute",e.style.fontFamily="monospace",e.style.fontSize=r.DEFAULT_FONTSIZE+"px",e.style.margin="0",e.style.transform="scale("+t.fontSize/r.DEFAULT_FONTSIZE+")",e.style.userSelect="none",e.style.transformOrigin="left top",e.style.padding=i+"px",e.style.pointerEvents="none"},t.clearTextArea=function(e,t){t.value="",e.style.display="none"};var r=n(86),a=t.MIN_WIDTH=20,i=t.PADDING=4;function o(e,t,n,a){n.style.transform="scale("+a/r.DEFAULT_FONTSIZE+")",t.style.transform="scale("+a/r.DEFAULT_FONTSIZE+")",t.style.width=n.clientWidth-2*i+"px",t.style.height=n.clientHeight-2*i+"px",e.style.width=n.clientWidth*a/r.DEFAULT_FONTSIZE+"px",e.style.height=n.clientHeight*a/r.DEFAULT_FONTSIZE+"px"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),a=s(n(1)),i=n(86),o=n(246);function s(e){return e&&e.__esModule?e:{default:e}}n(247);var u="iower-23nsdf090sd",c=function(){function e(){(0,r.default)(this,e),this.fontSize=i.DEFAULT_FONTSIZE,this.color="black",this.fonts=[8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88],this.colors=["rgb(224,32,32)","rgb(250,100,0)","rgb(247,181,0)","rgb(109,212,0)","rgb(68,215,182)","rgb(50,197,255)","rgb(0,145,255)","rgb(98,54,255)","rgb(182,32,224)","rgb(109,114,120)","rgb(0,0,0)","rgb(255,255,255)"],this.fontInputPrevValue="",this.colorCells=[],this.colorPlatteOpen=!1,this.toolbarContainer=document.createElement("div"),this.toolbarContainer.className="text-toolbar",this.toolbarContainer.id=u,this.colorBtn=document.createElement("div"),this.colorBtn.innerText="",this.colorBtn.className="color flex-cell";var t=document.createElement("span");this.colorBtn.appendChild(t),this.colorPlatteContainer=document.createElement("div"),this.colorPlatteContainer.className="platte-container",this.colorPlatteContainer.onmousemove=function(e){e.stopPropagation()};for(var n=0;n<this.colors.length;n++){var a=document.createElement("div");a.className="color-cell",a.style.backgroundColor=this.colors[n],"rgb(255,255,255)"===this.colors[n]&&(a.style.border="1px solid #D9D9DB"),this.colorPlatteContainer.appendChild(a),this.colorCells.push(a)}this.fontInput=document.createElement("input"),this.fontInput.className="fontsize input",this.fontIncBtn=document.createElement("div"),this.fontIncBtn.className="fontsize inc flex-cell";var o=document.createElement("span");o.innerText="+",this.fontIncBtn.appendChild(o),this.fontDecBtn=document.createElement("div"),this.fontDecBtn.className="fontsize dec flex-cell";var s=document.createElement("span");s.innerText="-",this.fontDecBtn.appendChild(s),this.toolbarContainer.appendChild(this.fontInput),this.toolbarContainer.appendChild(this.fontIncBtn),this.toolbarContainer.appendChild(this.fontDecBtn),this.toolbarContainer.appendChild(this.colorBtn),this.toolbarContainer.appendChild(this.colorPlatteContainer),this._registerEvents(),this._stopPropagation()}return(0,a.default)(e,[{key:"show",value:function(e){var t=e.left,n=e.top,r=e.container,a=e.fontSize,i=e.color,o=e.scale;this.setFontsize(a),this.setColor(i),document.getElementById(u)||r.appendChild(this.toolbarContainer),this.toolbarContainer.style.display="flex",this.toolbarContainer.style.transformOrigin="left bottom",this.toolbarContainer.style.transform="scale("+o+")",this.colorPlatteContainer.style.display="none",this.updatePosition({left:t,top:n})}},{key:"resize",value:function(e){this.toolbarContainer.style.transform="scale("+e+")"}},{key:"updatePosition",value:function(e){var t=e.left,n=e.top;this.toolbarContainer.style.left=t-23+"px",this.toolbarContainer.style.top=n-78+"px"}},{key:"hide",value:function(){this.toolbarContainer.style.display="none"}},{key:"setFontsize",value:function(e){this.fontSize=e,this.fontInputPrevValue=Math.round(e).toString(),this.fontInput.value=this.fontInputPrevValue}},{key:"setColor",value:function(e){this.color=e,this.colorBtn.firstChild.style.backgroundColor=this.color,this.setColorPlatteState(!1)}},{key:"setColorPlatteState",value:function(e){this.colorPlatteOpen=e,this.colorPlatteContainer.style.display=e?"flex":"none"}},{key:"onFontSizeChange",value:function(e){this.fontSizeCb=e}},{key:"onColorChange",value:function(e){this.colorCb=e}},{key:"_registerEvents",value:function(){for(var e=this,t=function(t){e.colorCells[t].onclick=function(n){e.setColor(e.colors[t]),e.colorCb&&e.colorCb(e.color)}},n=0;n<this.colorCells.length;n++)t(n);this.colorBtn.onclick=function(t){e.setColorPlatteState(!e.colorPlatteOpen)},this.fontIncBtn.onclick=function(t){e.fontSize<o.MAX_FONT_SIZE&&e._sendFontChangeCommand(Math.min(e.fontSize+8,o.MAX_FONT_SIZE))},this.fontDecBtn.onclick=function(t){e.fontSize>o.MIN_FONT_SIZE&&e._sendFontChangeCommand(Math.max(e.fontSize-8,o.MIN_FONT_SIZE))};var r=function(t){var n=e.fontInput.value;if(""!==n){var r=(0,o.testFontSizeText)(n),a=void 0;a="exceed_max"===r?o.MAX_FONT_SIZE:"exceed_min"===r?o.MIN_FONT_SIZE:Number(n),e.fontInput.value=a,e.fontInputPrevValue=a.toString(),e._sendFontChangeCommand(e.fontInput.value),t&&e.fontInput.blur()}};this.fontInput.onkeydown=function(e){e.stopPropagation(),"Enter"===e.key&&r(!0)},this.fontInput.onblur=function(){r(!1)},this.fontInput.oninput=function(t){var n=t.target.value;n=n.replace(/\D/g,""),e.fontInput.value=n}}},{key:"_sendFontChangeCommand",value:function(e){var t="string"==typeof e?Number(e):e;this.setFontsize(t),this.fontSizeCb&&this.fontSizeCb(this.fontSize)}},{key:"_stopPropagation",value:function(){this.toolbarContainer.onmousedown=function(e){e.stopPropagation()},this.toolbarContainer.ontouchstart=function(e){e.stopPropagation()}}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testFontSizeText=function(e){var t=Number(e);return isNaN(t)?"nan":t>r?"exceed_max":t<=a?"exceed_min":"valid"};var r=t.MAX_FONT_SIZE=999,a=t.MIN_FONT_SIZE=12},function(e,t,n){var r=n(248);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(22)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(21)(!1)).push([e.i,".text-toolbar {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-around;\n\n    position: absolute;\n\n    box-sizing: border-box;\n    height: 48px;\n    margin: 12px 12px 24px;\n\n    -webkit-user-select: none;\n\n       -moz-user-select: none;\n\n        -ms-user-select: none;\n\n            user-select: none;\n    background-color: white;\n    border-radius: 4px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n    z-index: 7;\n}\n\n    .text-toolbar .flex-cell {\n        display: flex;\n        flex: 1;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        border: none;\n        width: 40px;\n        height: 40px;\n    }\n\n    .text-toolbar .color {\n        border-radius: 12px;\n    }\n\n    .text-toolbar .color span {\n            width: 18px;\n            height: 18px;\n            border-radius: 9px;\n        }\n\n    .text-toolbar .fontsize.input {\n        height: 24px;\n        vertical-align: top;\n        box-sizing: border-box;\n        width: 40px;\n        outline: none;\n        border: 1px solid rgba(0, 0, 0, 0.3);\n        margin: 0 6px 0 8px;\n        text-align: center;\n    }\n\n    .text-toolbar .fontsize.inc, .text-toolbar .fontsize.dec {\n        border-radius: 12px;\n        font-size: 32px;\n        line-height: 24px;\n        text-align: center;\n        vertical-align: top;\n        position: relative;\n        top: -3px;\n    }\n\n    .text-toolbar .platte-container {\n        position: absolute;\n        display: none;\n        flex-direction: row;\n        flex-wrap: wrap;\n\n        align-items: center;\n        justify-content: space-around;\n        box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n        bottom: 56px;\n        right: 0;\n        background-color: white;\n        width: 100%;\n    }\n\n    .text-toolbar .platte-container .color-cell {\n            width: 20px;\n            height: 20px;\n            border-radius: 10px;\n            margin: 10px;\n            display: inline-block;\n            box-sizing: border-box\n        }\n\n    .text-toolbar .platte-container .color-cell:hover {\n                cursor: pointer;\n            }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(16)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="page",e.description="页面相关操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("pageChangePlugin",this.onPageChange.bind(this))}},{key:"onPageChange",value:function(){return this.emit("event:appState:change","page",{pageNames:this.opsManager.currBoard.pageNames.slice(),currPage:this.opsManager.currBoard.currIndex})}},{key:"eventsToListen",value:function(){return{"page:goto":{value:this.goto.bind(this),information:{args:"page: number",message:"跳转至页面"}},"page:add":{value:this.add.bind(this),information:{args:"insertAfter?: number",message:"添加页面。默认添加至当前board最后"}},"page:delete":{value:this.delete.bind(this),information:{args:"page: number",message:"删除页面。只有当页面数量大于1时可以删除页面"}}}}},{key:"add",value:function(e){this.dispatch({type:this.type,action:"add",insertAfter:e})}},{key:"goto",value:function(e){e!==this.opsManager.currBoard.currIndex&&this.opsManager.currBoard.pageNames.includes(e.toString())&&this.dispatch({type:this.type,action:"goto",page:e})}},{key:"delete",value:function(e){var t=this.opsManager.currBoard.pages;e in t&&(0,r.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",page:e})}}]),t}(c(n(8)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(8)),c=n(172),l=n(17);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="image",e.description="图片操作",e.dispatchImage=function(t,n,r,a){var i=(0,c.getImageProperPosition)(e,n,r),o=i.sx,s=i.sy,u=i.width,l=i.height;a?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}},a):e.dispatch({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}})},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"image:upload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number\n                    }",message:"上传图片"}}}}},{key:"addImage",value:function(e,t){return(0,c.addImage)(this,e,t)}},{key:"preview",value:function(e,t,n){var r=e.data,a=(0,l.getTransformedBoundary)(r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);return(0,c.draw)(t,r.url,a,{page:n.page,preview:!0})}},{key:"draw",value:function(e,t,n){var r=e.data,a=(0,l.getTransformedBoundary)(r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);return(0,c.draw)(t,r.url,a,{page:n.page,div:n.div,id:e.opId,type:"image"})}},{key:"hide",value:function(e,t,n){var r,a=n.querySelector("[id='image-"+e.opId+"']");null===(r=null==a?void 0:a.parentNode)||void 0===r||r.removeChild(a)}}]),t}(u.default);t.default=h},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgwIiBoZWlnaHQ9IjM2MCIgdmlld0JveD0iMCAwIDQ4MCAzNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wIDBINDgwVjM2MEgwVjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQ3OCAySDJWMzU4SDQ3OFYyWk0wIDBWMzYwSDQ4MFYwSDBaIiBmaWxsPSIjRDlEOURCIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTY2LjI5NCAxMjZIMzE1TDMxNSAxODkuMzg2TDI5NS4wNDkgMTY3LjY0QzI5MS4xNDQgMTYzLjM4NCAyODQuNDU2IDE2My4zMTEgMjgwLjQ2IDE2Ny40ODNMMjM4Ljc5MiAyMTAuOTc3TDIxOS45MTcgMTkxLjU3MkMyMTYuNzg0IDE4OC4zNTEgMjExLjYxMyAxODguMzQxIDIwOC40NjggMTkxLjU1MUwxNjcuMzM4IDIzMy41MjlIMTY2LjI5NEwxNjYuMjk0IDEyNlpNMTY2LjI5NCAyNDEuNTI5QzE2NC40NzggMjQxLjUyOSAxNjIuODAzIDI0MC45MjQgMTYxLjQ2IDIzOS45MDRIMTYxLjA5MkwxNjEuMjUyIDIzOS43NDFDMTU5LjQ0NyAyMzguMjc0IDE1OC4yOTQgMjM2LjAzNiAxNTguMjk0IDIzMy41MjlWMTI2QzE1OC4yOTQgMTIxLjU4MiAxNjEuODc2IDExOCAxNjYuMjk0IDExOEgzMTVDMzE5LjQxOCAxMTggMzIzIDEyMS41ODIgMzIzIDEyNlYyMzMuNTI5QzMyMyAyMzcuOTQ4IDMxOS40MTggMjQxLjUyOSAzMTUgMjQxLjUyOUgxNjYuMjk0Wk0yMDEgMTcxLjgwNEMyMDkuMjg0IDE3MS44MDQgMjE2IDE2NS4wODggMjE2IDE1Ni44MDRDMjE2IDE0OC41MiAyMDkuMjg0IDE0MS44MDQgMjAxIDE0MS44MDRDMTkyLjcxNiAxNDEuODA0IDE4NiAxNDguNTIgMTg2IDE1Ni44MDRDMTg2IDE2NS4wODggMTkyLjcxNiAxNzEuODA0IDIwMSAxNzEuODA0WiIgZmlsbD0iI0U2RTdFQiIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(16)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="board",e.description="board相关操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"onBoardChange",value:function(){return this.emit("event:appState:change","board",{boardNames:(0,r.default)(this.app.room.boards),currBoard:this.app.room.currIndex})}},{key:"eventsToListen",value:function(){return{"board:goto":{value:this.goto.bind(this),information:{args:"boardName: string",message:"跳转至board。若board不存在，则创建board"}},"board:add":{value:this.add.bind(this),information:{args:"boardName: string, pageCount: number",message:"创建[pageCount]页数的board"}},"board:delete":{value:this.delete.bind(this),information:{args:"boardName: string",message:"删除board。只有当board数量大于1时可以删除board"}}}}},{key:"goto",value:function(e){e!==this.app.room.currIndex&&this.dispatch({type:this.type,action:"goto",boardName:e})}},{key:"add",value:function(e,t){if(this.app.room.boards.hasOwnProperty(e))throw new Error("尝试创建的文档"+e+"已存在");this.dispatch({type:this.type,action:"add",boardName:e,pageCount:t})}},{key:"delete",value:function(e){var t=this.app.room.boards;e in t&&(0,r.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",boardName:e})}}]),t}(c(n(8)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COPY_PASTE_SHIFT=void 0;var r=l(n(2)),a=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(8)),c=l(n(254));function l(e){return e&&e.__esModule?e:{default:e}}var d=t.COPY_PASTE_SHIFT=50,h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="duplicate",e.description="拷贝drawable快照",e.copiedSnapshotArray=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"复制当前选中的元素"}}}}},{key:"handleKeyDown",value:function(e){var t=this,n=e.key.toLocaleLowerCase();if("c"===n&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.opsManager.selectedOpIds.length>0){e.preventDefault();var r=this.opsManager.selectedOpIds.filter((function(e){return t.drawOpsOfPage.hasOwnProperty(e)}));return this.copiedSnapshotArray=(0,c.default)(r.map((function(e){return t.drawOpsOfPage[e]}))),!0}if("v"===n&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.copiedSnapshotArray.length>0)return e.preventDefault(),this.execCommand(this.copiedSnapshotArray.slice()),!0}},{key:"execCommand",value:function(e){if(this.opsManager.selectedOpIds.length>0||e&&e.length>0){var t=this.getSnapshot(e);this.dispatch(t);var n=t.duplicates.map((function(e){return e.opId}));this.opsManager.selectOp.dispatch(this.opsManager.selectOp.getSnapshot(n))}}},{key:"getSnapshot",value:function(e){var t=this,n=!!e;if(!e){var r=this.opsManager.selectedOpIds;e=[];for(var a=0;a<r.length;a++){var i=r[a];if(this.drawOpsOfPage.hasOwnProperty(i)){var o=this.drawOpsOfPage[i];e.push(o)}}}return e=e.map((function(e){return(e=(0,c.default)(e)).data.dx=(e.data.dx?e.data.dx:0)+d,e.data.dy=(e.data.dy?e.data.dy:0)+d,e.opId=t.opsManager.currPage.getNextOpId(!0),e})),n&&(this.copiedSnapshotArray=e.slice()),{type:this.type,duplicates:e}}}]),t}(u.default);t.default=h},function(e,t,n){(function(e,n){var r="[object Arguments]",a="[object Function]",i="[object GeneratorFunction]",o="[object Map]",s="[object Set]",u=/\w*$/,c=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,d={};d[r]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[o]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[s]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[a]=d["[object WeakMap]"]=!1;var h="object"==typeof e&&e&&e.Object===Object&&e,f="object"==typeof self&&self&&self.Object===Object&&self,p=h||f||Function("return this")(),v=t&&!t.nodeType&&t,y=v&&"object"==typeof n&&n&&!n.nodeType&&n,g=y&&y.exports===v;function m(e,t){return e.set(t[0],t[1]),e}function w(e,t){return e.add(t),e}function b(e,t,n,r){var a=-1,i=e?e.length:0;for(r&&i&&(n=e[++a]);++a<i;)n=t(n,e[a],a,e);return n}function _(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function k(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function x(e,t){return function(n){return e(t(n))}}function M(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var S,C=Array.prototype,O=Function.prototype,A=Object.prototype,I=p["__core-js_shared__"],P=(S=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||""))?"Symbol(src)_1."+S:"",T=O.toString,E=A.hasOwnProperty,D=A.toString,R=RegExp("^"+T.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=g?p.Buffer:void 0,z=p.Symbol,j=p.Uint8Array,L=x(Object.getPrototypeOf,Object),B=Object.create,F=A.propertyIsEnumerable,U=C.splice,W=Object.getOwnPropertySymbols,H=N?N.isBuffer:void 0,Y=x(Object.keys,Object),Q=ye(p,"DataView"),Z=ye(p,"Map"),X=ye(p,"Promise"),K=ye(p,"Set"),V=ye(p,"WeakMap"),G=ye(Object,"create"),q=_e(Q),J=_e(Z),$=_e(X),ee=_e(K),te=_e(V),ne=z?z.prototype:void 0,re=ne?ne.valueOf:void 0;function ae(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function oe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function se(e){this.__data__=new ie(e)}function ue(e,t){var n=xe(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Me(e)}(e)&&E.call(e,"callee")&&(!F.call(e,"callee")||D.call(e)==r)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],a=n.length,i=!!a;for(var o in e)!t&&!E.call(e,o)||i&&("length"==o||we(o,a))||n.push(o);return n}function ce(e,t,n){var r=e[t];E.call(e,t)&&ke(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function le(e,t){for(var n=e.length;n--;)if(ke(e[n][0],t))return n;return-1}function de(e,t,n,c,l,h,f){var p;if(c&&(p=h?c(e,l,h,f):c(e)),void 0!==p)return p;if(!Oe(e))return e;var v=xe(e);if(v){if(p=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&E.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,p)}else{var y=me(e),g=y==a||y==i;if(Se(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if("[object Object]"==y||y==r||g&&!h){if(_(e))return h?e:{};if(p=function(e){return"function"!=typeof e.constructor||be(e)?{}:(t=L(e),Oe(t)?B(t):{});var t}(g?{}:e),!t)return function(e,t){return pe(e,ge(e),t)}(e,function(e,t){return e&&pe(t,Ae(t),e)}(p,e))}else{if(!d[y])return h?e:{};p=function(e,t,n,r){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return fe(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return function(e,t){var n=t?fe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var n=t?fe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case o:return function(e,t,n){return b(t?n(k(e),!0):k(e),m,new e.constructor)}(e,r,n);case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,u.exec(e));return t.lastIndex=e.lastIndex,t}(e);case s:return function(e,t,n){return b(t?n(M(e),!0):M(e),w,new e.constructor)}(e,r,n);case"[object Symbol]":return i=e,re?Object(re.call(i)):{}}var i}(e,y,de,t)}}f||(f=new se);var x=f.get(e);if(x)return x;if(f.set(e,p),!v)var S=n?function(e){return function(e,t,n){var r=t(e);return xe(e)?r:function(e,t){for(var n=-1,r=t.length,a=e.length;++n<r;)e[a+n]=t[n];return e}(r,n(e))}(e,Ae,ge)}(e):Ae(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(S||e,(function(r,a){S&&(r=e[a=r]),ce(p,a,de(r,t,n,c,a,e,f))})),p}function he(e){return!(!Oe(e)||(t=e,P&&P in t))&&(Ce(e)||_(e)?R:c).test(_e(e));var t}function fe(e){var t=new e.constructor(e.byteLength);return new j(t).set(new j(e)),t}function pe(e,t,n,r){n||(n={});for(var a=-1,i=t.length;++a<i;){var o=t[a],s=r?r(n[o],e[o],o,n,e):void 0;ce(n,o,void 0===s?e[o]:s)}return n}function ve(e,t){var n,r,a=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?a["string"==typeof t?"string":"hash"]:a.map}function ye(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return he(n)?n:void 0}ae.prototype.clear=function(){this.__data__=G?G(null):{}},ae.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ae.prototype.get=function(e){var t=this.__data__;if(G){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return E.call(t,e)?t[e]:void 0},ae.prototype.has=function(e){var t=this.__data__;return G?void 0!==t[e]:E.call(t,e)},ae.prototype.set=function(e,t){return this.__data__[e]=G&&void 0===t?"__lodash_hash_undefined__":t,this},ie.prototype.clear=function(){this.__data__=[]},ie.prototype.delete=function(e){var t=this.__data__,n=le(t,e);return!(n<0)&&(n==t.length-1?t.pop():U.call(t,n,1),!0)},ie.prototype.get=function(e){var t=this.__data__,n=le(t,e);return n<0?void 0:t[n][1]},ie.prototype.has=function(e){return le(this.__data__,e)>-1},ie.prototype.set=function(e,t){var n=this.__data__,r=le(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},oe.prototype.clear=function(){this.__data__={hash:new ae,map:new(Z||ie),string:new ae}},oe.prototype.delete=function(e){return ve(this,e).delete(e)},oe.prototype.get=function(e){return ve(this,e).get(e)},oe.prototype.has=function(e){return ve(this,e).has(e)},oe.prototype.set=function(e,t){return ve(this,e).set(e,t),this},se.prototype.clear=function(){this.__data__=new ie},se.prototype.delete=function(e){return this.__data__.delete(e)},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ie){var r=n.__data__;if(!Z||r.length<199)return r.push([e,t]),this;n=this.__data__=new oe(r)}return n.set(e,t),this};var ge=W?x(W,Object):function(){return[]},me=function(e){return D.call(e)};function we(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function be(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||A)}function _e(e){if(null!=e){try{return T.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ke(e,t){return e===t||e!=e&&t!=t}(Q&&"[object DataView]"!=me(new Q(new ArrayBuffer(1)))||Z&&me(new Z)!=o||X&&"[object Promise]"!=me(X.resolve())||K&&me(new K)!=s||V&&"[object WeakMap]"!=me(new V))&&(me=function(e){var t=D.call(e),n="[object Object]"==t?e.constructor:void 0,r=n?_e(n):void 0;if(r)switch(r){case q:return"[object DataView]";case J:return o;case $:return"[object Promise]";case ee:return s;case te:return"[object WeakMap]"}return t});var xe=Array.isArray;function Me(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!Ce(e)}var Se=H||function(){return!1};function Ce(e){var t=Oe(e)?D.call(e):"";return t==a||t==i}function Oe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ae(e){return Me(e)?ue(e):function(e){if(!be(e))return Y(e);var t=[];for(var n in Object(e))E.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}n.exports=function(e){return de(e,!0,!0)}}).call(this,n(255),n(174)(e))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(44)),a=f(n(6)),i=f(n(2)),o=f(n(0)),s=f(n(1)),u=f(n(3)),c=f(n(4)),l=n(17),d=f(n(167)),h=f(n(40));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="pen-arrow",e.description="带箭头的涂鸦操作工具。\n首先使用op:pen-arrow:activate设置画布为涂鸦模式。通过op:pen-arrow:lineWidth, op:pen-arrow:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getArrowPoints",value:function(e,t){var n=[];if(e.length>1&&t){var r=e.length>2?[e[e.length-3],e[e.length-1]]:e.slice(e.length-2),a=(0,l.getLineCoef)(r);if((0,l.dist)(r[0],r[1])>1){var i=r[1][0]-r[0][0]>0?(0,l.getXFromCoefAndOffset)(r[1],a,1):2*r[1][0]-(0,l.getXFromCoefAndOffset)(r[1],a,1),o=r[1][0]-r[0][0]==0?r[1][1]+(r[1][1]-r[0][1]>0?1:-1):(0,l.getLineFromPointsY)(r,i);r.push([i,o])}n=(0,l.getArrowPoints)(this.lineWidth+1,r)}return n}},{key:"getSnapshot",value:function(e){var t=this.momentumPoints,n=!e&&t.length>2,r=this.getArrowPoints(t,n),i={boundary:this.getBoundaryRect()},o=this.opsManager.currPage.getOpId(),s=this.app.room.opIdSnapshotMap[o];return s&&s.snapshot.hasOwnProperty("category")?this.sampleSeq>0&&e?(0,a.default)((0,a.default)({},i),{points:t.slice(t.length-h.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,a.default)((0,a.default)({},i),{points:t.slice(t.length-h.default.pointsPerBatch),arrowPoints:r,inProgress:e,total:t.length}):(0,a.default)((0,a.default)({},i),{type:this.type,points:t.slice(),color:this.color,lineWidth:this.lineWidth,arrowPoints:r,inProgress:e,total:t.length}):(0,a.default)((0,a.default)({},i),{type:this.type,points:t.slice(),color:this.color,lineWidth:this.lineWidth,arrowPoints:r,inProgress:e,total:t.length})}},{key:"draw",value:function(e,t){var n=e.data,a=n.points;t.beginPath();var i=(0,l.getTransformedPoint)(a[0],n.dx,n.dy,n.scaleX,n.scaleY);t.moveTo.apply(t,(0,r.default)(i));for(var o=1;o<a.length;o++){var s=(0,l.getTransformedPoint)(a[o],n.dx,n.dy,n.scaleX,n.scaleY);t.lineTo.apply(t,(0,r.default)(s))}t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke();var u=n.arrowPoints;3===u.length&&(t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(u[0],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(u[1],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(u[2],n.dx,n.dy,n.scaleX,n.scaleY))),t.fillStyle=n.color,t.fill())}}]),t}(d.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(44)),a=d(n(6)),i=d(n(2)),o=d(n(0)),s=d(n(1)),u=d(n(3)),c=d(n(4)),l=n(17);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="line-arrow",e.description="绘制带箭头线段。\n首先使用op:line-arrow:activate设置画布为线段模式。通过op:line-arrow:lineWidth, op:line-arrow:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t=!e&&this.points.length>2,n=[];if(this.points.length>1&&t){var r=[this.sp,this.ep];n=(0,l.getArrowPoints)(this.lineWidth+1,r)}var i={boundary:this.getBoundaryRect()};return(0,a.default)((0,a.default)({},i),{type:this.type,sp:this.sp,ep:this.ep,color:this.color,lineWidth:this.lineWidth,arrowPoints:n,inProgress:e})}},{key:"draw",value:function(e,t){var n=e.data,a=this.getStartEndPointFromSnapshot(n),i=a.sp,o=a.ep;t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(i,n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(o,n.dx,n.dy,n.scaleX,n.scaleY))),t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke();var s=n.arrowPoints;3===s.length&&(t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(s[0],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(s[1],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(s[2],n.dx,n.dy,n.scaleX,n.scaleY))),t.fillStyle=n.color,t.fill())}}]),t}(d(n(169)).default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(6)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="element-eraser",e.description="删除元素。",e.lastSelectedOpIds=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"postMouseMove",value:function(e){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(175)+") -1 17, auto":document.body.style.cursor="auto"}},{key:"postMouseUp",value:function(e){this.postClick(e)}},{key:"postClick",value:function(e){this.dispatch(this.getSelectionSnapshot(!1,[])),e.length>0&&this.dispatch(this.getSnapshot(e)),this.lastSelectedOpIds=[]}},{key:"getSnapshot",value:function(e){var t=e.slice();return{type:"element-eraser",deleteOpIds:t,dependOn:t}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{hidden:!0});return(0,r.default)({},e,{data:n})}}]),t}(c(n(170)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(8)),c=d(n(40)),l=n(73);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="laser",e.description="镭射灯",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this))}},{key:"handleOpChange",value:function(e){var t;"laser"!==e&&"laser"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&(document.body.style.cursor="default",this.dispatch(this.getSnapshot(!1)))}},{key:"handleMouseLeave",value:function(e,t,n){this.dispatch(this.getSnapshot(!1))}},{key:"handleMouseMove",value:function(e,t,n){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="none":document.body.style.cursor="auto",this.dispatch(this.getSnapshot(!0,[t,n]))}},{key:"getSnapshot",value:function(e,t){return{type:"laser",point:t,inProgress:e,skipUndo:!0,reuseOpType:"laser",color:c.default.strokeColor}}},{key:"draw",value:function(e,t){var n=e.data,r=6/this.app.camera.scale;e.data.inProgress&&n.point&&(t.save(),t.beginPath(),t.arc(n.point[0],n.point[1],r,0,2*Math.PI,!0),t.shadowColor="rgba(255, 0, 0, 0.5)",t.shadowBlur=8,t.fillStyle="#ff0000",t.fill(),t.restore(),e.uid!==this.app.account&&(0,l.drawUserName)({ctx:t,account:e.uid,scale:this.app.camera.scale,px:n.point[0],py:n.point[1],bgColor:n.color}))}}]),t}(u.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(6)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="lock",e.description="锁定元素。",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{lock:{value:this.lockOps.bind(this),information:{args:"opIds",message:"锁定元素"}},unlock:{value:this.unlockOps.bind(this),information:{args:"opIds",message:"解锁元素"}}}}},{key:"lockOps",value:function(e){this.dispatch(this.getSnapshot(e,"lock"))}},{key:"unlockOps",value:function(e){this.dispatch(this.getSnapshot(e,"unlock"))}},{key:"getSnapshot",value:function(e,t){return{type:this.type,action:t,dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{locked:"lock"===t.data.action});return(0,r.default)({},e,{data:n})}}]),t}(c(n(8)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),a=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(8)),c=n(172);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="background",e.description="设置背景操作",e.getBoundaryFromSnapshot=function(t){var n=void 0;if(t.data.hasOwnProperty("imgWidth")){var r=(0,c.getImageProperPosition)(e,t.data.imgWidth,t.data.imgHeight);n={sx:r.sx,sy:r.sy,w:r.width,h:r.height}}else n=t.data.boundary;return n},e.dispatchImage=function(t,n,r,a){var i=(0,c.getBackgroundImagePorperPosition)(e,n,r),o=i.sx,s=i.sy,u=i.width,l=i.height;a?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}},a):e.dispatch({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}})},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"background:imageUpload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number,\n                        pageIndex?: number\n                    }",message:"上传背景图片"}}}}},{key:"addImage",value:function(e,t){return(0,c.addImage)(this,e,t)}},{key:"preview",value:function(e,t,n){var r=e.data;return(0,c.draw)(t,r.url,this.getBoundaryFromSnapshot(e),{page:n.page,preview:!0})}},{key:"draw",value:function(e,t,n){var r=e.data;return(0,c.draw)(t,r.url,this.getBoundaryFromSnapshot(e),{page:n.page,div:n.div,id:e.opId,type:"background"})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(2)),a=h(n(0)),i=h(n(1)),o=h(n(3)),s=h(n(4)),u=h(n(8)),c=n(48),l=n(74),d=n(45);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="pan",e.activate=!1,e.description="平移操作",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handleMouseMove",value:function(e,t,n,r,a){this.app.enableCameraTransform&&(0,l.shouldDispatch)(this.app)&&(this.activate?document.body.style.cursor="grabbing":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="grab":document.body.style.cursor="auto",this.activate&&this.lastPoint&&(this.dispatch(this.getSnapshot(r-this.lastPoint[0],a-this.lastPoint[1])),this.lastPoint=[r,a]))}},{key:"handleMouseDown",value:function(e,t,n,r,a){this.app.cameraTransformEnabled&&((0,l.shouldDispatch)(this.app)?(this.activate=!0,this.beginBatch(),this.lastPoint=[r,a]):(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info"}))}},{key:"handleMouseUp",value:function(e,t,n,r,a){this.app.cameraTransformEnabled&&(0,l.shouldDispatch)(this.app)&&(this.activate&&this.lastPoint&&(this.dispatch(this.getSnapshot(r-this.lastPoint[0],a-this.lastPoint[1])),this.lastPoint=void 0),this.activate=!1)}},{key:"getSnapshot",value:function(e,t){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"pan",dx:-e,dy:-t,animate:!1})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(2)),a=h(n(0)),i=h(n(1)),o=h(n(3)),s=h(n(4)),u=h(n(8)),c=n(48),l=n(74),d=n(45);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="zoom",e.sp=[0,0],e.description="缩放操作",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousewheel.tap("MousewheelPlugin",this.handleMouseWheel.bind(this))}},{key:"eventsToListen",value:function(){return{"zoom:in":{value:this.zoomIn.bind(this),information:{args:"",message:"缩放"}},"zoom:out":{value:this.zoomOut.bind(this),information:{args:"",message:"缩放"}},"zoom:to":{value:this.zoomTo.bind(this),information:{args:"scale: number, animate: boolean",message:"缩放"}}}}},{key:"handleMouseWheel",value:function(e,t,n,r,a){if(this.app.cameraTransformEnabled)if((0,l.shouldDispatch)(this.app)){var i=void 0;i=e.deltaY>0?1/.86:.86,this.app.camera.zoomFactor*i>=20&&i>1||this.app.camera.zoomFactor*i<=.03&&i<1||this.isMouseDown||this.app.container.isTargetOnContainer(e.target)&&(this.beginBatch(),this.dispatch(this.getSnapshot(i,!1,[r,a])))}else(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info"})}},{key:"zoomIn",value:function(){if((0,l.shouldDispatch)(this.app)&&!(this.app.camera.zoomFactor*(1/.86)>=20))return this.beginBatch(),this.dispatch(this.getSnapshot(1/.86,!1))}},{key:"zoomOut",value:function(){if((0,l.shouldDispatch)(this.app)&&!(this.app.camera.zoomFactor/(1/.86)<=.03))return this.beginBatch(),this.dispatch(this.getSnapshot(.86,!1))}},{key:"zoomTo",value:function(e,t){if((0,l.shouldDispatch)(this.app))return this.beginBatch(),this.dispatch(this.getSnapshot(e/this.app.camera.zoomFactor,t))}},{key:"getSnapshot",value:function(e,t,n){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"zoom",animate:t,center:n,scale:e})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(8)),c=n(48),l=n(74);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="reset-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"reset-camera",animate:e})}}]),t}(u.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=y(n(32)),a=y(n(2)),i=y(n(0)),o=y(n(1)),s=y(n(3)),u=y(n(4)),c=y(n(8)),l=y(n(168)),d=y(n(175)),h=y(n(266)),f=n(267),p=y(n(40)),v=n(73);function y(e){return e&&e.__esModule?e:{default:e}}var g=new Image,m=new Image,w=new Image;g.src=l.default,m.src=d.default,w.src=h.default;var b=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="mouse-pointer",e.description="展示鼠标位置",e.sampleSeq=0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseleave.tap("MousemovePlugin",this.handleMouseLeave.bind(this))}},{key:"handleMouseMove",value:function(e,t,n){var r;if(this.app.showCursor&&"laser"!==(null===(r=this.opsManager.currOp)||void 0===r?void 0:r.type)){var a=this.app.container.isTargetOnContainer(e.target);this.sampleSeq%6==0&&this.dispatch(this.getSnapshot([t,n],a)),this.sampleSeq+=1}}},{key:"handleMouseLeave",value:function(e,t,n){var r;this.app.showCursor&&"laser"!==(null===(r=this.opsManager.currOp)||void 0===r?void 0:r.type)&&(this.dispatch(this.getSnapshot([t,n],!1)),this.sampleSeq=0)}},{key:"getSnapshot",value:function(e,t){return{type:"mouse-pointer",point:[Number(e[0].toFixed(1)),Number(e[1].toFixed(1))],c:p.default.strokeColor,show:t?1:0,op:this.opsManager.currOp?this.opsManager.currOp.type:"",reuseOpType:"mouse-pointer",nickname:this.app.nickname}}},{key:"preview",value:function(){}},{key:"draw",value:function(e,t){if(!((new Date).valueOf()-e.time>5e3)){var n=e.data;if(e.uid!==this.app.account&&n.show&&n.point){var a=this.getImageByOpType(n.op),i=this.mapPointInsideContainer(n.point[0],n.point[1]),o=(0,r.default)(i,2),s=o[0],u=o[1];f.DrawOpType.includes(n.op)&&(s-=1/this.app.camera.scale,u-=27/this.app.camera.scale);var c=32/this.app.camera.scale;t.drawImage(a,s,u,c,c),(0,v.drawUserName)({ctx:t,account:n.nickname||e.uid,scale:this.app.camera.scale,px:s,py:u,bgColor:n.c})}}}},{key:"mapPointInsideContainer",value:function(e,t){var n=this.app.camera.convertToPointInWorld(0,0),a=(0,r.default)(n,2),i=a[0],o=a[1],s=this.app.camera.convertToPointInWorld(this.app.container.width,this.app.container.height),u=(0,r.default)(s,2),c=u[0],l=u[1];return e<i+30?e=i+30:e>c-25&&(e=c-25),t<o+30?t=o+30:t>l-15&&(t=l-15),[e,t]}},{key:"getImageByOpType",value:function(e){return"element-eraser"===e?m:f.DrawOpType.includes(e)?g:w}}]),t}(c.default);t.default=b},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MzA2MTkyNDQ5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwOTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU2IDBsNjEyLjY1MDY2NyA1NzMuODI0LTI1MC4yODI2NjcgMjIuNzQxMzMzLTQ1LjQ0IDQuMDk2IDE4LjkwMTMzMyA0MS41NTczMzMgMTUxLjg1MDY2NyAzMzIuNTQ0TDYzMS42OCAxMDI0bC0xNDQuODk2LTMzNi4xMjgtMTguMTc2LTQyLjM2OC0zMy41Nzg2NjcgMzEuNTMwNjY3LTE3Ny43OTIgMTY2Ljc0MTMzM0wyNTYgMCIgcC1pZD0iMjA5NyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DrawOpType=["ellipse","rect","pen","pen-arrow","line","line-arrow"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),a=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(8)),c=n(48);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="resize-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.resize.tap("ResizePlugin",this.handleResize.bind(this))}},{key:"handleResize",value:function(e,t,n){"follower"===this.app.vision.mode?this.app.camera.updateTransParamAndRefresh():this.dispatch(this.getSnapshot(t,n))}},{key:"getSnapshot",value:function(e,t){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"resize-camera",width:e,height:t,animate:!1})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(8)),c=n(48),l=n(74);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="fit-to-content",e.description="缩放至完全包含内容",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-content",animate:e})}}]),t}(u.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(8)),c=n(48),l=n(74);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="fit-to-doc",e.description="缩放至完全包含文档",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app)&&this.app.room.currBoard.currPage.backgroundSnapshot)return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-doc",animate:e})}}]),t}(u.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(12)),a=h(n(16)),i=h(n(0)),o=h(n(1)),s=h(n(184)),u=n(54),c=n(110),l=n(274),d=n(188);function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t,n){(0,i.default)(this,e),this.currIndex="whiteboard",this.isReceivingBatchSnapshots=!1,this.boards={},this.pkgIdOpIdMap={},this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={},this.app=t,this.dataHub=n,this._init()}return(0,o.default)(e,[{key:"getPage",value:function(e,t){var n=this.boards[e];if(!n)throw new Error("找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,a.default)(this.app.room.boards).join(","));var r=n.pages[t];if(!r)throw new Error("找不到索引为"+t+"的白板页，当前房间白板页码为: "+n.pageNames.join(","));return r}},{key:"recoverFullSnapshot",value:function(e){if(!this.opIdSnapshotMap.hasOwnProperty(e.opId))return e;var t=this.opIdSnapshotMap[e.opId].snapshot;return this.app.opsManager.mergePartial(t,e)}},{key:"reset",value:function(){var e,t,n,r;console.warn("白板--\x3e","room.reset"),this._init(),null===(t=null===(e=this.currBoard)||void 0===e?void 0:e.currPage)||void 0===t||t.cleanNonCanvasElements(),null===(r=null===(n=this.currBoard)||void 0===n?void 0:n.currPage)||void 0===r||r.refresh()}},{key:"beginReceiveBatchSnapshots",value:function(){this.isReceivingBatchSnapshots=!0}},{key:"endReceiveBatchSnapshots",value:function(e,t,n){var r,a,i,o=this;if(this.isReceivingBatchSnapshots=!1,this.currBoard.currPage.calcDrawOpQueue(),e.length>0){var s=e[e.length-1];s.boundary.width>0&&s.boundary.height>0?s.animate?(0,c.transitionToCameraBound)(this.app.camera,s.boundary,(function(){var e;null===(e=o.app.previewFactory)||void 0===e||e.refreshPreviewsOfCurrBoard(),"function"==typeof n&&n(!0)})):(this.app.camera.setCameraBound(s.boundary),null===(r=this.app.previewFactory)||void 0===r||r.refreshPreviewsOfCurrBoard(),"function"==typeof n&&n(!0)):"function"==typeof n&&n(!1)}else this.currBoard.currPage.refresh(),t?null===(a=this.app.previewFactory)||void 0===a||a.refreshPreviewsOfCurrBoard():null===(i=this.app.previewFactory)||void 0===i||i.refreshPreviewsOfCurrPage(),"function"==typeof n&&n(!1)}},{key:"dispatch",value:function(e){var t=-1!==u.cameraSnapshotTypes.indexOf(e.data.type);if("camera-bound"!==e.data.type||0!==e.data.boundary.width&&0!==e.data.boundary.height){if((this.app.editable||t)&&!this.dataHub.isSynchronizing){var n=this.dataHub.sendSnapshot(e);this.execSnapshot({snapshot:e,pkgId:n})}}else console.error("白板--\x3e error, camera-bound的宽高为0",e)}},{key:"execSnapshot",value:function(e){var t={pkgId:e.pkgId,snapshot:this.recoverFullSnapshot(e.snapshot)};this.cacheSnapshot(t),this.pushSnapshotToQueue(t);var n=t.snapshot;if("inPageOp"===n.category)this.getPage(n.board,n.page.toString()).addOpInPage(n);else if("pageOp"===n.category){var r=this.boards[n.board];r&&r.addOpInBoard(n)}else"globalOp"===n.category?(0,l.addGlobalOp)(this,n):(0,l.addOpInRoom)(this,n)}},{key:"execBatchSnapshots",value:function(e,t){var n=this,a=e.map((function(e){var t={pkgId:e.pkgId,snapshot:n.recoverFullSnapshot(e.snapshot)};return n.cacheSnapshot(t),t})),i=0===a.filter((function(e){return"inPageOp"!==e.snapshot.category})).length,o=a.filter((function(e){return"boardOp"===e.snapshot.category})).length>0,s=a.filter((function(e){return"globalOp"===e.snapshot.category&&"camera-bound"===e.snapshot.data.type})).map((function(e){return{animate:e.snapshot.data.animate,boundary:(0,d.getCameraBoundFromGlobalOp)(n,e.snapshot)}})).filter((function(e){return e.boundary})),u=a.filter((function(e){return"globalOp"!==e.snapshot.category||"camera-bound"!==e.snapshot.data.type}));if(i){var c=!1;u.forEach((function(e){n.pushSnapshotToQueue(e);var t=e.snapshot,r=n.getPage(t.board,t.page.toString());c=r.addOpInPage(t,!1)||c})),c&&this.endReceiveBatchSnapshots([],!1,t)}else{this.beginReceiveBatchSnapshots();try{var l=!0,h=!1,f=void 0;try{for(var p,v=(0,r.default)(u);!(l=(p=v.next()).done);l=!0){var y=p.value;this.execSnapshot(y)}}catch(e){h=!0,f=e}finally{try{!l&&v.return&&v.return()}finally{if(h)throw f}}}finally{this.endReceiveBatchSnapshots(s,o,t)}}}},{key:"cacheSnapshot",value:function(e){var t,n=e.snapshot.opId,r=e.pkgId;if(this.opIdSnapshotMap[n]){e.snapshot=this.recoverFullSnapshot(e.snapshot);var a=this.opIdSnapshotMap[n].pkgId,i=this.pkgIdOpIdMap[a].indexOf(n);this.pkgIdOpIdMap[a].splice(i,1),0===this.pkgIdOpIdMap[a].length&&delete this.pkgIdOpIdMap[a]}this.opIdSnapshotMap[n]=e,(t=this.pkgIdOpIdMap)[r]||(t[r]=[]),this.pkgIdOpIdMap[r].push(n)}},{key:"pushSnapshotToQueue",value:function(e){var t,n,r=e.snapshot.category,a=e.snapshot.opId,i=e.pkgId;if("globalOp"===r)this._pushSnapshotInArray(a,i,this.globalSnapshotIds);else if("boardOp"===r)this._pushSnapshotInArray(a,i,this.boardsSnapshotIds);else if("pageOp"===e.snapshot.category){var o=e.snapshot.board;this.boardOps.hasOwnProperty(o)||(this.boardOps[o]={pageSnapshotIds:[],pages:{}}),(t=this.boardOps[o]).pageSnapshotIds||(t.pageSnapshotIds=[]),this._pushSnapshotInArray(a,i,this.boardOps[o].pageSnapshotIds)}else if("inPageOp"===e.snapshot.category){var s=e.snapshot.board,u=e.snapshot.page;this.boardOps.hasOwnProperty(s)||(this.boardOps[s]={pageSnapshotIds:[],pages:{}}),this.boardOps[s].pages.hasOwnProperty(u)||(this.boardOps[s].pages[u]={inPageSnapshotIds:[]}),(n=this.boardOps[s].pages[u]).inPageSnapshotIds||(n.inPageSnapshotIds=[]),this._pushSnapshotInArray(a,i,this.boardOps[s].pages[u].inPageSnapshotIds)}}},{key:"_pushSnapshotInArray",value:function(e,t,n){var r=n.indexOf(e);-1!==r&&n.splice(r,1);for(var a=n.length;a>=0;a--){if(0===a){n.splice(a,0,e);break}if(this.opIdSnapshotMap[n[a-1]].pkgId<=t){n.splice(a,0,e);break}}}},{key:"mergeDebouncedData",value:function(e,t){if("snapshot"!==t&&e.length>0)return e[e.length-1];if("snapshot"!==t)throw new Error("白板--\x3e mergeDebounceData, dataArr is empty!!");var n={},i=!0,o=!1,s=void 0;try{for(var u,c=(0,r.default)(e);!(i=(u=c.next()).done);i=!0){var l=u.value;"vision"===l.type?n.vision=l:n.hasOwnProperty(l.value.opId)?l.value.hasOwnProperty("category")?n[l.value.opId]=l.value:n[l.value.opId].hasOwnProperty("category")?n[l.value.opId]=this.app.opsManager.mergePartial(n[l.value.opId],l.value):n[l.value.opId]=this.app.opsManager.mergeTwoPartial(n[l.value.opId],l.value):n[l.value.opId]=l.value}}catch(e){o=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}return 1===(0,a.default)(n).length?{type:"snapshot",value:(0,a.default)(n).map((function(e){return n[e]}))[0]}:{type:"snapshotArr",value:(0,a.default)(n).map((function(e){return n[e]}))}}},{key:"_init",value:function(){var e=new s.default(this.app,"whiteboard");this.boards={whiteboard:e},this.currIndex="whiteboard",this.pkgIdOpIdMap={},this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={}}},{key:"currBoard",get:function(){return this.boards[this.currIndex]}}]),e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calcDrawOpQueue=void 0;var r=s(n(12)),a=s(n(59)),i=n(54),o=n(109);function s(e){return e&&e.__esModule?e:{default:e}}var u=new a.default,c=(t.calcDrawOpQueue=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.drawOpQueue={},e.hiddenOpQueue={};var n=f(e,e.opQueue),r=n.normalQueue,a=n.abNormalQueue,i=p(e,r),o=v(e,i),s=y(e,o);c(e,a),l(e,s),t||d(e)},function(e,t){e.backgroundSnapshot=void 0;for(var n=0;n<t.length;n++){var r=t[n];"background"===r.data.type?e.backgroundSnapshot=r:"select"===r.data.type?r.data.inProgress?e.lastInProgressSelectOfUser[r.uid]=r:(delete e.lastInProgressSelectOfUser[r.uid],e.lastSelectOfUser[r.uid]=r):"mouse-pointer"===r.data.type?e.lastMousePointerOfUser[r.uid]=r:r.data.type}}),l=function(e,t){var n={},a=[],i=!0,o=!1,s=void 0;try{for(var c,l=(0,r.default)(t);!(i=(c=l.next()).done);i=!0){var d=c.value;if(e.lastInProgressSelectOfUser={},Array.isArray(d.data.dependOn)){var f=!0,p=!1,v=void 0;try{for(var y,m=(0,r.default)(d.data.dependOn);!(f=(y=m.next()).done);f=!0){var w=y.value;n.hasOwnProperty(w)?(a.push(w),n[w].push(d)):u.has(w)||(u.add(w),console.error("白板--\x3e","miss op",n,d,w,t))}}catch(e){p=!0,v=e}finally{try{!f&&m.return&&m.return()}finally{if(p)throw v}}}else"string"==typeof d.data.dependOn?n.hasOwnProperty(d.data.dependOn)?(a.push(d.data.dependOn),n[d.data.dependOn].push(d)):u.has(d.data.dependOn)||(u.add(d.data.dependOn),console.error("白板--\x3e","miss op",n,d,d.data.dependOn,t)):n[d.opId]=[d]}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}for(var b in g(e,a),n){var _=h(e,b,n);_.data.hidden?e.hiddenOpQueue[b]=_:e.drawOpQueue[b]=_}},d=function(e){if(e.app.room.currBoard.currPage===e){var t=(0,o.getSelectedOpIds)(e);e.opsManager.selectOp.setSelectedOpIds(t);var n=e.lastInProgressSelectOfUser[e.app.account];n?e.opsManager.selectOp.setInProgressSelectedOpIds(n.data.selectedOpIds):e.opsManager.selectOp.setInProgressSelectedOpIds([])}},h=function(e,t,n){for(var r=n[t][0],a=1;a<n[t].length;a++)r=(0,o.transformOp)(e,r,n[t][a]);return r},f=function(e,t){var n=[],a=[],o=!0,s=!1,u=void 0;try{for(var c,l=(0,r.default)(t);!(o=(c=l.next()).done);o=!0){var d=c.value;i.snapshotOutOfNormalFlowTypes.includes(d.data.type)?a.push(d):n.push(d)}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}return{normalQueue:n,abNormalQueue:a}},p=function(e,t){for(var n=t.slice(),r=n.length-1;r>=0;r--){var a=n[r];if("undo"===a.data.type||"redo"===a.data.type)for(var i=a.data.undoOpId||a.data.redoOpId,o=r-1;o>=0;o--)n[o].opId===i&&(n.splice(r,1),n.splice(o,1),r--)}return n},v=function(e,t){for(var n=t.slice(),r=n.length-1;r>=0;r--){if("clear"===n[r].data.type)return g(e,n.slice(0,r+1).map((function(e){return e.opId}))),n=n.slice(r+1)}return n},y=function(e,t){for(var n=[],r=0;r<t.length;r++){var a=t[r];"duplicate"===a.data.type?n=n.concat(a.data.duplicates):n.push(t[r])}return n},g=function(e,t){for(var n in e.lastInProgressSnapshotOfUser){var r=e.lastInProgressSnapshotOfUser[n];t.includes(r.snapshot.opId)&&delete e.lastInProgressSnapshotOfUser[n]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addIncrementSnapshot=void 0;var r=n(186),a=n(109),i=(t.addIncrementSnapshot=function(e,t){"text"===t.data.type?i(e,t):o(e,t)},function(e,t){if(e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString())if(t.data.dependOn){var n=t.data.dependOn,i=e.drawOpQueue[n];i&&(i=(0,a.transformOp)(e,i,t),e.drawOpQueue[n]=i,(0,r.drawText)(e,i),(0,r.drawInProgressSnapshots)(e))}else e.drawOpQueue[t.opId]=t,(0,r.drawText)(e,t)}),o=function(e,t){s(e,t),e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString()&&("laser"===t.data.type&&(0,r.drawInProgressSnapshots)(e),"mouse-pointer"===t.data.type||(e.drawOpQueue[t.opId]=t),(0,r.drawInProgressSnapshots)(e))},s=function(e,t){"select"===t.data.type?t.data.inProgress&&(e.lastInProgressSelectOfUser[t.uid]=t):"mouse-pointer"===t.data.type?e.lastMousePointerOfUser[t.uid]=t:e.lastInProgressSnapshotOfUser.hasOwnProperty(t.uid)&&e.lastInProgressSnapshotOfUser[t.uid].snapshot.opId===t.opId?e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:e.lastInProgressSnapshotOfUser[t.uid].beginAt}:e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:Date.now()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gotoBoard=t.addBoard=t.deleteBoard=t.addOpInRoom=t.addGlobalOp=void 0;var r=u(n(16)),a=n(110),i=u(n(184)),o=n(187),s=n(188);function u(e){return e&&e.__esModule?e:{default:e}}var c=void 0,l=(t.addGlobalOp=function(e,t){var n,r=e.app.camera,i=(0,s.getCameraBoundFromGlobalOp)(e,t);i&&(t.data.animate?(0,a.transitionToCameraBound)(r,i,(function(){var t;null===(t=e.app.previewFactory)||void 0===t||t.refreshPreviewsOfCurrBoard()})):(e.app.camera.setCameraBound(i),null===(n=e.app.previewFactory)||void 0===n||n.refreshPreviewsOfCurrBoard()))},t.addOpInRoom=function(e,t){var n,r=t.data,a=r.action,i=r.boardName;"goto"===a&&h(e,i,t),"delete"===a&&l(e,i,t),"add"===a&&d(e,i,t),e.app.opsManager.hooks.addOpHook.call(t,!0),null===(n=e.app.previewFactory)||void 0===n||n.refreshPreviewsOfCurrBoard()},t.deleteBoard=function(e,t,n){if(e.boards.hasOwnProperty(t))if(1===(0,r.default)(e.boards).length)console.error("白板--\x3e","不能删除最后一个board");else{var a=(0,r.default)(e.boards),i=a.indexOf(t);delete e.boards[t];var s=i;i===a.length-1&&(s=i-1),e.currIndex=(0,r.default)(e.boards)[s];var u=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,o.gotoPage)(u,u.currIndex,n),clearTimeout(c),e.isReceivingBatchSnapshots||(c=setTimeout((function(){e.app.hasBackground()&&e.app.fitToContent(!1)}),0))}else console.error("白板--\x3e","删除board:"+t+", 但是board不存在")}),d=t.addBoard=function(e,t,n){e.boards[t]=new i.default(e.app,t),e.currIndex=t;var r=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call();for(var a=1;a<n.data.pageCount;a++)(0,o.addPage)(r,void 0,n);(0,o.gotoPage)(r,0,n),clearTimeout(c),e.isReceivingBatchSnapshots||(c=setTimeout((function(){e.app.hasBackground()&&e.app.fitToContent(!1)}),0))},h=t.gotoBoard=function(e,t,n){e.boards.hasOwnProperty(t)||(e.boards[t]=new i.default(e.app,t)),e.currIndex=t;var r=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,o.gotoPage)(r,r.currIndex,n),e.app.hasBackground()&&!e.isReceivingBatchSnapshots&&e.app.fitToContent(!1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(16)),a=c(n(12)),i=c(n(35)),o=c(n(0)),s=c(n(1)),u=n(45);function c(e){return e&&e.__esModule?e:{default:e}}var l=["select","select-hover","camera-bound","mouse-pointer","laser"],d=function(){function e(t,n){var r=this;(0,o.default)(this,e),this.debounceData={},this.clientIdToData={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-1,this.dataOfSync={},this.isSynchronizing=!1,this._scheduleNextBroadcast=function(e,t){return requestAnimationFrame((function(){(new Date).valueOf()-e.time<70?e.timer=r._scheduleNextBroadcast(e,t):r._doBroadcastData(e,t)}))},this._doBroadcastData=function(e,t){var n=r.app.room.mergeDebouncedData(e.dataQueue,t),a={strategy:"snapshot"===t?1:2,data:(0,i.default)(n),client_pkg_id:e.client_pkg_id};"snapshot"!==t&&(a.dataType=t),r.handler.broadcastData(a),r.clientIdToData[a.client_pkg_id]=n,r.debounceData[t]={timer:null,client_pkg_id:-1,time:0,dataQueue:[]}},this._setupResendSyncRequestTimer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;clearTimeout(r.resendSyncRequestTimer),r.resendSyncRequestTimer=setTimeout((function(){e<=8?(console.log("白板--\x3e，同步数据超时，第"+(e+1)+"次请求同步数据, "+r.lastContinueServerPkgId),r.handler.sendSyncRequest(r.lastContinueServerPkgId),r._setupResendSyncRequestTimer(e+1)):((0,u.showToast)({type:"error",msg:"无法同步数据，请检查你的网络",time:1e3}),console.error("白板--\x3e多次同步数据失败"))}),1e4)},this.app=t,this.handler=n,this.bindEvents()}return(0,s.default)(e,[{key:"reset",value:function(){for(var e in this.debounceData)this.debounceData[e].timer&&cancelAnimationFrame(this.debounceData[e].timer);this.debounceData={},this.clientIdToData={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-1,this.dataOfSync={},this.isSynchronizing=!1,clearTimeout(this.resendSyncRequestTimer)}},{key:"bindEvents",value:function(){this.handler.on("data",this.onData.bind(this)),this.handler.on("broadcastAck",this.onBroadcastAck.bind(this)),this.handler.on("syncRequestAck",this.onSendRequestAck.bind(this)),this.handler.on("syncRequestResponse",this.onSendRequestResponse.bind(this))}},{key:"onData",value:function(e){var t=e.data,n=e.server_pkg_id;if(this._updateServerPkgInfo(n,n),this.isSynchronizing)this.dataOfSync[n]=t;else{var r=t.type,a=t.value;"snapshot"===r?this.room.execSnapshot({snapshot:a,pkgId:n}):"broadcaster"===r?this.app.vision.receiveBroadcaster(a):"snapshotArr"===r&&this.room.execBatchSnapshots(a.map((function(e){return{snapshot:e,pkgId:n}})))}}},{key:"sendSyncRequest",value:function(){console.log("白板--\x3e 请求同步数据, 是否正在同步数据",this.isSynchronizing),this.isSynchronizing||(this.isSynchronizing=!0,this.handler.sendSyncRequest(this.lastContinueServerPkgId),this.lastPkgIdToSync=-1,this.dataOfSync={},this._setupResendSyncRequestTimer())}},{key:"onSendRequestAck",value:function(e){this.lastPkgIdToSync=e.last_server_pkg_id,this._updateAppAfterSync()}},{key:"onSendRequestResponse",value:function(e){if(this.isSynchronizing){var t=e.start_server_pkg_id,n=e.end_server_pkg_id,r=e.packages;Array.isArray(r)||(r=[]);var i=!0,o=!1,s=void 0;try{for(var u,c=(0,a.default)(r);!(i=(u=c.next()).done);i=!0){var l=u.value;this.dataOfSync[l.server_pkg_id]=l.data}}catch(e){o=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}this._updateServerPkgInfo(t,n),this._updateAppAfterSync()}}},{key:"onBroadcastAck",value:function(e){var t=this,n=e.server_pkg_id,r=e.client_pkg_id;this._updateServerPkgInfo(n,n);var a=this.clientIdToData[r];delete this.clientIdToData[r],a||console.warn("白板--\x3e broadcastAck, client_pkg_id:"+r+"的数据不存在"),a&&"snapshot"===a.type&&r!==n?this.app.room.cacheSnapshot({pkgId:n,snapshot:a.value}):a&&"snapshotArr"===a.type&&r!==n&&a.value.forEach((function(e){t.app.room.cacheSnapshot({pkgId:n,snapshot:e})}))}},{key:"sendSnapshot",value:function(e){return l.includes(e.data.type)?this.broadcastData({data:{type:"snapshot",value:e},dataType:e.data.type,strategy:2},e.data.type):this.broadcastData({data:{type:"snapshot",value:e},strategy:1},"snapshot")}},{key:"broadcastRoomState",value:function(e,t){return this.broadcastData({data:{type:t,value:e},strategy:2},t)}},{key:"broadcastData",value:function(e,t){if(!this.debounceData.hasOwnProperty(t)||!this.debounceData[t].timer){var n=this.nextLocalFakeId;this.debounceData[t]={timer:null,time:(new Date).valueOf(),client_pkg_id:n,dataQueue:[]},this.clientIdToData[n]={}}var r=this.debounceData[t];return r.dataQueue.push(e.data),r.timer||(r.timer=this._scheduleNextBroadcast(r,t)),r.client_pkg_id}},{key:"_updateAppAfterSync",value:function(){var e=this;if(this.lastContinueServerPkgId>=this.lastPkgIdToSync&&clearTimeout(this.resendSyncRequestTimer),this.lastContinueServerPkgId>=this.lastPkgIdToSync&&this.isSynchronizing){console.log("白板--\x3e 同步数据接收完毕: "+this.lastContinueServerPkgId+"--"+this.lastPkgIdToSync),this.isSynchronizing=!1,console.log("白板--\x3e","event:sync_finished"),this.app.emit("event:editable:change",this.app.editable),this.app.dispatcher.emit("event:sync_finished");for(var t=this._getDataToSync(),n=void 0,r=t.length-1;r>=0;r--)if("broadcaster"===t[r].data.type){n=t[r].data.value;break}var i=[],o=!0,s=!1,u=void 0;try{for(var c,l=(0,a.default)(t);!(o=(c=l.next()).done);o=!0){var d=c.value;if("snapshot"===d.data.type)i.push({pkgId:d.pkgId,snapshot:d.data.value});else if("snapshotArr"===d.data.type){var h=!0,f=!1,p=void 0;try{for(var v,y=(0,a.default)(d.data.value);!(h=(v=y.next()).done);h=!0){var g=v.value;i.push({pkgId:d.pkgId,snapshot:g})}}catch(e){f=!0,p=e}finally{try{!h&&y.return&&y.return()}finally{if(f)throw p}}}}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}n&&this.app.vision.receiveBroadcasterAfterSync(n),this.app.room.execBatchSnapshots(i,(function(t){t||e.app.hasBackground()&&e.app.fitToContent(!1)}))}}},{key:"_getDataToSync",value:function(){var e=this;return(0,r.default)(this.dataOfSync).sort((function(e,t){return Number(e)-Number(t)})).map((function(t){try{return{data:JSON.parse(e.dataOfSync[t]),pkgId:Number(t)}}catch(e){return}})).filter((function(e){return e}))}},{key:"_updateServerPkgInfo",value:function(e,t){for(var n=0,r=e;n<=this.serverPkgSinceLast.length&&!(r>t);)if(r<=this.lastContinueServerPkgId)r++;else if(n===this.serverPkgSinceLast.length){for(var a,i=[];r<=t;)i.push(r),r+=1;(a=this.serverPkgSinceLast).splice.apply(a,[n,0].concat(i))}else this.serverPkgSinceLast[n]<r?n++:this.serverPkgSinceLast[n]===r?(r++,n++):(this.serverPkgSinceLast.splice(n,0,r),r++,n++);for(n=0;n<this.serverPkgSinceLast.length&&this.serverPkgSinceLast[n]===this.lastContinueServerPkgId+n+1;n++);this.lastContinueServerPkgId+=n,this.serverPkgSinceLast.splice(0,n)}},{key:"room",get:function(){return this.app.room}},{key:"lastServerPkgId",get:function(){return this.serverPkgSinceLast.length>0?this.serverPkgSinceLast[this.serverPkgSinceLast.length-1]:this.lastContinueServerPkgId}},{key:"nextLocalFakeId",get:function(){var e=this.lastServerPkgId,t=(0,r.default)(this.clientIdToData).map((function(e){return Number(e)})).sort();return 0===t.length||e>=t[t.length-1]?e+1:t[t.length-1]+1}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(55)),a=u(n(12)),i=u(n(0)),o=u(n(1)),s=u(n(29));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,r){return new(n||(n=s.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},l=function(){function e(t){(0,i.default)(this,e),this.previewCache={},this.task=[],this.isLoopBusy=!1,this.container=document.createElement("div"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.app=t,this.app.opsManager.hooks.pageReady.tap("PageReadyPlugin",this.onPageReady.bind(this)),this.app.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.setupPreviewElements(),this.resizeElements()}return(0,o.default)(e,[{key:"setupPreviewElements",value:function(){var e=document.createElement("div");e.style.position="relative",e.style.visibility="hidden",document.body.appendChild(e),this.container=e,this.setBackgroundColor(),this.canvas=document.createElement("canvas"),e.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")}},{key:"setBackgroundColor",value:function(){this.container.style.backgroundColor=this.app.appConfig.canvas_bg_color}},{key:"resizeElements",value:function(){this.container.style.width=this.app.container.width+"px",this.container.style.height=this.app.container.height+"px";var e=this.container.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height}},{key:"onOpAdded",value:function(e){if("inPageOp"===e.category&&!e.data.inProgress&&"laser"!==e.data.type&&"mouse-pointer"!==e.data.type&&!this.app.room.isReceivingBatchSnapshots){var t=e.board,n=e.page;this.invalidatePreview(n.toString(),t),this.getPreviews([{pageIndex:n.toString(),boardName:t}])}}},{key:"refreshPreviewsOfCurrBoard",value:function(){if(!this.app.room.isReceivingBatchSnapshots){this.task=[];var e=this.app.room.currBoard,t=e.pageNames,n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(t);!(n=(o=s.next()).done);n=!0){var u=o.value;this.invalidatePreview(u,e.boardName)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}var c=[{boardName:e.boardName,pageIndex:e.currIndex.toString()}].concat(t.map((function(t){return{boardName:e.boardName,pageIndex:t.toString()}})));this.addPreviewTask(c)}}},{key:"refreshPreviewsOfCurrPage",value:function(){if(!this.app.room.isReceivingBatchSnapshots){var e=this.app.room.currBoard;this.invalidatePreview(e.currPage.pageIndex,e.boardName);var t=[{boardName:e.boardName,pageIndex:e.currIndex.toString()}];this.addPreviewTask(t)}}},{key:"onPageReady",value:function(e,t){this.invalidatePreview(t.toString(),e),this.getPreviews([{pageIndex:t.toString(),boardName:e}])}},{key:"getPreviewsOfBoard",value:function(e){this.task=[];var t=this.app.room.boards[e].pageNames.map((function(t){return{boardName:e,pageIndex:t.toString()}}));return this.getPreviews(t)}},{key:"getPreviews",value:function(e){var t=this;if(this.app.room.isReceivingBatchSnapshots)return e.map((function(e){return""}));var n=[],r=e.map((function(e){var r=t.getCacheKey(e.pageIndex.toString(),e.boardName);return t.previewCache.hasOwnProperty(r)?t.previewCache[r]:(n.push(e),"")}));return this.addPreviewTask(n),r}},{key:"startLoop",value:function(){return c(this,void 0,void 0,r.default.mark((function e(){var t,n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoopBusy){e.next=2;break}return e.abrupt("return");case 2:return this.isLoopBusy=!0,e.next=5,new s.default((function(e){setTimeout(e,0)}));case 5:t=r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.shiftNextReadyTask();case 2:t=e.sent;case 3:if(null!==t){e.next=11;break}return e.next=6,n.delay(30);case 6:return e.next=8,n.shiftNextReadyTask();case 8:t=e.sent,e.next=3;break;case 11:return e.next=13,new s.default((function(e){try{var r=n.generatePreview(t);n.app.dispatcher.emit("event:appState:change","preview",{pageIndex:t.pageIndex,boardName:t.boardName,data:r})}catch(e){console.error(e)}finally{e()}}));case 13:return e.next=15,n.delay(100);case 15:case"end":return e.stop()}}),e,n)}));case 6:if(!(this.task.length>0)){e.next=10;break}return e.delegateYield(t(),"t0",8);case 8:e.next=6;break;case 10:this.isLoopBusy=!1;case 11:case"end":return e.stop()}}),e,this)})))}},{key:"shiftNextReadyTask",value:function(){return c(this,void 0,void 0,r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<this.task.length)){e.next=22;break}if("ready"!==this.task[t].state){e.next=19;break}if(n=this.task[t],this.task.splice(t,1),e.prev=5,!this.app.room.getPage(n.boardName,n.pageIndex)){e.next=11;break}return e.abrupt("return",n);case 11:return t--,e.abrupt("continue",19);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(5),t--,e.abrupt("continue",19);case 19:t++,e.next=1;break;case 22:return e.abrupt("return",null);case 23:case"end":return e.stop()}}),e,this,[[5,15]])})))}},{key:"delay",value:function(e){return c(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new s.default((function(t){setTimeout((function(){t()}),e)})));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"generatePreview",value:function(e){var t=this.app.room.getPage(e.boardName,e.pageIndex);t.calcDrawOpQueue(),t.refresh({ctx:this.ctx,preview:!0});var n=this.getCacheKey(e.pageIndex,e.boardName),r=this.canvas.toDataURL();return this.previewCache[n]=r,r}},{key:"getCacheKey",value:function(e,t){return t+"-129*&^ljdfh893-"+e}},{key:"addPreviewTask",value:function(e){var t=this;setTimeout((function(){e.reverse().forEach((function(e){var n=t.getCacheKey(e.pageIndex,e.boardName),r=t.previewCache.hasOwnProperty(n),a=t.getTaskIndexOfPage(e.pageIndex,e.boardName);if(-1!==a&&t.task.splice(a,1),!r){var i=t.app.room.boards[e.boardName];if(i){var o=i.pages[e.pageIndex];o&&t.task.unshift({pageIndex:e.pageIndex,boardName:e.boardName,state:o.blocked?"waiting":"ready"})}}})),t.startLoop()}),0)}},{key:"getTaskIndexOfPage",value:function(e,t){for(var n=0;n<this.task.length;n++)if(this.task[n].pageIndex===e&&this.task[n].boardName===t)return n;return-1}},{key:"invalidatePreview",value:function(e,t){delete this.previewCache[this.getCacheKey(e,t)],this.app.dispatcher.emit("event:appState:change","preview",{pageIndex:e,boardName:t,data:""})}}]),e}();t.default=l},function(e,t,n){var r=function(){return this}()||Function("return this")(),a=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=a&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(278),a)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=v;var l={},d={};d[i]=function(){return this};var h=Object.getPrototypeOf,f=h&&h(h(C([])));f&&f!==n&&r.call(f,i)&&(d=f);var p=w.prototype=g.prototype=Object.create(d);m.prototype=p.constructor=w,w.constructor=m,w[s]=m.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(p),e},c.awrap=function(e){return{__await:e}},b(_.prototype),_.prototype[o]=function(){return this},c.AsyncIterator=_,c.async=function(e,t,n,r){var a=new _(v(e,t,n,r));return c.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(p),p[s]="Generator",p[i]=function(){return this},p.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;M(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function v(e,t,n,r){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return O()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=y(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function g(){}function m(){}function w(){}function b(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(n,a){function i(){return new Promise((function(t,i){!function t(n,a,i,o){var s=y(e[n],e,a);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,i,o)}),(function(e){t("throw",e,i,o)})):Promise.resolve(c).then((function(e){u.value=e,i(u)}),o)}o(s.arg)}(n,a,t,i)}))}return t=t?t.then(i,i):i()}}function k(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=y(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:O}}function O(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(16)),a=u(n(32)),i=u(n(0)),o=u(n(1)),s=n(17);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,i.default)(this,e),this.scale=1,this.cameraBoundByUser={},this.app=t,this.centerX=0,this.centerY=0,this.translateX=0,this.translateY=0,this.scale=1,this.width=1920,this.height=1080}return(0,o.default)(e,[{key:"getContainerWorldRect",value:function(){var e=this.container.el.getBoundingClientRect(),t=e.width,n=e.height,r=this.convertToPointInWorld(0,0),i=(0,a.default)(r,2),o=i[0],s=i[1],u=this.convertToPointInWorld(t,n),c=(0,a.default)(u,2),l=c[0],d=c[1];return{centerX:o/2+l/2,centerY:s/2+d/2,width:l-o,height:d-s}}},{key:"getContainerWorldRectByCameraBound",value:function(e){var t=this.container.width,n=this.container.height;return t/n>e.width/e.height?e.width=e.height/n*t:e.height=e.width/t*n,e}},{key:"convertToPointInWorld",value:function(e,t){return[e=(e-this.translateX)/this.scale,t=(t-this.translateY)/this.scale]}},{key:"convertDom",value:function(e){e.style.transform="translate("+this.translateX+"px, "+this.translateY+"px) scale("+this.scale+")"}},{key:"convertDomAndRefresh",value:function(){var e,t,n,r;this.convertDom(this.container.backgroundEl),this.convertDom(this.container.imageEl),this.convertDom(this.container.domEl),this.convertDom(this.container.textAreaEl),null===(n=null===(t=null===(e=this.app.room)||void 0===e?void 0:e.currBoard)||void 0===t?void 0:t.currPage)||void 0===n||n.refresh(),null===(r=this.app.previewFactory)||void 0===r||r.resizeElements()}},{key:"convertCanvas",value:function(e){e.translate(this.translateX,this.translateY),e.scale(this.scale,this.scale)}},{key:"setCameraBound",value:function(e){this.centerX=e.centerX,this.centerY=e.centerY,this.width=e.width,this.height=e.height,this.updateTransParamAndRefresh()}},{key:"getNextCameraBound",value:function(e){if("pan"===e.type)return this._roundBoundary(this.getCameraBoundPan(e));if("zoom"===e.type)return this._roundBoundary(this.getCameraBoundZoom(e));if("reset-camera"===e.type)return this._roundBoundary(this.getCameraBoundReset());if("fit-to-content"===e.type)return this._roundBoundary(this.getCameraBoundFitToContent());if("fit-to-doc"===e.type)return this._roundBoundary(this.getCameraBoundFitToDoc());if("resize-camera"===e.type)return this._roundBoundary(this.getCameraBoundResize());throw new Error("不应该进入此分支(getCameraBound), data类型为："+e)}},{key:"_roundBoundary",value:function(e){return{centerX:Number(e.centerX.toFixed(1)),centerY:Number(e.centerY.toFixed(1)),width:Number(e.width.toFixed(1)),height:Number(e.height.toFixed(1))}}},{key:"getCameraBoundPan",value:function(e){var t=this.centerX,n=this.centerY,r=this.width,a=this.height;return t+=e.dx/this.scale,n+=e.dy/this.scale,this.getContainerWorldRectByCameraBound({centerX:t,centerY:n,width:r,height:a})}},{key:"getCameraBoundZoom",value:function(e){var t=this.centerX,n=this.centerY,r=this.width,a=this.height,i=void 0;i=e.center?this.convertToPointInWorld(e.center[0],e.center[1]):[t,n];var o=e.scale;return t=i[0]-(i[0]-t)/o,n=i[1]-(i[1]-n)/o,r/=o,a/=o,this.getContainerWorldRectByCameraBound({centerX:t,centerY:n,width:r,height:a})}},{key:"getCameraBoundReset",value:function(){return{centerX:0,centerY:0,width:this.container.width,height:this.container.height}}},{key:"getCameraBoundFitToDoc",value:function(){var e=this.app.room.currBoard.currPage.backgroundSnapshot;if(e){var t=e.data.boundary,n=t.sx,r=t.sy,a=t.w,i=t.h;return this.getContainerWorldRectByCameraBound({centerX:n+a/2,centerY:r+i/2,width:a,height:i})}return{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}},{key:"getCameraBoundFitToContent",value:function(){var e=this.app.room.currBoard.currPage,t=e.drawOpQueue,n=e.backgroundSnapshot;if(0===(0,r.default)(t).length&&!n)return this.getCameraBoundReset();var a={sx:1e7,sy:1e7,ex:-1e7,ey:-1e7};if(n){var i=n.data.boundary,o=i.sx,u=i.sy,c=i.w,l=i.h;a.sx=Math.min(a.sx,o),a.sy=Math.min(a.sy,u),a.ex=Math.max(a.ex,o+c),a.ey=Math.max(a.ey,u+l)}for(var d in t){var h=t[d].data;if(h.boundary&&null!==h.boundary.sx&&void 0!==h.boundary.sx&&null!==h.boundary.sy&&void 0!==h.boundary.sy&&null!==h.boundary.w&&void 0!==h.boundary.w&&null!==h.boundary.h&&void 0!==h.boundary.h){var f=(0,s.getTransformedBoundary)(h.boundary,h.dx,h.dy,h.scaleX,h.scaleY),p=f.sx,v=f.sy,y=f.w,g=f.h;a.sx=Math.min(a.sx,p),a.sy=Math.min(a.sy,v),a.ex=Math.max(a.ex,p+y),a.ey=Math.max(a.ey,v+g)}}if(a.ex-a.sx<100&&a.ey-a.sy<100){var m=100-(a.ex-a.sx),w=100-(a.ey-a.ex);a.sx=a.sx-m/2,a.ex=a.ex+m/2,a.sy=a.sy-w/2,a.ey=a.ey+w/2}return this.getContainerWorldRectByCameraBound({centerX:a.sx/2+a.ex/2,centerY:a.sy/2+a.ey/2,width:a.ex-a.sx+0,height:a.ey-a.sy+0})}},{key:"getCameraBoundResize",value:function(){return{centerX:this.centerX,centerY:this.centerY,width:this.container.width/this.zoomFactor,height:this.container.height/this.zoomFactor}}},{key:"updateTransParam",value:function(e){var t=e?e.width:this.width,n=e?e.height:this.height,r=e?e.centerX:this.centerX,a=e?e.centerY:this.centerY,i=t/n;this.container.width/this.container.height>i?this.scale=this.container.height/n:this.scale=this.container.width/t,this.translateX=this.container.width/2-r*this.scale,this.translateY=this.container.height/2-a*this.scale}},{key:"updateTransParamAndRefresh",value:function(){this.updateTransParam(),this.convertDomAndRefresh(),this.app.emit("event:appState:change","zoomFactor",this.zoomFactor)}},{key:"zoomFactor",get:function(){return this.scale}},{key:"container",get:function(){return this.app.container}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(12)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this.records=[],this.nextRecordIndex=0,this.lastTime=0,this.offsetBegin=0,this.pkgId=0,this.app=t}return(0,i.default)(e,[{key:"addRecordData",value:function(e){this.records=e.sort((function(e,t){return e.time-t.time}))}},{key:"setViewer",value:function(e){this.app.account=e;var t=this.lastTime;this.lastTime=1/0,this.seekTo(t)}},{key:"seekTo",value:function(e){var t=e>this.lastTime;this.lastTime=e;for(var n=t?this.nextRecordIndex:0,a=n;a<this.records.length;a++){if(this.records[a].time+this.offsetBegin>e)break}var i=this.records.slice(n,a);this.nextRecordIndex=a,t||(this.app.resetState(),this.pkgId=0);for(var o=[],s=void 0,u=void 0,c=0;c<i.length;c++)if("snapshot"===i[c].record.type)o.push({snapshot:i[c].record.value,pkgId:this.pkgId}),this.pkgId+=1;else if("snapshotArr"===i[c].record.type){var l=!0,d=!1,h=void 0;try{for(var f,p=(0,r.default)(i[c].record.value);!(l=(f=p.next()).done);l=!0){var v=f.value;o.push({snapshot:v,pkgId:this.pkgId}),this.pkgId+=1}}catch(e){d=!0,h=e}finally{try{!l&&p.return&&p.return()}finally{if(d)throw h}}}else"broadcaster"===i[c].record.type?s=i[c].record.value:"observeMode"===i[c].record.type&&i[c].record.value.account===this.app.account&&(u=i[c].record.value);s&&this.app.vision.receiveBroadcasterAfterSync(s),u&&this.app.vision.receiveObserveModeAfterSync(u),this.app.room.execBatchSnapshots(o)}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(32)),a=s(n(29)),i=s(n(0)),o=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,i.default)(this,e),this._lastDirection=0,this._interruptFreeDraw=!1,this.app=t}return(0,o.default)(e,[{key:"reconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("白板--\x3e 模拟重连， 是否清空数据: "+t+", 是否重新创建socket连接: "+e),t&&this.app.resetState(),e?this.app.dataHub.handler._simulateReconnect():this.app.readyToSyncData()}},{key:"generateRandomLines",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this._interruptFreeDraw=!1,this._generateRandomLines(e,t,n,r)}},{key:"interruptRandomLines",value:function(){this._interruptFreeDraw=!0}},{key:"_generateRandomLines",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;if(console.log("正在生成随机线段，还剩余"+t+"次"),this._interruptFreeDraw)return console.log("随机涂鸦被打断");t<=0||setTimeout((function(){n._generateRandomLines2(e,r).then((function(){return n._generateRandomLines(e,t-1,r,a)}))}),a)}},{key:"_generateRandomLines2",value:function(e,t){var n=this,r=this.app.container.el,i=r.offsetWidth,o=r.offsetHeight,s=Math.random()*i,u=Math.random()*o,c=new MouseEvent("mousedown",{clientX:s,clientY:u});this.app.container.el.dispatchEvent(c);for(var l=this._simulateMouseMove(s,u,0),d=function(e){l=l.then((function(e){return t>0?new a.default((function(n){setTimeout((function(){n(e)}),t)})):e})).then((function(t){return n._interruptFreeDraw?a.default.reject(t):n._simulateMouseMove(t.x,t.y,e)}))},h=0;h<e;h++)d(h);return l.catch((function(e){return e})).then((function(e){c=new MouseEvent("mouseup",{clientX:e.x,clientY:e.y}),document.dispatchEvent(c)}))}},{key:"_simulateMouseMove",value:function(e,t,n){var i=this;return new a.default((function(a){setTimeout((function(){var o=i._getDxDy(n),s=(0,r.default)(o,2),u=s[0],c=s[1];e+=u,t+=c;var l=new MouseEvent("mousemove",{clientX:e,clientY:t});document.dispatchEvent(l),a({x:e,y:t})}),0)}))}},{key:"_getDxDy",value:function(e){return e%30==0&&(this._lastDirection=Math.floor(4*Math.random())),0===this._lastDirection?[10*Math.random(),10*Math.random()]:1===this._lastDirection?[10*Math.random(),-10*Math.random()]:2===this._lastDirection?[-10*Math.random(),10*Math.random()]:[-10*Math.random(),-10*Math.random()]}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),a=s(n(1)),i=n(45),o=n(110);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,r.default)(this,e),this.mode="freeObserver",this.app=t,this.camera=this.app.camera}return(0,a.default)(e,[{key:"setMode",value:function(e){this.mode=e,this.app.emit("event:appState:change","vision",{mode:e,isBroadcasting:void 0!==this.broadcaster})}},{key:"setBroadcaster",value:function(e){this.broadcaster=e,this.app.emit("event:appState:change","vision",{mode:this.mode,isBroadcasting:void 0!==this.broadcaster})}},{key:"setSelfAsBroadcaster",value:function(){if(!this.app.dataHub.isSynchronizing){var e=this.app.account;this.setMode("broadcaster"),this.setBroadcaster(e),(0,i.showToast)({type:"success",msg:"其他用户将与您保持视角同步",time:3}),this.app.dataHub.broadcastRoomState({broadcaster:e},"broadcaster"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!0)}}},{key:"unsetSelfAsBroadcaster",value:function(){this.app.dataHub.isSynchronizing||"broadcaster"===this.mode&&(this.broadcaster!==this.app.account?(console.error("白板--\x3e 取消广播。但事实上目前用户并不是房间的广播者",this.broadcaster,this.app.account),this.setMode("follower")):(this.setMode("freeObserver"),this.setBroadcaster(void 0)),(0,i.showToast)({type:"success",msg:"其他用户将停止与您保持视角同步"}),this.app.dataHub.broadcastRoomState({broadcaster:void 0},"broadcaster"))}},{key:"setSelfAsFollower",value:function(){if(!this.app.dataHub.isSynchronizing)if("broadcaster"===this.mode)console.error("请先停止广播");else if("freeObserver"===this.mode){this.setMode("follower");var e=this.camera.cameraBoundByUser[this.broadcaster];(0,o.transitionToCameraBound)(this.camera,e),(0,i.showToast)({type:"success",msg:"与"+this.broadcaster+"保持视角同步"}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"follower"},"observeMode")}}},{key:"setSelfAsFreeObserver",value:function(){this.app.dataHub.isSynchronizing||("broadcaster"===this.mode?console.error("请先停止广播"):"follower"===this.mode&&(this.setMode("freeObserver"),(0,i.showToast)({type:"success",msg:"与"+this.broadcaster+"解除视角同步"}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"freeObserver"},"observeMode"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!1)))}},{key:"receiveBroadcaster",value:function(e){var t=e.broadcaster;t?((0,i.showToast)({msg:"正在与"+t+"保持视角同步",type:"success",time:3}),this.setMode("follower"),this.setBroadcaster(t)):((0,i.showToast)({msg:"主播取消了视角同步",type:"success",time:3}),this.setMode("freeObserver"),this.setBroadcaster(void 0))}},{key:"receiveBroadcasterAfterSync",value:function(e){e.broadcaster===this.app.account?((0,i.showToast)({type:"success",msg:"其他用户正在与您保持视角同步",time:3}),this.setMode("broadcaster"),this.setBroadcaster(this.app.account)):e.broadcaster?((0,i.showToast)({msg:"正在与"+e.broadcaster+"保持视角同步",type:"success",time:3}),this.setMode("follower"),this.setBroadcaster(e.broadcaster)):(this.setMode("freeObserver"),this.setBroadcaster(void 0))}},{key:"receiveObserveModeAfterSync",value:function(e){if(e.account===this.app.account)if("follower"===e.mode){this.setMode("follower");var t=this.camera.cameraBoundByUser[this.broadcaster];(0,o.transitionToCameraBound)(this.camera,t),(0,i.showToast)({type:"success",msg:"正在与"+this.broadcaster+"保持视角同步"})}else{this.setMode("freeObserver");var n=this.camera.cameraBoundByUser[this.app.account];(0,o.transitionToCameraBound)(this.camera,n),(0,i.showToast)({type:"success",msg:"与"+this.broadcaster+"解除视角同步"})}}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTime=t.fetchBlob=t.getID=t.RECORD_FILE=void 0;var r=i(n(55)),a=i(n(29));function i(e){return e&&e.__esModule?e:{default:e}}t.parseUrl=function(e){var t=s.exec(e||"");if(t)return{uid:t[1],cid:t[2],timestamp:parseInt(t[3]),chunk:parseInt(t[4]),type:t[6],url:e};var n=e.lastIndexOf(".");return{url:e,type:e.slice(n+1)}},t.ab2str=function(e){return o(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!u){t.next=4;break}return t.abrupt("return",u.decode(e));case 4:return t.next=6,new a.default((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(new Blob([new Uint8Array(e)]))}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))};var o=function(e,t,n,r){return new(n||(n=a.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},s=t.RECORD_FILE=/(\d+)-(\d+)-(\d+)-(\d+)(-mixed)?\.(mp4|aac|flv|gz)$/i;t.getID=function(){return~~(1e4*Math.random())};var u=void 0;"function"==typeof window.TextEncoder&&(u=new window.TextDecoder("utf-8"));t.fetchBlob=function(e){return new a.default((function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){t(r.response)},r.onerror=n,r.send()}))};var c=function(e){return e<10?"0"+e:""+e};t.getTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(e=~~(e/1e3))%60,r=(e=~~((e-=n)/60))%60,a=~~(e/60);return 0===a&&!1===t?[c(r)+":"+c(n),a]:[a+":"+c(r)+":"+c(n),a]}},function(e,t){!function(n){"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=n()}((function(){return function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return a(t[o][1][e]||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";var r=e("./zlib/deflate"),a=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/messages"),s=e("./zlib/zstream"),u=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=a.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(o[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var l;if(l="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,l)))throw new Error(o[n]);this._dict_set=!0}}function l(e,t){var n=new c(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}c.prototype.push=function(e,t){var n,o,s=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=i.string2buf(e):"[object ArrayBuffer]"===u.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(c),s.next_out=0,s.avail_out=c),1!==(n=r.deflate(s,o))&&0!==n)return this.onEnd(n),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(i.buf2binstring(a.shrinkBuf(s.output,s.next_out))):this.onData(a.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==n);return 4===o?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==o||(this.onEnd(0),!(s.avail_out=0))},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=c,n.deflate=l,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,l(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,l(e,t)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(e,t,n){"use strict";var r=e("./zlib/inflate"),a=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/constants"),s=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),l=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(s[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[n])}function h(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}d.prototype.push=function(e,t){var n,s,u,c,d,h=this.strm,f=this.options.chunkSize,p=this.options.dictionary,v=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=i.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(f),h.next_out=0,h.avail_out=f),(n=r.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===o.Z_BUF_ERROR&&!0===v&&(n=o.Z_OK,v=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),!(this.ended=!0);h.next_out&&(0!==h.avail_out&&n!==o.Z_STREAM_END&&(0!==h.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(u=i.utf8border(h.output,h.next_out),c=h.next_out-u,d=i.buf2string(h.output,u),h.next_out=c,h.avail_out=f-c,c&&a.arraySet(h.output,h.output,u,c,0),this.onData(d)):this.onData(a.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(v=!0)}while((0<h.avail_in||0===h.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(h.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=d,n.inflate=h,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},n.ungzip=h},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t,n,r=Array.prototype.slice.call(arguments,1);r.length;){var a=r.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(var i in a)t=a,n=i,Object.prototype.hasOwnProperty.call(t,n)&&(e[i]=a[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),a);else for(var i=0;i<r;i++)e[a+i]=t[n+i]},flattenChunks:function(e){var t,n,r,a,i,o;for(t=r=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),t=a=0,n=e.length;t<n;t++)i=e[t],o.set(i,a),a+=i.length;return o}},i={arraySet:function(e,t,n,r,a){for(var i=0;i<r;i++)e[a+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,i))},n.setTyped(r)},{}],4:[function(e,t,n){"use strict";var r=e("./common"),a=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){i=!1}for(var o=new r.Buf8(256),s=0;s<256;s++)o[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function u(e,t){if(t<65534&&(e.subarray&&i||!e.subarray&&a))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,n.string2buf=function(e){var t,n,a,i,o,s=e.length,u=0;for(i=0;i<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(a=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(a-56320),i++),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(u),i=o=0;o<u;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(a=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(a-56320),i++),n<128?t[o++]=n:(n<2048?t[o++]=192|n>>>6:(n<65536?t[o++]=224|n>>>12:(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63),t[o++]=128|n>>>6&63),t[o++]=128|63&n);return t},n.buf2binstring=function(e){return u(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,a=t.length;n<a;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,a,i,s=t||e.length,c=new Array(2*s);for(n=r=0;n<s;)if((a=e[n++])<128)c[r++]=a;else if(4<(i=o[a]))c[r++]=65533,n+=i-1;else{for(a&=2===i?31:3===i?15:7;1<i&&n<s;)a=a<<6|63&e[n++],i--;1<i?c[r++]=65533:a<65536?c[r++]=a:(a-=65536,c[r++]=55296|a>>10&1023,c[r++]=56320|1023&a)}return u(c,r)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}},{"./common":3}],5:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){for(var a=65535&e|0,i=e>>>16&65535|0,o=0;0!==n;){for(n-=o=2e3<n?2e3:n;i=i+(a=a+t[r++]|0)|0,--o;);a%=65521,i%=65521}return a|i<<16|0}},{}],6:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,a){var i=r,o=a+n;e^=-1;for(var s=a;s<o;s++)e=e>>>8^i[255&(e^t[s])];return-1^e}},{}],8:[function(e,t,n){"use strict";var r,a=e("../utils/common"),i=e("./trees"),o=e("./adler32"),s=e("./crc32"),u=e("./messages"),c=-2,l=258,d=262,h=113;function f(e,t){return e.msg=u[t],t}function p(e){return(e<<1)-(4<e?9:0)}function v(e){for(var t=e.length;0<=--t;)e[t]=0}function y(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(a.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function g(e,t){i._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,y(e.strm)}function m(e,t){e.pending_buf[e.pending++]=t}function w(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function b(e,t){var n,r,a=e.max_chain_length,i=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-d?e.strstart-(e.w_size-d):0,c=e.window,h=e.w_mask,f=e.prev,p=e.strstart+l,v=c[i+o-1],y=c[i+o];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+o]===y&&c[n+o-1]===v&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<p);if(r=l-(p-i),i=p-l,o<r){if(e.match_start=t,s<=(o=r))break;v=c[i+o-1],y=c[i+o]}}}while((t=f[t&h])>u&&0!=--a);return o<=e.lookahead?o:e.lookahead}function _(e){var t,n,r,i,u,c,l,h,f,p,v=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=v+(v-d)){for(a.arraySet(e.window,e.window,v,v,0),e.match_start-=v,e.strstart-=v,e.block_start-=v,t=n=e.hash_size;r=e.head[--t],e.head[t]=v<=r?r-v:0,--n;);for(t=n=v;r=e.prev[--t],e.prev[t]=v<=r?r-v:0,--n;);i+=v}if(0===e.strm.avail_in)break;if(c=e.strm,l=e.window,h=e.strstart+e.lookahead,p=void 0,(f=i)<(p=c.avail_in)&&(p=f),n=0===p?0:(c.avail_in-=p,a.arraySet(l,c.input,c.next_in,p,h),1===c.state.wrap?c.adler=o(c.adler,l,p,h):2===c.state.wrap&&(c.adler=s(c.adler,l,p,h)),c.next_in+=p,c.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+3-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<d&&0!==e.strm.avail_in)}function k(e,t){for(var n,r;;){if(e.lookahead<d){if(_(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-d&&(e.match_length=b(e,n)),e.match_length>=3)if(r=i._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,r,a;;){if(e.lookahead<d){if(_(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-d&&(e.match_length=b(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){for(a=e.strstart+e.lookahead-3,r=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(g(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=i._tr_tally(e,0,e.window[e.strstart-1]))&&g(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}function M(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(1146),this.dyn_dtree=new a.Buf16(122),this.bl_tree=new a.Buf16(78),v(this.dyn_ltree),v(this.dyn_dtree),v(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(16),this.heap=new a.Buf16(573),v(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(573),v(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function C(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:h,e.adler=2===t.wrap?0:1,t.last_flush=0,i._tr_init(t),0):f(e,c)}function O(e){var t,n=C(e);return 0===n&&((t=e.state).window_size=2*t.w_size,v(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function A(e,t,n,r,i,o){if(!e)return c;var s=1;if(-1===t&&(t=6),r<0?(s=0,r=-r):15<r&&(s=2,r-=16),i<1||9<i||8!==n||r<8||15<r||t<0||9<t||o<0||4<o)return f(e,c);8===r&&(r=9);var u=new S;return(e.state=u).strm=e,u.wrap=s,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new a.Buf8(2*u.w_size),u.head=new a.Buf16(u.hash_size),u.prev=new a.Buf16(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new a.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=o,u.method=n,O(e)}r=[new M(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(_(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,g(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-d&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(g(e,!1),e.strm.avail_out),1)})),new M(4,4,8,4,k),new M(4,5,16,8,k),new M(4,6,32,32,k),new M(4,4,16,16,x),new M(8,16,32,32,x),new M(8,16,128,128,x),new M(8,32,128,256,x),new M(32,128,258,1024,x),new M(32,258,258,4096,x)],n.deflateInit=function(e,t){return A(e,t,8,15,8,0)},n.deflateInit2=A,n.deflateReset=O,n.deflateResetKeep=C,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?c:(e.state.gzhead=t,0):c},n.deflate=function(e,t){var n,a,o,u;if(!e||!e.state||5<t||t<0)return e?f(e,c):c;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||666===a.status&&4!==t)return f(e,0===e.avail_out?-5:c);if(a.strm=e,n=a.last_flush,a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,m(a,31),m(a,139),m(a,8),a.gzhead?(m(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),m(a,255&a.gzhead.time),m(a,a.gzhead.time>>8&255),m(a,a.gzhead.time>>16&255),m(a,a.gzhead.time>>24&255),m(a,9===a.level?2:2<=a.strategy||a.level<2?4:0),m(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(m(a,255&a.gzhead.extra.length),m(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=s(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(m(a,0),m(a,0),m(a,0),m(a,0),m(a,0),m(a,9===a.level?2:2<=a.strategy||a.level<2?4:0),m(a,3),a.status=h);else{var d=8+(a.w_bits-8<<4)<<8;d|=(2<=a.strategy||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(d|=32),d+=31-d%31,a.status=h,w(a,d),0!==a.strstart&&(w(a,e.adler>>>16),w(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(o=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),y(e),o=a.pending,a.pending!==a.pending_buf_size));)m(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),y(e),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}m(a,u=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0)}while(0!==u);a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),y(e),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}m(a,u=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0)}while(0!==u);a.gzhead.hcrc&&a.pending>o&&(e.adler=s(e.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.status=103)}else a.status=103;if(103===a.status&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&y(e),a.pending+2<=a.pending_buf_size&&(m(a,255&e.adler),m(a,e.adler>>8&255),e.adler=0,a.status=h)):a.status=h),0!==a.pending){if(y(e),0===e.avail_out)return a.last_flush=-1,0}else if(0===e.avail_in&&p(t)<=p(n)&&4!==t)return f(e,-5);if(666===a.status&&0!==e.avail_in)return f(e,-5);if(0!==e.avail_in||0!==a.lookahead||0!==t&&666!==a.status){var b=2===a.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(_(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}(a,t):3===a.strategy?function(e,t){for(var n,r,a,o,s=e.window;;){if(e.lookahead<=l){if(_(e),e.lookahead<=l&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&0<e.strstart&&(r=s[a=e.strstart-1])===s[++a]&&r===s[++a]&&r===s[++a]){o=e.strstart+l;do{}while(r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&a<o);e.match_length=l-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=i._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}(a,t):r[a.level].func(a,t);if(3!==b&&4!==b||(a.status=666),1===b||3===b)return 0===e.avail_out&&(a.last_flush=-1),0;if(2===b&&(1===t?i._tr_align(a):5!==t&&(i._tr_stored_block(a,0,0,!1),3===t&&(v(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),y(e),0===e.avail_out))return a.last_flush=-1,0}return 4!==t?0:a.wrap<=0?1:(2===a.wrap?(m(a,255&e.adler),m(a,e.adler>>8&255),m(a,e.adler>>16&255),m(a,e.adler>>24&255),m(a,255&e.total_in),m(a,e.total_in>>8&255),m(a,e.total_in>>16&255),m(a,e.total_in>>24&255)):(w(a,e.adler>>>16),w(a,65535&e.adler)),y(e),0<a.wrap&&(a.wrap=-a.wrap),0!==a.pending?0:1)},n.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&t!==h&&666!==t?f(e,c):(e.state=null,t===h?f(e,-3):0):c},n.deflateSetDictionary=function(e,t){var n,r,i,s,u,l,d,h,f=t.length;if(!e||!e.state)return c;if(2===(s=(n=e.state).wrap)||1===s&&42!==n.status||n.lookahead)return c;for(1===s&&(e.adler=o(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(v(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new a.Buf8(n.w_size),a.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),u=e.avail_in,l=e.next_in,d=e.input,e.avail_in=f,e.next_in=0,e.input=t,_(n);n.lookahead>=3;){for(r=n.strstart,i=n.lookahead-2;n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++,--i;);n.strstart=r,n.lookahead=2,_(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=d,e.avail_in=u,n.wrap=s,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(e,t,n){"use strict";t.exports=function(e,t){var n,r,a,i,o,s,u,c,l,d,h,f,p,v,y,g,m,w,b,_,k,x,M,S,C;n=e.state,r=e.next_in,S=e.input,a=r+(e.avail_in-5),i=e.next_out,C=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),u=n.dmax,c=n.wsize,l=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,v=n.lencode,y=n.distcode,g=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{p<15&&(f+=S[r++]<<p,p+=8,f+=S[r++]<<p,p+=8),w=v[f&g];t:for(;;){if(f>>>=b=w>>>24,p-=b,0==(b=w>>>16&255))C[i++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=v[(65535&w)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}_=65535&w,(b&=15)&&(p<b&&(f+=S[r++]<<p,p+=8),_+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=S[r++]<<p,p+=8,f+=S[r++]<<p,p+=8),w=y[f&m];n:for(;;){if(f>>>=b=w>>>24,p-=b,!(16&(b=w>>>16&255))){if(0==(64&b)){w=y[(65535&w)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(k=65535&w,p<(b&=15)&&(f+=S[r++]<<p,(p+=8)<b&&(f+=S[r++]<<p,p+=8)),u<(k+=f&(1<<b)-1)){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=b,p-=b,(b=i-o)<k){if(l<(b=k-b)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(M=h,(x=0)===d){if(x+=c-b,b<_){for(_-=b;C[i++]=h[x++],--b;);x=i-k,M=C}}else if(d<b){if(x+=c+d-b,(b-=d)<_){for(_-=b;C[i++]=h[x++],--b;);if(x=0,d<_){for(_-=b=d;C[i++]=h[x++],--b;);x=i-k,M=C}}}else if(x+=d-b,b<_){for(_-=b;C[i++]=h[x++],--b;);x=i-k,M=C}for(;2<_;)C[i++]=M[x++],C[i++]=M[x++],C[i++]=M[x++],_-=3;_&&(C[i++]=M[x++],1<_&&(C[i++]=M[x++]))}else{for(x=i-k;C[i++]=C[x++],C[i++]=C[x++],C[i++]=C[x++],2<(_-=3););_&&(C[i++]=C[x++],1<_&&(C[i++]=C[x++]))}break}}break}}while(r<a&&i<s);r-=_=p>>3,f&=(1<<(p-=_<<3))-1,e.next_in=r,e.next_out=i,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=i<s?s-i+257:257-(i-s),n.hold=f,n.bits=p}},{}],11:[function(e,t,n){"use strict";var r=e("../utils/common"),a=e("./adler32"),i=e("./crc32"),o=e("./inffast"),s=e("./inftrees"),u=-2;function c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):u}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):u}function f(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?u:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,h(e))):u}function p(e,t){var n,r;return e?(r=new l,(e.state=r).window=null,0!==(n=f(e,t))&&(e.state=null),n):u}var v,y,g=!0;function m(e){if(g){var t;for(v=new r.Buf32(512),y=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,v,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,y,0,e.work,{bits:5}),g=!1}e.lencode=v,e.lenbits=9,e.distcode=y,e.distbits=5}function w(e,t,n,a){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),a>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(a<(i=o.wsize-o.wnext)&&(i=a),r.arraySet(o.window,t,n-a,i,o.wnext),(a-=i)?(r.arraySet(o.window,t,n-a,a,0),o.wnext=a,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}n.inflateReset=h,n.inflateReset2=f,n.inflateResetKeep=d,n.inflateInit=function(e){return p(e,15)},n.inflateInit2=p,n.inflate=function(e,t){var n,l,d,h,f,p,v,y,g,b,_,k,x,M,S,C,O,A,I,P,T,E,D,R,N=0,z=new r.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return u;12===(n=e.state).mode&&(n.mode=13),f=e.next_out,d=e.output,v=e.avail_out,h=e.next_in,l=e.input,p=e.avail_in,y=n.hold,g=n.bits,b=p,_=v,E=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;g<16;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(2&n.wrap&&35615===y){z[n.check=0]=255&y,z[1]=y>>>8&255,n.check=i(n.check,z,2,0),g=y=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=30;break}if(g-=4,T=8+(15&(y>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&y?10:12,g=y=0;break;case 2:for(;g<16;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&(z[0]=255&y,z[1]=y>>>8&255,n.check=i(n.check,z,2,0)),g=y=0,n.mode=3;case 3:for(;g<32;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}n.head&&(n.head.time=y),512&n.flags&&(z[0]=255&y,z[1]=y>>>8&255,z[2]=y>>>16&255,z[3]=y>>>24&255,n.check=i(n.check,z,4,0)),g=y=0,n.mode=4;case 4:for(;g<16;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&(z[0]=255&y,z[1]=y>>>8&255,n.check=i(n.check,z,2,0)),g=y=0,n.mode=5;case 5:if(1024&n.flags){for(;g<16;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&(z[0]=255&y,z[1]=y>>>8&255,n.check=i(n.check,z,2,0)),g=y=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(p<(k=n.length)&&(k=p),k&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,l,h,k,T)),512&n.flags&&(n.check=i(n.check,l,k,h)),p-=k,h+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===p)break e;for(k=0;T=l[h+k++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T)),T&&k<p;);if(512&n.flags&&(n.check=i(n.check,l,k,h)),p-=k,h+=k,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===p)break e;for(k=0;T=l[h+k++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T)),T&&k<p;);if(512&n.flags&&(n.check=i(n.check,l,k,h)),p-=k,h+=k,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;g<16;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}g=y=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;g<32;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}e.adler=n.check=c(y),g=y=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=f,e.avail_out=v,e.next_in=h,e.avail_in=p,n.hold=y,n.bits=g,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&g,g-=7&g,n.mode=27;break}for(;g<3;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}switch(n.last=1&y,g-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(m(n),n.mode=20,6!==t)break;y>>>=2,g-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}y>>>=2,g-=2;break;case 14:for(y>>>=7&g,g-=7&g;g<32;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&y,g=y=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(p<k&&(k=p),v<k&&(k=v),0===k)break e;r.arraySet(d,l,h,k,f),p-=k,h+=k,v-=k,f+=k,n.length-=k;break}n.mode=12;break;case 17:for(;g<14;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(n.nlen=257+(31&y),y>>>=5,g-=5,n.ndist=1+(31&y),y>>>=5,g-=5,n.ncode=4+(15&y),y>>>=4,g-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;g<3;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}n.lens[j[n.have++]]=7&y,y>>>=3,g-=3}for(;n.have<19;)n.lens[j[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},E=s(0,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,E){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;C=(N=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,O=65535&N,!((S=N>>>24)<=g);){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(O<16)y>>>=S,g-=S,n.lens[n.have++]=O;else{if(16===O){for(R=S+2;g<R;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(y>>>=S,g-=S,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}T=n.lens[n.have-1],k=3+(3&y),y>>>=2,g-=2}else if(17===O){for(R=S+3;g<R;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}g-=S,T=0,k=3+(7&(y>>>=S)),y>>>=3,g-=3}else{for(R=S+7;g<R;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}g-=S,T=0,k=11+(127&(y>>>=S)),y>>>=7,g-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;k--;)n.lens[n.have++]=T}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,D={bits:n.lenbits},E=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,E){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},E=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,E){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=p&&258<=v){e.next_out=f,e.avail_out=v,e.next_in=h,e.avail_in=p,n.hold=y,n.bits=g,o(e,_),f=e.next_out,d=e.output,v=e.avail_out,h=e.next_in,l=e.input,p=e.avail_in,y=n.hold,g=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;C=(N=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,O=65535&N,!((S=N>>>24)<=g);){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(C&&0==(240&C)){for(A=S,I=C,P=O;C=(N=n.lencode[P+((y&(1<<A+I)-1)>>A)])>>>16&255,O=65535&N,!(A+(S=N>>>24)<=g);){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}y>>>=A,g-=A,n.back+=A}if(y>>>=S,g-=S,n.back+=S,n.length=O,0===C){n.mode=26;break}if(32&C){n.back=-1,n.mode=12;break}if(64&C){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&C,n.mode=22;case 22:if(n.extra){for(R=n.extra;g<R;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,g-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;C=(N=n.distcode[y&(1<<n.distbits)-1])>>>16&255,O=65535&N,!((S=N>>>24)<=g);){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(0==(240&C)){for(A=S,I=C,P=O;C=(N=n.distcode[P+((y&(1<<A+I)-1)>>A)])>>>16&255,O=65535&N,!(A+(S=N>>>24)<=g);){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}y>>>=A,g-=A,n.back+=A}if(y>>>=S,g-=S,n.back+=S,64&C){e.msg="invalid distance code",n.mode=30;break}n.offset=O,n.extra=15&C,n.mode=24;case 24:if(n.extra){for(R=n.extra;g<R;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,g-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===v)break e;if(k=_-v,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}k>n.wnext?(k-=n.wnext,x=n.wsize-k):x=n.wnext-k,k>n.length&&(k=n.length),M=n.window}else M=d,x=f-n.offset,k=n.length;for(v<k&&(k=v),v-=k,n.length-=k;d[f++]=M[x++],--k;);0===n.length&&(n.mode=21);break;case 26:if(0===v)break e;d[f++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;g<32;){if(0===p)break e;p--,y|=l[h++]<<g,g+=8}if(_-=v,e.total_out+=_,n.total+=_,_&&(e.adler=n.check=n.flags?i(n.check,d,_,f-_):a(n.check,d,_,f-_)),_=v,(n.flags?y:c(y))!==n.check){e.msg="incorrect data check",n.mode=30;break}g=y=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;g<32;){if(0===p)break e;p--,y+=l[h++]<<g,g+=8}if(y!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}g=y=0}n.mode=29;case 29:E=1;break e;case 30:E=-3;break e;case 31:return-4;case 32:default:return u}return e.next_out=f,e.avail_out=v,e.next_in=h,e.avail_in=p,n.hold=y,n.bits=g,(n.wsize||_!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&w(e,e.output,e.next_out,_-e.avail_out)?(n.mode=31,-4):(b-=e.avail_in,_-=e.avail_out,e.total_in+=b,e.total_out+=_,n.total+=_,n.wrap&&_&&(e.adler=n.check=n.flags?i(n.check,d,_,e.next_out-_):a(n.check,d,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===b&&0===_||4===t)&&0===E&&(E=-5),E)},n.inflateEnd=function(e){if(!e||!e.state)return u;var t=e.state;return t.window&&(t.window=null),e.state=null,0},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?u:((n.head=t).done=!1,0):u},n.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?u:11===n.mode&&a(1,t,r,0)!==n.check?-3:w(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(e,t,n){"use strict";var r=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,u,c,l,d,h){var f,p,v,y,g,m,w,b,_,k=h.bits,x=0,M=0,S=0,C=0,O=0,A=0,I=0,P=0,T=0,E=0,D=null,R=0,N=new r.Buf16(16),z=new r.Buf16(16),j=null,L=0;for(x=0;x<=15;x++)N[x]=0;for(M=0;M<u;M++)N[t[n+M]]++;for(O=k,C=15;1<=C&&0===N[C];C--);if(C<O&&(O=C),0===C)return c[l++]=20971520,c[l++]=20971520,h.bits=1,0;for(S=1;S<C&&0===N[S];S++);for(O<S&&(O=S),x=P=1;x<=15;x++)if(P<<=1,(P-=N[x])<0)return-1;if(0<P&&(0===e||1!==C))return-1;for(z[1]=0,x=1;x<15;x++)z[x+1]=z[x]+N[x];for(M=0;M<u;M++)0!==t[n+M]&&(d[z[t[n+M]]++]=M);if(0===e?(D=j=d,m=19):1===e?(D=a,R-=257,j=i,L-=257,m=256):(D=o,j=s,m=-1),x=S,g=l,I=M=E=0,v=-1,y=(T=1<<(A=O))-1,1===e&&852<T||2===e&&592<T)return 1;for(;;){for(w=x-I,d[M]<m?(b=0,_=d[M]):d[M]>m?(b=j[L+d[M]],_=D[R+d[M]]):(b=96,_=0),f=1<<x-I,S=p=1<<A;c[g+(E>>I)+(p-=f)]=w<<24|b<<16|_|0,0!==p;);for(f=1<<x-1;E&f;)f>>=1;if(0!==f?(E&=f-1,E+=f):E=0,M++,0==--N[x]){if(x===C)break;x=t[n+d[M]]}if(O<x&&(E&y)!==v){for(0===I&&(I=O),g+=S,P=1<<(A=x-I);A+I<C&&!((P-=N[A+I])<=0);)A++,P<<=1;if(T+=1<<A,1===e&&852<T||2===e&&592<T)return 1;c[v=E&y]=O<<24|A<<16|g-l|0}}return 0!==E&&(c[g+E]=x-I<<24|64<<16|0),h.bits=O,0}},{"../utils/common":3}],13:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,n){"use strict";var r=e("../utils/common");function a(e){for(var t=e.length;0<=--t;)e[t]=0}var i=256,o=286,s=30,u=15,c=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],l=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);a(f);var p=new Array(60);a(p);var v=new Array(512);a(v);var y=new Array(256);a(y);var g=new Array(29);a(g);var m,w,b,_=new Array(s);function k(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}function x(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function M(e){return e<256?v[e]:v[256+(e>>>7)]}function S(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function C(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,S(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function O(e,t,n){C(e,n[2*t],n[2*t+1])}function A(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function I(e,t,n){var r,a,i=new Array(16),o=0;for(r=1;r<=u;r++)i[r]=o=o+n[r-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=A(i[s]++,s))}}function P(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function T(e){8<e.bi_valid?S(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function E(e,t,n,r){var a=2*t,i=2*n;return e[a]<e[i]||e[a]===e[i]&&r[t]<=r[n]}function D(e,t,n){for(var r=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&E(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!E(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r}function R(e,t,n){var r,a,o,s,u=0;if(0!==e.last_lit)for(;r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],a=e.pending_buf[e.l_buf+u],u++,0===r?O(e,a,t):(O(e,(o=y[a])+i+1,t),0!==(s=c[o])&&C(e,a-=g[o],s),O(e,o=M(--r),n),0!==(s=l[o])&&C(e,r-=_[o],s)),u<e.last_lit;);O(e,256,t)}function N(e,t){var n,r,a,i=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==i[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(a=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=o[2*a+1]);for(t.max_code=l,n=e.heap_len>>1;1<=n;n--)D(e,i,n);for(a=c;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],D(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,i[2*a]=i[2*n]+i[2*r],e.depth[a]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,i[2*n+1]=i[2*r+1]=a,e.heap[1]=a++,D(e,i,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,a,i,o,s,c=t.dyn_tree,l=t.max_code,d=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,v=t.stat_desc.max_length,y=0;for(i=0;i<=u;i++)e.bl_count[i]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)v<(i=c[2*c[2*(r=e.heap[n])+1]+1]+1)&&(i=v,y++),c[2*r+1]=i,l<r||(e.bl_count[i]++,o=0,p<=r&&(o=f[r-p]),s=c[2*r],e.opt_len+=s*(i+o),h&&(e.static_len+=s*(d[2*r+1]+o)));if(0!==y){do{for(i=v-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[v]--,y-=2}while(0<y);for(i=v;0!==i;i--)for(r=e.bl_count[i];0!==r;)l<(a=e.heap[--n])||(c[2*a+1]!==i&&(e.opt_len+=(i-c[2*a+1])*c[2*a],c[2*a+1]=i),r--)}}(e,t),I(i,l,e.bl_count)}function z(e,t,n){var r,a,i=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=o,o=t[2*(r+1)+1],++s<u&&a===o||(s<c?e.bl_tree[2*a]+=s:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,i=a,(s=0)===o?(u=138,c=3):a===o?(u=6,c=3):(u=7,c=4))}function j(e,t,n){var r,a,i=-1,o=t[1],s=0,u=7,c=4;for(0===o&&(u=138,c=3),r=0;r<=n;r++)if(a=o,o=t[2*(r+1)+1],!(++s<u&&a===o)){if(s<c)for(;O(e,a,e.bl_tree),0!=--s;);else 0!==a?(a!==i&&(O(e,a,e.bl_tree),s--),O(e,16,e.bl_tree),C(e,s-3,2)):s<=10?(O(e,17,e.bl_tree),C(e,s-3,3)):(O(e,18,e.bl_tree),C(e,s-11,7));i=a,(s=0)===o?(u=138,c=3):a===o?(u=6,c=3):(u=7,c=4)}}a(_);var L=!1;function B(e,t,n,a){var i,o,s;C(e,0+(a?1:0),3),o=t,s=n,T(i=e),S(i,s),S(i,~s),r.arraySet(i.pending_buf,i.window,o,s,i.pending),i.pending+=s}n._tr_init=function(e){L||(function(){var e,t,n,r,a,i=new Array(16);for(r=n=0;r<28;r++)for(g[r]=n,e=0;e<1<<c[r];e++)y[n++]=r;for(y[n-1]=r,r=a=0;r<16;r++)for(_[r]=a,e=0;e<1<<l[r];e++)v[a++]=r;for(a>>=7;r<s;r++)for(_[r]=a<<7,e=0;e<1<<l[r]-7;e++)v[256+a++]=r;for(t=0;t<=u;t++)i[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,i[8]++;for(;e<=255;)f[2*e+1]=9,e++,i[9]++;for(;e<=279;)f[2*e+1]=7,e++,i[7]++;for(;e<=287;)f[2*e+1]=8,e++,i[8]++;for(I(f,287,i),e=0;e<s;e++)p[2*e+1]=5,p[2*e]=A(e,5);m=new k(f,c,257,o,u),w=new k(p,l,0,s,u),b=new k(new Array(0),d,0,19,7)}(),L=!0),e.l_desc=new x(e.dyn_ltree,m),e.d_desc=new x(e.dyn_dtree,w),e.bl_desc=new x(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,P(e)},n._tr_stored_block=B,n._tr_flush_block=function(e,t,n,r){var a,o,s=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<i;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),N(e,e.l_desc),N(e,e.d_desc),s=function(e){var t;for(z(e,e.dyn_ltree,e.l_desc.max_code),z(e,e.dyn_dtree,e.d_desc.max_code),N(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=a&&(a=o)):a=o=n+5,n+4<=a&&-1!==t?B(e,t,n,r):4===e.strategy||o===a?(C(e,2+(r?1:0),3),R(e,f,p)):(C(e,4+(r?1:0),3),function(e,t,n,r){var a;for(C(e,t-257,5),C(e,n-1,5),C(e,r-4,4),a=0;a<r;a++)C(e,e.bl_tree[2*h[a]+1],3);j(e,e.dyn_ltree,t-1),j(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),R(e,e.dyn_ltree,e.dyn_dtree)),P(e),r&&T(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(y[n]+i+1)]++,e.dyn_dtree[2*M(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){var t;C(e,2,3),O(e,256,f),16===(t=e).bi_valid?(S(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":3}],15:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(e,t,n){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}))},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(55)),a=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),c=d(n(29)),l=d(n(34));function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,r){return new(n||(n=c.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},f=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.offsetBegin=0,e.offsetEnd=0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"playUtilBtwTimeAndReady",value:function(e){return h(this,void 0,void 0,r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showTrack();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"isWaiting",value:function(e){return e<this.offsetBegin||this.offsetEnd,!1}},{key:"setViewer",value:function(e){}},{key:"setPlaySpeed",value:function(e){}},{key:"showTrack",value:function(){return h(this,void 0,void 0,r.default.mark((function e(){var t=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state="beforeshow",e.next=3,new c.default((function(e){t.emit("visibleChange","show",t.params,(function(n){t.showTrackCb(n),e()}))}));case 3:this.state="playing",setTimeout((function(){t.emit("showTrack")}));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"hideTrack",value:function(){return h(this,void 0,void 0,r.default.mark((function e(){var t=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state="beforefinish",e.next=3,new c.default((function(e){t.emit("visibleChange","hide",t.params,(function(){t.hideTrackCb(),e()}))}));case 3:setTimeout((function(){t.emit("hideTrack")})),this.state="finished";case 5:case"end":return e.stop()}}),e,this)})))}},{key:"destroy",value:function(){return h(this,void 0,void 0,r.default.mark((function e(){var t=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._awaitTrackHandler();case 2:if("playing"!==this.state){e.next=5;break}return e.next=5,this.hideTrack();case 5:this.eventNames().forEach((function(e){return t.off(e)}));case 6:case"end":return e.stop()}}),e,this)})))}},{key:"update",value:function(e){return h(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.seekTo(e,!0,!1);case 2:this.play();case 3:case"end":return t.stop()}}),t,this)})))}},{key:"seekTo",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return h(this,void 0,void 0,r.default.mark((function a(){return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("init"!==this.state&&"error"!==this.state){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,this._awaitTrackHandler();case 4:if(!(e<this.offsetBegin)){r.next=11;break}if("playing"!==this.state){r.next=8;break}return r.next=8,this.hideTrack();case 8:return r.abrupt("return",this.state="ready");case 11:if(!(e>this.offsetEnd)){r.next=18;break}if("playing"!==this.state){r.next=15;break}return r.next=15,this.hideTrack();case 15:return r.abrupt("return",this.state="finished");case 18:if("ready"!==this.state&&"finished"!==this.state){r.next=21;break}return r.next=21,this.showTrack();case 21:return this.state="playing",r.next=24,this.doSetTrack(e,t,n);case 24:case"end":return r.stop()}}),a,this)})))}},{key:"_awaitTrackHandler",value:function(){return h(this,void 0,void 0,r.default.mark((function e(){var t=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("beforeshow"!==this.state){e.next=4;break}return e.next=3,new c.default((function(e){t.once("showTrack",e)}));case 3:this.state="playing";case 4:if("beforefinish"!==this.state){e.next=8;break}return e.next=7,new c.default((function(e){t.once("hideTrack",e)}));case 7:this.state="finished";case 8:case"end":return e.stop()}}),e,this)})))}},{key:"duration",get:function(){return this.offsetEnd-this.offsetBegin}}]),t}(l.default);t.default=f},function(e,t,n){"use strict";var r=i(n(44)),a=i(n(16));function i(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e){function t(e){var n=void 0;function r(){for(var e=arguments.length,a=Array(e),i=0;i<e;i++)a[i]=arguments[i];if(r.enabled){var o=r,s=Number(new Date),u=s-(n||s);o.diff=u,o.prev=n,o.curr=s,n=s,a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;c++;var r=t.formatters[n];if("function"==typeof r){var i=a[c];e=r.call(o,i),a.splice(c,1),c--}return e})),t.formatArgs.call(o,a);var l=o.log||t.log;l.apply(o,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=t.selectColor(e),r.destroy=i,r.extend=o,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function o(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat((0,r.default)(t.names.map(s)),(0,r.default)(t.skips.map(s).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n=void 0,r=("string"==typeof e?e:"").split(/[\s,]+/),a=r.length;for(n=0;n<a;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n=void 0,r=void 0;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(334),(0,a.default)(e).forEach((function(n){t[n]=e[n]})),t.instances=[],t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserManager=void 0;var r=h(n(44)),a=h(n(195)),i=h(n(2)),o=h(n(0)),s=h(n(1)),u=h(n(3)),c=h(n(4)),l=h(n(344)),d=n(34);function h(e){return e&&e.__esModule?e:{default:e}}t.UserManager=function(e){function t(e){var n=e.account,r=e.maxUserHistory;(0,o.default)(this,t);var s=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return s.userKeys=[],s.userMap=new a.default,s.onUndo=function(e){s.emit("undo",e)},s.onRedo=function(e){s.emit("redo",e)},s.account=n,s.maxUserHistory="number"==typeof r?r:10,s}return(0,c.default)(t,e),(0,s.default)(t,[{key:"getUser",value:function(e){return this.userMap.get(e)}},{key:"addUser",value:function(e){if(this.userMap.has(e))return this.userMap.get(e);var t=new l.default(e,this.maxUserHistory);return t.on("undo",this.onUndo),t.on("redo",this.onRedo),this.userMap.set(e,t),t}},{key:"hasUser",value:function(e){return this.userMap.has(e)}},{key:"remove",value:function(e){this.userMap.has(e)&&this.userMap.get(e).removeAllListeners();return this.userMap.delete(e)}},{key:"removeOtherUsers",value:function(){var e=this;this.others.forEach((function(t){t.removeAllListeners(),e.userMap.delete(t.account)}))}},{key:"destroy",value:function(){this.all.forEach((function(e){return e.removeAllListeners()})),this.userMap.clear()}},{key:"toSnapshot",value:function(e){return this.all.map((function(t){return{account:t.account,recycle:t.recycle.map((function(t){return t.toSnapshot(e)})),calibrate:t.getCalibrateAction().toString()}}))}},{key:"myself",get:function(){return this.userMap.get(this.account)}},{key:"others",get:function(){var e=this,t=[];return this.userMap.forEach((function(n,r){r===e.account||t.push(n)})),t}},{key:"uids",get:function(){return[].concat((0,r.default)(this.userMap.keys()))}},{key:"all",get:function(){return[].concat((0,r.default)(this.userMap.values()))}}]),t}(d.EventEmitter)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStandardCursor=function(e){},t.isStandardMode=function(e){if("string"!=typeof e)return[!1,"模式必须是字符串"];if(""===(e=e.trim()))return[!1,"模式不能为空！"];if("player"===e)return[!0];if(!~e.indexOf(":"))return[!1,"模式格式不正确！没有找到分割符-> ："];e.split(":");return[!0]},t.isValidTool=function(e){if("string"!=typeof e)return!1;switch(e){case"fill":case"flag":case"free":case"line":case"rect":case"circle":case"roundRect":case"solidRect":case"solidRoundRect":case"solidCircle":case"text":case"ellipse":case"solidEllipse":case"erase":return!0;default:return!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(55)),a=f(n(2)),i=f(n(0)),o=f(n(1)),s=f(n(3)),u=f(n(4)),c=f(n(29)),l=f(n(293)),d=n(118),h=n(283);function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,n,r){return new(n||(n=c.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},v=function(e){function t(e,n){(0,i.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));r.params=e,r.viewerArr=[],r.urlArray=[],r.type="gz",r.offsetBegin=0,r.offsetEnd=0;var o=void 0;return Array.isArray(e)?(o=e[0].timestamp,r.urlArray=e.map((function(e){return e.url}))):(o=e.timestamp,r.url=e.url),r.timestamp=o,r.opt=n,r.state="init",r.nextRecordIndex=0,r.viewer="unknown",r}return(0,u.default)(t,e),(0,o.default)(t,[{key:"fetchData",value:function(){return p(this,void 0,void 0,r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("init wb track "),t=void 0,e.prev=2,e.next=5,(0,h.fetchBlob)(this.url);case 5:t=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",["error",[]]);case 11:return e.next=13,this.getRawRecordFromBlob(t);case 13:return n=e.sent,e.abrupt("return",["ready",n]);case 15:case"end":return e.stop()}}),e,this,[[2,8]])})))}},{key:"fetchMultiData",value:function(){return p(this,void 0,void 0,r.default.mark((function e(){var t,n,a,i=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],e.prev=1,n=0;case 3:if(!(n<this.urlArray.length)){e.next=10;break}return e.next=6,(0,h.fetchBlob)(this.urlArray[n]);case 6:t[n]=e.sent;case 7:n++,e.next=3;break;case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",["error",[]]);case 15:return e.next=17,c.default.all(t.map((function(e){return i.getRawRecordFromBlob(e)})));case 17:return a=e.sent,e.abrupt("return",["ready",a]);case 19:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"getRawRecordFromBlob",value:function(e){return p(this,void 0,void 0,r.default.mark((function t(){var n,a=this;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new c.default((function(t){var n=[],i=new FileReader;i.readAsBinaryString(e),i.onload=function(){return p(a,void 0,void 0,r.default.mark((function e(){var a,o,s,u,c,l,f,p,v,y;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=d.pako.ungzip(i.result),o=new DataView(a.buffer),s=o.byteLength,u=0;case 4:if(!(u<s)){e.next=17;break}return c=o.getInt32(u,!0),l=o.getInt32(u+4,!0),f=c-8,p=u+8,v=a.slice(p,p+f),e.next=12,(0,h.ab2str)(v);case 12:y=e.sent,n.push({time:l,str:y}),u+=c,e.next=4;break;case 17:o=null,n.length&&(this.offsetEnd=Math.max(this.offsetBegin+n[n.length-1].time+1e3,this.offsetEnd)),t(n);case 20:case"end":return e.stop()}}),e,this)})))}}));case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"hideTrackCb",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(l.default);t.default=v},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(321)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(n(55)),a=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(4)),c=g(n(29)),l=g(n(34)),d=g(n(322)),h=n(324),f=g(n(329)),p=g(n(330)),v=g(n(347)),y=n(283);function g(e){return e&&e.__esModule?e:{default:e}}var m=function(e,t,n,r){return new(n||(n=c.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},w=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.speed=1,e.init=function(t){var n=[],r=[];t.videoTracks.forEach((function(e){n.push(new f.default(e))})),t.whiteboardTracks.forEach((function(e){"1.0"===t.version||"2.0"===t.version?n.push(new p.default(e,{version:t.version})):r.push(e)})),r.length>0&&n.push(new v.default(r,{version:t.version})),e.timeline=new d.default(n),e.timeline.on("tick",(function(t){return e.emit("tick",t)})),e.timeline.on("pause",(function(){return e.emit("pause")})),e.timeline.on("play",(function(){return e.emit("play")})),e.timeline.on("finished",(function(){e.emit("finished")})),e.timeline.on("visibleChange",(function(t,n,r){e._visibleChangeCallHandler(t,n,r),e.emit("visibleChange",t,n)}));var a=e;return new c.default((function(t,n){e.timeline.once("ready",(function(e){t({player:a,params:e})}))}))},e._visibleChangeCallHandler=function(e,t,n){"show"===e?n(t.container):n()},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"bindControlContainer",value:function(e){"function"==typeof this.unmount&&this.unmount(),this.unmount=(0,h.mount)(e,this)}},{key:"setPlaySpeed",value:function(e){if(e<=.1||e>=100)throw new Error("播放速度不能大于100，或者小于0.1");this.timeline&&(this.timeline.setPlaySpeed(e),this.speed=e,this.emit("speedChange",e))}},{key:"setViewer",value:function(e){this.timeline&&this.timeline.setViewer(e)}},{key:"play",value:function(){if(this.timeline)return this.timeline.play()}},{key:"pause",value:function(){if(this.timeline)return this.timeline.pause()}},{key:"seekTo",value:function(e){this.timeline&&this.timeline.seekTo(e)}},{key:"destroy",value:function(){return m(this,void 0,void 0,r.default.mark((function e(){var t=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.timeline){e.next=3;break}return e.next=3,this.timeline.destroy();case 3:"function"==typeof this.unmount&&(this.unmount(),this.unmount=void 0),delete this.timeline,this.eventNames().forEach((function(e){return t.off(e)}));case 6:case"end":return e.stop()}}),e,this)})))}}],[{key:"getInstance",value:function(e){var n=e.whiteboardParams.urlArr.map((function(t){var n=(0,y.parseUrl)(t);if(n&&e.whiteboardParams.timestamp&&(n.timestamp=e.whiteboardParams.timestamp),!n.timestamp)throw new Error("replay--\x3e 无法获取白板录像文件的开始时间, 请仔细检查你的参数");if(!e.whiteboardParams.container)throw new Error("replay--\x3e 白板容器不可用，请仔细检查你的参数");return n.container=e.whiteboardParams.container,n})).filter((function(e){return e})),r=void 0;return r=e.videoParams?e.videoParams.map((function(e,t){var n=(0,y.parseUrl)(e.url);if(n&&e.timestamp&&(n.timestamp=e.timestamp),!n.timestamp)throw new Error("replay--\x3e 无法获取第"+(t+1)+"个视频录像的开始时间, 请仔细检查你的参数");return e.container||console.error("replay--\x3e 第"+(t+1)+"个录像文件的容器为空，请仔细检查你的参数"),n.container=e.container,n})):[],console.log("replay--\x3e 录像回放参数为",n,r,e.version),(new t).init({whiteboardTracks:n,videoTracks:r,version:e.version||"3.0"})}}]),t}(l.default);t.default=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(55)),a=f(n(2)),i=f(n(0)),o=f(n(1)),s=f(n(3)),u=f(n(4)),c=f(n(29)),l=f(n(34)),d=n(323),h=f(d);function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,n,r){return new(n||(n=c.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},v=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.tracks=e,n.ticker=new h.default,n.endTimeStamp=0,n.state="pause",n.busy=!1,n.handleTrackVisibleChange=function(e,t,r){n.emit("visibleChange",e,t,r)},n.update=function(e){return p(n,void 0,void 0,r.default.mark((function t(){var n=this;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"play"!==this.state&&console.error("update应该处于play状态下才调用"),t.next=3,c.default.all(this.tracks.map((function(t){return t.update(e)})));case 3:this.tracks.every((function(e){return"finished"===e.state}))&&setTimeout((function(){n._doPause(),n.state="finished",n.emit("finished")}));case 4:case"end":return t.stop()}}),t,this)})))},n.initTrack(e),n.bindTickerEvents(),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"initTrack",value:function(e){var t=this;this.tracks=e.slice();var n=y(e),r=m(e,n);console.log("init every track"),c.default.all(r).then((function(r){console.log("every track inited");var a=t.tracks.filter((function(e,t){return"error"===r[t]}));t.tracks=t.tracks.filter((function(e,t){return"ready"===r[t]})),a.length>0&&console.error("bad track",a),t.endTimeStamp=g(e),t.bindTrackEvents(),console.log("timeline ready");var i=[];t.tracks.forEach((function(e){Array.isArray(e.viewerArr)&&e.viewerArr.forEach((function(e){i.includes(e)||i.push(e)}))})),0===i.length&&i.push("unknown"),t.emit("ready",{beginTimeStamp:n,endTimeStamp:t.endTimeStamp+n,duration:t.endTimeStamp,viewerArr:i})}))}},{key:"bindTrackEvents",value:function(){var e=this;this.tracks.forEach((function(t){t.on("visibleChange",e.handleTrackVisibleChange),t.on("waitingToPlay",(function(){return e.handleTrackWaitingToPlay()})),t.on("canplay",(function(){return e.handleTrackCanPlay()}))}))}},{key:"bindTickerEvents",value:function(){var e=this;this.ticker.on("tick",(function(t){e.emit("tick",t),e.update(t)})),this.ticker.on("pause",(function(){e.emit("pause")})),this.ticker.on("play",(function(){e.emit("play")}))}},{key:"handleTrackWaitingToPlay",value:function(){"play"===this.state&&this.hasTrackWaiting()&&(this.state="waitingToPlay",this._doPause())}},{key:"handleTrackCanPlay",value:function(){"waitingToPlay"!==this.state||this.hasTrackWaiting()||(this.state="play",this._doPlay())}},{key:"hasTrackWaiting",value:function(){var e=this;return void 0!==this.tracks.find((function(t){return t.isWaiting(e.ticker.currTimeStamp)}))}},{key:"pause",value:function(){this.busy?console.warn("busy pause"):("play"===this.state&&this._doPause(),"finished"!==this.state&&(this.state="pause"))}},{key:"play",value:function(){this.busy?console.warn("busy play"):"finished"!==this.state?this.hasTrackWaiting()?this.state="waitingToPlay":(this.state="play",this._doPlay()):(this.state="play",this.seekTo(0))}},{key:"setPlaySpeed",value:function(e){this.ticker.rate=e,this.tracks.forEach((function(t){t.setPlaySpeed(e)}))}},{key:"setViewer",value:function(e){this.tracks.forEach((function(t){return t.setViewer(e)}))}},{key:"seekTo",value:function(e){return p(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.busy){t.next=2;break}return t.abrupt("return");case 2:if(e=Math.min(Math.max(e,0),this.endTimeStamp),!(this.ticker.currTimeStamp<e&&e<this.ticker.currTimeStamp+2*d.DEFAULT_INTERVAL)){t.next=5;break}return t.abrupt("return");case 5:if(!(e<this.ticker.currTimeStamp)){t.next=20;break}return"finished"===this.state&&(this.state="pause"),this.busy=!0,this.ticker.setCurrentTime(e),t.prev=9,t.next=12,c.default.all(this.tracks.map((function(t){return t.seekTo(e,!1)})));case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(9),console.error(t.t0);case 17:this.busy=!1,t.next=31;break;case 20:return this.busy=!0,this.ticker.setCurrentTime(e),t.prev=22,t.next=25,c.default.all(this.tracks.map((function(t){return t.seekTo(e,!0)})));case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(22),console.error(t.t1);case 30:this.busy=!1;case 31:"play"===this.state?this._doPlay():this._doPause();case 32:case"end":return t.stop()}}),t,this,[[9,14],[22,27]])})))}},{key:"_doPause",value:function(){this.ticker.pause(),this.tracks.forEach((function(e){return e.pause()}))}},{key:"_doPlay",value:function(){this.ticker.play(),this.tracks.forEach((function(e){return e.play()}))}},{key:"destroy",value:function(){return p(this,void 0,void 0,r.default.mark((function e(){var t=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ticker.destory(),e.next=3,c.default.all(this.tracks.map((function(e){return e.destroy()})));case 3:this.eventNames().forEach((function(e){return t.off(e)}));case 4:case"end":return e.stop()}}),e,this)})))}}]),t}(l.default);t.default=v;var y=function(e){var t=Number.POSITIVE_INFINITY;return e.forEach((function(e){t>e.timestamp&&(t=e.timestamp)})),t},g=function(e){var t=Number.NEGATIVE_INFINITY;return e.forEach((function(e){t<e.offsetEnd&&(t=e.offsetEnd)})),t},m=function(e,t){var n=/iphone/i.test(navigator.userAgent),r=c.default.resolve("got lucky ~");return e.map((function(e){if(e.offsetBegin=e.timestamp-t,n&&("mp4"===e.type||"flv"===e.type||"aac"===e.type)){var a=e.init(r);return r=a,a}return e.init()}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_INTERVAL=void 0;var r=c(n(2)),a=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=n(34);function c(e){return e&&e.__esModule?e:{default:e}}var l=t.DEFAULT_INTERVAL=10,d=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.state="pause",e.currTimeStamp=0,e.lastRealTime=void 0,e.rate=1,e.microTask=function(){"play"===e.state&&e.tick()},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"destory",value:function(){var e=this;this.pause(),this.eventNames().forEach((function(t){return e.off(t)}))}},{key:"tick",value:function(){var e=Date.now();if(void 0!==this.lastRealTime){var t=(e-this.lastRealTime)*this.rate;this.currTimeStamp=this.currTimeStamp+t,this.lastRealTime=e,this.emit("tick",this.currTimeStamp)}else this.lastRealTime=e}},{key:"pause",value:function(){this.timer&&window.clearInterval(this.timer),this.timer=void 0,this.lastRealTime=void 0,this.state="pause",this.emit("pause")}},{key:"play",value:function(){this.timer||(this.timer=setInterval(this.microTask,l)),this.state="play",this.emit("play")}},{key:"setCurrentTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currTimeStamp=e,this.lastRealTime=void 0}}]),t}(u.EventEmitter);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(32)),a=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4));t.mount=function(e,t){if(!e)throw new Error("RecordPlayer mount传入的容器不能为空");if(!t)throw new Error("请传入录制回放实例");var n=(0,c.render)(l.default.createElement(y,{player:t}),e);return function(){(0,c.render)(l.default.createElement(g,null),e,n)}};var c=n(9),l=p(c),d=n(283),h=p(n(325)),f=p(n(326));function p(e){return e&&e.__esModule?e:{default:e}}n(327);var v=/iphone|android/i.test(navigator.userAgent),y=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));n.toolUIEl=(0,c.createRef)(),n.onMouseMove=function(e){var t=n.getCurrentXAndTime(e),a=t.currentX,i=t.currentTime,o=(0,d.getTime)(i),s=(0,r.default)(o,1)[0];n.setState({labelLeft:a,labelText:s})},n.pauseOrPlay=function(e){var t=n.state.paused;t?n.props.player.play():n.props.player.pause(),n.setState({paused:!t})},n.onMouseDown=function(e){"slider"===e.target.getAttribute("role")&&(n.setState({showLabel:!0,drag:!0}),n.onMouseMove(e))},n.onMouseUp=function(e){n.state.drag&&n.seekTo(e),n.hidePosition(e)},n.handleClickSpeed=function(e){n.setState({speedOptionShow:!n.state.speedOptionShow})},n.handleClickSpeedOption=function(e,t){e.stopPropagation(),n.setState({speedOptionShow:!1}),n.props.player.setPlaySpeed(t)},n.showPosition=function(e){n.setState({showLabel:!0}),n.onMouseMove(e)},n.hidePosition=function(e){n.setState({showLabel:!1})},n.seekTo=function(e){var t=n.getCurrentXAndTime(e),r=t.currentX,a=t.currentTime;n.props.player.seekTo(a);var i={labelLeft:r,time:a,drag:!1};v&&(i.showLabel=!1),n.setState(i)},n.getCurrentXAndTime=function(e){var t=0,r=n.toolUIEl.current.getBoundingClientRect().left;t=e.type.search(/mouse|click/)>-1?e.clientX-r:e.touches[0].clientX-r;var a=n.toolUIEl.current.offsetWidth;return t<0&&(t=0),t>a&&(t=a),{currentX:t,currentTime:n.state.duration*(t/a)}};var o=e.player;return n.state={time:o.timeline.ticker.currTimeStamp,duration:o.timeline.endTimeStamp,showLabel:!1,labelLeft:0,labelText:"",paused:"pause"===o.timeline.ticker.state,currSpeed:o.speed,speedOptionShow:!1,drag:!1},o.on("tick",(function(e){n.setState({time:e})})),o.on("play",(function(){n.setState({paused:!1})})),o.on("pause",(function(){n.setState({paused:!0})})),o.on("speedChange",(function(e){n.setState({currSpeed:e})})),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"renderSpeed",value:function(){var e=this,t=1===this.state.currSpeed?"倍数":this.state.currSpeed+"x";return l.default.createElement("div",{className:"player-speed",onClick:this.handleClickSpeed},l.default.createElement("div",{className:"player-speed-text"},t),this.state.speedOptionShow&&l.default.createElement("div",{className:"player-speed-options"},[2,1.5,1.25,1,.75,.5].map((function(t){return l.default.createElement("div",{className:"option",key:t,onClick:function(n){return e.handleClickSpeedOption(n,t)}},t,"x")}))))}},{key:"render",value:function(e,t){var n=t.time,a=t.duration,i=t.showLabel,o=t.labelLeft,s=t.labelText,u=t.paused,c=t.drag,p=0;p=n>=a?100:n<=0?0:n/a*100;var v=void 0;if(n>a){var y=(0,d.getTime)(a),g=(0,r.default)(y,1)[0];v=g+"/"+g}else{var m=(0,d.getTime)(a),w=(0,r.default)(m,2),b=w[0],_=w[1],k=(0,d.getTime)(n,_>0);v=(0,r.default)(k,1)[0]+"/"+b}var x=void 0;return x=11===v.length?140:v.length<17?160:180,l.default.createElement("div",{className:"player-container"},l.default.createElement("div",{className:"player-play-icon-wrapper",role:"icon",onClick:this.pauseOrPlay},l.default.createElement("span",{className:"player-play-icon",style:{backgroundImage:"url("+(u?f.default:h.default)+")"}})),this.renderSpeed(),l.default.createElement("div",{role:"duration",className:"player-duration"},v),l.default.createElement("div",{ref:this.toolUIEl,className:"player-timeline",style:{right:x+"px"},onClick:this.seekTo,onMouseEnter:this.showPosition,onMouseLeave:this.hidePosition,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onTouchStart:this.onMouseDown,onTouchMove:this.onMouseMove,onTouchEnd:this.onMouseUp,role:"timeline"},l.default.createElement("span",{role:"currentLabel",className:"player-timeline-label",style:{display:i?"inline-block":"none",left:o+"px"}},s),l.default.createElement("span",{role:"label-background",className:"player-timeline-bg",style:{display:i?"inline-block":"none",height:20,left:o+"px"}}),l.default.createElement("div",{role:"blue-line",className:"player-timeline-blueline",style:{width:p+"%"}}),l.default.createElement("div",{role:"slider",className:"player-timeline-slider",style:{left:c?o+"px":p+"%",backgroundClip:c?"border-box":"content-box"}})))}}]),t}(l.default.Component);t.default=y;var g=function(){return null}},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTUxOTYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MDgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU5Ljk0NzkyOTA5IDEzMy45MjE4OTNoMTI2LjAyNjAzNDgxYzIzLjMzODE1NDczIDAgNDIuMDA4Njc4MjcgMTguNjcwNTIzNTMgNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZ2NjcyLjEzODg1NzQ4YzAgMjMuMzM4MTU0NzMtMTguNjcwNTIzNTMgNDIuMDA4Njc4MjctNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZIMjU5Ljk0NzkyOTA5Yy0yMy4zMzgxNTQ3MyAwLTQyLjAwODY3ODI3LTE4LjY3MDUyMzUzLTQyLjAwODY3OTU2LTQyLjAwODY3ODI2VjE3NS45MzA1NzEyNmMwLTIzLjMzODE1NDczIDE4LjY3MDUyMzUzLTQyLjAwODY3ODI3IDQyLjAwODY3OTU2LTQyLjAwODY3ODI2ek02MzguMDI2MDM2MSAxMzMuOTIxODkzaDEyNi4wMjYwMzQ4MWMyMy4zMzgxNTQ3MyAwIDQyLjAwODY3ODI3IDE4LjY3MDUyMzUzIDQyLjAwODY3OTU2IDQyLjAwODY3ODI2djY3Mi4xMzg4NTc0OGMwIDIzLjMzODE1NDczLTE4LjY3MDUyMzUzIDQyLjAwODY3ODI3LTQyLjAwODY3OTU2IDQyLjAwODY3ODI2aC0xMjYuMDI2MDM0ODFjLTIzLjMzODE1NDczIDAtNDIuMDA4Njc4MjctMTguNjcwNTIzNTMtNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZWMTc1LjkzMDU3MTI2YzAtMjMuMzM4MTU0NzMgMTguNjcwNTIzNTMtNDIuMDA4Njc4MjcgNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyOTA5Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTI0MjE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTEyLjcyNDg4NCA0MjkuMzU1NjgxTDIwOC43OTc1NDUgMTMuMTk4NjM4QzE1MS42MDM0NDktMjAuNTk3ODc0IDY0LjAxMjQ5IDEyLjE5ODc0MSA2NC4wMTI0OSA5NS43OTAxMTJWOTI3LjkwNDIxOWMwIDc0Ljk5MjI1OSA4MS4zOTE1OTkgMTIwLjE4NzU5NCAxNDQuNzg1MDU1IDgyLjU5MTQ3NWw3MDMuOTI3MzM5LTQxNS45NTcwNjRjNjIuNzkzNTE4LTM2Ljk5NjE4MSA2Mi45OTM0OTgtMTI4LjE4Njc2OCAwLTE2NS4xODI5NDl6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyMTMyIj48L3BhdGg+PC9zdmc+"},function(e,t,n){var r=n(328);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(22)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(21)(!1)).push([e.i,".player-container {\n    display: block;\n    position: relative;\n    height: 30px;\n    background: rgba(113, 113, 113, 0.23);\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n}\n\n    .player-container .player-play-icon-wrapper {\n        position:absolute;\n        top:5px;\n        left:10px;\n        height:20px;\n        width:20px;\n        cursor:pointer;\n    }\n\n    .player-container .player-play-icon-wrapper .player-play-icon {\n            display:inline-block;\n            height:inherit;\n            width:inherit;\n            background-size:cover;\n        }\n\n    .player-container .player-speed {\n        position: absolute;\n        top: 5px;\n        right: 85px;\n        width: 57px;\n        height: 20px;\n        font-size: 14px;\n        font-family: sans-serif;\n        cursor: pointer;\n    }\n\n    .player-container .player-speed .player-speed-text {\n            text-align: center;\n        }\n\n    .player-container .player-speed .player-speed-options {\n            position: absolute;\n            bottom: 27px;\n            background: rgba(0,0,0,.8);\n            padding: 0 10px;\n            color: white;\n            text-align: center;\n        }\n\n    .player-container .player-speed .player-speed-options .option {\n                margin: 10px 0;\n            }\n\n    .player-container .player-duration {\n        position:absolute;\n        top:5px;\n        right:10px;\n        height:20px;\n        font-size:14px;\n        font-family:sans-serif;\n    }\n\n    .player-container .player-timeline {\n        position: absolute;\n        left: 40px;\n        top: 12px;\n        bottom: 12px;\n        height: 6px;\n        cursor: pointer;\n        background: rgba(0,0,0,0.12);\n    }\n\n    .player-container .player-timeline-label {\n        position: absolute;\n        height: 20px;\n        background: white;\n        border-radius: 3px;\n        bottom: 10px;\n        padding: 4px 6px;\n        transform: translateX(-50%);\n    }\n\n    .player-container .player-timeline-bg {\n        position: absolute;\n        height: 20px;\n        background: 'white';\n        width: 2px;\n        bottom: -5px;\n        pointer-events: none;\n    }\n\n    .player-container .player-timeline-blueline {\n        position: absolute;\n        background: rgba(24, 121, 226, 0.7);\n        height: inherit;\n        pointer-events: none;\n    }\n\n    .player-container .player-timeline-slider {\n        position: absolute;\n        top: -5px;\n        bottom: -5px;\n        background: white;\n        box-sizing: content-box;\n        padding:0 4px;\n        width: 4px;\n        transform:translateX(-6px);\n    }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(55)),a=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),c=d(n(29)),l=d(n(293));function d(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,r){return new(n||(n=c.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},f=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));n.params=e,n.offsetBegin=0,n.offsetEnd=0,n.waitingForData=!0;var r=e.type,o=e.url,u=e.timestamp;return n.type=r,n.timestamp=u,n.url=o,n.state="init",n.videoRef=document.createElement("video"),n.videoRef.oncanplay=function(){n.waitingForData=!1,n.emit("canplay")},n.videoRef.onwaiting=function(){n.waitingForData=!0,n.emit("waitingToPlay")},n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"init",value:function(e){return h(this,void 0,void 0,r.default.mark((function t(){var n,a=this;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=3;break}return t.next=3,e;case 3:return console.log("init video track"),t.next=6,new c.default((function(e){var t=a.videoRef;t.src=a.url,p(t),t.preload="metadata",t.onloadeddata=function(n){var r=t.duration;r!=r?r=Number.NEGATIVE_INFINITY:r*=1e3,a.offsetEnd=a.offsetBegin+r,t.pause(),a.state="ready",console.log("init video ready"),e("ready")},t.onerror=function(t){console.error(t),e("error")}}));case 6:return n=t.sent,t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"doSetTrack",value:function(e,t,n){return h(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n&&this.setVideoTime(e);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"showTrackCb",value:function(e){e&&(y(e)||e.appendChild(this.videoRef))}},{key:"hideTrackCb",value:function(){this.videoRef&&this.videoRef.pause()}},{key:"setPlaySpeed",value:function(e){this.videoRef&&(this.videoRef.playbackRate=e)}},{key:"pause",value:function(){this.videoRef&&this.videoRef.pause()}},{key:"play",value:function(){this.videoRef&&"playing"===this.state?this.videoRef.play():this.videoRef.pause()}},{key:"setVideoTime",value:function(e){this.videoRef.currentTime=(e-this.offsetBegin)/1e3}},{key:"isWaiting",value:function(e){return!(e<this.offsetBegin||e>this.offsetEnd)&&this.waitingForData}}]),t}(l.default);t.default=f;var p=function(e){e.setAttribute("data-x-4wb","true"),e.setAttribute("playsinline","playsinline"),e.setAttribute("webkit-playsinline","webkit-playsinline")},v=function(e){return"true"===e.getAttribute("data-x-4wb")},y=function(e){if(e.children.length>0)for(var t=0,n=e.children.length;t<n;t++){var r=e.children[t];if("video"===r.tagName.toLowerCase()&&v(r))return!0}return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(n(55)),a=m(n(32)),i=m(n(2)),o=m(n(0)),s=m(n(1)),u=m(n(3)),c=m(n(4)),l=m(n(12)),d=m(n(81)),h=m(n(29)),f=m(n(331)),p=n(112),v=n(111),y=m(n(338)),g=m(n(297));function m(e){return e&&e.__esModule?e:{default:e}}var w=function(e,t,n,r){return new(n||(n=h.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},b=function(e){if(!d.default.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[d.default.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):(0,l.default)(e),t={},r("next"),r("throw"),r("return"),t[d.default.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new h.default((function(r,a){(function(e,t,n,r){h.default.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,a,(t=e[n](t)).done,t.value)}))}}},_=function(e){function t(e,n){(0,o.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.params=e,r.drawManager=null,r.records=[],r}return(0,c.default)(t,e),(0,s.default)(t,[{key:"init",value:function(){return w(this,void 0,void 0,r.default.mark((function e(){var t,n,i,o,s,u=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchData();case 2:if(t=e.sent,n=(0,a.default)(t,2),i=n[0],o=n[1],console.log("init ",i,o),"error"!==i){e.next=12;break}return this.state="error",e.abrupt("return","error");case 12:return s=[],this.isCompatible&&(s.push(new f.default(10,'16:{"mode"¦"draw"，"tool"¦"flag"，"size"¦1，"color"¦"#000000"，"fontsize"¦24};',!1)),s.push(new f.default(20,'16:{"color"¦"#000"};16:{"size"¦1};',!1)),s.push(new f.default(30,'16:{"ownerCanvasHeight"¦1000，"ownerCanvasWidth"¦1300};',!1))),o.forEach((function(e){s.push(new f.default(e.time,e.str,u.isCompatible))})),this.isCompatible&&s.length&&k(s),this.records=s,this.state="ready",e.abrupt("return","ready");case 19:case"end":return e.stop()}}),e,this)})))}},{key:"doSetTrack",value:function(e,t,n){return w(this,void 0,void 0,r.default.mark((function a(){var i,o,s,u,c,l;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0===(i=t?this.nextRecordIndex:0)&&console.warn("seek back",e,n,i),!this.records.length||!this.drawManager){r.next=14;break}if(o=!1,s=x(this.records,e,this.offsetBegin,i),u=this.records.slice(i,s),this.nextRecordIndex=s,n&&(c=M(u),u=c.recordsToExecute,o=c.needSkipFirstCleanFrame),u.length&&(0===i&&(l=this.params.account,this.drawManager.clear(l),this.drawManager.clearImage(),this.drawManager.clearHtmlFile(),this.drawManager.resetState()),S(u,o,this.drawManager,this.params.account)),this.nextRecordIndex!==this.records.length){r.next=12;break}return r.next=12,this.hideTrack();case 12:r.next=16;break;case 14:return r.next=16,this.hideTrack();case 16:case"end":return r.stop()}}),a,this)})))}},{key:"showTrackCb",value:function(e){e&&!this.drawManager&&(this.drawManager=new y.default(e))}},{key:"isCompatible",get:function(){return"1.0"===this.opt.version}}]),t}(g.default);function k(e){if(!e)return[];if(0===e.length)return e;for(var t=void 0,n="flag",r=0,a=e.length;r<a;r++)for(var i=e[r].actions,o=0;o<i.length;){var s=i[o];switch(s.TYPE){case v.WActions.CALIBRATE:var u=s.color;if(u){if(u===t){i.splice(o,1);continue}t=u}o++;continue;case v.WActions.START:"flag"===n&&(n="free",console.log("deleted"),i.splice(o,0,new p.CalibrateAction({tool:"free"})),++o),++o;continue;case v.WActions.LASER_PEN:"free"===n&&(n="flag",console.log("insert flage"),i.splice(o,0,new p.CalibrateAction({tool:"flag"})),++o),++o;continue;case v.WActions.LASER_PEN_END:++o;default:++o}}e.forEach((function(e){return e.updateIndex()}))}function x(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=r;a<e.length;a++){var i=e[a];if(i.time+n>t)return a}return a}function M(e){for(var t=!1,n=e.length;n--;){if(e[n].isClearFrame)break}if(-1!==n){for(var r=0;r<n;r++){var a=e[r];e[r]=a.toStateRelatedRecord()}t=!0,e=e.filter((function(e){return 0!==e.actions.length}))}return{needSkipFirstCleanFrame:t,recordsToExecute:e}}function S(e,t,n,a){var i,o,s,u;return w(this,void 0,void 0,r.default.mark((function c(){var l,d,h;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,r.prev=1,i=b(e);case 3:return r.next=5,i.next();case 5:if((o=r.sent).done){r.next=19;break}if(!(l=o.value).isClearFrame||!t){r.next=15;break}return d=l.actions,h=l.clearIndex,r.next=12,n.executeActions(a,d.slice(h[0]));case 12:t=!1,r.next=17;break;case 15:return r.next=17,n.executeActions(a,l.actions);case 17:r.next=3;break;case 19:r.next=24;break;case 21:r.prev=21,r.t0=r.catch(1),s={error:r.t0};case 24:if(r.prev=24,r.prev=25,!o||o.done||!(u=i.return)){r.next=29;break}return r.next=29,u.call(i);case 29:if(r.prev=29,!s){r.next=32;break}throw s.error;case 32:return r.finish(29);case 33:return r.finish(24);case 34:r.next=39;break;case 36:r.prev=36,r.t1=r.catch(0),console.error(r.t1);case 39:case"end":return r.stop()}}),c,this,[[0,36],[1,21,24,34],[25,,29,33]])})))}t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(0)),a=c(n(1)),i=n(111),o=u(n(332)),s=u(n(197));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,n,a){(0,r.default)(this,e),this.time=t,this.isCompatible=a,"string"==typeof n?(this.data=n,this.actions=a?o.unpackBulk(n):s.unpackBulk(n)):(this.data="",this.actions=n),this.clearIndex=[],this.isClearFrame=!1,this.updateIndex()}return(0,a.default)(e,[{key:"updateIndex",value:function(){this.clearIndex=this.actions.reduce((function(e,t,n){return t.TYPE===i.WActions.CLEAR&&e.push(n),e}),[]),this.isClearFrame=0!==this.clearIndex.length}},{key:"getStateRelatedActions",value:function(){return this.actions.filter((function(e){return i.StateRelatedActions.indexOf(e.TYPE)>-1}))}},{key:"toStateRelatedRecord",value:function(){return new e(this.time,this.getStateRelatedActions(),this.isCompatible)}}]),e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.packBulk=function(e){var t=e.map((function(e){return s(e)})).join(";")+";";return i.default.m.syncmanager("packBulk anyAction",t),t},t.pack=s,t.unpackBulk=function(e){var t=[];return e.split(";").forEach((function(e){var n=u(e);if(n)if(Array.isArray(n))for(;n.length;){var r=n.shift();r&&t.push(r)}else t.push(n)})),t},t.unpack=u,t.formatColor=c,t.hex2rgb=l;var r,a=n(79),i=(r=a)&&r.__esModule?r:{default:r},o=n(112);function s(e,t){return i.default.m.syncmanager("pack anyAction",e),console.assert(void 0!==e.action,"ooops"),e.action.toString()}function u(e){if(e){var t=e.indexOf(":");i.default.m.syncmanager("unpack command ",e);var n=void 0,r=void 0;-1==t?(n=+e,r=""):(n=+e.slice(0,t),r=e.slice(t+1,e.length));var a=r.length>1?r.split(","):[];switch(i.default.command("unpack",e),n){case 1:var s=[new o.StartAction(+a[0],+a[1])];return a[2]&&s.unshift(new o.CalibrateAction({color:c(a[2])})),s;case 2:var u=[new o.MoveAction(+a[0],+a[1])];return a[2]&&u.unshift(new o.CalibrateAction({color:c(a[2])})),u;case 3:var l=[new o.EndAction(+a[0],+a[1])];return a[2]&&l.unshift(new o.CalibrateAction({color:c(a[2])})),l;case 12:return new o.LaserPenAction(+a[0],+a[1]);case 13:return new o.LaserPenEndAction;case 4:return new o.RevokeAction;case 5:return new o.SerialAction;case 6:return new o.ClearAction;case 7:return new o.ClearAckAction;case 8:return new o.SyncRequestAction;case 9:return void console.warn("收到了同步指令，未做兼容，请联系云信技术支持");case 10:return new o.SyncPrepareAction;case 11:return new o.SyncPrepareAckAction;case 14:return new o.FileAction({docId:a[0],currentPage:+a[1],pageCount:+a[2],type:"0"==a[2]?"clear":"img"});default:}}}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;if(!e)return-1;var n="";return 16===t?(e=+e)<0?(n=l(e),console.log("hex2rgb",e,n),n):((n=e.toString(16)).length<3&&(n=("000"+n).slice(-3)),n.length>3&&n.length<6&&(n=("000"+n).slice(-6)),n="#"+n):10===t?(n=e.replace(/#/gi,""),n=parseInt("0x"+n),isNaN(n)?-1:n):void 0}function l(e){var t=e>>16&255,n=e>>8&255,r=255&e;return t=t.toString(16),n=n.toString(16),r=r.toString(16),console.log("rgb",t,n,r),"#"+("0"+t).slice(-2)+("0"+n).slice(-2)+("0"+r).slice(-2)}},function(e,t,n){"use strict";(function(r){var a,i=n(35),o=(a=i)&&a.__esModule?a:{default:a};t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(a=r))})),t.splice(a,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e=void 0;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=n(294)(t),e.exports.formatters.j=function(e){try{return(0,o.default)(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(114))},function(e,t){var n=1e3,r=6e4,a=60*r,i=24*a;function o(e,t,n,r){var a=t>=1.5*n;return Math.round(e/n)+" "+r+(a?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*a;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return o(e,t,i,"day");if(t>=a)return o(e,t,a,"hour");if(t>=r)return o(e,t,r,"minute");if(t>=n)return o(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=a)return Math.round(e/a)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";(function(r){var a,i=n(16),o=(a=i)&&a.__esModule?a:{default:a};var s=n(336),u=n(194);t.init=function(e){e.inspectOpts={};for(var n=(0,o.default)(t.inspectOpts),r=0;r<n.length;r++)e.inspectOpts[n[r]]=t.inspectOpts[n[r]]},t.log=function(){return r.stderr.write(u.format.apply(u,arguments)+"\n")},t.formatArgs=function(n){var r=this.namespace;if(this.useColors){var a=this.color,i="[3"+(a<8?a:"8;5;"+a),o="  "+i+";1m"+r+" [0m";n[0]=o+n[0].split("\n").join("\n"+o),n.push(i+"m+"+e.exports.humanize(this.diff)+"[0m")}else n[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+r+" "+n[0]},t.save=function(e){e?r.env.DEBUG=e:delete r.env.DEBUG},t.load=function(){return r.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):s.isatty(r.stderr.fd)},t.colors=[6,2,3,4,5,1];try{var c=n(337);c&&(c.stderr||c).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=(0,o.default)(r.env).filter((function(e){return/^debug_/i.test(e)})).reduce((function(e,t){var n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()})),a=r.env[t];return a=!!/^(yes|on|true|enabled)$/i.test(a)||!/^(no|off|false|disabled)$/i.test(a)&&("null"===a?null:Number(a)),e[n]=a,e}),{}),e.exports=n(294)(t);var l=e.exports.formatters;l.o=function(e){return this.inspectOpts.colors=this.useColors,u.inspect(e,this.inspectOpts).replace(/\s*\n\s*/g," ")},l.O=function(e){return this.inspectOpts.colors=this.useColors,u.inspect(e,this.inspectOpts)}}).call(this,n(114))},function(e,t){t.isatty=function(){return!1},t.ReadStream=function(){throw new Error("tty.ReadStream is not implemented")},t.WriteStream=function(){throw new Error("tty.ReadStream is not implemented")}},function(e,t,n){"use strict";e.exports={stdout:!1,stderr:!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=I(n(55)),a=I(n(35)),i=I(n(32)),o=I(n(6)),s=I(n(2)),u=I(n(0)),c=I(n(1)),l=I(n(3)),d=I(n(4)),h=I(n(12)),f=I(n(81)),p=I(n(29)),v=I(n(196)),y=I(n(34)),g=I(n(284)),m=I(n(79)),w=I(n(339)),b=I(n(340)),_=n(112),k=A(n(197)),x=I(n(341)),M=n(111),S=I(n(190)),C=n(118),O=A(C);function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function I(e){return e&&e.__esModule?e:{default:e}}var P=function(e,t,n,r){return new(n||(n=p.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},T=function(e){if(!f.default.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[f.default.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):(0,h.default)(e),t={},r("next"),r("throw"),r("return"),t[f.default.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new p.default((function(r,a){(function(e,t,n,r){p.default.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,a,(t=e[n](t)).done,t.value)}))}}},E=function(e){return this instanceof E?(this.v=e,this):new E(e)},D=function(e,t,n){if(!f.default.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),i=[];return r={},o("next"),o("throw"),o("return"),r[f.default.asyncIterator]=function(){return this},r;function o(e){a[e]&&(r[e]=function(t){return new p.default((function(n,r){i.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=a[e](t)).value instanceof E?p.default.resolve(n.value.v).then(u,c):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}},R=((0,v.default)("data"),function(e){return(0,C.getKiloBytes)(e).toFixed(2)+"KB"}),N=function(e){var t=e.length,n=g.default.ungzip(e,{to:"string"});return console.debug("GZIP数据大小:"+R(t)+",原始数据大小："+R(n)+"，压缩比率为 "+(100*t/n.length).toFixed(2)+"%"),n},z=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,u.default)(this,t);var r=(0,l.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return r.afterInit=function(){r.state="inited",r.syncManager.send({toAccount:0,actions:[{action:new _.VersionAction({ver:1,account:r.account,gzip:!0})}]}),r.emit("inited")},r.afterSync=function(e){r.syncState="done",r.flushInCommingQueue(),r.emit("afterSync",e)},r.readyToSyncData=function(){"owner"===r.identity&&(r.syncState="begin",r.syncBegin()),"normal"===r.identity&&(r.syncState="waiting",r.syncRequest(r.ownerAccount))},r.onIframeMessage=function(e){m.default.h5("onIframeMessage",e.data);var t=e.data||{};if("to_yunxin_wb"===t.identity){var n=r.syncManager.fileData;if(n){var a=(0,o.default)({},n),i=t.page,s=t.anim,u=t.trigger,c=(t.time,[i,s,u,t.isBack?"1":"0","0"].join("&"));if(console.warn("onIframeMessage"),console.warn(c,a.h5Cmd),0===parseInt(i))return;a.h5Cmd===c&&console.warn("the same cmd"),a.currentPage!=i&&r.drawAdapter.clear(),a.currentPage=parseInt(i),a.h5Cmd=c,m.default.h5("onIframeMessage->emit action",e.data),r.drawAdapter.worker.emitAction({account:r.account,action:new _.FileAction(a)})}}},r.simulator=new w.default(r),r.container=e,r.opt=n,r.account=n.account,r.nim=n.nim,r.identity=n.identity,r.ownerAccount=n.ownerAccount,r.connector=n.whiteboard,r.incommingQueue=[],r.actionProcessing=!1,console.log("init wb adapter"),r.syncManager=new b.default(r.account),r.syncManager.on("flush",(function(e){r.connector&&r.connector.sendData&&r.connector.sendData(e)})),r.fileMap={},r.eventHub=S.default,r.state="created",r.syncState="inited",r.drawAdapter=new x.default(e,r.opt),r.drawAdapter.on("inited",r.afterInit),r.drawAdapter.on("action",(function(e){console.log("syncState",r.syncState),"waiting"!==r.syncState&&r.syncManager.broadcastAction(e)})),r.drawAdapter.on("instantAction",(function(e){console.warn("instant action",r.syncState),"waiting"!==r.syncState&&setTimeout((function(){r.syncManager.send({toAccount:0,actions:[e]},1)}))})),r.connectorStatus="off",r.connector&&(r.connector.on("data",(function(e){r.execute(e)})),r.connector.on("joinChannel",(function(e){console.log("join channel ",e),e.account===r.opt.ownerAccount&&"waiting"===r.syncState&&(r.syncState="done",r.flushInCommingQueue())}))),r.timmer=setInterval((function(){}),100),r}return(0,d.default)(t,e),(0,c.default)(t,[{key:"execute",value:function(e){var t=e.account,n=e.data;if(t&&n&&t!==this.account){var r=void 0,a=void 0,o=void 0,s=!1;if("number"==typeof n&&(n=""+n),"GZIP"===n.substr(0,4)){var u=n.substr(5,150),c=b.default.GZIP_TESTER_1.exec(u);if(!c)return void console.error("未匹配到GZIP压缩格式",n);u="";var l=(0,i.default)(c,4),d=l[0],h=l[1],f=l[2],p=l[3];a=h,o="gzip";var v=n.substr(5+d.length);if("1"===f)n=N(v),r=k.unpackBulk(n);else{var y=this.incommingQueue.find((function(e){return e.id===h}));if(!y){var g=new Array(+f);return g[+p]=v,y={account:t,type:o,id:a,total:+f,curLen:1,data:g,result:[new _.SerialAction]},void this.incommingQueue.push(y)}if(y.curLen++,y.data[+p]=v,y.total!==y.curLen)return;var w=N(y.data.join(""));r=k.unpackBulk(w),y.result=r,s=!0}}else r=k.unpackBulk(n),a=""+Date.now()+Math.random(),o="text";var x=s?this.incommingQueue.findIndex((function(e){return e.id===a})):-1,S=r.findIndex((function(e){return e.TYPE===M.WActions.SYNC||e.TYPE===M.WActions.SYNC_PREPARE}));if(S>-1){var C=r[S];C.TYPE===M.WActions.SYNC?this.handleSyncAction(C):this.executeActions(t,r)}else"waiting"===this.syncState||this.actionProcessing?s||this.incommingQueue.push({account:t,type:o,id:a,total:1,curLen:1,data:[],result:r}):0==this.incommingQueue.length?(m.default.m.worker("execute:",t,r),this.executeActions(t,r)):0===x?this.flushInCommingQueue():s||this.incommingQueue.push({account:t,type:o,id:a,total:1,curLen:1,data:[],result:r})}}},{key:"executeActions",value:function(e,t){var n,s,u,c;return P(this,void 0,void 0,r.default.mark((function l(){var d,h,f,p,v,y,g,w,b,k,x;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:d=this.drawAdapter,r.prev=1,n=T(t);case 3:return r.next=5,n.next();case 5:if((s=r.sent).done){r.next=69;break}h=s.value,r.t0=h.TYPE,r.next=r.t0===M.WActions.REVOKE||r.t0===M.WActions.REDO||r.t0===M.WActions.CALIBRATE||r.t0===M.WActions.TEXT||r.t0===M.WActions.START||r.t0===M.WActions.MOVE||r.t0===M.WActions.END||r.t0===M.WActions.LASER_PEN||r.t0===M.WActions.LASER_PEN_END?11:r.t0===M.WActions.SERIAL?13:r.t0===M.WActions.CLEAR?15:r.t0===M.WActions.CLEAR_ACK?19:r.t0===M.WActions.SYNC_REQUEST?21:r.t0===M.WActions.SYNC?25:r.t0===M.WActions.SYNC_PREPARE?30:r.t0===M.WActions.SYNC_PREPARE_ACK?33:r.t0===M.WActions.FILE?35:r.t0===M.WActions.VERSION?64:66;break;case 11:return d.act(e,h),r.abrupt("break",67);case 13:return console.log("serial:",h),r.abrupt("break",67);case 15:return this.syncManager.clear(),this.syncManager.makeClearAck(e),d.clear(h.accounts,e,{force:this.ownerAccount===e,quiet:!0}),r.abrupt("break",67);case 19:return d.act(e,h),r.abrupt("break",67);case 21:return console.warn("recive sync request from ",e),f=this.drawAdapter.worker.getSnapshot(),this.syncManager.syncTo(e,f),r.abrupt("break",67);case 25:return console.warn("recive sync from ",e),p=h,r.next=29,this.handleSyncAction(p);case 29:return r.abrupt("break",67);case 30:return console.warn("recive sync prepare from ",e),this.syncResponse(e),r.abrupt("break",67);case 33:return console.warn("recive sync prepare ack from ",e),r.abrupt("break",67);case 35:if(h.TYPE!==M.WActions.FILE){r.next=64;break}if(v=h.file,m.default.h5("recive h5 FileAction",v),y=this.syncManager.fileData,g=y&&(0,o.default)({},y),(0,a.default)(y)!==(0,a.default)(v)){r.next=42;break}return r.abrupt("return",console.warn("same file data"));case 42:if("img"!==v.type){r.next=62;break}if(!g){r.next=50;break}"h5"===g.type&&this.clearHtmlFile(),v.docId&&v.docId==g.docId&&(g.currentPage=parseInt(""+(v.currentPage||1)),g.url=g.urlStr.replace("{index}",""+v.currentPage),this.image(g,e)),w=_.FileAction.immuteUpdate(g,v),b=(0,i.default)(w,1),k=b[0],this.syncManager.setFileData(k),r.next=60;break;case 50:if(x=void 0,!this.opt.handleFile){r.next=57;break}return r.next=54,this.opt.handleFile(v.type,v);case 54:x=r.sent,r.next=58;break;case 57:x=v;case 58:this.syncManager.setFileData(x),this.image(v,e);case 60:r.next=63;break;case 62:"h5"===v.type?(m.default.h5("current file",g),g?("img"==g.type&&this.clearImage(e),v.docId&&v.docId==g.docId?(m.default.h5("current file h5 cmd is ",g.h5Cmd),m.default.h5("file h5 cmd is ",v.h5Cmd),g.h5Cmd!==v.h5Cmd&&this.pagedHtmlFile(v.h5Cmd.split("&"))):(this.syncManager.setFileData(v),this.setHtmlFile(v,e),v.h5Cmd&&setTimeout(this.pagedHtmlFile.bind(this,v.h5Cmd.split("&")),3e3))):(this.syncManager.setFileData(v),this.setHtmlFile(v,e),v.h5Cmd&&setTimeout(this.pagedHtmlFile.bind(this,v.h5Cmd.split("&")),3e3))):(m.default.h5("delete file",g),this.syncManager.setFileData(void 0),g&&("img"===g.type?this.clearImage(e):"h5"===g.type&&this.clearHtmlFile()));case 63:return r.abrupt("break",67);case 64:if(h.TYPE!==M.WActions.VERSION){r.next=66;break}return r.abrupt("break",67);case 66:h.TYPE;case 67:r.next=3;break;case 69:r.next=74;break;case 71:r.prev=71,r.t1=r.catch(1),u={error:r.t1};case 74:if(r.prev=74,r.prev=75,!s||s.done||!(c=n.return)){r.next=79;break}return r.next=79,c.call(n);case 79:if(r.prev=79,!u){r.next=82;break}throw u.error;case 82:return r.finish(79);case 83:return r.finish(74);case 84:case"end":return r.stop()}}),l,this,[[1,71,74,84],[75,,79,83]])})))}},{key:"flushInCommingQueue",value:function(){var e,t;return P(this,void 0,void 0,r.default.mark((function n(){var a,i,o,s,u,c,l;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("waiting"!==this.syncState){n.next=2;break}return n.abrupt("return");case 2:a=this.incommingQueue.length;case 3:if(!a){n.next=63;break}this.actionProcessing=!0,i=this.incommingQueue.slice(),o=0,s=!1,n.prev=8,n.prev=9,e=void 0,u=T(i);case 11:return n.next=13,u.next();case 13:if((c=n.sent).done){n.next=33;break}l=c.value,n.t0=l.type,n.next="text"===n.t0||"gzip"===n.t0?19:"function"===n.t0?29:30;break;case 19:if(l.total!==l.curLen){n.next=26;break}if(o++,l.dirty){n.next=24;break}return n.next=24,this.executeActions(l.account,l.result);case 24:n.next=28;break;case 26:throw s=!0,new Error("message need waiting!");case 28:case 29:return n.abrupt("break",31);case 30:l.type;case 31:n.next=11;break;case 33:n.next=38;break;case 35:n.prev=35,n.t1=n.catch(9),e={error:n.t1};case 38:if(n.prev=38,n.prev=39,!c||c.done||!(t=u.return)){n.next=43;break}return n.next=43,t.call(u);case 43:if(n.prev=43,!e){n.next=46;break}throw e.error;case 46:return n.finish(43);case 47:return n.finish(38);case 48:n.next=53;break;case 50:n.prev=50,n.t2=n.catch(8),console.error(n.t2);case 53:return n.prev=53,this.incommingQueue=this.incommingQueue.slice(o,this.incommingQueue.length),n.finish(53);case 56:if(!s){n.next=60;break}return n.abrupt("break",63);case 60:a=this.incommingQueue.length;case 61:n.next=3;break;case 63:this.actionProcessing=!1;case 64:case"end":return n.stop()}}),n,this,[[8,50,53,56],[9,35,38,48],[39,,43,47]])})))}},{key:"destroy",value:function(){this.drawAdapter&&this.drawAdapter.destroy(),this.syncManager&&this.syncManager.destroy(),this.eventHub.removeAllListeners(),this.removeAllListeners()}},{key:"enableDraw",value:function(e){"inited"===this.state?this.drawAdapter&&this.drawAdapter.enableDraw(e):console.warn("inited")}},{key:"handleSyncAction",value:function(e){var t,n,a,i,o,s;return P(this,void 0,void 0,r.default.mark((function u(){var c,l,d,h,f,p,v,y,g,m,w,b,x,M,S,O,A,I,P,R,N,z,j,L,B,F=this;return r.default.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:console.log(e),c=void 0,l=void 0,d=e.sync,h=d.shapes,f=d.users,p=d.transhShapes,v=d.file,y=d.canvasRatio,g=d.canvasHeight,d.canvasWidth,m=d.ownerWidth,d.ownerHeight,w=h.slice(),b=function(){return D(this,arguments,r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w.length){e.next=7;break}return e.next=3,E(w.shift());case 3:return e.next=5,e.sent;case 5:e.next=0;break;case 7:case"end":return e.stop()}}),e,this)})))},(x=this.drawAdapter.worker.container).canvasRatio=y,x.resize(),x.updateCanvasPropSize(m,g),M=Date.now(),S=this.drawAdapter.worker.localUser.getCalibrateAction(),O=this.actionProcessing,this.actionProcessing=!0,v&&this.executeActions(this.ownerAccount,[new _.FileAction(v)]),u.prev=15,A=T(b());case 17:return u.next=19,A.next();case 19:if((I=u.sent).done){u.next=39;break}if(P=I.value){u.next=24;break}return u.abrupt("continue",37);case 24:return u.prev=24,u.next=27,this.drawAdapter.worker.restoreShape(P,!1);case 27:u.next=32;break;case 29:u.prev=29,u.t0=u.catch(24),console.error(u.t0);case 32:if(!(Date.now()-M>200)){u.next=37;break}return u.next=36,(0,C.sleep)(30);case 36:M=Date.now();case 37:u.next=17;break;case 39:u.next=44;break;case 41:u.prev=41,u.t1=u.catch(15),t={error:u.t1};case 44:if(u.prev=44,u.prev=45,!I||I.done||!(n=A.return)){u.next=49;break}return u.next=49,n.call(A);case 49:if(u.prev=49,!t){u.next=52;break}throw t.error;case 52:return u.finish(49);case 53:return u.finish(44);case 54:this.drawAdapter.worker.container.fullRender(),u.prev=55,R=T(f);case 57:return u.next=59,R.next();case 59:if((N=u.sent).done){u.next=102;break}if(!(z=N.value).recycle||!z.recycle.length){u.next=100;break}u.prev=63,o=void 0,j=T(z.recycle);case 65:return u.next=67,j.next();case 67:if((L=u.sent).done){u.next=85;break}return B=L.value,u.prev=70,u.next=73,this.drawAdapter.worker.restoreShape(B,!0);case 73:u.next=78;break;case 75:u.prev=75,u.t2=u.catch(70),console.error(u.t2);case 78:if(!(Date.now()-M>200)){u.next=83;break}return u.next=82,(0,C.sleep)(30);case 82:M=Date.now();case 83:u.next=65;break;case 85:u.next=90;break;case 87:u.prev=87,u.t3=u.catch(63),o={error:u.t3};case 90:if(u.prev=90,u.prev=91,!L||L.done||!(s=j.return)){u.next=95;break}return u.next=95,s.call(j);case 95:if(u.prev=95,!o){u.next=98;break}throw o.error;case 98:return u.finish(95);case 99:return u.finish(90);case 100:u.next=57;break;case 102:u.next=107;break;case 104:u.prev=104,u.t4=u.catch(55),a={error:u.t4};case 107:if(u.prev=107,u.prev=108,!N||N.done||!(i=R.return)){u.next=112;break}return u.next=112,i.call(R);case 112:if(u.prev=112,!a){u.next=115;break}throw a.error;case 115:return u.finish(112);case 116:return u.finish(107);case 117:this.drawAdapter.worker.users.all.forEach((function(e){e.guessMyUndoCount(),e.emitUserShape()})),l=f.map((function(e){var t=e.account,n=e.calibrate,r=k.unpack(n.toString()),a=t!==F.drawAdapter.worker.account;return a&&r&&F.drawAdapter.act(t,r),!a&&r&&(S=r),{account:t,calibrate:r}})),this.drawAdapter.act(this.account,S),this.declareCalibrate(S),c={users:l,shapes:h,transhShapes:p},this.actionProcessing=O,this.afterSync(c);case 124:case"end":return u.stop()}}),u,this,[[15,41,44,54],[24,29],[45,,49,53],[55,104,107,117],[63,87,90,100],[70,75],[91,,95,99],[108,,112,116]])})))}},{key:"setSize",value:function(e,t){this.syncManager.pushQueue(0,{action:new _.CalibrateAction({size:e})}),this.drawAdapter.setSize(e,t)}},{key:"setFontsize",value:function(e,t){this.drawAdapter.setFontsize(e,t)}},{key:"setColor",value:function(e,t){this.drawAdapter.setColor(e,t)}},{key:"undo",value:function(){return this.drawAdapter.undo()}},{key:"redo",value:function(){return this.drawAdapter.redo()}},{key:"clear",value:function(e,t,n){this.drawAdapter.clear(e,t,n)}},{key:"image",value:function(e,t){this.drawAdapter.image(e,t)}},{key:"clearImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account;this.clear(),this.drawAdapter.clearImage(e)}},{key:"setHtmlFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account;m.default.h5("setHtmlFile",e);var n=this.drawAdapter.worker.container,r=n.paddingLeft,a=n.paddingTop,i=n.canvasHeight,o=n.canvasWidth;if(this.iframe)console.warn("已经有iframe了");else{var s=document.createElement("iframe");s.src=e.url,s.scrolling="no",s.name="nimHtmlFile",s.frameBorder="0",s.style.position="absolute",s.style.top=a+"px",s.style.left=r+"px",s.style.zIndex="1",s.style.width=o+"px",s.style.height=i+"px",s.width=""+o,s.height=""+i,this.container.insertBefore(s,this.container.children[0]),this.drawAdapter.worker.container.displayCanvas.style.backgroundColor="transparent",this.iframe=s,window.addEventListener("message",this.onIframeMessage,!1),this.drawAdapter.worker.emitAction({account:t,action:new _.FileAction(e)}),this.syncManager.setFileData(e)}}},{key:"pagedHtmlFile",value:function(e){m.default.h5("pagedHtmlFile",e);var t=this.iframe;if(t){try{if(!t.contentWindow||t.contentDocument&&"complete"!==t.contentDocument.readyState)return void setTimeout(this.pagedHtmlFile.bind(this,e),800)}catch(e){return console.error(e),!1}var n={identity:"from_yunxin_wb",page:parseInt(e[0]),anim:parseInt(e[1]),trigger:parseInt(e[2]),isBack:"1"==e[3],time:0};t.currentPage=parseInt(n.page);var r=[n.page,n.anim,n.trigger,n.isBack,n.time].join("&");console.warn("toPage"),console.warn(r,this.syncManager.fileData&&this.syncManager.fileData.h5Cmd),m.default.h5("toHtmlPage",n),t.contentWindow.postMessage(n,"*")}}},{key:"toPageHtmlFile",value:function(e,t,n){var r=this.iframe;if(m.default.h5("toPageHtmlFile",e,t,n),r){try{if(!r.contentWindow||r.contentDocument&&"complete"!==r.contentDocument.readyState)return!1}catch(e){return!1}var a=void 0;switch(e){case"leftEnd":a={page:0,anim:-1,trigger:-1,isBack:!1};break;case"left":a={page:t-1,anim:-1,trigger:-1,isBack:!1};break;case"up":a={which:37};break;case"down":a={which:39};break;case"right":a={page:t,anim:-1,trigger:-1,isBack:!1};break;case"rightEnd":a={page:n-1,anim:-1,trigger:-1,isBack:!1};break;default:console.warn("")}return void 0!==a&&(a.identity="from_yunxin_wb",m.default.h5("current file h5 cmd is ",this.syncManager.fileData&&this.syncManager.fileData.h5Cmd),m.default.h5("toPageHtmlFile->post",a),r.contentWindow.postMessage(a,"*"),r.currentPage=parseInt(a.page),r.pageNum=n),!0}}},{key:"clearHtmlFile",value:function(){this.clear(),m.default.h5("clearHtmlFile"),!this.iframe||!this.container||this.iframe&&this.iframe.parentNode!==this.container||(this.syncManager.setFileData(void 0),window.removeEventListener("message",this.onIframeMessage,!1),this.container.removeChild(this.iframe),this.drawAdapter.worker.container.displayCanvas.style.backgroundColor="#ffffff")}},{key:"_image",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account;console.log("_image",e);var n=e.docId,r=e.currentPage;if(n&&r-0!=0){var a=this.nim,i=this.fileMap[n];if(i||a)if(console.log("file!!!",i),i)i.prefix,i.type,i.transType;else{var o=this;a?a.getFile({docId:n,success:function(r){o.fileMap[n]=r,o._image(e,t)},error:function(e){console.error("getFile error",e)}}):console.warn("缺少nim实例，无法拉取文件")}}else this.clearImage(t)}},{key:"setContainer",value:function(e,t){this.drawAdapter.setContainer(e,t)}},{key:"removeUser",value:function(e){e&&this.drawAdapter.removeUser(e)}},{key:"resize",value:function(){this.drawAdapter.resize()}},{key:"useTool",value:function(e,t){this.drawAdapter.useTool(e,t)}},{key:"syncBegin",value:function(){m.default.m.worker("owner sync begin"),this.syncManager.clear(),this.syncManager.makeSyncPrepare(),this.clear(),this.clearImage(),this.syncState="done",this.declareCalibrate(),this.afterSync()}},{key:"syncRequest",value:function(e){this.syncState="waiting",m.default.m.worker("sync request->",e),this.syncManager.makeSyncRequest(e)}},{key:"syncResponse",value:function(e){m.default.m.worker("sync response->",e),this.clear(void 0,e,{force:!0}),this.clearHtmlFile(),this.clearImage(e),this.syncManager.clear(),this.syncManager.makeSyncPrepareAck(e),this.declareCalibrate()}},{key:"declareCalibrate",value:function(e){if(!e){var t=this.drawAdapter.worker.getSelfCalibrate();t&&(e=t)}e?(m.default.m.worker("sync response calibrate->",e),this.syncManager.send({toAccount:0,actions:[{action:e}]})):console.warn("no self calibrate action")}},{key:"changeRoleToPlayer",value:function(){return 0===this.role||(this.enableDraw(!0),this.role=0),p.default.resolve({role:"player"})}},{key:"changeRoleToAudience",value:function(){var e=this;return 1===this.role?p.default.resolve({role:"audience"}):(this.enableDraw(!1),new p.default((function(t,n){setTimeout((function(){e.role=1,t({role:"audience"})}),1e3)})))}},{key:"resetState",value:function(){this.syncManager.clear();var e=this.drawAdapter.worker,t=e.users,n=(e.container,e.shapes);t.all.forEach((function(e){e.clearShapes()})),n.clear(),this.drawAdapter.worker.updateCursor(),t.removeOtherUsers()}}]),t}(y.default);t.default=z,z.util=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(0)),a=o(n(1)),i=o(n(198));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,r.default)(this,e),this.app=t}return(0,a.default)(e,[{key:"freeDraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e-4;this.app.useTool("free",this.app.account);for(var n=0;n<e;n++){var r=Math.random(),a=Math.random(),o=Math.random()*t,s=Math.random()*t;this.app.drawAdapter.worker.mousedown(new i.default(r,a),this.app.account),this.app.drawAdapter.worker.mousemove(new i.default(r+o,a+s),this.app.account),this.app.drawAdapter.worker.mouseup(new i.default(r+o,a+s),this.app.account)}}},{key:"rectDraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e-4;this.app.useTool("rect",this.app.account);for(var n=0;n<e;n++){var r=Math.random(),a=Math.random(),o=Math.random()*t,s=Math.random()*t;this.app.drawAdapter.worker.mousedown(new i.default(r,a),this.app.account),this.app.drawAdapter.worker.mousemove(new i.default(r+o,a+s),this.app.account),this.app.drawAdapter.worker.mouseup(new i.default(r+o,a+s),this.app.account)}}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(n(16)),a=m(n(35)),i=m(n(2)),o=m(n(0)),s=m(n(1)),u=m(n(3)),c=m(n(4)),l=n(111),d=n(112),h=m(n(79)),f=m(n(34)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(197)),v=n(118),y=m(n(284)),g=m(n(190));function m(e){return e&&e.__esModule?e:{default:e}}window.pako=y.default;var w=function(e){function t(e){(0,o.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.broadcastAction=function(e){var t=e.action;if(t.TYPE===l.WActions.FILE){var r=t.file;console.log(r);n.fileData&&r.docId&&(r.docId,n.fileData.docId);if(n.fileData&&(0,a.default)(r)===(0,a.default)(n.fileData))return;"clear"===r.type?n.setFileData(void 0):n.setFileData(r)}n.pushQueue(0,e)},n.account=e,n.dataQue={},n.lastDataMap={},n.shadowUsers={},n.doNotSendBefore=Date.now(),n.startLoop(),n}return(0,c.default)(t,e),(0,s.default)(t,[{key:"pushQueue",value:function(e,t){if(h.default.m.syncmanager("pushQueue",e,t),void 0===t.action){var n=new Error("ss");console.log(n.stack)}this.dataQue[e]=this.dataQue[e]||[],this.dataQue[e].push(t)}},{key:"send",value:function(e,t){var n=this,r=e.toAccount,a=e.actions;if(a&&!(a.length<1)){var i=p.packBulk(a.filter((function(e){return!!e})));if(console.log("send",i),i.length>10&&""+r!="0"){this.gzipStr(i).forEach((function(e,a){n.flush({toAccount:r,data:e},a,t)}))}else{var o={toAccount:r,data:i};this.flush(o,0,t),h.default.m.syncmanager("sendRaw:\n",o)}}}},{key:"flush",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;setTimeout((function(){t.emit("flush",e)}),r*n)}},{key:"makeClearAck",value:function(e){this.send({toAccount:e,actions:[{action:new d.ClearAckAction}]})}},{key:"makeSyncPrepare",value:function(){this.send({toAccount:0,actions:[{action:new d.SyncPrepareAction}]})}},{key:"makeSyncPrepareAck",value:function(e){this.send({toAccount:0,actions:[{action:new d.SyncPrepareAckAction}]})}},{key:"gzipStr",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("gzip stirng:",e);var n=y.default.gzip(e,{to:"string"});console.log("gzip stirng:",y.default.gzip(e));var r=(0,v.getKiloBytes)(n),a=[];if(r>49)for(var i=n.length,o=0;o<i;)a.push(n.substr(o,25088)),o+=25088;else a.push(n);if(t){var s=1,u=a,c=u.length,l=Date.now()+"."+Math.floor(1e3*Math.random())+Math.floor(1e3*Math.random())+Math.floor(1e3*Math.random());a=a.map((function(e,t){return"GZIP:"+s+"|"+l+"|"+c+"|"+t+"|=||=|"+e}))}return a}},{key:"makeSyncRequest",value:function(e){this.send({toAccount:e,actions:[{action:new d.SyncRequestAction}]})}},{key:"syncTo",value:function(e,t){this.fileData&&(t.file=this.fileData);var n=new d.SyncAction(t);this.send({toAccount:e,actions:[{action:n}]})}},{key:"clear",value:function(){console.warn("clear sync manager"),this.dataQue={}}},{key:"delayMS",value:function(e){this.doNotSendBefore=Date.now()+e}},{key:"startLoop",value:function(){var e=this;this.timer=setInterval((function(){if(!(Date.now()<e.doNotSendBefore)){var t=e.dataQue;(0,r.default)(t).forEach((function(n){!t[n]||t[n].length<1||e.send&&(e.send({toAccount:n,actions:t[n]}),t[n].length=0)}))}}),100)}},{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.timer=void 0,this.dataQue={}}},{key:"setFileData",value:function(e){this.fileData=e,g.default.emit("globalFile",this.fileData)}}]),t}(f.default);t.default=w,w.GZIP_TESTER_1=/1\|([\d.]+)\|(\d+)\|(\d+)\|=\|\|=\|/},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(2)),a=p(n(0)),i=p(n(1)),o=p(n(3)),s=p(n(4)),u=p(n(342)),c=p(n(34)),l=n(118),d=p(n(196)),h=p(n(79)),f=n(296);function p(e){return e&&e.__esModule?e:{default:e}}(0,d.default)("AdapterDraw");var v=function(e){function t(e,n){(0,a.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return i.onInited=function(){i.emit("inited")},i.worker=new u.default(e,n),i.worker.on("action",i.onAction.bind(i)),i.worker.on("instantAction",i.onInstantAction.bind(i)),i.worker.on("inited",i.onInited),i}return(0,s.default)(t,e),(0,i.default)(t,[{key:"act",value:function(e,t){if(t){var n={account:e,action:t};h.default.m.adapter("act->",t,e),this.worker.act(n)}}},{key:"onAction",value:function(e){e.account===this.worker.account&&this.worker.isEnable&&(h.default.m.adapter("onAction",e),e&&this.emit("action",e))}},{key:"onInstantAction",value:function(e){h.default.m.adapter("onInstantAction",e),e&&this.emit("instantAction",e)}},{key:"enableDraw",value:function(e){return this.worker.enableDraw(e)}},{key:"destroy",value:function(){this.worker.destroy(),this.removeAllListeners()}},{key:"useTool",value:function(e,t){h.default.m.adapter(e,t),(0,f.isValidTool)(e)?this.worker.useTool(e,t):console.warn("画笔工具不正确!->",e)}},{key:"resize",value:function(){return this.worker.resize()}},{key:"removeUser",value:function(e){return this.worker.removeUser(e)}},{key:"setContainer",value:function(e,t){return this.worker.setContainer(e,t)}},{key:"image",value:function(e,t){return this.worker.image(e,t)}},{key:"clearImage",value:function(e){return this.worker.clearImage(e)}},{key:"undo",value:function(e){return this.worker.undo(e)}},{key:"redo",value:function(e){return this.worker.redo(e)}},{key:"clear",value:function(e,t,n){return this.worker.clear(e,t,n)}},{key:"setColor",value:function(e,t){e&&((0,l.formatColor)(e,10)===l.formatColor.INVALID?console.error("whiteboard::setColor:设置颜色失败:不合法的色值"):(console.log("adapterDraw::setColor",e),this.worker.setColor(e,t)))}},{key:"setSize",value:function(e,t){e&&(/^[\d]+$/.test(""+e)?(console.log("adapterDraw::setSize",e),this.worker.setSize(e,t)):console.error("whiteboard::setSize:设置画笔粗细失败:不合法的数值:",e))}},{key:"setFontsize",value:function(e,t){e&&(/^[\d]+$/.test(""+e)?(console.log("adapterDraw::setFontsize",e),this.worker.setFontsize(e,t)):console.error("whiteboard::setFontsize:设置文字大小失败:不合法的数值:",e))}}]),t}(c.default);t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=I(n(55)),a=I(n(32)),i=I(n(12)),o=I(n(16)),s=I(n(2)),u=I(n(0)),c=I(n(1)),l=I(n(3)),d=I(n(4)),h=I(n(29)),f=I(n(34)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(191)),v=n(198),y=I(v),g=I(n(343)),m=I(n(79)),w=n(295),b=I(n(345)),_=n(346),k=I(_),x=n(111),M=n(296),S=n(112),C=n(197),O=n(118),A=I(n(190));function I(e){return e&&e.__esModule?e:{default:e}}var P=function(e,t,n,r){return new(n||(n=h.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},T="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAAANACwAAAAAEAAQAAAEPbDJSau9OOvNew0AEHDA8wCkiW6g6AXHMU4LgizUYRgEZdsUggFAQCgUP+AERggcFYHaDaMgEBQchBNhiQAAIfkECQAADQAsAAAAABAAEAAABDuwyUmrvTYAEDAFzwN4EyiSksaRyHF06GEYBNoQ82EHBwHbCIUCYRMKiwSCYoFALDCIwLDZBFJtTKclAgAh+QQJAAANACwAAAAAEAAQAAAEPrDJGQAIM2vwHtAUcVTdBzaHYRCKip2EepxacBAvjSgKQmc83m+iILCGEkSgh5wsEIhFEwqdUpvPaHPLnUQAACH5BAkAAA0ALAAAAAAQABAAAAQ+sMkZyAkz62MM0ROiKAjRXQCATeOIHEQAPA+QKQShZHOdIQFSRqaSLBCIBQiERC41TcQzc0xOr9isdsvtPiMAIfkECQAADQAsAAAAABAAEAAABD2wyYmUQjNra/VcCLIoBKEExBFkYRtcBGAQbJsdhnFkoMimGI8wAACshBnA4wFAJpdNp4RolFqv2Kx2q4kAACH5BAkAAA0ALAAAAAAQABAAAAQ9sMm5EFoza2u1b5ylKMjXVFdAjGamrEo7IWMpz8QR3A0BGATewWA48BA5mykAAOxugMcDwItOeUwnb9uKAAAh+QQJAAANACwAAAAAEAAQAAAEO7DJSau92C6EVp4c90khMjZbd5KKYo4B0Z4KIZ9I4H7IQQSng8FwwAQAgJgBQMAAHo+kD3h5Rk/HpCUCACH5BAkAAA0ALAAAAAAQABAAAAQ8sMlJq7046827nwuCLJwoliYXjlIAAAGFKApCAc8DULQSTzgd4kCYEQgKigt2MBgOC5rtQnAeOAHilBIBADs=",E=function(e){function t(e,n){(0,u.default)(this,t);var r,a=(0,l.default)(this,(t.__proto__||(0,s.default)(t)).call(this));if(a.handleInputDomBlur=function(){console.log("blur");var e=a.container.inputDom,t=a.account;if(a.localUser){var n=e.getAttribute("data-point");if(n){var r=a.container,i=r.ownerCanvasHeight,o=r.ownerCanvasWidth,s=y.default.fromString(n);e.style.display="none";var u=(e.value||"").trim();if(e.value="",i&&o&&u){var c=new S.TextAction(s.x,s.y,u);a.renderText(c,t),a.emitAction({account:t,action:c})}}}},a.dispatcher=function(e){if("keydown"!==e.type&&"keyup"!==e.type&&e.preventDefault(),e=e.originalEvent?e.originalEvent:e,a.container.displayCtx){var t=a.container.displayCtx.canvas.getBoundingClientRect(),n=void 0,r=void 0;e.touches&&1===e.touches.length?(n=e.touches[0].clientX,r=e.touches[0].clientY):e.changedTouches&&1===e.changedTouches.length?(n=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY):(n=e.clientX,r=e.clientY);var i=e,o=i.ctrlKey,s=i.shiftKey,u=i.altKey,c=i.which;n||0===n||(n=0),r||0===r||(r=0);var l=Math.round(n-t.left),d=Math.round(r-t.top),h=a.container,f=h.ownerCanvasHeight,p=h.ownerCanvasWidth,v=h.canvasWidth,g=h.canvasHeight;if(f&&p&&v&&g){var m=new y.default(+(l/v).toFixed(4),+(d/g).toFixed(4)),w=e.type;"touchstart"===w&&(w="mousedown"),"touchmove"===w&&(w="mousemove"),"touchend"===w&&(w="mouseup"),2!==c&&3!==c&&a[w](m,a.account,{ctrlKey:o,shiftKey:s,altKey:u,which:c})}}},void 0===n)throw new Error("Option is Undefined!");return a.state="created",a.opt=n,a.account=n.account||0,a.users=new w.UserManager(n),a.shapes=new b.default,a.shapes.wrap(a.users),a.container=new k.default(e,n),a.container.on("init-canvas",(function(){m.default.m.worker("init-canvas event");var e=a.addUser(a.account);a.localUser=e,a.state="inited",a.afterInit()})),a.container.on("ownerCanavasUpdate",(r=void 0,function(e,t){console.log("ownerCanavasUpdate timmer"),clearTimeout(r),r=setTimeout((function(){console.log("ownerCanavasUpdate timmer"),a.emit("instantAction",{account:a.account,action:new S.CalibrateAction({ownerCanvasHeight:t,ownerCanvasWidth:e})})}),200)})),a.container.wrap(a.shapes,a.users),a.container.inputDom.addEventListener("blur",a.handleInputDomBlur),a.isEnable=!1,a}return(0,d.default)(t,e),(0,c.default)(t,[{key:"setContainer",value:function(e,t){m.default.m.worker("setContainer"),this.container.setContainer(e,t)}},{key:"isDrawEnable",value:function(){return this.isEnable}},{key:"enableDraw",value:function(e){if(m.default.m.worker("enableDraw",e),this.isEnable=!!e,A.default.emit("canDraw",this.isEnable),this.switchEventListener(!!e),this.localUser){var t=this.localUser.tool;if(e){var n=void 0;n="flag"===t?"flag":"crosshair",this.setCursor(n)}else/flag/.test(this.localUser.tool)&&(this.clearFlag(),this.emitAction({account:this.account,action:new S.LaserPenEndAction})),this.setCursor("not-allowed")}}},{key:"updateCursor",value:function(){if(this.localUser){var e=this.localUser.tool;if(this.isEnable){var t=void 0;t="flag"===e?"flag":"crosshair",this.setCursor(t)}else/flag/.test(this.localUser.tool)&&(this.clearFlag(),this.emitAction({account:this.account,action:new S.LaserPenEndAction})),this.setCursor("not-allowed")}}},{key:"switchEventListener",value:function(e){var t=this,n=e?"add":"remove",r=[this.container.maskCanvas],a=this.dispatcher;r.forEach((function(e){["mouseleave","mousedown","mousemove","touchmove","touchstart"].forEach((function(t){e[n+"EventListener"](t,a)}))})),["mouseup","touchend"].forEach((function(e){var r=n+"EventListener";t.container.container[r](e,a)})),["keydown","keyup"].forEach((function(e){var t=n+"EventListener";document.documentElement[t](e,a)}))}},{key:"setCursor",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not-allowed";m.default.m.worker("setCursor",t);var n=[this.container.maskCanvas];t=/(flag|crosshair|not-allowed)/.test(t)?t:"crosshair",this.cursor=t||this.cursor,"flag"===this.cursor&&(this.cursor="none"),n.forEach((function(t){t.style.cursor=e.cursor}))}},{key:"afterInit",value:function(){this.emit("inited")}},{key:"emitAction",value:function(e){this.emit("action",e)}},{key:"useTool",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account;if(m.default.m.worker("use tool:",e,t),"created"!=this.state){var n=(0,M.isValidTool)(e);if(n){var r=this.getUser(t);if(!e)return r.tool;if(r||(r=this.addUser(t)),m.default.m.worker("use tool:",r),r.tool!==e){var a={tool:e};r.update(a),"flag"===e?r.ctx.canvas.style.visibility="visible":this.clearFlag(t),m.default.m.worker("useTool check account",t),t===this.account&&("text"!==r.tool&&(this.container.inputDom.style.display="none"),this.setCursor(r.tool),m.default.m.worker("useTool check account",t),this.dispatchCalibrateAction(a))}}else console.error("useTool 参数不正确！",e)}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"clearFlag",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account,t=this.getUser(e);t&&(t.flagPos=new y.default(3,3).toString(),this.renderFlag(),this.emitAction({account:e,action:new S.LaserPenEndAction}))}},{key:"setSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);if(m.default.m.worker("setSize",e,t,n),"created"!=this.state){if(n||(n=this.addUser(t)),!e)return n.size;if("number"!=typeof+e)throw new Error("Type Error: size");var r={size:+e};n.update(r),this.dispatchCalibrateAction(r)}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"getSelfCalibrate",value:function(){return this.localUser?this.localUser.getCalibrateAction():null}},{key:"setColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);if("created"!=this.state){if(n||(n=this.addUser(t)),!e)return n.color;var r={color:e.toLowerCase()};this.dispatchCalibrateAction(r),n.update(r)}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"setFontsize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);if(m.default.m.worker("set font size",e,t,n),"created"!=this.state){if(n||(n=this.addUser(t)),!e)return n.fontsize;if("number"!=typeof+e)throw new Error("Type Error: fontsize");var r={fontsize:+e};n.update(r),this.dispatchCalibrateAction(r),this.container.inputDom.style.fontSize=e+"px"}else console.warn("未初始化容器，请在inited事件后调整当前模式")}},{key:"keydown",value:function(e,t,n){var r=this.users.getUser(t);r||(r=this.addUser(t));var a=n.ctrlKey,i=n.shiftKey,o=n.altKey,s=n.which;if([16,17,18].indexOf(s)>-1){var u=r.keyDown,c={keyDown:{ctrlKey:a,altKey:o,shiftKey:i,which:null===u?-1:u.which}};r.update(c),this.dispatchCalibrateAction(c),this._afterKeyChange(r,t,n)}}},{key:"keyup",value:function(e,t,n){var r=n.ctrlKey,a=n.shiftKey,i=n.altKey,o=n.which,s=this.users.getUser(t);if(s||(s=this.addUser(t)),[16,17,18].indexOf(o)>-1){var u=s.keyDown,c=null===u?-1:u.which;o===c&&(c=-1);var l={keyDown:{altKey:i,shiftKey:a,ctrlKey:r,which:o}};s.update(l),this.dispatchCalibrateAction(l),this._afterKeyChange(s,t,n)}}},{key:"_afterKeyChange",value:function(e,t,n){e.isMouseDown&&"flag"!==e.tool&&"free"!==e.tool&&"erase"!==e.tool&&this.mousemove(e.end,t,n)}},{key:"mousedown",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=void 0,r=this.getUser(t),a=r.mode,i=r.tool,o=r.color,s=r.size,u=r.fontsize,c=(r.keyDown,r.ctx),l=this.container.displayCtx;if((!r.isFlag||i&&"flag"!==i)&&"text"!==i&&("erase"!==i||0!==this.shapes.visibles.length)){r.whenMouseDown(y.default.clone(e));var d=r.end;r.isMouseDown&&(m.default.mouse("user.isMouseDown->true"),this.mouseup(d,t)),"free"===i||"erase"===i?(c.canvas.style.visibility="hidden",c.beginPath()):c.canvas.style.visibility="visible",m.default.m.worker("switch mode = ",a,i),this.lastStateAccount=r.account,(0,_.applyState)(c,r),(0,_.applyState)(l,r);var h=this.container,f=h.ownerCanvasHeight,p=h.ownerCanvasWidth,v=void 0;switch(f&&p&&(v=new S.StartAction(e.x,e.y)),a){case"draw":switch(r.isMouseDown=!0,m.default.log("user is mouseDown",r.isMouseDown,r),n=new g.default({user:r,mode:a,tool:i,size:s,color:o,fontsize:u,start:y.default.clone(e),actions:v,keyDown:r.keyDown}),r.pushShape(n),this.shapes.push(n),i){case"circle":case"ellipse":case"line":case"rect":case"roundRect":case"solidCircle":case"solidEllipse":case"solidRoundRect":case"solidRect":case"erase":case"free":case"flag":break;case"fill":this.lastStateAccount=r.account,(0,_.applyState)(n.ctx,r),(0,_.applyState)(l,r),n.draw(l),r.isMouseDown=!1;break;default:}}m.default.m.worker("emit on mousedown"),p&&f&&this.emitAction({account:t,action:v})}}},{key:"mousemove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=arguments[2],r=this.getUser(t);if(m.default.mouse("mousemove",r,!r.isMouseDown&&!r.isFlag),r.isFlag||r.isMouseDown){r.whenMouseMove(y.default.clone(e));var a=r.mode,i=r.tool,s=r.keyDown,u=r.end;if("erase"!==i||0!==this.shapes.visibles.length){var c=r.ctx,l=this.container.displayCtx;m.default.mouse("mousemove",e,r);var d=r.activeShape,h=new S.MoveAction(e.x,e.y);switch(n&&(0,o.default)(s).some((function(e){return n[e]!==s[e]}))&&r.update({keyDown:n}),"flag"!==i&&this.shiftKeyTool(r,d,(function(e){i=e})),r.account!==this.lastStateAccount&&"flag"!==i&&(this.lastStateAccount=r.account,(0,_.applyState)(c,r),(0,_.applyState)(l,r)),a){case"draw":switch(i){case"flag":r.flagPos=y.default.clone(e).toString(),this.renderFlag();break;case"erase":case"free":d&&(d.updateCorner(u),d.actions.push(h),d.freeMove(c),d.freeMove(l));break;case"line":p.clearCtx(c),d.updateCorner(u),d.draw(c);break;case"rect":case"solidRect":d&&(p.clearCtx(c),d.updateCorner(u),d.draw(c));break;case"roundRect":case"solidRoundRect":p.clearCtx(c),d&&(d.updateCorner(u),d.draw(c));break;case"circle":case"solidCircle":p.clearCtx(c),d&&(d.updateCorner(u),d.draw(c));break;case"ellipse":case"solidEllipse":p.clearCtx(c),d&&(d.updateCorner(u),d.draw(c));break;case"fill":case"text":h=null;break;default:}}h&&this.emitAction({account:t,action:h})}}else console.log("pre return when mouse down is false")}},{key:"shiftKeyTool",value:function(e,t,n){if(e.keyDown.shiftKey){var r=e.tool;"ellipse"===r?(r="circle",t&&(t.tool=r),n(r)):"circle"===r&&(r="ellipse",t&&(t.tool=r),n(r))}else t&&t.tool!==e.tool&&(t.tool=e.tool)}},{key:"mouseup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=this.getUser(t);e.text;console.warn("mouse up"),m.default.m.worker("mouse up",t);var r=n.mode,a=n.tool,i=n.color,o=(n.size,n.fontsize),s=(n.start,n.oldMid),u=n.end;if("erase"!==a||0!==this.shapes.visibles.length){var c=y.default.middle(u,e);s.clone(),u.clone();if(s.copy(c),u.copy(e),n.oldMid=s.clone(),n.end=u.clone(),n.isFlag)return this.clearFlag(),void this.emitAction({account:t,action:new S.LaserPenEndAction});if(n.isMouseDown||"text"===a){n.isMouseDown=!1,console.warn("turn use mouse down to false",n.isMouseDown,n.account);var l=n.ctx,d=this.container.displayCtx,h=n.activeShape,f=h&&h.ctx;if("text"!==a){if(h&&f){var v=!0;l.canvas.style.visibility="visible",h.updateCorner(u);var g=new S.EndAction(u.x,u.y);switch("flag"!==a&&(this.shiftKeyTool(n,h,(function(e){a=e})),this.lastStateAccount=n.account,(0,_.applyState)(l,n),(0,_.applyState)(d,n)),r){case"draw":switch(a){case"erase":case"free":h.expandCorner(),h.freeEnd(l),h.freeEnd(d);break;case"line":p.clearCtx(l),h.draw(l);break;case"rect":case"solidRect":p.clearCtx(l),h.draw(l);break;case"roundRect":case"solidRoundRect":p.clearCtx(l),h.draw(l);break;case"circle":case"solidCircle":p.clearCtx(l),h.draw(l);break;case"ellipse":case"solidEllipse":p.clearCtx(l),h.draw(l);break;case"flag":case"fill":g=null,v=!1;break;default:}v&&this.moveUserShapeToDisplay(n)}h.keyDown=n.keyDown,g&&(h.actions.push(g),this.emitAction({account:t,action:g}))}}else{var w=this.getCanvasCoord(u),b=this.container,k=b.canvasWidth,x=b.canvasHeight,M=b.inputDom,C=M.style,O=C.display;if(w.x<0||w.x>k||w.y<0||w.y>x)return;if("none"===O){var A=k-w.x-10;w.y;C.width=10*o>A?(A>0?A:0)+"px":A+"px",C.padding="1px 0",C.verticalAlign="top",C.lineHeight=o+"px",C.top=w.y+this.container.paddingTop+"px",C.left=w.x+this.container.paddingLeft+"px",C.fontSize=o+"px",C.display="block",C.color=i,M.setAttribute("data-point",u.toString()),M.focus(),n.end.copy(u)}else M.blur()}}}}},{key:"mouseleave",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,n=arguments[2];if(console.log("mouse leave"),t===this.account){var r=this.getUser(t);switch(r.tool){case"flag":this.clearFlag(t),this.emitAction({account:t,action:new S.LaserPenEndAction});break;case"text":break;default:this.mouseup(e,t,n)}}}},{key:"renderText",value:function(e,t){var n,r;r=e;var a=new y.default(e.x,e.y),i=this.getOwnerCoord(a);if((n=(e.text||"").trim())&&t){var o=this.getUser(t);o||(o=this.addUser(t));var s=o,u=s.tool,c=s.mode,l=s.size,d=s.color,h=s.fontsize,f=this.container.displayCtx,v=new g.default({user:o,mode:c,tool:u,size:l,color:d,fontsize:h,start:y.default.clone(a),actions:r,keyDown:o.keyDown});this.shapes.push(v),o.pushShape(v);var m=o.ctx;this.lastStateAccount=o.account,(0,_.applyState)(m,o),(0,_.applyState)(f,o),p.text(m,i,n,h,!0,d);var w=o.activeShape.corner;w[0].x=i.x-l,w[0].y=i.y-20,w[1].x=i.x+h*n.length,w[1].y=i.y+h+20,this.moveUserShapeToDisplay(o)}}},{key:"clearTransparentPix",value:function(e){for(var t=e.length,n=e,r=0;r<t;r+=4){n[3+r]<243&&(n[0+r]=0,n[1+r]=0,n[2+r]=0,n[3+r]=0)}}},{key:"moveUserShapeToDisplay",value:function(e,t){var n=e.activeShape,r=e.ctx,a=this.container.displayCtx;if(n&&a){var i=n.tool,o=n.ctx,s=(n.color,n.corner);m.default.log("corner",s);var u=Math.ceil(s[1].x-s[0].x),c=Math.ceil(s[1].y-s[0].y);if(0===u||0===c)return m.default.m.worker("mouseup shape is zero size"),void console.error("mouseup shape is zero size");m.default.m.worker("mouseup going to anti shape",e.account);var l=r.getImageData(s[0].x,s[0].y,u,c);"erase"===i&&m.default.image(r.canvas.toDataURL(),"erase"),!this.opt.clearTransparentPix||["text"].includes(i)&&!t||this.clearTransparentPix(l.data),o.canvas.width=u,o.canvas.height=c,p.setpixelated(o),p.setLineStyle(o),o.putImageData(l,0,0),a.imageSmoothingEnabled=!1,"free"!==i&&a.drawImage(o.canvas,Math.round(s[0].x),Math.round(s[0].y)),p.clearCtx(r)}else console.error("activeShape is ",n,"displayCtx is ",a)}},{key:"renderFlag",value:function(){var e=this,t=this.container.maskCtx;if(t){p.clearCtx(t);var n=this.container,r=n.ownerCanvasWidth,a=n.ownerCanvasHeight;this.users.all.forEach((function(n){var i=n.mode,o=n.tool,s=(n.color,n.flagPos);if("draw"==i&&"flag"===o&&r&&a){var u=y.default.fromString(s),c=e.getOwnerCoord(u);console.log("render flag",u,s,n.account),p.circle(t,c,5,!1,"#ff0000"),p.circle(t,c,4,!0,"#ff0000")}}))}}},{key:"getCanvasCoord",value:function(e){var t=this.container,n=t.canvasHeight,r=t.canvasWidth;return n&&r?new v.Coord(e.x*r,e.y*n):new v.Coord(0,0)}},{key:"getOwnerCoord",value:function(e){var t=this.container,n=t.ownerCanvasHeight,r=t.ownerCanvasWidth;return n&&r?new v.Coord(e.x*r,e.y*n):new v.Coord(0,0)}},{key:"undo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account,t=this.getUser(e);if(t&&0!==t.shapes.length){var n=t.undo();return this.emitAction({account:e,action:new S.RevokeAction}),n}}},{key:"redo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account,t=this.getUser(e);if(t&&0!==t.recycle.length){var n=t.redo();return this.emitAction({account:e,action:new S.RedoAction}),n}}},{key:"image",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,r=e.url,a=void 0===r?"":r,i=e.docId,o=void 0===i?"":i,s=e.currentPage,u=void 0===s?0:s,c=e.pageCount,l=void 0===c?0:c,d=e.type,h=void 0===d?"clear":d,f=e.urlStr,p=void 0===f?"":f,v=e.h5Cmd,y=void 0===v?"":v;if(a){if(this.container&&this.container.displayCtx){var g=this.container.displayCtx.canvas,m=new Image,w=void 0===this.opt.backgroundUrl?T:this.opt.backgroundUrl;m.onload=function(){t.container.container.classList.remove("canvas-loading"),g.style.backgroundSize="contain",g.style.backgroundImage="url("+a+")"},this.container.container.classList.add("canvas-loading"),g.style.backgroundSize="auto",g.style.backgroundImage="url("+w+")",m.src=a}this.emitAction({account:n,action:new S.FileAction({url:a,docId:o,currentPage:u,pageCount:l,type:h,urlStr:p,h5Cmd:y})})}}},{key:"clearImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.account;this.container.displayCtx&&(this.container.displayCtx.canvas.style.backgroundImage=""),this.emitAction({account:e,action:new S.FileAction({docId:"",type:"clear"})})}},{key:"clear",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.account,r=arguments[2],a=r&&r.force,o=r&&r.quiet;if(this.container.displayCtx){p.clearCtx(this.container.displayCtx);var s=!0,u=!1,c=void 0;try{for(var l,d=(0,i.default)(this.users.all);!(s=(l=d.next()).done);s=!0){var h=l.value;h.isMouseDown&&!a?(m.default.m.worker("user.isMouseDown = true"),this.container.displayCtx.drawImage(h.ctx.canvas,0,0)):h.ctx&&p.clearCtx(h.ctx)}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}}var f=void 0;if(e&&(Array.isArray(e)||(e=[e]),0!=e.length&&(f=e)),f)f.forEach((function(e){var n=t.getUser(e);n&&(n.shapes.forEach((function(e){t.shapes.remove(e)})),n.clearShapes())})),this.container.displayCtx&&this.container.fullRender();else{this.shapes.clear();var v=!0,y=!1,g=void 0;try{for(var w,b=(0,i.default)(this.users.all);!(v=(w=b.next()).done);v=!0){var _=w.value;_.clearShapes()}}catch(e){y=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw g}}}o||this.emitAction({account:n,action:new S.ClearAction(f)})}},{key:"act",value:function(e){m.default.m.worker("act->",e);var t=e.account;e.action;t&&!this.users.hasUser(t)&&this.addUser(t);var n=e.action;switch(n.TYPE){case x.WActions.START:this.mousedown(n,t);break;case x.WActions.MOVE:case x.WActions.LASER_PEN:this.mousemove(n,t);break;case x.WActions.TEXT:this.renderText(n,t);break;case x.WActions.END:this.mouseup(n,t);break;case x.WActions.LASER_PEN_END:this.clearFlag(t);break;case x.WActions.REDO:this.redo(t);break;case x.WActions.REVOKE:this.undo(t);break;case x.WActions.CLEAR:break;case x.WActions.CALIBRATE:this.calibrate(t,n);break;case x.WActions.SYNC_PREPARE_ACK:case x.WActions.SERIAL:break;case x.WActions.CLEAR_ACK:this.clear(t,t,{quiet:!0,force:!0});break;case x.WActions.SYNC_REQUEST:case x.WActions.FILE:case x.WActions.SYNC:case x.WActions.SYNC_PREPARE:case x.WActions.VERSION:break;default:}}},{key:"resize",value:function(){this.container.resize()}},{key:"dispatchCalibrateAction",value:function(e){this.emit("action",{account:this.account,action:new S.CalibrateAction(e)})}},{key:"calibrate",value:function(e,t){if(e){var n=t.ownerCanvasHeight,r=t.ownerCanvasWidth;n&&r&&(console.warn("update owner canvas"),this.container.canvasRatio=r/n,this.container.resize(),this.container.updateCanvasPropSize(r,n));var a=S.CalibrateAction.USER_PROPS.reduce((function(e,n){return n in t&&(e[n]=t[n]),e}),{}),i=this.getUser(e);i&&i.update(a)}}},{key:"addUser",value:function(e){if(m.default.m.worker("addUser",e),this.users.hasUser(e))return this.getUser(e);var t=this.users.addUser(e);return this.container.addUser(this.account,t),this.users.all.sort((function(e,t){return e.account>t.account?1:-1})).forEach((function(e,t){e.ctx.canvas.style.zIndex=""+(10+t)})),m.default.m.worker("create User ->",t),t}},{key:"getUser",value:function(e){return e==this.account&&this.localUser?this.localUser:this.users.getUser(e)}},{key:"removeUser",value:function(e){e&&this.clearFlag(e)&&this._removeUser(e)}},{key:"_removeUser",value:function(e){var t=this.getUser(e);if(t){try{this.container.container.removeChild(t.ctx.canvas)}catch(e){}this.users.remove(e)}}},{key:"destroy",value:function(){var e=this;this.container.inputDom.removeEventListener("blur",this.handleInputDomBlur),this.users.destroy(),this.switchEventListener(!1),this.users.uids.map((function(t){e._removeUser(t)})),this.shapes.destroy(),this.container.destroy(),this.removeAllListeners()}},{key:"getSnapshot",value:function(){var e=this.shapes,t=e.transh,n=e.visibles,r=this.container,a=r.canvasWidth,i=r.canvasHeight,o=r.ownerCanvasHeight,s=r.ownerCanvasWidth,u={width:a,height:i};return{users:this.users.toSnapshot(u),ownerWidth:s,ownerHeight:o,canvasWidth:a,canvasHeight:i,canvasRatio:a/(0===i?1e-6:i),transhShapes:t.map((function(e){return e.toSnapshot(u)})),shapes:n.map((function(e){return e.toSnapshot(u)}))}}},{key:"restoreShape",value:function(e,t){return P(this,void 0,void 0,r.default.mark((function n(){var i,o,s,u,c,l,d,f,m,w,b,k,x,M,S,A,I,P,T,E,D,R,N,z,j,L,B,F,U,W,H,Y,Q,Z,X,K,V,G,q,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,de,he,fe,pe,ve,ye,ge,me,we,be,_e,ke,xe,Me,Se,Ce,Oe,Ae,Ie,Pe,Te,Ee,De,Re,Ne,ze,je,Le,Be,Fe,Ue,We,He=this;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=e.id,o=e.start,s=e.user,u=e.color,c=e.fontsize,l=e.size,d=e.mode,f=e.actions,m=e.optimized,w=e.imageData,b=e.corner,k=e.keyDown,x=e.tool,M=(0,C.unpackBulk)(f),S=M.length,(A=this.users.getUser(s))||(A=this.addUser(s)),I=this.container,P=I.ownerCanvasWidth,T=I.ownerCanvasHeight,(E=new g.default({user:A,mode:d,tool:x,size:l,color:u,fontsize:c,start:y.default.fromString(o),actions:M,keyDown:k})).id=i,E.optimized=m,D=b.map((function(e){return y.default.fromString(e).toCoord(P,T)})),R=(0,a.default)(D,2),N=R[0],z=R[1],j=N,L=v.Coord.areaSize(N,z),B=L.width,F=L.height,U=E.ctx,p.setCanvasPropSize(U,{width:B,height:F}),E.corner=[N,z],(0,_.applyState)(U,{ctx:U,color:u,size:l,tool:x}),console.assert(U.lineWidth===l,"shape line width is not the same",l,U.lineWidth),t?A.recycle.push(E):(A.shapes.push(E),this.shapes.push(E)),W=function(e){var t=M[0],n=M[S-1],r=He.getOwnerCoord(t),a=He.getOwnerCoord(n);return e?[r.minus(e),a.minus(e)]:[r,a]},H=!0,n.t0=x,n.next="free"===n.t0||"erase"===n.t0?24:"line"===n.t0?26:"circle"===n.t0||"solidCircle"===n.t0?29:"ellipse"===n.t0||"solidEllipse"===n.t0?33:"rect"===n.t0||"solidRect"===n.t0?37:"roundRect"===n.t0||"solidRoundRect"===n.t0?44:"text"===n.t0?52:"fill"===n.t0?58:"flag"===n.t0?64:66;break;case 24:if(S>=2)if(Y=W(j),Q=(0,a.default)(Y,2),Z=Q[0],X=Q[1],K=Z.clone(),V=Z.clone(),G=Z.clone(),2===S)p.line(U,K,G,u);else{for(q=1,J=S-1;q<J;q++)$=this.getOwnerCoord(M[q]).minus(j),ee=v.Coord.middle(G,$),te=V.clone(),ne=G.clone(),V.copy(ee),G.copy($),p.free(U,te,ne,ee,u,l);re=v.Coord.middle(G,X),ae=V.clone(),G.clone(),p.free(U,ae,re,X,u,l)}return n.abrupt("break",69);case 26:return ie=W(j),oe=(0,a.default)(ie,2),se=oe[0],ue=oe[1],p.line(U,se,ue,u),n.abrupt("break",69);case 29:return ce=W(j),le=(0,a.default)(ce,2),de=le[0],he=le[1],fe=g.default.calculateRadius(x,de,he),pe=fe.radius,p.circle(U,de,pe,"solidCircle"===x,u),n.abrupt("break",69);case 33:return ve=W(j),ye=(0,a.default)(ve,2),ge=ye[0],me=ye[1],we=g.default.calculateRadius(x,ge,me),we.radius,be=we.xRadius,_e=we.yRadius,p.ellipse(U,ge,be,_e,"solidEllipse"===x,u),n.abrupt("break",69);case 37:return ke=W(j),xe=(0,a.default)(ke,2),Me=xe[0],Se=xe[1],Ce=Se.x-Me.x,Oe=Se.y-Me.y,Ae=Math.min(Math.abs(Ce),Math.abs(Oe)),k.shiftKey&&(Ce=(0,O.sign)(Ce)*Ae,Oe=(0,O.sign)(Oe)*Ae),p.rect(U,Me,Ce,Oe,"solidRect"===x,u),n.abrupt("break",69);case 44:return Ie=W(j),Pe=(0,a.default)(Ie,2),Te=Pe[0],Ee=Pe[1],De=Ee.x-Te.x,Re=Ee.y-Te.y,Ne=Math.min(Math.abs(De),Math.abs(Re)),k.shiftKey&&(De=(0,O.sign)(De)*Ne,Re=(0,O.sign)(Re)*Ne),ze=Ne<l?2:.1*Ne,p.roundRect(U,Te,De,Re,ze,"solidRoundRect"===x,u),n.abrupt("break",69);case 52:return je=M[0],Le=je.text,Be=this.getOwnerCoord(je).minus(j),p.text(U,Be,Le,c,!0,u),H=!1,n.abrupt("break",69);case 58:return Fe=Math.abs(N.x-z.x),Ue=Math.abs(N.y-z.y),n.next=62,new h.default((function(e){var t=new Image;t.src=w,t.onerror=function(){return e()},t.onload=function(){console.log("fill"),U.drawImage(t,0,0,Fe,Ue),e()}}));case 62:case 64:return H=!1,n.abrupt("break",69);case 66:H=!1,x,console.warn("尝试恢复未知的图形");case 69:if(this.opt.clearTransparentPix&&H)try{We=U.getImageData(0,0,B,F),this.clearTransparentPix(We.data),U.putImageData(We,B,F)}catch(e){console.error(e)}case 70:case"end":return n.stop()}}),n,this)})))}},{key:"mesure",value:function(e){var t=this;document.getElementById("worker-mesure-anim")||document.head.insertAdjacentHTML("beforeend","<style>@keyframes xxx-xxx{from{background:red;}to{background:green}}</style>"),Array.isArray(e)||(e=[e]),e.forEach((function(e){t.container.container.insertAdjacentHTML("afterbegin",'<div style="z-index:2222;display:inline-block;position:absolute;background:red;top:'+e.x+"px;left:"+e.y+'px;width:2px;height:2px;animation:xxx-xxx 1s infinite"></div>')}))}}]),t}(f.default);t.default=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(32)),a=c(n(0)),i=c(n(1)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(191)),s=c(n(79)),u=n(118);function c(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){var n=t.user,r=t.mode,i=t.tool,s=t.size,u=t.color,c=t.start,l=t.actions,d=t.fontsize,h=t.keyDown;(0,a.default)(this,e);var f=performance&&performance.timing&&performance.timing.navigationStart+performance.now();this.id=f||Date.now(),this.user=n,this.visible=!0,this.ctx=document.createElement("canvas").getContext("2d");var p=this.ctx.canvas,v=n.ctx.canvas;p.style.width=v.style.width,p.style.height=v.style.height,this.ctx.lineWidth=n.ctx.lineWidth,this.coordWidth=v.width,this.coordHeight=v.height,o.setCanvasPropSize(this.ctx,{width:this.coordWidth,height:this.coordHeight}),this.tool=i,this.mode=r,this.color=u,this.size=s,this.fontsize=d,Array.isArray(l)?this.actions=l:void 0===l?(console.warn("action undefined! create a shape"),this.actions=[]):this.actions=[l],this.keyDown=h,this.start=c.toCoord(this.coordWidth,this.coordHeight),this.corner=[this.start.clone(),this.start.clone()],this.transform=[],this.path=[],this.zIndex=1,this.detail=e.calculateRadius(this.tool,this.start,this.start)}return(0,i.default)(e,[{key:"updateCorner",value:function(t){var n=this.getCoord(t),a=this.start,i=this.size,o=(0,r.default)(this.corner,2),s=o[0],u=o[1],c=e.calculateRadius(this.tool,a,n);this.detail=c;var l=c.xRadius,d=c.yRadius,h=c.radius;c.width,c.height;switch(this.tool){case"solidCircle":case"circle":s.x=a.x-h-i,s.y=a.y-h-i,u.x=a.x+h+i,u.y=a.y+h+i;break;case"ellipse":case"solidEllipse":s.x=a.x-l-i,s.y=a.y-d-i,u.x=a.x+l+i,u.y=a.y+d+i;break;case"rect":case"roundRect":case"solidRect":case"solidRoundRect":case"line":s.copy(a.clone().topLeft(n)),u.copy(a.clone().bottomRight(n));break;case"text":case"free":case"erase":s.topLeft(n),u.bottomRight(n);break;case"flag":case"fill":break;default:this.tool}return"fill"!==this.tool&&"text"!==this.tool&&"free"!==this.tool&&"erase"!==this.tool&&(s.x-=i,s.y-=i,u.x+=i,u.y+=i),c}},{key:"expandCorner",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size,t=(0,r.default)(this.corner,2),n=t[0],a=t[1];n.x-=e,n.y-=e,a.x+=e,a.y+=e}},{key:"destroy",value:function(){s.default.shape("shape delete ctx",this.user,this.ctx,this.actions)}},{key:"toSnapshot",value:function(e){var t=e.width,n=e.height,r=this.id,a=this.mode,i=this.tool,o=this.size,s=this.fontsize,u=this.color,c=this.start,l=this.actions,d=this.keyDown;return"fill"===i?{id:r,user:this.user.account,mode:a,tool:i,size:o,fontsize:s,color:u,start:c.toPoint(t,n).toString(),optimized:!0,imageData:this.ctx.canvas.toDataURL(),keyDown:d,corner:this.corner.map((function(e){return e.toPoint(t,n).toString()})),actions:l.filter((function(e){return e})).map((function(e){return e.toString()})).join(";")+";"}:{id:r,user:this.user.account,mode:a,tool:i,size:o,fontsize:s,color:u,start:c.toPoint(t,n).toString(),optimized:!1,imageData:"",corner:this.corner.map((function(e){return e.toPoint(t,n).toString()})),keyDown:d,actions:l.filter((function(e){return e})).map((function(e){return e.toString()})).join(";")+";"}}},{key:"draw",value:function(e){var t=this.user.end.toCoord(this.coordWidth,this.coordHeight);switch(this.tool){case"fill":o.fill(e,t,this.color,this);break;case"erase":case"free":o.free(e,this.getCoord(this.user.prevOldMid),this.getCoord(this.user.prevEnd),this.getCoord(this.user.oldMid),this.color,this.size);break;case"line":o.line(e,this.getCoord(this.user.start),this.getCoord(this.user.end),this.color);break;case"rect":case"solidRect":var n=this.getCoord(this.user.end),r=this.getCoord(this.user.start),a=n.x-r.x,i=n.y-r.y,s=Math.min(Math.abs(a),Math.abs(i));this.user.keyDown.shiftKey&&(a=(0,u.sign)(a)*s,i=(0,u.sign)(i)*s),o.rect(e,r,a,i,"solidRect"===this.tool,this.color);break;case"roundRect":case"solidRoundRect":var c=this.getCoord(this.user.end),l=this.getCoord(this.user.start),d=c.x-l.x,h=c.y-l.y,f=Math.min(Math.abs(d),Math.abs(h)),p=f<this.size?2:.1*f;this.user.keyDown.shiftKey&&(d=(0,u.sign)(d)*f,h=(0,u.sign)(h)*f),o.roundRect(e,l,d,h,p,"solidRoundRect"===this.tool,this.color);break;case"circle":case"solidCircle":var v=this.detail.radius,y=this.getCoord(this.user.start);o.circle(e,y,v,"solidCircle"===this.tool,this.color);break;case"ellipse":case"solidEllipse":var g=this.getCoord(this.user.start),m=this.detail,w=m.xRadius,b=m.yRadius;o.ellipse(e,g,w,b,"solidEllipse"===this.tool,this.color)}}},{key:"freeMove",value:function(e){o.free(e,this.getCoord(this.user.prevOldMid),this.getCoord(this.user.prevEnd),this.getCoord(this.user.oldMid),this.color,this.size)}},{key:"freeEnd",value:function(e){o.free(e,this.getCoord(this.user.prevOldMid),this.getCoord(this.user.oldMid),this.getCoord(this.user.end),this.color,this.size)}},{key:"getCoord",value:function(e){return e.toCoord(this.coordWidth,this.coordHeight)}}],[{key:"calculateRadius",value:function(e,t,n){var r=Math.abs(n.x-t.x),a=Math.abs(n.y-t.y),i=void 0,o=void 0,s=void 0;switch(e){case"circle":case"solidCircle":case"ellipse":case"solidEllipse":i=(o=r)>(s=a)?o:s}return{xRadius:o,yRadius:s,radius:i,width:r,height:a}}}]),e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(2)),a=p(n(0)),i=p(n(1)),o=p(n(3)),s=p(n(4)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(191)),c=p(n(198)),l=n(34),d=p(n(79)),h=n(112),f=p(n(190));function p(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(e,n){(0,a.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return i.undoCount=0,i.account=e,i.ctx=document.createElement("canvas").getContext("2d"),i.ctx.canvas.className="wb_-_-"+e,u.setpixelated(i.ctx),u.setLineStyle(i.ctx),i.shapes=[],i.recycle=[],i.mode="draw",i.tool="flag",i.flagPos=new c.default(99999,99999).toString(),i.size=4,i.color="#000000",i.fontsize=24,i.isMouseDown=!1,i.start=new c.default(0,0),i.oldMid=new c.default(0,0),i.prevOldMid=new c.default(0,0),i.end=new c.default(0,0),i.prevEnd=new c.default(0,0),i.keyDown={altKey:!1,ctrlKey:!1,shiftKey:!1,which:-1},f.default.emit("userUpdate",i.account,{tool:i.tool,size:i.size,color:i.color,fontsize:i.fontsize,mode:i.mode,keyDown:i.keyDown}),i.maxUserHistory=n,i._resetCalibrate=i.getCalibrateAction(),i}return(0,s.default)(t,e),(0,i.default)(t,[{key:"update",value:function(e){var n=this;t.PROPS.forEach((function(t){t in e&&(n[t]=e[t])})),this.emit("update",this.account,e),f.default.emit("userUpdate",this.account,e),d.default.user("update user ",this,"with ",e)}},{key:"pushShape",value:function(e){return this.recycle.length&&(this.recycle.forEach((function(e){return e.destroy()})),this.recycle.length=0),this.undoCount=0,this.shapes.push(e),this.configActiveShape(),this.emitUserShape(),e}},{key:"configActiveShape",value:function(){console.log("config active shape "),this.activeShape=this.shapes[this.shapes.length-1]}},{key:"undo",value:function(){if(this.undoCount>=this.maxUserHistory)return console.warn("reach maxUserHistory! abort undo"),this.shapes.length;this.undoCount++;var e=this.shapes.pop();return e&&(this.recycle.push(e),this.configActiveShape(),d.default.log("undo:",this),this.emit("undo",this),this.emitUserShape()),this.shapes.length}},{key:"redo",value:function(){if(0===this.undoCount)return this.recycle.length;this.undoCount--;var e=this.recycle.pop();return e&&(this.shapes.push(e),this.configActiveShape(),this.emit("redo",this),this.emitUserShape()),this.recycle.length}},{key:"getCalibrateAction",value:function(){var e=this.mode,t=this.tool,n=this.size,r=this.color,a=this.fontsize,i=this.isMouseDown,o=this.keyDown,s=this.flagPos;return new h.CalibrateAction({mode:e,tool:t,size:n,color:r,fontsize:a,isMouseDown:i,flagPos:s,keyDown:o})}},{key:"clearShapes",value:function(){d.default.user("user reset:",this),this.shapes.forEach((function(e){return e.destroy()})),this.shapes=[],this.recycle=[],this.undoCount=0,this.emitUserShape()}},{key:"emitUserShape",value:function(){var e=this.undoCount,t=(this.recycle.length,this.shapes.length),n=this.maxUserHistory-e;t<n&&(n=t),f.default.emit("userShapes",this.account,n,this.recycle.length)}},{key:"guessMyUndoCount",value:function(){this.undoCount=this.recycle.length}},{key:"whenMouseDown",value:function(e){this.prevOldMid=e.clone(),this.prevEnd=e.clone(),this.start=e.clone(),this.oldMid=e.clone(),this.end=e.clone()}},{key:"whenMouseMove",value:function(e){this.prevOldMid=this.oldMid.clone(),this.prevEnd=this.end.clone(),this.oldMid=c.default.middle(this.end,e),this.end=e.clone()}},{key:"whenMouseUp",value:function(e){this.prevOldMid=this.oldMid.clone(),this.prevEnd=this.end.clone(),this.oldMid=c.default.middle(this.end,e),this.end=e.clone()}},{key:"reset",value:function(){this.update(this._resetCalibrate),f.default.emit("userUpdate",this.account,this._resetCalibrate)}},{key:"destroy",value:function(){(this.shapes.length||this.recycle.length)&&this.clearShapes(),d.default.user("delete user ctx:",this)}},{key:"isFlag",get:function(){return"flag"===this.tool}}]),t}(l.EventEmitter);v.PROPS=["mode","tool","size","color","fontsize","isMouseDown","flagPos","keyDown"],t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(2)),a=h(n(0)),i=h(n(1)),o=h(n(3)),s=h(n(4)),u=n(34),c=n(295),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(191)),d=h(n(190));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return e.onUndo=function(t){var n=t.recycle[t.recycle.length-1];e.remove(n),e.emit("undo",t)},e.onRedo=function(t){var n=t.shapes[t.shapes.length-1];e.push(n),e.emit("redo",t)},e.visibles=[],e.transh=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"push",value:function(e){this.visibles.push(e),this.visibles.sort((function(e,t){return e.id-t.id})),d.default.emit("globalShapes",this.visibles.length)}},{key:"remove",value:function(e){var t=this.visibles.indexOf(e);~t&&(this.visibles.splice(t,1),d.default.emit("globalShapes",this.visibles.length))}},{key:"wrap",value:function(e){e instanceof c.UserManager&&(this.clearListener(),this._usernameger=e,this._usernameger.on("undo",this.onUndo),this._usernameger.on("redo",this.onRedo))}},{key:"clear",value:function(){this.visibles.forEach((function(e){e.destroy()})),this.visibles.length=0,d.default.emit("globalShapes",this.visibles.length)}},{key:"destroy",value:function(){this.clearListener()}},{key:"clearListener",value:function(){this._usernameger&&(this._usernameger.removeAllListeners(),delete this._usernameger)}},{key:"resizeCanvas",value:function(e){var t=e.widthScale,n=e.heightScale;this.visibles.forEach((function(e){var r=e.ctx.canvas,a=r.width,i=r.height,o=a*t,s=i*n;l.setCanvasPropSize(e.ctx,{height:s,width:o}),e.corner[0].x*=t,e.corner[0].y*=n,e.corner[1].x*=t,e.corner[1].y*=n}))}}]),t}(u.EventEmitter);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(6)),a=f(n(12)),i=f(n(2)),o=f(n(0)),s=f(n(1)),u=f(n(3)),c=f(n(4));t.applyState=v;var l=n(34),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(191)),h=f(n(79));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e,n){(0,o.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.paddingTop=0,r.paddingLeft=0,r.canvasRatio=null,r.onResize=function(){r.container&&(r.onResize.waiting||(r.onResize.waiting=!0,setTimeout((function(){r.onResize.waiting=!1,r.resize()}),300)))},r.resize=function(){var e=parseInt(""+r.container.clientWidth);if(isNaN(e)||e<=0)throw new Error("白板宽度应是大于0的数字");var t=parseInt(""+r.container.clientHeight);if(isNaN(t)||t<=0)throw new Error("白板高度应是大于0的数字");if(0!==e&&0!==t&&(r.containerWidth=e,r.containerHeight=t,null===r.canvasRatio?r.calcCanvasLayout(e/t):r.calcCanvasLayout(),r.updateCanvasStyleSize({paddingLeft:r.paddingLeft,paddingTop:r.paddingTop,canvasWidth:r.canvasWidth,canvasHeight:r.canvasHeight}),console.log("resize"),r.opt&&"owner"===r.opt.identity)){r.canvasWidth&&r.canvasHeight,r.emit("ownerCanavasUpdate",r.canvasWidth,r.canvasHeight);r.containerHeight,r.containerWidth,r.ownerCanvasHeight,r.ownerCanvasWidth;r.updateCanvasPropSize(r.canvasWidth,r.canvasHeight)}},r.onUndo=function(){if(r.displayCtx&&r.shapes&&r.users){r.fullRender();var e=!0,t=!1,n=void 0;try{for(var i,o=(0,a.default)(r.users.all);!(e=(i=o.next()).done);e=!0){var s=i.value;s.isMouseDown&&r.displayCtx.drawImage(s.ctx.canvas,0,0)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}},r.onRedo=function(){if(r.displayCtx&&r.shapes&&r.users){r.fullRender();var e=!0,t=!1,n=void 0;try{for(var i,o=(0,a.default)(r.users.all);!(e=(i=o.next()).done);e=!0){var s=i.value;s.isMouseDown&&r.displayCtx.drawImage(s.ctx.canvas,0,0)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}},r.inputDom=function(){var e=document.createElement("input");e.type="text",e.autofocus=!0,e.className="wb-canvas__input";var t=e.style;return t.position="absolute",t.display="none",t.padding="0px",t.zIndex="999",e}(),r.opt=n,r.inited=!1,e?(r.setContainer(e,n,!0),r):(0,u.default)(r)}return(0,c.default)(t,e),(0,s.default)(t,[{key:"wrap",value:function(e,t){this.clearListener(),this.shapes=e,this.users=t,this.shapes.on("undo",this.onUndo),this.shapes.on("redo",this.onRedo)}},{key:"clearListener",value:function(){this.shapes&&this.shapes.removeAllListeners()}},{key:"setContainer",value:function(e,t,n){if(h.default.m.containermanager("setContainer",e,t),!(e instanceof HTMLElement))throw new Error("画板容器不是HTMLElement实例");this.container&&(this.container.removeEventListener("resize",this.onResize),this.container.remove()),this.container=e,e.style.position="relative",t||(t=this.opt?this.opt:{}),this.containerHeight=e.clientHeight,this.containerWidth=e.clientWidth,console.warn("canvas height!",t,this.canvasRatio),null===this.canvasRatio&&(t.height&&t.width?(this.canvasHeight=t.height,this.canvasWidth=t.width,this.updateCanvasPropSize(this.canvasWidth,this.canvasHeight),this.canvasRatio=this.canvasWidth/this.canvasHeight):this.canvasRatio=this.containerWidth/this.containerHeight);var a=this.canvasRatio;null===a&&(a=this.containerWidth/this.containerHeight),"number"==typeof a&&this.calcCanvasLayout(a),this.opt=(0,r.default)(this.opt,t),this.inited||this.initEssential(),this.updateCanvasStyleSize({paddingLeft:this.paddingLeft,paddingTop:this.paddingTop,canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight}),n&&"owner"===this.opt.identity&&this.updateCanvasPropSize(this.canvasWidth,this.canvasHeight),h.default.m.containermanager("setContainer/appendChild",this.displayCanvas,this.inputDom),e.appendChild(this.displayCanvas),e.appendChild(this.maskCanvas),e.appendChild(this.inputDom),this.adjustSize=!1,window.addEventListener("resize",this.onResize),window.addEventListener("orientationchange",this.onResize,!1)}},{key:"calcCanvasLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvasRatio,t=this.containerWidth/this.containerHeight;t>e?(this.canvasHeight=Math.floor(this.containerHeight||0),this.canvasWidth=Math.floor(this.canvasHeight*e)):(this.canvasWidth=Math.floor(this.containerWidth||0),this.canvasHeight=Math.floor(this.canvasWidth/e));var n=this.containerHeight-this.canvasHeight,r=this.containerWidth-this.canvasWidth;this.paddingTop=Math.floor(n/2),this.paddingLeft=Math.floor(r/2)}},{key:"initEssential",value:function(){var e=this;if("number"!=typeof this.containerWidth)throw new Error("画板宽度不是数字");if("number"!=typeof this.containerHeight)throw new Error("画板高度不是数字");var t=document.createElement("canvas");this.displayCtx=t.getContext("2d"),d.setLineStyle(this.displayCtx),t.setAttribute("data-id","displayCanvas");var n=("\n    position: relative;\n    top: "+this.paddingTop+"px;\n    left: "+this.paddingLeft+"px;\n    box-sizing: content-box;\n    background-position: center;\n    background-repeat: no-repeat;\n    background-color: #ffffff;\n    background-size: contain;\n    z-index: 2;\n    ").trim().replace("\n","");t.style.cssText=n,this.displayCanvas=t;var r=document.createElement("canvas");this.maskCtx=r.getContext("2d"),d.setpixelated(this.maskCtx),d.setLineStyle(this.maskCtx),this.maskCtx.lineWidth=1,r.setAttribute("data-id","maskCanvas");var a=("\n    position: absolute;\n    top: "+this.paddingTop+";\n    left: "+this.paddingLeft+";\n    box-sizing: content-box;\n    transform: translate3d(0,0,0);\n    z-index: 500;\n    ").trim().replace("\n","");r.style.cssText=a,this.maskCanvas=r,this.inited=!0,h.default.m.containermanager("initCanvas"),setTimeout((function(){e.emit("init-canvas"),e.opt&&"owner"===e.opt.identity&&e.emit("ownerCanavasUpdate",e.canvasWidth,e.canvasHeight)}))}},{key:"updateCanvasStyleSize",value:function(e){var t=e.canvasWidth,n=e.canvasHeight;if(this.maskCtx&&this.maskCanvas&&(d.setCavansStyleSize(this.maskCtx,t,n),d.applyCanvasLayout(this.maskCanvas,e)),this.displayCtx&&this.displayCanvas&&(d.setCavansStyleSize(this.displayCtx,e.canvasWidth,e.canvasHeight),d.applyCanvasLayout(this.displayCanvas,e)),this.users){var r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(this.users.all);!(r=(s=u.next()).done);r=!0){var c=s.value;d.setCavansStyleSize(c.ctx,t,n),d.applyCanvasLayout(c.ctx.canvas,e)}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}}}},{key:"updateCanvasPropSize",value:function(e,t){var n=this.ownerCanvasHeight,r=this.ownerCanvasWidth;this.ownerCanvasWidth=e||300,this.ownerCanvasHeight=t||300;var i={width:this.ownerCanvasWidth,height:this.ownerCanvasHeight};if(this.maskCtx&&d.setCanvasPropSize(this.maskCtx,i),this.displayCtx&&d.setCanvasPropSize(this.displayCtx,i),this.users){var o=!0,s=!1,u=void 0;try{for(var c,l=(0,a.default)(this.users.all);!(o=(c=l.next()).done);o=!0){var h=c.value;d.setCanvasPropSize(h.ctx,{width:e,height:t})}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}}this.shapes&&this.shapes.resizeCanvas({widthScale:e/r,heightScale:t/n}),this.fullRender()}},{key:"addUser",value:function(e,t){var n=t.ctx.canvas,r=t.account;this.displayCanvas;n.style.position="absolute",n.style.boxSizing="content-box",n.style.top=this.paddingTop+"px",n.style.left=this.paddingLeft+"px",n.style.width=this.canvasWidth+"px",n.style.height=this.canvasHeight+"px",n.width=this.ownerCanvasWidth,n.height=this.ownerCanvasHeight,h.default.m.containermanager("addUser",r,t),n.style.cursor=r===e?"not-allowed":"crosshair",this.container.appendChild(n),d.setpixelated(t.ctx),d.setLineStyle(t.ctx)}},{key:"destroy",value:function(){this.container.removeChild(this.maskCanvas),this.container.removeChild(this.displayCtx.canvas),this.removeAllListeners(),window.removeEventListener("resize",this.onResize),window.removeEventListener("orientationchange",this.onResize,!1)}},{key:"fullRender",value:function(){if(this.displayCtx){this.displayCtx.canvas;d.clearCtx(this.displayCtx),this.displayCtx.getImageData(0,0,1,1)}if(this.shapes&&this.displayCtx){var e=this.displayCtx,t=this.shapes.visibles;e.save(),h.default.log("displayCtx");for(var n=0,r=t.length;n<r;n++){var a=t[n];console.assert(void 0!==a.ctx,"shape ctx is ubdefined",a);var i=a.ctx&&(0===a.ctx.canvas.width||0===a.ctx.canvas.height);h.default.m.containermanager("render shape:",a,"skip",i),i||(v(e,a),"erase"===a.tool&&console.log(e.globalCompositeOperation),e.drawImage(a.ctx.canvas,a.corner[0].x,a.corner[0].y))}e.restore()}else h.default.m.containermanager("no render",this.shapes,this.displayCtx)}}]),t}(l.EventEmitter);function v(e,t){var n=t.ctx,r=t.size,a=t.color,i=t.tool;void 0!==e?(e.lineWidth=r,e.strokeStyle=a,e.fillStyle=a,"erase"===i&&e!==n?"destination-out"!==e.globalCompositeOperation&&(e.globalCompositeOperation="destination-out"):e.globalCompositeOperation="source-over"):console.warn("applyState上下文为空!")}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=y(n(55)),a=y(n(101)),i=y(n(59)),o=y(n(32)),s=y(n(2)),u=y(n(0)),c=y(n(1)),l=y(n(3)),d=y(n(4)),h=y(n(29)),f=y(n(297)),p=n(206),v=y(n(34));function y(e){return e&&e.__esModule?e:{default:e}}var g=function(e,t,n,r){return new(n||(n=h.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},m=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,l.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e,n));return r.records=[],r.connector=new w,r.drawManager=null,Array.isArray(e)&&(r.params=e[0]),r}return(0,d.default)(t,e),(0,c.default)(t,[{key:"init",value:function(){return g(this,void 0,void 0,r.default.mark((function e(){var t,n,s,u,c,l;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchMultiData();case 2:if(t=e.sent,n=(0,o.default)(t,2),s=n[0],u=n[1],"error"!==s){e.next=11;break}return this.state="error",e.abrupt("return","error");case 11:return c=[],u.forEach((function(e){e.forEach((function(e){c.push({record:JSON.parse(e.str),time:e.time})}))})),c=c.sort((function(e,t){return e.time-t.time})),this.records=c,l=new i.default,c.forEach((function(e){"snapshot"===e.record.type&&e.record.value.uid&&l.add(e.record.value.uid),"snapshotArr"===e.record.type&&Array.isArray(e.record.value)&&e.record.value.length>0&&e.record.value[0].uid&&l.add(e.record.value[0].uid)})),this.viewerArr=(0,a.default)(l),this.viewerArr.length>0&&(this.viewer=this.viewerArr[0]),this.state="ready",e.abrupt("return","ready");case 21:case"end":return e.stop()}}),e,this)})))}},{key:"setViewer",value:function(e){var t;this.viewer=e,null===(t=this.drawManager)||void 0===t||t.setViewer(e)}},{key:"doSetTrack",value:function(e,t,n){var a;return g(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null===(a=this.drawManager)||void 0===a||a.seekTo(e);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"showTrackCb",value:function(e){e&&!this.drawManager&&(this.drawManager=new p.App({account:this.viewer,container:e,connector:this.connector,isRecordPlayer:!0,platform:"web",nim:{}}),window.drawPlugin=this.drawManager,this.drawManager.addRecordData(this.records))}}]),t}(f.default);t.default=m;var w=function(e){function t(){return(0,u.default)(this,t),(0,l.default)(this,(t.__proto__||(0,s.default)(t)).apply(this,arguments))}return(0,d.default)(t,e),(0,c.default)(t,[{key:"sendData",value:function(){}},{key:"broadcastData",value:function(){}},{key:"sendSyncRequest",value:function(){}}]),t}(v.default)}]).default}));
//# sourceMappingURL=RecordPlayer_v3.1.0.log.js.map