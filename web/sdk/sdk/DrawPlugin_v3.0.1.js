!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.DrawPlugin=t():e.DrawPlugin=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=259)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(91),i=(r=o)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){e.exports={default:n(103),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(33),i=(r=o)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){"use strict";t.__esModule=!0;var r=a(n(113)),o=a(n(80)),i=a(n(33));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,o.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(7),o=n(5),i=n(23),a=n(15),s=n(16),u=function(e,t,n){var c,l,d,f=e&u.F,h=e&u.G,p=e&u.S,v=e&u.P,y=e&u.B,g=e&u.W,m=h?o:o[t]||(o[t]={}),b=m.prototype,w=h?r:p?r[t]:(r[t]||{}).prototype;for(c in h&&(n=t),n)(l=!f&&w&&void 0!==w[c])&&s(m,c)||(d=l?w[c]:n[c],m[c]=h&&"function"!=typeof w[c]?n[c]:y&&l?i(d,r):g&&w[c]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):v&&"function"==typeof d?i(Function.call,d):d,v&&((m.virtual||(m.virtual={}))[c]=d,e&u.R&&b&&!b[c]&&a(b,c,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var r=n(44)("wks"),o=n(29),i=n(7).Symbol,a="function"==typeof i;(e.exports=function(e){return r[e]||(r[e]=a&&i[e]||(a?i:o)("Symbol."+e))}).store=r},function(e,t,n){e.exports={default:n(84),__esModule:!0}},function(e,t,n){e.exports=!n(18)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(0)),o=a(n(1)),i=a(n(33));function a(e){return e&&e.__esModule?e:{default:e}}var s={type:"",boardName:"whiteboard",pageIndex:"0",dependOn:void 0,timestamp:0},u=!1;function c(e,t,n,r){var o=!1;return s.pageIndex!==n||s.boardName!==r?o=!0:s.inProgress?(e!==s.type||(void 0===t?"undefined":(0,i.default)(t))!==(0,i.default)(s.dependOn)||"string"==typeof t&&t!==s.dependOn||Array.isArray(t)&&Array.isArray(s.dependOn)&&t.join(",")!==s.dependOn.join(",")||u||["undo","redo","image"].includes(e))&&(o=!0):o=!0,o}var l=function(){function e(t){(0,r.default)(this,e),this.type="base",this.app=t,this.opsManager=t.opsManager,this.registerHooks()}return(0,o.default)(e,[{key:"registerHooks",value:function(){}},{key:"eventsToListen",value:function(){return{exec:{value:!1,information:{args:"",message:"执行"+this.type+"事件"}},activate:{value:!1,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"eventsToEmit",value:function(){return{}}},{key:"execCommand",value:function(){console.warn("白板--\x3e","若设置了exec为true，请继承execCommand函数，并作出对应的处理。")}},{key:"afterActivate",value:function(){}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"opIdForseen",value:function(e,t){return c(e,t,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName)?this.opsManager.currPage.getNextOpId():this.opsManager.currPage.getOpId()}},{key:"dispatch",value:function(e){if("page"===e.type)this.dispatchPageAction(e);else if("board"===e.type)this.dispatchBoardAction(e);else{var t=this.app.room.boards[this.app.room.currIndex],n=(new Date).valueOf(),r=c(e.type,e.dependOn,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName);u=!1,s={type:e.type,dependOn:e.dependOn,timestamp:n,pageIndex:this.opsManager.currPage.pageIndex,boardName:this.opsManager.currPage.boardName,inProgress:e.inProgress},r&&this.opsManager.currPage.prepareNewOpId();var o={category:"inPageOp",board:this.app.room.currIndex,page:t.currIndex,time:n,uid:this.app.account,opId:this.opsManager.currPage.getOpId(),data:e};this.app.room.dispatch(o)}}},{key:"dispatchFromPage",value:function(e,t){var n=(new Date).valueOf();t.prepareNewOpId();var r={category:"inPageOp",board:t.boardName,page:Number(t.pageIndex),time:n,uid:this.app.account,opId:t.getOpId(),data:e};s={type:e.type,dependOn:e.dependOn,timestamp:n,pageIndex:t.pageIndex,boardName:t.boardName,inProgress:e.inProgress},this.app.room.dispatch(r)}},{key:"dispatchPageAction",value:function(e){var t=(new Date).valueOf(),n={category:"pageOp",board:this.app.room.currIndex,time:t,uid:this.app.account,opId:t.toString(),data:e};this.app.room.dispatch(n)}},{key:"dispatchBoardAction",value:function(e){var t=(new Date).valueOf(),n={category:"boardOp",time:t,uid:this.app.account,opId:t.toString(),data:e};this.app.room.dispatch(n)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=this.app.dispatcher).emit.apply(t,["event:"+this.type+":"+e].concat(r))}},{key:"draw",value:function(e,t,n){console.warn("白板--\x3e","请实现"+this.type+"子类中draw函数。")}},{key:"preview",value:function(e,t,n){this.draw(e,t,n)}},{key:"hide",value:function(e,t,n){}},{key:"beginBatch",value:function(){u=!0}},{key:"isKeyDown",value:function(e){return this.app.container.isKeyDown(e)}},{key:"getOpTypeByOpId",value:function(e){return this.opsManager.drawOpsOfPage.hasOwnProperty(e)?this.opsManager.drawOpsOfPage[e].data.type:void 0}},{key:"isMouseDown",get:function(){return this.app.container.isMouseDown}},{key:"opsOfPage",get:function(){return this.opsManager.currPage.opQueue}},{key:"drawOpsOfPage",get:function(){return this.opsManager.drawOpsOfPage}}]),e}();t.default=l},function(e,t,n){var r=n(14),o=n(62),i=n(40),a=Object.defineProperty;t.f=n(10)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),o)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(13);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(12),o=n(25);e.exports=n(10)?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){e.exports={default:n(89),__esModule:!0}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){e.exports={default:n(166),__esModule:!0}},function(e,t,n){var r=n(55),o=n(41);e.exports=function(e){return r(o(e))}},function(e,t,n){var r=n(41);e.exports=function(e){return Object(r(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLineFromPointsY=t.getVerticalLineY=t.getXFromCoefAndOffset=t.getLineCoef=t.getArrowPoints=void 0,t.distSqrt=o,t.dist=i,t.rectCollide=function(e,t){return!(e.sx>t.sx+t.w||e.sx+e.w<t.sx||e.sy>t.sy+t.h||e.sy+e.h<t.sy)},t.pointCollideWithPoint=function(e,t,n){return o(e,t)<=n*n},t.pointCollideWithLine=function(e,t,n,r){return i(e,t)+i(e,n)-i(t,n)<=r},t.pointInRect=function(e,t){return t[0]>e.sx&&t[0]<e.sx+e.w&&t[1]>e.sy&&t[1]<e.sy+e.h},t.getTransformedBoundary=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{factor:1,coordinate:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},i=r.factor*(e.sx-r.coordinate)+r.coordinate,a=o.factor*(e.sy-o.coordinate)+o.coordinate;i+=t||0,a+=n||0;var s=e.w*r.factor,u=e.h*o.factor;s<0&&(i+=s,s=-s);u<0&&(a+=u,u=-u);return{sx:i,sy:a,w:s,h:u}},t.getTransformedPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{factor:1,coordinate:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},i=r.factor*(e[0]-r.coordinate)+r.coordinate,a=o.factor*(e[1]-o.coordinate)+o.coordinate;return[i+=t||0,a+=n||0]},t.combineBoundary=function(e,t){var n=(0,r.min)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),o=(0,r.min)(e.sy,t.sy,e.sy+e.h,t.sy+t.h),i=(0,r.max)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),a=(0,r.max)(e.sy,t.sy,e.sy+e.h,t.sy+t.h);return{sx:n,sy:o,w:i-n,h:a-o}},t.getBoundaryBoxFromTwoPoints=function(e,t){var n=(0,r.min)(e[0],t[0]),o=(0,r.max)(e[0],t[0]),i=(0,r.min)(e[1],t[1]),a=(0,r.max)(e[1],t[1]);return{sx:n,sy:i,w:o-n,h:a-i}};var r=n(77);function o(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function i(e,t){return Math.sqrt(o(e,t))}t.getArrowPoints=function(e,t){var n=5*e,r=2*e,o=a(t),i=t[1][0]-t[0][0]>0?s(t[1],o,n):2*t[1][0]-s(t[1],o,n),l=t[1][0]-t[0][0]==0?t[1][1]+(t[1][1]-t[0][1]>0?n:-n):c(t,i),d=s(t[1],-1/o,r),f=t[1][1]-t[0][1]==0?t[1][1]-r:u(t[1],o,d),h=2*t[1][0]-s(t[1],-1/o,r);return[[i,l],[d,f],[h,t[1][1]-t[0][1]==0?t[1][1]+r:u(t[1],o,h)]]};var a=t.getLineCoef=function(e){return(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0},s=t.getXFromCoefAndOffset=function(e,t,n){return Math.sqrt(Math.pow(n,2)/(Math.pow(t,2)+1))+e[0]},u=t.getVerticalLineY=function(e,t,n){return(e[0]-n)/t+e[1]},c=t.getLineFromPointsY=function(e,t){return Math.max(-1e6,(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0)*(t-e[0][0])+e[0][1]}},function(e,t,n){var r=n(39);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(63),o=n(45);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=!0},function(e,t){e.exports={}},function(e,t,n){"use strict";var r=d(n(52)),o=d(n(99)),i=d(n(80)),a=d(n(19)),s=d(n(9)),u=d(n(33)),c=d(n(0)),l=d(n(1));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){(0,c.default)(this,e),Array.isArray(t)||(t=[]),this._args=t,this.taps=[],this.interceptors=[],this.call=this._call,this.promise=this._promise,this.callAsync=this._callAsync,this._x=void 0}return(0,l.default)(e,[{key:"compile",value:function(e){throw new Error("Abstract: should be overriden")}},{key:"_createCall",value:function(e){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:e})}},{key:"tap",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tap(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"sync",fn:t},e)).name||""===e.name)throw new Error("Missing name for tap");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapAsync",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapAsync(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"async",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapAsync");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapPromise",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapPromise(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"promise",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapPromise");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"_runRegisterInterceptors",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=(0,a.default)(this.interceptors);!(t=(o=i.next()).done);t=!0){var s=o.value;if(s.register){var u=s.register(e);void 0!==u&&(e=u)}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}return e}},{key:"withOptions",value:function(e){var t=function(t){return(0,s.default)({},e,"string"==typeof t?{name:t}:t)};e=(0,s.default)({},e,this._withOptions);var n=this._withOptionsBase||this,r=(0,i.default)(n);return r.tapAsync=function(e,r){return n.tapAsync(t(e),r)},r.tap=function(e,r){return n.tap(t(e),r)},r.tapPromise=function(e,r){return n.tapPromise(t(e),r)},r._withOptions=e,r._withOptionsBase=n,r}},{key:"isUsed",value:function(){return this.taps.length>0||this.interceptors.length>0}},{key:"intercept",value:function(e){if(this._resetCompilation(),this.interceptors.push((0,s.default)({},e)),e.register)for(var t=0;t<this.taps.length;t++)this.taps[t]=e.register(this.taps[t])}},{key:"_resetCompilation",value:function(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}},{key:"_insert",value:function(e){this._resetCompilation();var t=void 0;"string"==typeof e.before?t=new o.default([e.before]):Array.isArray(e.before)&&(t=new o.default(e.before));var n=0;"number"==typeof e.stage&&(n=e.stage);for(var r=this.taps.length;r>0;){r--;var i=this.taps[r];this.taps[r+1]=i;var a=i.stage||0;if(t){if(t.has(i.name)){t.delete(i.name);continue}if(t.size>0)continue}if(!(a>n)){r++;break}}this.taps[r]=e}}]),e}();function h(e,t){return function(){return this[e]=this._createCall(t),this[e].apply(this,arguments)}}(0,r.default)(f.prototype,{_call:{value:h("call","sync"),configurable:!0,writable:!0},_promise:{value:h("promise","promise"),configurable:!0,writable:!0},_callAsync:{value:h("callAsync","async"),configurable:!0,writable:!0}}),e.exports=f},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";var r=n(94)(!0);n(57)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t,n){var r=n(12).f,o=n(16),i=n(8)("toStringTag");e.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){"use strict";t.__esModule=!0;var r=a(n(105)),o=a(n(79)),i="function"==typeof o.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof o.default&&"symbol"===i(r.default)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":void 0===e?"undefined":i(e)}},function(e,t,n){"use strict";var r=a(n(19)),o=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,o.default)(this,e),this.config=t,this.options=void 0,this._args=void 0}return(0,i.default)(e,[{key:"create",value:function(e){this.init(e);var t=void 0;switch(this.options.type){case"sync":t=new Function(this.args(),'"use strict";\n'+this.header()+this.content({onError:function(e){return"throw "+e+";\n"},onResult:function(e){return"return "+e+";\n"},resultReturns:!0,onDone:function(){return""},rethrowIfPossible:!0}));break;case"async":t=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.content({onError:function(e){return"_callback("+e+");\n"},onResult:function(e){return"_callback(null, "+e+");\n"},onDone:function(){return"_callback();\n"}}));break;case"promise":var n=!1,r=this.content({onError:function(e){return n=!0,"_error("+e+");\n"},onResult:function(e){return"_resolve("+e+");\n"},onDone:function(){return"_resolve();\n"}}),o="";o+='"use strict";\n',o+="return new Promise((_resolve, _reject) => {\n",n&&(o+="var _sync = true;\n",o+="function _error(_err) {\n",o+="if(_sync)\n",o+="_resolve(Promise.resolve().then(() => { throw _err; }));\n",o+="else\n",o+="_reject(_err);\n",o+="};\n"),o+=this.header(),o+=r,n&&(o+="_sync = false;\n"),o+="});\n",t=new Function(this.args(),o)}return this.deinit(),t}},{key:"setup",value:function(e,t){e._x=t.taps.map((function(e){return e.fn}))}},{key:"init",value:function(e){this.options=e,this._args=e.args.slice()}},{key:"deinit",value:function(){this.options=void 0,this._args=void 0}},{key:"header",value:function(){var e="";this.needContext()?e+="var _context = {};\n":e+="var _context;\n",e+="var _x = this._x;\n",this.options.interceptors.length>0&&(e+="var _taps = this.taps;\n",e+="var _interceptors = this.interceptors;\n");for(var t=0;t<this.options.interceptors.length;t++){var n=this.options.interceptors[t];n.call&&(e+=this.getInterceptor(t)+".call("+this.args({before:n.context?"_context":void 0})+");\n")}return e}},{key:"needContext",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,i=(0,r.default)(this.options.taps);!(e=(o=i.next()).done);e=!0){if(o.value.context)return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"callTap",value:function(e,t){for(var n=t.onError,r=t.onResult,o=t.onDone,i=t.rethrowIfPossible,a="",s=!1,u=0;u<this.options.interceptors.length;u++){var c=this.options.interceptors[u];c.tap&&(s||(a+="var _tap"+e+" = "+this.getTap(e)+";\n",s=!0),a+=this.getInterceptor(u)+".tap("+(c.context?"_context, ":"")+"_tap"+e+");\n")}a+="var _fn"+e+" = "+this.getTapFn(e)+";\n";var l=this.options.taps[e];switch(l.type){case"sync":i||(a+="var _hasError"+e+" = false;\n",a+="try {\n"),a+=r?"var _result"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n":"_fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",i||(a+="} catch(_err) {\n",a+="_hasError"+e+" = true;\n",a+=n("_err"),a+="}\n",a+="if(!_hasError"+e+") {\n"),r&&(a+=r("_result"+e)),o&&(a+=o()),i||(a+="}\n");break;case"async":var d="";d+=r?"(_err"+e+", _result"+e+") => {\n":"_err"+e+" => {\n",d+="if(_err"+e+") {\n",d+=n("_err"+e),d+="} else {\n",r&&(d+=r("_result"+e)),o&&(d+=o()),d+="}\n",d+="}",a+="_fn"+e+"("+this.args({before:l.context?"_context":void 0,after:d})+");\n";break;case"promise":a+="var _hasResult"+e+" = false;\n",a+="var _promise"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",a+="if (!_promise"+e+" || !_promise"+e+".then)\n",a+="  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise"+e+" + ')');\n",a+="_promise"+e+".then(_result"+e+" => {\n",a+="_hasResult"+e+" = true;\n",r&&(a+=r("_result"+e)),o&&(a+=o()),a+="}, _err"+e+" => {\n",a+="if(_hasResult"+e+") throw _err"+e+";\n",a+=n("_err"+e),a+="});\n"}return a}},{key:"callTapsSeries",value:function(e){var t=this,n=e.onError,r=e.onResult,o=e.resultReturns,i=e.onDone,a=e.doneReturns,s=e.rethrowIfPossible;if(0===this.options.taps.length)return i();for(var u=this.options.taps.findIndex((function(e){return"sync"!==e.type})),c=o||a||!1,l="",d=i,f=function(e){var o=e;d!==i&&"sync"!==t.options.taps[o].type&&(l+="function _next"+o+"() {\n",l+=d(),l+="}\n",d=function(){return(c?"return ":"")+"_next"+o+"();\n"});var a=d,f=function(e){return e?"":i()},h=t.callTap(o,{onError:function(e){return n(o,e,a,f)},onResult:r&&function(e){return r(o,e,a,f)},onDone:!r&&a,rethrowIfPossible:s&&(u<0||o<u)});d=function(){return h}},h=this.options.taps.length-1;h>=0;h--)f(h);return l+=d()}},{key:"callTapsLooping",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;if(0===this.options.taps.length)return n();var o=this.options.taps.every((function(e){return"sync"===e.type})),i="";o||(i+="var _looper = () => {\n",i+="var _loopAsync = false;\n"),i+="var _loop;\n",i+="do {\n",i+="_loop = false;\n";for(var a=0;a<this.options.interceptors.length;a++){var s=this.options.interceptors[a];s.loop&&(i+=this.getInterceptor(a)+".loop("+this.args({before:s.context?"_context":void 0})+");\n")}return i+=this.callTapsSeries({onError:t,onResult:function(e,t,n,r){var i="";return i+="if("+t+" !== undefined) {\n",i+="_loop = true;\n",o||(i+="if(_loopAsync) _looper();\n"),i+=r(!0),i+="} else {\n",i+=n(),i+="}\n"},onDone:n&&function(){var e="";return e+="if(!_loop) {\n",e+=n(),e+="}\n"},rethrowIfPossible:r&&o}),i+="} while(_loop);\n",o||(i+="_loopAsync = true;\n",i+="};\n",i+="_looper();\n"),i}},{key:"callTapsParallel",value:function(e){var t=this,n=e.onError,r=e.onResult,o=e.onDone,i=e.rethrowIfPossible,a=e.onTap,s=void 0===a?function(e,t){return t()}:a;if(this.options.taps.length<=1)return this.callTapsSeries({onError:n,onResult:r,onDone:o,rethrowIfPossible:i});var u="";u+="do {\n",u+="var _counter = "+this.options.taps.length+";\n",o&&(u+="var _done = () => {\n",u+=o(),u+="};\n");for(var c=function(e){var a=function(){return o?"if(--_counter === 0) _done();\n":"--_counter;"},c=function(e){return e||!o?"_counter = 0;\n":"_counter = 0;\n_done();\n"};u+="if(_counter <= 0) break;\n",u+=s(e,(function(){return t.callTap(e,{onError:function(t){var r="";return r+="if(_counter > 0) {\n",r+=n(e,t,a,c),r+="}\n"},onResult:r&&function(t){var n="";return n+="if(_counter > 0) {\n",n+=r(e,t,a,c),n+="}\n"},onDone:!r&&function(){return a()},rethrowIfPossible:i})}),a,c)},l=0;l<this.options.taps.length;l++)c(l);return u+="} while(false);\n"}},{key:"args",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.before,n=e.after,r=this._args;return t&&(r=[t].concat(r)),n&&(r=r.concat(n)),0===r.length?"":r.join(", ")}},{key:"getTapFn",value:function(e){return"_x["+e+"]"}},{key:"getTap",value:function(e){return"_taps["+e+"]"}},{key:"getInterceptor",value:function(e){return"_interceptors["+e+"]"}}]),e}();e.exports=s},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(14),o=n(73),i=n(45),a=n(43)("IE_PROTO"),s=function(){},u=function(){var e,t=n(54)("iframe"),r=i.length;for(t.style.display="none",n(74).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[i[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[a]=e):n=u(),void 0===t?n:o(n,t)}},function(e,t,n){n(97);for(var r=n(7),o=n(15),i=n(27),a=n(8)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<s.length;u++){var c=s[u],l=r[c],d=l&&l.prototype;d&&!d[a]&&o(d,a,c),i[c]=i.Array}},function(e,t){!function(n){"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=n()}((function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){return o(t[a][1][e]||e)}),l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,o="~";function i(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,i),u=o?o+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(o=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(o?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=o?o+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,a=new Array(i);r<i;r++)a[r]=n[r].fn;return a},c.prototype.listenerCount=function(e){var t=o?o+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,r,i,a){var s=o?o+e:e;if(!this._events[s])return!1;var u,c=this._events[s],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,a),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else for(var d,f=c.length,h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,n);break;case 4:c[h].fn.call(c[h].context,t,n,r);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c[h].fn.apply(c[h].context,u)}return!0},c.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,r){var i=o?o+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||u(this,i);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[i]=1===c.length?c[0]:c:u(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=o?o+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=o,c.EventEmitter=c,void 0!==t&&(t.exports=c)},{}]},{},[1])(1)}))},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(44)("keys"),o=n(29);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t,n){var r=n(5),o=n(7),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(26)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){"use strict";t.__esModule=!0;var r=i(n(163)),o=i(n(19));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var s,u=(0,o.default)(e);!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){t.f=n(8)},function(e,t,n){var r=n(7),o=n(5),i=n(26),a=n(48),s=n(12).f;e.exports=function(e){var t=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,n){e.exports={default:n(121),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r,o=n(159),i=(r=o)&&r.__esModule?r:{default:r};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t,n){e.exports={default:n(182),__esModule:!0}},function(e,t,n){e.exports={default:n(236),__esModule:!0}},function(e,t,n){var r=n(13),o=n(7).document,i=r(o)&&r(o.createElement);e.exports=function(e){return i?o.createElement(e):{}}},function(e,t,n){var r=n(35);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(42),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t,n){"use strict";var r=n(26),o=n(6),i=n(64),a=n(15),s=n(27),u=n(95),c=n(32),l=n(65),d=n(8)("iterator"),f=!([].keys&&"next"in[].keys()),h=function(){return this};e.exports=function(e,t,n,p,v,y,g){u(n,t,p);var m,b,w,_=function(e){if(!f&&e in M)return M[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",k="values"==v,O=!1,M=e.prototype,S=M[d]||M["@@iterator"]||v&&M[v],P=S||_(v),I=v?k?_("entries"):P:void 0,C="Array"==t&&M.entries||S;if(C&&(w=l(C.call(new e)))!==Object.prototype&&w.next&&(c(w,x,!0),r||"function"==typeof w[d]||a(w,d,h)),k&&S&&"values"!==S.name&&(O=!0,P=function(){return S.call(this)}),r&&!g||!f&&!O&&M[d]||a(M,d,P),s[t]=P,s[x]=h,v)if(m={values:k?P:_("values"),keys:y?P:_("keys"),entries:I},g)for(b in m)b in M||i(M,b,m[b]);else o(o.P+o.F*(f||O),t,m);return m}},function(e,t){},function(e,t,n){e.exports=n(234)},function(e,t,n){var r=n(6),o=n(5),i=n(18);e.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*i((function(){n(1)})),"Object",a)}},function(e,t,n){var r=n(29)("meta"),o=n(13),i=n(16),a=n(12).f,s=0,u=Object.isExtensible||function(){return!0},c=!n(18)((function(){return u(Object.preventExtensions({}))})),l=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!i(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&d.NEED&&u(e)&&!i(e,r)&&l(e),e}}},function(e,t,n){e.exports=!n(10)&&!n(18)((function(){return 7!=Object.defineProperty(n(54)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(16),o=n(20),i=n(87)(!1),a=n(43)("IE_PROTO");e.exports=function(e,t){var n,s=o(e),u=0,c=[];for(n in s)n!=a&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~i(c,n)||c.push(n));return c}},function(e,t,n){e.exports=n(15)},function(e,t,n){var r=n(16),o=n(21),i=n(43)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){var r=n(23),o=n(128),i=n(129),a=n(14),s=n(56),u=n(96),c={},l={};(t=e.exports=function(e,t,n,d,f){var h,p,v,y,g=f?function(){return e}:u(e),m=r(n,d,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(i(g)){for(h=s(e.length);h>b;b++)if((y=t?m(a(p=e[b])[0],p[1]):m(e[b]))===c||y===l)return y}else for(v=g.call(e);!(p=v.next()).done;)if((y=o(v,m,p.value,t))===c||y===l)return y}).BREAK=c,t.RETURN=l},function(e,t,n){var r=n(63),o=n(45).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},function(e,t,n){var r=n(30),o=n(25),i=n(20),a=n(40),s=n(16),u=n(62),c=Object.getOwnPropertyDescriptor;t.f=n(10)?c:function(e,t){if(e=i(e),t=a(t,!0),u)try{return c(e,t)}catch(e){}if(s(e,t))return o(!r.f.call(e,t),e[t])}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(a=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=r.sources.map((function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"}));return[n].concat(i).concat([o]).join("\n")}var a;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];null!=i&&(r[i]=!0)}for(o=0;o<e.length;o++){var a=e[o];null!=a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var r,o,i={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=r.apply(this,arguments)),o}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},u=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=s.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),c=null,l=0,d=[],f=n(120);function h(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=i[r.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](r.parts[a]);for(;a<r.parts.length;a++)o.parts.push(b(r.parts[a],t))}else{var s=[];for(a=0;a<r.parts.length;a++)s.push(b(r.parts[a],t));i[r.id]={id:r.id,refs:1,parts:s}}}}function p(e,t){for(var n=[],r={},o=0;o<e.length;o++){var i=e[o],a=t.base?i[0]+t.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function v(e,t){var n=u(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=d[d.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=u(e.insertAt.before,n);n.insertBefore(t,o)}}function y(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return m(t,e.attrs),v(e,t),t}function m(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function b(e,t){var n,r,o,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var a=l++;n=c||(c=g(t)),r=x.bind(null,n,a,!1),o=x.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),v(e,t),t}(t),r=O.bind(null,n,t),o=function(){y(n),n.href&&URL.revokeObjectURL(n.href)}):(n=g(t),r=k.bind(null,n),o=function(){y(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return h(n,t),function(e){for(var r=[],o=0;o<n.length;o++){var a=n[o];(s=i[a.id]).refs--,r.push(s)}e&&h(p(e,t),t);for(o=0;o<r.length;o++){var s;if(0===(s=r[o]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete i[s.id]}}}};var w,_=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function x(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=_(t,o);else{var i=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function k(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function O(e,t,n){var r=n.css,o=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||i)&&(r=f(r)),o&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},,,function(e,t,n){var r=n(12),o=n(14),i=n(24);e.exports=n(10)?Object.defineProperties:function(e,t){o(e);for(var n,a=i(t),s=a.length,u=0;s>u;)r.f(e,n=a[u++],t[n]);return e}},function(e,t,n){var r=n(7).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(35),o=n(8)("toStringTag"),i="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?n:i?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.min=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.min(e,t)}))},t.max=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.max(e,t)}))}},function(e,t,n){var r=n(35);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){e.exports={default:n(107),__esModule:!0}},function(e,t,n){e.exports={default:n(117),__esModule:!0}},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMi41Mzg2IDIuNDYwMzRDMTMuMTUyNCAxLjg0NjU2IDE0LjE0NzUgMS44NDY1NSAxNC43NjEzIDIuNDYwMzRMMTcuNTM5NyA1LjIzODcxQzE4LjE1MzQgNS44NTI0OSAxOC4xNTM0IDYuODQ3NjIgMTcuNTM5NyA3LjQ2MTRMNy44MDEyMiAxNy4xOTk4QzcuNTQyMjIgMTcuNDU4OCA3LjIwMDkgMTcuNjE5MiA2LjgzNjIyIDE3LjY1MzRMMy4xODEyNyAxNy45OTUyQzIuNTA3MTMgMTguMDU4MiAxLjk0MTc2IDE3LjQ5MjkgMi4wMDQ4MSAxNi44MTg3TDIuMzQ2NjQgMTMuMTYzOEMyLjM4MDc1IDEyLjc5OTEgMi41NDExNSAxMi40NTc4IDIuODAwMTUgMTIuMTk4OEwxMi41Mzg2IDIuNDYwMzRaTTEzLjkyNzggMy4yOTM4NUMxMy43NzQzIDMuMTQwNCAxMy41MjU2IDMuMTQwNCAxMy4zNzIxIDMuMjkzODVMMy42MzM2NiAxMy4wMzIzQzMuNTY4OTEgMTMuMDk3IDMuNTI4ODEgMTMuMTgyNCAzLjUyMDI4IDEzLjI3MzVMMy4xODk0OSAxNi44MTA1TDYuNzI2NDYgMTYuNDc5N0M2LjgxNzYzIDE2LjQ3MTIgNi45MDI5NiAxNi40MzExIDYuOTY3NyAxNi4zNjYzTDE2LjcwNjIgNi42Mjc4OUMxNi44NTk2IDYuNDc0NDUgMTYuODU5NiA2LjIyNTY2IDE2LjcwNjIgNi4wNzIyMkwxMy45Mjc4IDMuMjkzODVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjYyMjQgOS41NDUxOEwxMC40NTQ4IDUuMzc3NjJMMTEuMjg4MyA0LjU0NDExTDE1LjQ1NTkgOC43MTE2N0wxNC42MjI0IDkuNTQ1MThaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(19)),o=l(n(2)),i=l(n(0)),a=l(n(1)),s=l(n(3)),u=l(n(4)),c=n(22);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="select",e.lineWidth=0,e.fillColor="rgba(230, 100, 100, 0.4)",e.eleContainerColor="rgb(0, 0, 0)",e.eleContainerWidth=2,e.eleContainerPadding=3,e.activate=!1,e.selectedOpIds=[],e.inProgressSelectedOpIds=[],e.description="选择操作工具。\n首先使用op:select:activate设置画布为选择模式。通过。然后画布会监听鼠标动作，生成选择框。具体用法如下：",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"select:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置选择框线段宽度"}},"select:fill:color":{value:this.setFillColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:stroke:color":{value:this.setStrokeColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:eleContainer:color":{value:this.setEleContainerColor.bind(this),information:{args:"color: ColorString",message:"设置被选中元素包含盒颜色"}},"select:eleContainer:width":{value:this.setEleContainerWidth.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒线段宽度"}},"select:eleContainerPadding":{value:this.setEleContainerPadding.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒的padding"}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this)),this.opsManager.hooks.pageChange.tap("pageChange",this.handlePageChange.bind(this))}},{key:"eventsToEmit",value:function(){return{activate:{args:"",message:"选择工具激活时，会发送此事件"},change:{args:"prevSelectedOpIds: string[], currSelectedOpIds: string[]",message:"选择元素发生变化时，发送该事件"}}}},{key:"handlePageChange",value:function(e){e.uid===this.app.account&&this.selectedOpIds.length>0&&this.dispatch(this.getSnapshot([]))}},{key:"handleOpChange",value:function(e){var t,n;"select"!==e&&"select"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&this.dispatch(this.getSnapshot([])),"select"===e&&"select"!==(null===(n=this.opsManager.currOp)||void 0===n?void 0:n.type)&&this.emit("activate"),this.beginBatch()}},{key:"postMouseUp",value:function(e){this.dispatch(this.getSnapshot(e)),this.lastSelectedOpIds=e}},{key:"postClick",value:function(e){if(0===e.length&&(new Date).valueOf()-this.opsManager.opMap.text.blurAt<100)return;this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return{type:this.type,points:this.points.slice(),inProgress:!1,selectedOpIds:e.slice(),skipUndo:!0}}},{key:"draw",value:function(e,t){this.drawSelectBox(e,t),this.drawSelectedElementBox(e,t)}},{key:"drawSelectBox",value:function(e,t){var n=e.data;if(n.inProgress&&n.points.length>=2){var r=(0,c.getBoundaryBoxFromTwoPoints)(n.points[0],n.points[n.points.length-1]),o=r.sx,i=r.sy,a=r.w,s=r.h;t.beginPath(),this.strokeColor&&this.lineWidth&&(t.strokeStyle=this.strokeColor,t.lineWidth=this.lineWidth,t.strokeRect(o,i,a,s)),this.fillColor&&(t.fillStyle=this.fillColor,t.fillRect(o,i,a,s))}}},{key:"drawSelectedElementBox",value:function(e,n){var o=this,i=e.data,a=i.selectedOpIds.filter((function(e){return o.drawOpsOfPage[e]})),s=this.eleContainerPadding;if(0!==a.length){var u=a.map((function(e){var t=o.drawOpsOfPage[e];return(0,c.getTransformedBoundary)(t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)}));i.inProgress||(u=[u.reduce((function(e,t){return(0,c.combineBoundary)(e,t)}))]),n.strokeStyle=this.eleContainerColor,n.lineWidth=this.eleContainerWidth,n.fillStyle=this.eleContainerColor;var l=!0,d=!1,f=void 0;try{for(var h,p=(0,r.default)(u);!(l=(h=p.next()).done);l=!0){var v=h.value;n.beginPath(),n.strokeRect(v.sx-s,v.sy-s,v.w+2*s,v.h+2*s),!i.inProgress&&this.opsManager.currOp instanceof t&&(n.fillRect(v.sx-s-5,v.sy-s-5,10,10),n.fillRect(v.sx+v.w+s-5,v.sy+v.h+s-5,10,10),n.fillRect(v.sx+v.w+s-5,v.sy-s-5,10,10),n.fillRect(v.sx-s-5,v.sy+v.h+s-5,10,10))}}catch(e){d=!0,f=e}finally{try{!l&&p.return&&p.return()}finally{if(d)throw f}}}}},{key:"setSelectedOpIds",value:function(e){this.selectedOpIds.join(",")!==e.join(",")&&(this.emit("change",this.selectedOpIds.slice(),e.slice()),this.opsManager.hooks.selectChange.call(this.selectedOpIds.slice(),e.slice()),this.selectedOpIds=e)}},{key:"setInProgressSelectedOpIds",value:function(e){this.inProgressSelectedOpIds=e.slice()}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setFillColor",value:function(e){this.fillColor=e}},{key:"setStrokeColor",value:function(e){this.strokeColor=e}},{key:"setEleContainerColor",value:function(e){this.eleContainerColor=e}},{key:"setEleContainerWidth",value:function(e){this.eleContainerWidth=e}},{key:"setEleContainerPadding",value:function(e){this.eleContainerPadding=e}}]),t}(l(n(141)).default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FONTSIZE=void 0;var r=a(n(9)),o=a(n(17)),i=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}t.DEFAULT_FONTSIZE=32;t.default=function e(t){var n=this;(0,i.default)(this,e),this.setAppConfig=function(e){if(0===(0,o.default)(e).length)console.error("白板--\x3e","调用了setAppConfig, 但传入的参数为空",e);else for(var t in e)n.config.hasOwnProperty(t)?"canvas_bg_color"===t&&(n.config.canvas_bg_color=e.canvas_bg_color,n.app.container.setBackgroundColor(),n.app.previewFactory.setBackgroundColor()):(console.error("白板--\x3e","setAppConfig传入的参数键值"+t+"不是有效的配置项"),console.error("白板--\x3e","目前支持的配置项有："+(0,o.default)(n.config)));(0,r.default)(n.config,e)},this.getAppConfig=function(){return n.config},this.app=t,this.config={canvas_bg_color:"#f5f5f7"}}},function(e,t,n){n(85),e.exports=n(5).Object.assign},function(e,t,n){var r=n(6);r(r.S+r.F,"Object",{assign:n(86)})},function(e,t,n){"use strict";var r=n(10),o=n(24),i=n(46),a=n(30),s=n(21),u=n(55),c=Object.assign;e.exports=!c||n(18)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=s(e),c=arguments.length,l=1,d=i.f,f=a.f;c>l;)for(var h,p=u(arguments[l++]),v=d?o(p).concat(d(p)):o(p),y=v.length,g=0;y>g;)h=v[g++],r&&!f.call(p,h)||(n[h]=p[h]);return n}:c},function(e,t,n){var r=n(20),o=n(56),i=n(88);e.exports=function(e){return function(t,n,a){var s,u=r(t),c=o(u.length),l=i(a,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(42),o=Math.max,i=Math.min;e.exports=function(e,t){return(e=r(e))<0?o(e+t,0):i(e,t)}},function(e,t,n){n(90),e.exports=n(5).Object.keys},function(e,t,n){var r=n(21),o=n(24);n(60)("keys",(function(){return function(e){return o(r(e))}}))},function(e,t,n){e.exports={default:n(92),__esModule:!0}},function(e,t,n){n(93);var r=n(5).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(6);r(r.S+r.F*!n(10),"Object",{defineProperty:n(12).f})},function(e,t,n){var r=n(42),o=n(41);e.exports=function(e){return function(t,n){var i,a,s=String(o(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(i=s.charCodeAt(u))<55296||i>56319||u+1===c||(a=s.charCodeAt(u+1))<56320||a>57343?e?s.charAt(u):i:e?s.slice(u,u+2):a-56320+(i-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(36),o=n(25),i=n(32),a={};n(15)(a,n(8)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(a,{next:o(1,n)}),i(e,t+" Iterator")}},function(e,t,n){var r=n(75),o=n(8)("iterator"),i=n(27);e.exports=n(5).getIteratorMethod=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[r(e)]}},function(e,t,n){"use strict";var r=n(98),o=n(76),i=n(27),a=n(20);e.exports=n(57)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t,n){e.exports={default:n(171),__esModule:!0}},function(e,t,n){var r=n(15);e.exports=function(e,t,n){for(var o in t)n&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){n(104),e.exports=n(5).Object.getPrototypeOf},function(e,t,n){var r=n(21),o=n(65);n(60)("getPrototypeOf",(function(){return function(e){return o(r(e))}}))},function(e,t,n){e.exports={default:n(106),__esModule:!0}},function(e,t,n){n(31),n(37),e.exports=n(48).f("iterator")},function(e,t,n){n(108),n(58),n(111),n(112),e.exports=n(5).Symbol},function(e,t,n){"use strict";var r=n(7),o=n(16),i=n(10),a=n(6),s=n(64),u=n(61).KEY,c=n(18),l=n(44),d=n(32),f=n(29),h=n(8),p=n(48),v=n(49),y=n(109),g=n(78),m=n(14),b=n(13),w=n(21),_=n(20),x=n(40),k=n(25),O=n(36),M=n(110),S=n(68),P=n(46),I=n(12),C=n(24),T=S.f,E=I.f,j=M.f,A=r.Symbol,D=r.JSON,N=D&&D.stringify,L=h("_hidden"),R=h("toPrimitive"),B={}.propertyIsEnumerable,z=l("symbol-registry"),F=l("symbols"),U=l("op-symbols"),W=Object.prototype,H="function"==typeof A&&!!P.f,Y=r.QObject,Q=!Y||!Y.prototype||!Y.prototype.findChild,X=i&&c((function(){return 7!=O(E({},"a",{get:function(){return E(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=T(W,t);r&&delete W[t],E(e,t,n),r&&e!==W&&E(W,t,r)}:E,Z=function(e){var t=F[e]=O(A.prototype);return t._k=e,t},G=H&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},q=function(e,t,n){return e===W&&q(U,t,n),m(e),t=x(t,!0),m(n),o(F,t)?(n.enumerable?(o(e,L)&&e[L][t]&&(e[L][t]=!1),n=O(n,{enumerable:k(0,!1)})):(o(e,L)||E(e,L,k(1,{})),e[L][t]=!0),X(e,t,n)):E(e,t,n)},K=function(e,t){m(e);for(var n,r=y(t=_(t)),o=0,i=r.length;i>o;)q(e,n=r[o++],t[n]);return e},J=function(e){var t=B.call(this,e=x(e,!0));return!(this===W&&o(F,e)&&!o(U,e))&&(!(t||!o(this,e)||!o(F,e)||o(this,L)&&this[L][e])||t)},V=function(e,t){if(e=_(e),t=x(t,!0),e!==W||!o(F,t)||o(U,t)){var n=T(e,t);return!n||!o(F,t)||o(e,L)&&e[L][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=j(_(e)),r=[],i=0;n.length>i;)o(F,t=n[i++])||t==L||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===W,r=j(n?U:_(e)),i=[],a=0;r.length>a;)!o(F,t=r[a++])||n&&!o(W,t)||i.push(F[t]);return i};H||(s((A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===W&&t.call(U,n),o(this,L)&&o(this[L],e)&&(this[L][e]=!1),X(this,e,k(1,n))};return i&&Q&&X(W,e,{configurable:!0,set:t}),Z(e)}).prototype,"toString",(function(){return this._k})),S.f=V,I.f=q,n(67).f=M.f=$,n(30).f=J,P.f=ee,i&&!n(26)&&s(W,"propertyIsEnumerable",J,!0),p.f=function(e){return Z(h(e))}),a(a.G+a.W+a.F*!H,{Symbol:A});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)h(te[ne++]);for(var re=C(h.store),oe=0;re.length>oe;)v(re[oe++]);a(a.S+a.F*!H,"Symbol",{for:function(e){return o(z,e+="")?z[e]:z[e]=A(e)},keyFor:function(e){if(!G(e))throw TypeError(e+" is not a symbol!");for(var t in z)if(z[t]===e)return t},useSetter:function(){Q=!0},useSimple:function(){Q=!1}}),a(a.S+a.F*!H,"Object",{create:function(e,t){return void 0===t?O(e):K(O(e),t)},defineProperty:q,defineProperties:K,getOwnPropertyDescriptor:V,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var ie=c((function(){P.f(1)}));a(a.S+a.F*ie,"Object",{getOwnPropertySymbols:function(e){return P.f(w(e))}}),D&&a(a.S+a.F*(!H||c((function(){var e=A();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=t=r[1],(b(t)||void 0!==e)&&!G(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!G(t))return t}),r[1]=t,N.apply(D,r)}}),A.prototype[R]||n(15)(A.prototype,R,A.prototype.valueOf),d(A,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},function(e,t,n){var r=n(24),o=n(46),i=n(30);e.exports=function(e){var t=r(e),n=o.f;if(n)for(var a,s=n(e),u=i.f,c=0;s.length>c;)u.call(e,a=s[c++])&&t.push(a);return t}},function(e,t,n){var r=n(20),o=n(67).f,i={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==i.call(e)?function(e){try{return o(e)}catch(e){return a.slice()}}(e):o(r(e))}},function(e,t,n){n(49)("asyncIterator")},function(e,t,n){n(49)("observable")},function(e,t,n){e.exports={default:n(114),__esModule:!0}},function(e,t,n){n(115),e.exports=n(5).Object.setPrototypeOf},function(e,t,n){var r=n(6);r(r.S,"Object",{setPrototypeOf:n(116).set})},function(e,t,n){var r=n(13),o=n(14),i=function(e,t){if(o(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(23)(Function.call,n(68).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return i(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:i}},function(e,t,n){n(118);var r=n(5).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){var r=n(6);r(r.S,"Object",{create:n(36)})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.snapshotOutOfNormalFlowTypes=["background"]},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},function(e,t,n){var r=n(5),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},function(e,t,n){"use strict";var r=n(39);function o(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new o(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(50)),o=s(n(17)),i=s(n(9)),a=s(n(33));function s(e){return e&&e.__esModule?e:{default:e}}t.default={isUndefined:function(e){return void 0===e},isDOM:function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,a.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,a.default)(e))&&1===e.nodeType&&"string"==typeof e.nodeName},isValidString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isValidArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)&&e.length},isValidHexColor:function(e){return/^#[0-9abcdef]{6}$/gi.test(e)},isObject:function(e){return"object"===(void 0===e?"undefined":(0,a.default)(e))},isValidObject:function(e){if("object"!==(void 0===e?"undefined":(0,a.default)(e)))return!1;if(e=(0,i.default)({},e),o.default&&0===(0,o.default)(e).length)return!1;try{return"{}"!==(0,r.default)(e)}catch(e){return!1}},validate:function(e,t,n){var i=this,a=[];(0,o.default)(n).map((function(e){var o=n[e],s=t[e];if(i.isUndefined(s))o.isRequire&&a.push({key:e,message:e+" is required"});else{switch(o.type.toLowerCase()){case"dom":i.isDOM(s)||a.push({key:e,message:"Expected dom, but get other type"});break;case"string":i.isValidString(s)||a.push({key:e,message:"Expected string, but get other type"});break;case"boolean":i.isBoolean(s)||a.push({key:e,message:"Expected boolean, but get other type"});break;case"function":i.isFunction(s)||a.push({key:e,message:"Expected function, but get other type"});break;case"number":i.isNumber(s)||a.push({key:e,message:"Expected number, but get other type"});break;case"object":i.isObject(s)||a.push({key:e,message:"Expected object, but get other type"});break;case"array":i.isValidArray(s)||a.push({key:e,message:"Expected array, but get other type"});break;default:a.push({key:e,message:e+"的类型未知: "+o.type.toLowerCase()})}o.enum&&!o.enum.includes(s)&&a.push({key:e,message:"Expected "+e+" to be one of "+(0,r.default)(o.enum)+", but it is not"})}})),a.length>0&&(console.error("白板--\x3e",e+"参数异常"),console.error("白板--\x3e","错误信息：",a),console.error("白板--\x3e","参数为：",t))}}},,,function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,d=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&h())}function h(){if(!l){var e=s(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},,function(e,t,n){var r=n(14);e.exports=function(e,t,n,o){try{return o?t(r(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&r(i.call(e)),t}}},function(e,t,n){var r=n(27),o=n(8)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||i[o]===e)}},function(e,t,n){var r=n(8)("iterator"),o=!1;try{var i=[7][r]();i.return=function(){o=!0},Array.from(i,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var i=[7],a=i[r]();a.next=function(){return{done:n=!0}},i[r]=function(){return a},e(i)}catch(e){}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=function(e,t,n){e.addEventListener(t,n)},t.off=function(e,t,n){e.removeEventListener(t,n)}},function(e,t,n){"use strict";var r=n(12).f,o=n(36),i=n(100),a=n(23),s=n(101),u=n(66),c=n(57),l=n(76),d=n(133),f=n(10),h=n(61).fastKey,p=n(102),v=f?"_s":"size",y=function(e,t){var n,r=h(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){s(e,l,t,"_i"),e._t=t,e._i=o(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&u(r,n,e[c],e)}));return i(l.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=p(this,t),r=y(n,e);if(r){var o=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=o),o&&(o.p=i),n._f==r&&(n._f=o),n._l==r&&(n._l=i),n[v]--}return!!r},forEach:function(e){p(this,t);for(var n,r=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(p(this,t),e)}}),f&&r(l.prototype,"size",{get:function(){return p(this,t)[v]}}),l},def:function(e,t,n){var r,o,i=y(e,t);return i?i.v=n:(e._l=i={i:o=h(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=i),r&&(r.n=i),e[v]++,"F"!==o&&(e._i[o]=i)),e},getEntry:y,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),d(t)}}},function(e,t,n){"use strict";var r=n(7),o=n(5),i=n(12),a=n(10),s=n(8)("species");e.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];a&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var r=n(7),o=n(6),i=n(61),a=n(18),s=n(15),u=n(100),c=n(66),l=n(101),d=n(13),f=n(32),h=n(12).f,p=n(173)(0),v=n(10);e.exports=function(e,t,n,y,g,m){var b=r[e],w=b,_=g?"set":"add",x=w&&w.prototype,k={};return v&&"function"==typeof w&&(m||x.forEach&&!a((function(){(new w).entries().next()})))?(w=t((function(t,n){l(t,w,e,"_c"),t._c=new b,null!=n&&c(n,g,t[_],t)})),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in x)||m&&"clear"==e||s(w.prototype,e,(function(n,r){if(l(this,w,e),!t&&m&&!d(n))return"get"==e&&void 0;var o=this._c[e](0===n?0:n,r);return t?this:o}))})),m||h(w.prototype,"size",{get:function(){return this._c.size}})):(w=y.getConstructor(t,e,g,_),u(w.prototype,n),i.NEED=!0),f(w,e),k[e]=w,o(o.G+o.W+o.F,k),m||y.setStrong(w,e,g),w}},function(e,t,n){var r=n(75),o=n(177);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return o(this)}}},function(e,t,n){"use strict";var r=n(6);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var r=n(6),o=n(39),i=n(23),a=n(66);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,s,u=arguments[1];return o(this),(t=void 0!==u)&&o(u),null==e?new this:(n=[],t?(r=0,s=i(u,arguments[2],2),a(e,!1,(function(e){n.push(s(e,r++))}))):a(e,!1,n.push,n),new this(n))}})}},function(e,t,n){"use strict";var r=u(n(2)),o=u(n(0)),i=u(n(1)),a=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(28),l=new(function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.resultReturns,o=e.onDone,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onResult:function(e,t,r){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+r()+"}\n"},resultReturns:r,onDone:o,rethrowIfPossible:i})}}]),t}(n(34))),d=function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncBailHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncBailHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(51)),o=h(n(19)),i=h(n(9)),a=h(n(2)),s=h(n(0)),u=h(n(1)),c=h(n(3)),l=h(n(4)),d=h(n(11)),f=n(22);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,s.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="pen",e.lineWidth=1,e.movedDuringMouseDown=!1,e.color="black",e.points=[],e.description="涂鸦操作工具。\n首先使用op:pen:activate设置画布为涂鸦模式。通过op:pen:lineWidth, op:pen:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,l.default)(t,e),(0,u.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"pen:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置涂鸦线段宽度"}},"pen:color":{value:this.setColor.bind(this),information:{args:"color: ColorString",message:"设置涂鸦颜色"}}}}},{key:"handleMouseMove",value:function(e,t,r){this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(81)+") -1 17, auto":document.body.style.cursor="auto",this.isMouseDown&&(this.points.push([t,r]),this.dispatch(this.getSnapshot(!0)),this.movedDuringMouseDown=!0)}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.points=[],this.points.push([t,n]),this.movedDuringMouseDown=!1}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.movedDuringMouseDown&&(this.points.push([t,n]),this.dispatch(this.getSnapshot(!1)),this.points=[])}},{key:"getSnapshot",value:function(e){var t={boundary:this.getBoundaryRect()};return(0,i.default)((0,i.default)({},t),{type:this.type,points:this.points.slice(),color:this.color,lineWidth:this.lineWidth,inProgress:e})}},{key:"getBoundaryRect",value:function(){if(0===this.points.length)throw new Error("涂鸦没有记录任何数据");var e=this.points[0][0],t=this.points[0][1],n=e,r=t,i=!0,a=!1,s=void 0;try{for(var u,c=(0,o.default)(this.points);!(i=(u=c.next()).done);i=!0){var l=u.value;e=Math.min(l[0],e),t=Math.min(l[1],t),n=Math.max(l[0],n),r=Math.max(l[1],r)}}catch(e){a=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw s}}return{sx:e,sy:t,w:n-e,h:r-t}}},{key:"draw",value:function(e,t){var n=e.data,o=n.points;t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,f.getTransformedPoint)(o[0],n.dx,n.dy,n.scaleX,n.scaleY)));for(var i=1;i<o.length;i++)t.lineTo.apply(t,(0,r.default)((0,f.getTransformedPoint)(o[i],n.dx,n.dy,n.scaleX,n.scaleY)));t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke()}},{key:"ifMouseOnOp",value:function(e,t,n){var o=this.app.container.ctx,i=e.data,a=i.points;o.beginPath(),o.moveTo.apply(o,(0,r.default)((0,f.getTransformedPoint)(a[0],i.dx,i.dy,i.scaleX,i.scaleY)));for(var s=1;s<a.length;s++)o.lineTo.apply(o,(0,r.default)((0,f.getTransformedPoint)(a[s],i.dx,i.dy,i.scaleX,i.scaleY)));return o.lineWidth=i.lineWidth+20,o.strokeStyle="rgba(0,0,0,0)",o.stroke(),o.isPointInStroke(t,n)}},{key:"setLineWidth",value:function(e){this.lineWidth=Number(e)}},{key:"setColor",value:function(e){this.color=e}}]),t}(d.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(51)),o=h(n(9)),i=h(n(2)),a=h(n(0)),s=h(n(1)),u=h(n(3)),c=h(n(4)),l=h(n(11)),d=n(22),f=n(77);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,a.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="line",e.lineWidth=1,e.movedDuringMouseDown=!1,e.color="black",e.points=[],e.description="绘制线段。\n首先使用op:line:activate设置画布为线段模式。通过op:line:lineWidth, op:line:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"line:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置线段宽度"}},"line:color":{value:this.setColor.bind(this),information:{args:"color: ColorString",message:"设置线段颜色"}}}}},{key:"handleMouseMove",value:function(e,t,r){this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(81)+") -1 17, auto":document.body.style.cursor="auto",this.isMouseDown&&(this.points.push([t,r]),this.dispatch(this.getSnapshot(!0)),this.movedDuringMouseDown=!0)}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.points=[],this.points.push([t,n]),this.movedDuringMouseDown=!1}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.movedDuringMouseDown&&(this.points.push([t,n]),this.dispatch(this.getSnapshot(!1)),this.points=[])}},{key:"getSnapshot",value:function(e){var t={boundary:this.getBoundaryRect()};return(0,o.default)((0,o.default)({},t),{type:this.type,points:this.points,color:this.color,lineWidth:this.lineWidth,inProgress:e})}},{key:"getBoundaryRect",value:function(){if(0===this.points.length)throw new Error("涂鸦没有记录任何数据");var e=(0,f.min)(this.points[0][0],this.points[this.points.length-1][0]),t=(0,f.min)(this.points[0][1],this.points[this.points.length-1][1]);return{sx:e,sy:t,w:(0,f.max)(this.points[0][0],this.points[this.points.length-1][0])-e,h:(0,f.max)(this.points[0][1],this.points[this.points.length-1][1])-t}}},{key:"draw",value:function(e,t){var n=e.data,o=n.points;t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,d.getTransformedPoint)(o[0],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,d.getTransformedPoint)(o[o.length-1],n.dx,n.dy,n.scaleX,n.scaleY))),t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke()}},{key:"ifMouseOnOp",value:function(e,t,n){var o=this.app.container.ctx,i=e.data,a=i.points;return o.beginPath(),o.moveTo.apply(o,(0,r.default)((0,d.getTransformedPoint)(a[0],i.dx,i.dy,i.scaleX,i.scaleY))),o.lineTo.apply(o,(0,r.default)((0,d.getTransformedPoint)(a[a.length-1],i.dx,i.dy,i.scaleX,i.scaleY))),o.strokeStyle="rgba(0,0,0,0)",o.lineWidth=i.lineWidth+20,o.stroke(),o.isPointInStroke(t,n)}},{key:"setLineWidth",value:function(e){this.lineWidth=Number(e)}},{key:"setColor",value:function(e){this.color=e}}]),t}(l.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),o=l(n(0)),i=l(n(1)),a=l(n(3)),s=l(n(4)),u=l(n(11)),c=n(142);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.points=[],e.lastSelectedOpIds=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"postMouseUp",value:function(e){}},{key:"postClick",value:function(e){}},{key:"postMouseMove",value:function(e,t){}},{key:"handleMouseDown",value:function(e,t,n){this.dispatch(this.getSelectionSnapshot(!1,[])),this.points=[[t,n]];var r=(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);this.dispatch(this.getSelectionSnapshot(!0,r)),this.lastSelectedOpIds=r}},{key:"handleMouseMove",value:function(e,t,n){this.isMouseDown?this.points.push([t,n]):this.points=[[t,n]];var r=void 0;if(this.isMouseDown)r=(0,c.findOpsUnderRect)(this.points,this.drawOpsOfPage),this.dispatch(this.getSelectionSnapshot(!0,r));else{var o=(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);r=(0,c.arrayDeduce)(o,this.opsManager.selectedOpIds),(0,c.idsChanged)(r,this.lastSelectedOpIds)&&this.dispatch(this.getSelectionSnapshot(!0,r))}this.lastSelectedOpIds=r,this.postMouseMove(e,r)}},{key:"handleMouseUp",value:function(e,t,n){if(this.isMouseDown){var r=this.isMouseDown?(0,c.findOpsUnderRect)(this.points,this.drawOpsOfPage):(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);this.postMouseUp(r)}}},{key:"handleClick",value:function(e,t,n){this.points=[[t,n]];var r=(0,c.findOpsUnderMouse)(this.points,this.drawOpsOfPage,this.opsManager);this.postClick(r)}},{key:"getSelectionSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1];return{type:"select",points:this.points.slice(),inProgress:e,selectedOpIds:t.slice(),skipUndo:!0}}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayDeduce=t.idsChanged=t.snapshotSelectable=t.findOpsUnderMouse=t.findOpsUnderRect=void 0;var r=s(n(19)),o=s(n(17)),i=s(n(47)),a=n(22);function s(e){return e&&e.__esModule?e:{default:e}}t.findOpsUnderRect=function(e,t){if(0===e.length)return[];var n=(0,a.getBoundaryBoxFromTwoPoints)(e[0],e[e.length-1]),r=[];for(var o in t){var i=t[o];if(i.data.boundary&&u(i)){var s=(0,a.getTransformedBoundary)(i.data.boundary,i.data.dx,i.data.dy,i.data.scaleX,i.data.scaleY);(0,a.rectCollide)(s,n)&&r.push(o)}}return r},t.findOpsUnderMouse=function(e,t,n){if(0===e.length)return[];for(var r=(0,a.getBoundaryBoxFromTwoPoints)(e[0],e[e.length-1]),s=(0,i.default)(e[e.length-1],2),c=s[0],l=s[1],d=(0,o.default)(t),f=d.length-1;f>=0;f--){var h=t[d[f]],p=n.opMap[h.data.type];if(h.data.boundary&&u(h)){var v=(0,a.getTransformedBoundary)(h.data.boundary,h.data.dx,h.data.dy,h.data.scaleX,h.data.scaleY);if((0,a.rectCollide)(v,r)){if(!p||!("ifMouseOnOp"in p))return[d[f]];if(p.ifMouseOnOp(h,c,l))return[d[f]]}}}return[]};var u=t.snapshotSelectable=function(e){return!e.data["non-selectable"]&&!e.data.locked};t.idsChanged=function(e,t){if(e.length!==t.length)return!0;var n=!0,o=!1,i=void 0;try{for(var a,s=(0,r.default)(e);!(n=(a=s.next()).done);n=!0){var u=a.value;if(-1===t.indexOf(u))return!0}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return!1},t.arrayDeduce=function(e,t){var n=[],o=!0,i=!1,a=void 0;try{for(var s,u=(0,r.default)(e);!(o=(s=u.next()).done);o=!0){var c=s.value;-1===t.indexOf(c)&&n.push(c)}}catch(e){i=!0,a=e}finally{try{!o&&u.return&&u.return()}finally{if(i)throw a}}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getImageProperPosition=t.draw=t.addImage=void 0;var r=n(144);t.addImage=function(e,t,n){if((0,r.resourceLoaded)(t)){var o=(0,r.getResource)(t),i=(null==n?void 0:n.width)?n.width:o.width,a=(null==n?void 0:n.height)?n.height:o.height;e.dispatchImage(t,i,a)}else{var s=e.opsManager.currPage;s.addWaitingResource(t),(0,r.fetchResource)(t,(function(r){var o=(null==n?void 0:n.width)?n.width:r.width,i=(null==n?void 0:n.height)?n.height:r.height;e.dispatchImage(t,o,i,s),s.removeWaitingResource(t)}))}},t.draw=function(e,t,n,o){var i=o.page,a=o.div,s=o.preview,u=o.id;if((0,r.resourceLoaded)(t)&&!s&&a&&u){var c=a.querySelector("[id='image-"+u+"']");c||((c=document.createElement("img")).id="image-"+u,c.style.userSelect="none",c.style.pointerEvents="none",c.style.position="absolute",c.src=t,a.appendChild(c)),c.width=n.w,c.height=n.h,c.style.left=n.sx+"px",c.style.top=n.sy+"px"}else(0,r.resourceLoaded)(t)?e.drawImage((0,r.getResource)(t),n.sx,n.sy,n.w,n.h):(i.addWaitingResource(t),(0,r.fetchResource)(t,(function(){i.removeWaitingResource(t)})))},t.getImageProperPosition=function(e,t,n){var r=e.app.container.width-e.app.sanityArea.left-e.app.sanityArea.right,o=e.app.container.height-e.app.sanityArea.top-e.app.sanityArea.bottom;return t>r&&n<o?(n=n*r/t,t=r):t<r&&n>o?(t=t*o/n,n=o):t>r&&n>o&&(t/n>r/o?(n=n*r/t,t=r):(t=t*o/n,n=o)),t/=e.app.camera.scale,n/=e.app.camera.scale,{sx:-t/2+(e.app.sanityArea.left/2-e.app.sanityArea.right/2)/e.app.camera.scale,sy:-n/2+(e.app.sanityArea.top/2-e.app.sanityArea.bottom/2)/e.app.camera.scale,width:t,height:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getResource=t.resourceLoaded=t.fetchResource=void 0;var r,o=n(19),i=(r=o)&&r.__esModule?r:{default:r};var a={},s={},u=(t.fetchResource=function(e,t){a.hasOwnProperty(e)||(a[e]=new Image,a[e].src=e,a[e].setAttribute("crossorigin","anonymous")),u(e,t)},function(e,t){s[e]=s[e]||[],s[e].push(t);var n=a[e];n.onload=function(){var t=s[e]||[],r=!0,o=!1,a=void 0;try{for(var u,c=(0,i.default)(t);!(r=(u=c.next()).done);r=!0){(0,u.value)(n)}}catch(e){o=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}}});t.resourceLoaded=function(e){var t=a[e];return t&&t.complete&&t.width>0&&t.height>0},t.getResource=function(e){return a[e]}},function(e,t,n){var r=n(14),o=n(39),i=n(8)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[i])?t:o(n)}},function(e,t,n){var r,o,i,a=n(23),s=n(238),u=n(74),c=n(54),l=n(7),d=l.process,f=l.setImmediate,h=l.clearImmediate,p=l.MessageChannel,v=l.Dispatch,y=0,g={},m=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){m.call(e.data)};f&&h||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++y]=function(){s("function"==typeof e?e:Function(e),t)},r(y),y},h=function(e){delete g[e]},"process"==n(35)(d)?r=function(e){d.nextTick(a(m,e,1))}:v&&v.now?r=function(e){v.now(a(m,e,1))}:p?(i=(o=new p).port2,o.port1.onmessage=b,r=a(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),m.call(e)}}:function(e){setTimeout(a(m,e,1),0)}),e.exports={set:f,clear:h}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(14),o=n(13),i=n(122);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},,,,function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},o=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,a=String(e).replace(o,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<i;u=r[++n])v(u)||!w(u)?a+=" "+u:a+=" "+s(u);return a},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),o=!0}return n.apply(this,arguments)}};var i,a={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&k(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return g(o)||(o=l(e,o,r)),o}var i=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(y(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,n);if(i)return i;var a=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return d(n);if(0===a.length){if(k(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(_(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return d(n)}var c,w="",O=!1,M=["{","}"];(h(n)&&(O=!0,M=["[","]"]),k(n))&&(w=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(w=" "+RegExp.prototype.toString.call(n)),_(n)&&(w=" "+Date.prototype.toUTCString.call(n)),x(n)&&(w=" "+d(n)),0!==a.length||O&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=O?function(e,t,n,r,o){for(var i=[],a=0,s=t.length;a<s;++a)I(t,String(a))?i.push(f(e,t,n,r,String(a),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(f(e,t,n,r,o,!0))})),i}(e,n,r,s,a):a.map((function(t){return f(e,n,r,s,t,O)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,w,M)):M[0]+w+M[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,o,i){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),I(r,o)||(a="["+o+"]"),s||(e.seen.indexOf(u.value)<0?(s=v(n)?l(e,u.value,null):l(e,u.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),m(a)){if(i&&o.match(/^\d+$/))return s;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function h(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function g(e){return"string"==typeof e}function m(e){return void 0===e}function b(e){return w(e)&&"[object RegExp]"===O(e)}function w(e){return"object"==typeof e&&null!==e}function _(e){return w(e)&&"[object Date]"===O(e)}function x(e){return w(e)&&("[object Error]"===O(e)||e instanceof Error)}function k(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function M(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(m(i)&&(i=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!a[n])if(new RegExp("\\b"+n+"\\b","i").test(i)){var r=e.pid;a[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else a[n]=function(){};return a[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=p,t.isNull=v,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=b,t.isObject=w,t.isDate=_,t.isError=x,t.isFunction=k,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(180);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){var e=new Date,t=[M(e.getHours()),M(e.getMinutes()),M(e.getSeconds())].join(":");return[e.getDate(),S[e.getMonth()],t].join(" ")}function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",P(),t.format.apply(t,arguments))},t.inherits=n(181),t._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var C="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function T(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(C&&e[C]){var t;if("function"!=typeof(t=e[C]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,C,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,o)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),C&&Object.defineProperty(t,C,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=C,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var o=n.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,a=function(){return o.apply(i,arguments)};t.apply(this,n).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(T,t,a)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(126))},function(e,t,n){e.exports={default:n(193),__esModule:!0}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var r=m(n(9)),o=m(n(17)),i=m(n(0)),a=m(n(1)),s=m(n(158)),u=m(n(168)),c=m(n(228)),l=m(n(229)),d=m(n(232)),f=m(n(233)),h=m(n(243)),p=m(n(83)),v=m(n(244)),y=m(n(123)),g=m(n(245));function m(e){return e&&e.__esModule?e:{default:e}}var b=function(){function e(t){(0,i.default)(this,e),this.isRecordPlayer=!1,this.editEnabled=!1,this.isSynchronizing=!1,this.sanityArea={left:16,right:16,top:16,bottom:16},this.account=t.account,this.ownerAccount=t.ownerAccount,this.platform=t.platform,this.configInstance=new p.default(this),this.dispatcher=new c.default,this.opsManager=new u.default(this),this.opsManager.extendDefaultOps(),this.connector=new d.default(this,t.connector),this.container=new s.default(this),this.room=new l.default(this,this.connector),this.container.addOpsManager(this.opsManager),this.opsManager.addContainer(this.container),this.previewFactory=new f.default(this),this.camera=new v.default(this),this.isRecordPlayer=!!t.isRecordPlayer,t.isRecordPlayer&&(this.player=new g.default(this)),this.account!==this.ownerAccount||t.isRecordPlayer||(this.recovery=new h.default(this,t.channel)),this.setContainer(t.container)}return(0,a.default)(e,[{key:"setAppConfig",value:function(e){this.configInstance.setAppConfig(e)}},{key:"setContainer",value:function(e){e.innerHTML="",this.container.appendTo(e)}},{key:"readyToSyncData",value:function(){var e=this;if(this.room.reset(),this.isSynchronizing=!0,this.emit("event:editable:change",this.editable),this.account===this.ownerAccount){0;var t=this.recovery.recover();t.forEach((function(t){e.room.dispatch(t,!1)})),this.opsManager.resetUndoRedoCount(),this.connector.sendForceSyncRequest(t),setTimeout((function(){e.isSynchronizing=!1,e.emit("event:editable:change",e.editable),e.emit("event:sync_finished")}),50)}else this.connector.sendSyncRequest()}},{key:"resetState",value:function(){this.room.reset()}},{key:"addDoc",value:function(e){y.default.validate("drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0},urlList:{type:"array",isRequire:!0}});var t=e.docName,n=e.urlList,r=(0,o.default)(this.room.boards).filter((function(e){return e.startsWith(t)})).length;0===r?this.gotoBoard(t):this.gotoBoard(t+"-"+r);for(var i=0;i<n.length;i++)this.setPageBackground(n[i]),i!==n.length-1&&this.addPage();this.gotoPage(0)}},{key:"setPageBackground",value:function(e){this.emit("op:background:imageUpload",e)}},{key:"setSanityArea",value:function(e){(0,r.default)(this.sanityArea,e)}},{key:"setTool",value:function(e){this.emit("op:"+e+":activate")}},{key:"setFontsize",value:function(e){this.emit("op:text:fontsize",e)}},{key:"setColor",value:function(e,t){t?"penClass"===t?(this.emit("op:pen:color",e),this.emit("op:line:color",e),this.emit("op:pen-arrow:color",e),this.emit("op:line-arrow:color",e)):"shapeClass"===t?(this.emit("op:rect:stroke:color",e),this.emit("op:rect:fill:color",e),this.emit("op:ellipse:stroke:color",e),this.emit("op:ellipse:fill:color",e)):this.emit("op:"+t+":color",e):(this.emit("op:pen:color",e),this.emit("op:line:color",e),this.emit("op:pen-arrow:color",e),this.emit("op:line-arrow:color",e),this.emit("op:rect:stroke:color",e),this.emit("op:rect:fill:color",e),this.emit("op:ellipse:stroke:color",e),this.emit("op:ellipse:fill:color",e))}},{key:"setShapeFill",value:function(e,t){if(t)if("rect"===t)this.emit("op:rect:isFill",e);else{if("ellipse"!==t)throw new Error("尝试设置图形是否填充，但是图形找不到: "+t);this.emit("op:ellipse:isFill",e)}else this.emit("op:rect:isFill",e),this.emit("op:ellipse:isFill",e)}},{key:"setWidth",value:function(e,t){t?"penClass"===t?(this.emit("op:pen:width",e),this.emit("op:line:width",e),this.emit("op:pen-arrow:width",e),this.emit("op:line-arrow:width",e)):"shapeClass"===t?(this.emit("op:rect:width",e),this.emit("op:ellipse:width",e)):this.emit("op:"+t+":width",e):(this.emit("op:pen:width",e),this.emit("op:line:width",e),this.emit("op:pen-arrow:width",e),this.emit("op:line-arrow:width",e),this.emit("op:rect:width",e),this.emit("op:ellipse:width",e))}},{key:"enableDraw",value:function(e){y.default.validate("drawPlugin.enableDraw",{editEnabled:e},{editEnabled:{type:"boolean",isRequire:!0}}),this.editEnabled=e,this.emit("event:editable:change",this.editable)}},{key:"undo",value:function(){this.emit("op:undo:exec")}},{key:"redo",value:function(){this.emit("op:redo:exec")}},{key:"clear",value:function(){this.emit("op:clear:exec")}},{key:"duplicate",value:function(){this.emit("op:duplicate:exec")}},{key:"deleteSelectedElements",value:function(){this.emit("op:delete:exec")}},{key:"addPage",value:function(e){this.emit("op:page:add",e)}},{key:"gotoPage",value:function(e){this.emit("op:page:goto",e)}},{key:"gotoBoard",value:function(e){y.default.validate("drawPlugin.gotoBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.emit("op:board:goto",e)}},{key:"deletePage",value:function(e){this.emit("op:page:delete",e)}},{key:"deleteBoard",value:function(e){y.default.validate("drawPlugin.deleteBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.emit("op:board:delete",e)}},{key:"getPageInfos",value:function(){return{pageNames:this.opsManager.currBoard.pageNames.slice(),currPage:this.opsManager.currBoard.currIndex}}},{key:"getBoardInfos",value:function(){return{boardNames:(0,o.default)(this.room.boards),currBoard:this.room.currIndex}}},{key:"getPreivews",value:function(e){return this.previewFactory.getPreviews(e)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=this.dispatcher).emit.apply(t,[e].concat(r))}},{key:"on",value:function(e,t){this.dispatcher.on(e,t)}},{key:"getOpDoc",value:function(e){return this.opsManager.getOpDoc(e)}},{key:"destroy",value:function(){this.dispatcher.destroy(),this.container.destroy(),document.body.style.cursor="auto"}},{key:"addRecordData",value:function(e){var t;null===(t=this.player)||void 0===t||t.addRecordData(e)}},{key:"seekTo",value:function(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e)}},{key:"editable",get:function(){return this.editEnabled&&!this.isSynchronizing}},{key:"appConfig",get:function(){return this.configInstance.getAppConfig()}}]),e}(),w={getInstance:function(e){return y.default.validate("DrawPlugin.instance",e,{account:{type:"string",isRequire:!0},nickname:{type:"string",isRequire:!0},ownerAccount:{type:"string",isRequire:!0},container:{type:"dom",isRequire:!0},channel:{type:"string",isRequire:!0},platform:{type:"string",isRequire:!0,enum:["android","ios","pc","mac","pad","web"]},connector:{type:"object",isRequire:!0}}),new b(e)}};t.App=b,t.default=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(51)),o=l(n(47)),i=l(n(19)),a=l(n(0)),s=l(n(1)),u=n(131),c=n(22);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){var n=this;(0,a.default)(this,e),this.elesToResize=[],this.top=0,this.left=0,this.keyPressed={},this.maybeClick=!1,this.mouseEventCache=[],this.isMouseDown=!1,this.sx=0,this.sy=0,this.lastMx=0,this.lastMy=0,this._resize=function(){var e=n.el.getBoundingClientRect(),t=!0,r=!1,o=void 0;try{for(var a,s=(0,i.default)(n.elesToResize);!(t=(a=s.next()).done);t=!0){var u=a.value;u instanceof HTMLCanvasElement?(u.width=e.width,u.height=e.height):(u.style.width=e.width+"px",u.style.height=e.height+"px")}}catch(e){r=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw o}}n.top=e.top,n.left=e.left,n.setElePosition(n.backgroundEl,"fixed"),n.setElePosition(n.domEl,"fixed"),n.setElePosition(n.textAreaEl,"fixed"),n.app.camera.updateTransformParams(),n.dispatcher.emit("container:resize")},this.getEventClientPos=function(e){var t=void 0,r=void 0;return e instanceof MouseEvent?(t=e.clientX,r=e.clientY):(t=e.touches[0].clientX,r=e.touches[0].clientY),t-=n.left,r-=n.top,n.app.camera.convertToPointInWorld(t,r)},this._contextmenu=function(e){e.preventDefault()},this._mousedown=function(e){if(!n.isMouseDown){var t=n.getEventClientPos(e),r=(0,o.default)(t,2),i=r[0],a=r[1];n.lastMx=i,n.lastMy=a,n.isMouseDown=!0,n.maybeClick=!0,n.sx=i,n.sy=a,n.mouseEventCache.push({type:"mousedown",args:[e,n.sx,n.sy]}),n.mouseEmitTimer=setTimeout((function(){n.maybeClick=!1,n._emitMouseEvents()}),150)}},this._mousemove=function(e){var t,r=n.getEventClientPos(e),i=(0,o.default)(r,2),a=i[0],s=i[1];n.lastMx=a,n.lastMy=s,n.maybeClick&&(n.maybeClick=(0,c.distSqrt)([a,s],[n.sx,n.sy])<=5),n.maybeClick?n.mouseEventCache.push({type:"mousemove",args:[e,a,s]}):(n.mouseEmitTimer&&(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n._emitMouseEvents()),null===(t=n.opsManager)||void 0===t||t.mousemove(e,a,s))},this._mouseup=function(e){var t,r,o=[n.lastMx,n.lastMy],i=o[0],a=o[1];n.maybeClick?(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n.mouseEventCache=[],n.maybeClick=!1,null===(r=n.opsManager)||void 0===r||r.click(e,i,a)):(n.mouseEmitTimer&&(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n._emitMouseEvents()),n.mouseEventCache=[],null===(t=n.opsManager)||void 0===t||t.mouseup(e,i,a)),n.isMouseDown=!1},this._mouseleave=function(e){var t,r=n.getEventClientPos(e),i=(0,o.default)(r,2),a=i[0],s=i[1];null===(t=n.opsManager)||void 0===t||t.mouseleave(e,a,s)},this._keyup=function(e){var t,r=e.key.toLocaleLowerCase();null===(t=n.opsManager)||void 0===t||t.keyup(e),n.keyPressed[r]=!1},this._keydown=function(e){var t,r=e.key.toLocaleLowerCase();n.keyPressed[r]=!0,null===(t=n.opsManager)||void 0===t||t.keydown(e)},this.app=t,this.dispatcher=t.dispatcher,this.el=document.createElement("div"),this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%",this.setBackgroundColor(),this.backgroundEl=this.setupDivElement("bg-el");var r=this.setupCanvasElement("bg-canvas");this.canvas=r.canvas,this.ctx=r.ctx,r=this.setupCanvasElement("front-canvas"),this.frontCanvas=r.canvas,this.frontCtx=r.ctx,this.domEl=this.setupDivElement("dom-el"),this.textAreaEl=this.setupDivElement("toolbar-el"),r=this.setupCanvasElement("laser-canvas"),this.laserCanvas=r.canvas,this.laserCtx=r.ctx,setTimeout((function(){n._resize()})),this._bindEvents()}return(0,s.default)(e,[{key:"setBackgroundColor",value:function(){this.el.style.backgroundColor=this.app.appConfig.canvas_bg_color}},{key:"appendTo",value:function(e){e.appendChild(this.el),this._resize(),this.dispatcher.emit("container:set")}},{key:"addOpsManager",value:function(e){this.opsManager=e}},{key:"isKeyDown",value:function(e){return this.keyPressed.hasOwnProperty(e)&&this.keyPressed[e]}},{key:"isTargetOnContainer",value:function(e){var t;return e===this.el||(null==e?void 0:e.parentNode)===this.el||(null===(t=null==e?void 0:e.parentNode)||void 0===t?void 0:t.parentNode)===this.el}},{key:"setupDivElement",value:function(e){var t=document.createElement("div");return t.style.transformOrigin="left top",t.className=e,this.el.appendChild(t),t}},{key:"setupCanvasElement",value:function(e){var t=document.createElement("canvas");this.setElePosition(t),t.className=e,t.style.pointerEvents="none";var n=t.getContext("2d");return this.el.appendChild(t),this.elesToResize.push(t),{canvas:t,ctx:n}}},{key:"_bindEvents",value:function(){window.addEventListener("scroll",this._resize),window.addEventListener("resize",this._resize),window.addEventListener("orientationchange",this._resize),(0,u.on)(this.el,"mousedown",this._mousedown),(0,u.on)(this.el,"mouseleave",this._mouseleave),(0,u.on)(window.document,"mousemove",this._mousemove),(0,u.on)(window.document,"mouseup",this._mouseup),(0,u.on)(this.el,"touchstart",this._mousedown),(0,u.on)(this.el,"touchmove",this._mousemove),(0,u.on)(this.el,"touchend",this._mouseup),(0,u.on)(window.document,"keyup",this._keyup),(0,u.on)(window.document,"keydown",this._keydown),(0,u.on)(document.body,"contextmenu",this._contextmenu)}},{key:"destroy",value:function(){window.removeEventListener("scroll",this._resize),window.removeEventListener("resize",this._resize),window.removeEventListener("orientationchange",this._resize),(0,u.off)(this.el,"mousedown",this._mousedown),(0,u.off)(this.el,"mouseleave",this._mouseleave),(0,u.off)(window.document,"mousemove",this._mousemove),(0,u.off)(window.document,"mouseup",this._mouseup),(0,u.off)(this.el,"touchstart",this._mousedown),(0,u.off)(this.el,"touchmove",this._mousemove),(0,u.off)(this.el,"touchend",this._mouseup),(0,u.off)(window.document,"keyup",this._keyup),(0,u.off)(window.document,"keydown",this._keydown),(0,u.off)(document.body,"contextmenu",this._contextmenu)}},{key:"setElePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"absolute";"absolute"===t?(e.style.position=t,e.style.left="0px",e.style.right="0px",e.style.top="0px",e.style.bottom="0px"):(e.style.position="fixed",e.style.left=this.left+"px",e.style.width=this.width+"px",e.style.top=this.top+"px",e.style.height=this.height+"px")}},{key:"_emitMouseEvents",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,a=(0,i.default)(this.mouseEventCache);!(e=(o=a.next()).done);e=!0){var s,u=o.value;(s=this.opsManager)[u.type].apply(s,(0,r.default)(u.args))}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}this.mouseEventCache=[]}},{key:"width",get:function(){return this.canvas.width}},{key:"height",get:function(){return this.canvas.height}}]),e}();t.default=d},function(e,t,n){e.exports={default:n(160),__esModule:!0}},function(e,t,n){n(31),n(161),e.exports=n(5).Array.from},function(e,t,n){"use strict";var r=n(23),o=n(6),i=n(21),a=n(128),s=n(129),u=n(56),c=n(162),l=n(96);o(o.S+o.F*!n(130)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,o,d,f=i(e),h="function"==typeof this?this:Array,p=arguments.length,v=p>1?arguments[1]:void 0,y=void 0!==v,g=0,m=l(f);if(y&&(v=r(v,p>2?arguments[2]:void 0,2)),null==m||h==Array&&s(m))for(n=new h(t=u(f.length));t>g;g++)c(n,g,y?v(f[g],g):f[g]);else for(d=m.call(f),n=new h;!(o=d.next()).done;g++)c(n,g,y?a(d,v,[o.value,g],!0):o.value);return n.length=g,n}})},function(e,t,n){"use strict";var r=n(12),o=n(25);e.exports=function(e,t,n){t in e?r.f(e,t,o(0,n)):e[t]=n}},function(e,t,n){e.exports={default:n(164),__esModule:!0}},function(e,t,n){n(37),n(31),e.exports=n(165)},function(e,t,n){var r=n(75),o=n(8)("iterator"),i=n(27);e.exports=n(5).isIterable=function(e){var t=Object(e);return void 0!==t[o]||"@@iterator"in t||i.hasOwnProperty(r(t))}},function(e,t,n){n(37),n(31),e.exports=n(167)},function(e,t,n){var r=n(14),o=n(96);e.exports=n(5).getIterator=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=C(n(0)),o=C(n(1)),i=n(169),a=C(n(139)),s=C(n(140)),u=C(n(82)),c=C(n(199)),l=C(n(200)),d=C(n(201)),f=C(n(202)),h=C(n(203)),p=C(n(204)),v=C(n(205)),y=C(n(206)),g=C(n(207)),m=C(n(208)),b=C(n(214)),w=C(n(215)),_=C(n(216)),x=C(n(217)),k=C(n(221)),O=C(n(222)),M=C(n(223)),S=C(n(225)),P=C(n(226)),I=C(n(227));function C(e){return e&&e.__esModule?e:{default:e}}var T=function(){function e(t){(0,r.default)(this,e),this.currOp=null,this.opMap={},this.app=t,this.dispatcher=t.dispatcher,this.hooks={mousedown:new i.SyncBailHook(["event","mx","my"]),mouseup:new i.SyncBailHook(["event","mx","my"]),mousemove:new i.SyncBailHook(["event","mx","my"]),mouseleave:new i.SyncBailHook(["event","mx","my"]),click:new i.SyncBailHook(["event","mx","my"]),keyup:new i.SyncBailHook(["event"]),keydown:new i.SyncBailHook(["event"]),addOpSnapshot:new i.SyncHook(["snapshot","isNew"]),refresh:new i.SyncHook([]),opChange:new i.SyncHook(["type"]),selectChange:new i.SyncHook(["prevSelectedOpIds","selectedOpIds"]),pageChange:new i.SyncHook(["snapshot"]),boardChange:new i.SyncHook([]),pageReady:new i.SyncHook(["boardName, pageIndex"])}}return(0,o.default)(e,[{key:"extendDefaultOps",value:function(){this.extendOp(a.default),this.extendOp(k.default),this.extendOp(O.default),this.extendOp(s.default),this.extendOp(y.default),this.extendOp(g.default),this.extendOp(m.default),this.extendOp(S.default),this.extendOp(u.default),this.extendOp(l.default),this.extendOp(c.default),this.extendOp(d.default),this.extendOp(x.default),this.extendOp(f.default),this.extendOp(h.default),this.extendOp(p.default),this.extendOp(v.default),this.extendOp(M.default),this.extendOp(b.default),this.extendOp(_.default),this.extendOp(w.default),this.extendOp(I.default),this.extendOp(P.default),this.setCurrOp("pen")}},{key:"addContainer",value:function(e){this.container=e}},{key:"extendOp",value:function(e){var t,n,r=this,o=new e(this.app);this.opMap[o.type]=o;var i=o.eventsToListen();if((null===(t=i.activate)||void 0===t?void 0:t.value)&&(null===(n=i.exec)||void 0===n?void 0:n.value))return console.log("白板--\x3e","操作不能同时设置activate和exec为true。操作不同同时为命令类操作，及状态类操作");for(var a in i.activate&&i.activate.value?this.dispatcher.on("op:"+o.type+":activate",(function(){r.setCurrOp(o.type)&&r.currOp.afterActivate()})):i.exec&&i.exec.value&&this.dispatcher.on("op:"+o.type+":exec",o.execCommand.bind(o)),i)"activate"!==a&&"exec"!==a&&this.dispatcher.on("op:"+a,i[a].value)}},{key:"getOpDoc",value:function(e){var t=[];if(void 0!==e)t=this._getOpDoc(e);else{for(var n in this.opMap)(t=t.concat(this._getOpDoc(n))).push("*************************************");t.push("全局事件\n\n用法：app.on('event:add:snapshot', (data: {local: boolean, snapshot: IOPSnapshot}) => {})\n作用： 接收到新的快照时发送此事件\n"),t.push("*************************************")}return t.join("\n\n")}},{key:"_getOpDoc",value:function(e){var t=[];if(this.opMap.hasOwnProperty(e)){var n=this.opMap[e];n.description&&t.push(n.description);var r=n.eventsToListen();for(var o in r){var i=r[o].information,a="op:"+o;"activate"!==o&&"exec"!==o||(a="op:"+n.type+":"+o),t.push("用法：app.emit('"+a+"'"+(i.args.length>0?", "+i.args:"")+")\n作用："+i.message)}var s=n.eventsToEmit();for(var u in s){var c=s[u],l="event:"+n.type+":"+u;t.push("用法：app.on('"+l+"', ("+c.args+") => {}\n作用： "+c.message)}}else console.log("白板--\x3e","op:"+e+"不存在!!!!!!");return t}},{key:"setCurrOp",value:function(e){var t;return(null===(t=this.currOp)||void 0===t?void 0:t.type)!==e&&(document.body.style.cursor="default",this.hooks.opChange.call(e),this.currOp=this.opMap[e],!0)}},{key:"mousedown",value:function(e,t,n){this.app.editable&&(this.hooks.mousedown.call(e,t,n)||this.currOp&&"handleMouseDown"in this.currOp&&this.currOp.handleMouseDown(e,t,n))}},{key:"mouseup",value:function(e,t,n){this.app.editable&&(this.hooks.mouseup.call(e,t,n)||this.currOp&&"handleMouseUp"in this.currOp&&this.currOp.handleMouseUp(e,t,n))}},{key:"mouseleave",value:function(e,t,n){this.app.editable&&(this.hooks.mouseleave.call(e,t,n)||this.currOp&&"handleMouseLeave"in this.currOp&&this.currOp.handleMouseLeave(e,t,n))}},{key:"mousemove",value:function(e,t,n){this.app.editable&&(this.hooks.mousemove.call(e,t,n)||this.currOp&&"handleMouseMove"in this.currOp&&this.currOp.handleMouseMove(e,t,n))}},{key:"click",value:function(e,t,n){this.app.editable&&(this.hooks.click.call(e,t,n)||this.currOp&&"handleClick"in this.currOp&&this.currOp.handleClick(e,t,n))}},{key:"keyup",value:function(e){this.app.editable&&(this.hooks.keyup.call(e)||this.currOp&&"handleKeyUp"in this.currOp&&this.currOp.handleKeyUp(e))}},{key:"keydown",value:function(e){this.app.editable&&(this.hooks.keydown.call(e)||this.currOp&&"handleKeyDown"in this.currOp&&this.currOp.handleKeyDown(e))}},{key:"draw",value:function(e,t,n){var r=e.data.type;this.opMap[r]&&this.opMap[r].draw(e,t,n)}},{key:"preview",value:function(e,t,n){var r=e.data.type;this.opMap[r].preview(e,t,n)}},{key:"hide",value:function(e,t,n){var r=e.data.type;this.opMap[r]&&this.opMap[r].hide(e,t,n)}},{key:"resetUndoRedoCount",value:function(){this.opMap.undo.resetCount(),this.opMap.redo.resetCount()}},{key:"currPage",get:function(){return this.currBoard.pages[this.currBoard.currIndex]}},{key:"currBoard",get:function(){return this.app.room.boards[this.app.room.currIndex]}},{key:"drawOpsOfPage",get:function(){return this.currPage.drawOpQueue||{}}},{key:"selectOp",get:function(){return this.opMap.select}},{key:"selectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.selectedOpIds}},{key:"inProgressSelectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.inProgressSelectedOpIds}}]),e}();t.default=T},function(e,t,n){"use strict";t.__esModule=!0,t.Tapable=n(170),t.SyncHook=n(184),t.SyncBailHook=n(138),t.SyncWaterfallHook=n(185),t.SyncLoopHook=n(186),t.AsyncParallelHook=n(187),t.AsyncParallelBailHook=n(188),t.AsyncSeriesHook=n(189),t.AsyncSeriesBailHook=n(190),t.AsyncSeriesWaterfallHook=n(191),t.HookMap=n(192),t.MultiHook=n(198)},function(e,t,n){"use strict";var r=i(n(99)),o=i(n(19));function i(e){return e&&e.__esModule?e:{default:e}}var a=n(152),s=n(138);function u(){var e=this;this._pluginCompat=new s(["options"]),this._pluginCompat.tap({name:"Tapable camelCase",stage:100},(function(e){e.names.add(e.name.replace(/[- ]([a-z])/g,(function(e,t){return t.toUpperCase()})))})),this._pluginCompat.tap({name:"Tapable this.hooks",stage:200},(function(t){var n=void 0,r=!0,i=!1,a=void 0;try{for(var s,u=(0,o.default)(t.names);!(r=(s=u.next()).done);r=!0){var c=s.value;if(void 0!==(n=e.hooks[c]))break}}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}if(void 0!==n){var l={name:t.fn.name||"unnamed compat plugin",stage:t.stage||0};return t.async?n.tapAsync(l,t.fn):n.tap(l,t.fn),!0}}))}e.exports=u,u.addCompatLayer=function(e){u.call(e),e.plugin=u.prototype.plugin,e.apply=u.prototype.apply},u.prototype.plugin=a.deprecate((function(e,t){if(Array.isArray(e))e.forEach((function(e){this.plugin(e,t)}),this);else if(!this._pluginCompat.call({name:e,fn:t,names:new r.default([e])}))throw new Error("Plugin could not be registered at '"+e+"'. Hook was not found.\nBREAKING CHANGE: There need to exist a hook at 'this.hooks'. To create a compatibility layer for this hook, hook into 'this._pluginCompat'.")}),"Tapable.plugin is deprecated. Use new API on `.hooks` instead"),u.prototype.apply=a.deprecate((function(){for(var e=0;e<arguments.length;e++)arguments[e].apply(this)}),"Tapable.apply is deprecated. Call apply on the plugin directly instead")},function(e,t,n){n(58),n(31),n(37),n(172),n(176),n(178),n(179),e.exports=n(5).Set},function(e,t,n){"use strict";var r=n(132),o=n(102);e.exports=n(134)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(o(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){var r=n(23),o=n(55),i=n(21),a=n(56),s=n(174);e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,d=6==e,f=5==e||d,h=t||s;return function(t,s,p){for(var v,y,g=i(t),m=o(g),b=r(s,p,3),w=a(m.length),_=0,x=n?h(t,w):u?h(t,0):void 0;w>_;_++)if((f||_ in m)&&(y=b(v=m[_],_,g),e))if(n)x[_]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return _;case 2:x.push(v)}else if(l)return!1;return d?-1:c||l?l:x}}},function(e,t,n){var r=n(175);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(13),o=n(78),i=n(8)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),r(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var r=n(6);r(r.P+r.R,"Set",{toJSON:n(135)("Set")})},function(e,t,n){var r=n(66);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){n(136)("Set")},function(e,t,n){n(137)("Set")},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){n(183);var r=n(5).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,n){var r=n(6);r(r.S+r.F*!n(10),"Object",{defineProperties:n(73)})},function(e,t,n){"use strict";var r=u(n(2)),o=u(n(0)),i=u(n(1)),a=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(28),l=new(function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:r})}}]),t}(n(34))),d=function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=u(n(2)),o=u(n(0)),i=u(n(1)),a=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(28),l=new(function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,r=e.onResult,o=e.resultReturns,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,t){return n(t)},onResult:function(e,n,r){var o="";return o+="if("+n+" !== undefined) {\n",o+=t._args[0]+" = "+n+";\n",o+="}\n",o+=r()},onDone:function(){return r(t._args[0])},doneReturns:o,rethrowIfPossible:i})}}]),t}(n(34))),d=function(e){function t(e){(0,o.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncWaterfallHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncWaterfallHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=u(n(2)),o=u(n(0)),i=u(n(1)),a=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(28),l=new(function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;return this.callTapsLooping({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:r})}}]),t}(n(34))),d=function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncLoopHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncLoopHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=c(n(52)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(28),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsParallel({onError:function(e,n,r,o){return t(n)+o(!0)},onDone:n})}}]),t}(n(34))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(52)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(28),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.onDone,o="";return o+="var _results = new Array("+this.options.taps.length+");\n",o+="var _checkDone = () => {\n",o+="for(var i = 0; i < _results.length; i++) {\n",o+="var item = _results[i];\n",o+="if(item === undefined) return false;\n",o+="if(item.result !== undefined) {\n",o+=n("item.result"),o+="return true;\n",o+="}\n",o+="if(item.error) {\n",o+=t("item.error"),o+="return true;\n",o+="}\n",o+="}\n",o+="return false;\n",o+="}\n",o+=this.callTapsParallel({onError:function(e,t,n,r){var o="";return o+="if("+e+" < _results.length && ((_results.length = "+(e+1)+"), (_results["+e+"] = { error: "+t+" }), _checkDone())) {\n",o+=r(!0),o+="} else {\n",o+=n(),o+="}\n"},onResult:function(e,t,n,r){var o="";return o+="if("+e+" < _results.length && ("+t+" !== undefined && (_results.length = "+(e+1)+"), (_results["+e+"] = { result: "+t+" }), _checkDone())) {\n",o+=r(!0),o+="} else {\n",o+=n(),o+="}\n"},onTap:function(e,t,n,r){var o="";return e>0&&(o+="if("+e+" >= _results.length) {\n",o+=n(),o+="} else {\n"),o+=t(),e>0&&(o+="}\n"),o},onDone:r})}}]),t}(n(34))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(52)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(28),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsSeries({onError:function(e,n,r,o){return t(n)+o(!0)},onDone:n})}}]),t}(n(34))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(52)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(28),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.resultReturns,o=e.onDone;return this.callTapsSeries({onError:function(e,n,r,o){return t(n)+o(!0)},onResult:function(e,t,r){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+r()+"}\n"},resultReturns:r,onDone:o})}}]),t}(n(34))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(52)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(28),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,r=e.onResult;e.onDone;return this.callTapsSeries({onError:function(e,t,r,o){return n(t)+o(!0)},onResult:function(e,n,r){var o="";return o+="if("+n+" !== undefined) {\n",o+=t._args[0]+" = "+n+";\n",o+="}\n",o+=r()},onDone:function(){return r(t._args[0])}})}}]),t}(n(34))),f=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,u.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=s(n(9)),o=s(n(153)),i=s(n(0)),a=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,i.default)(this,e),this._map=new o.default,this._factory=t,this._interceptors=[]}return(0,a.default)(e,[{key:"get",value:function(e){return this._map.get(e)}},{key:"for",value:function(e){var t=this.get(e);if(void 0!==t)return t;for(var n=this._factory(e),r=this._interceptors,o=0;o<r.length;o++)n=r[o].factory(e,n);return this._map.set(e,n),n}},{key:"intercept",value:function(e){this._interceptors.push((0,r.default)({factory:function(e,t){return t}},e))}},{key:"tap",value:function(e,t,n){return this.for(e).tap(t,n)}},{key:"tapAsync",value:function(e,t,n){return this.for(e).tapAsync(t,n)}},{key:"tapPromise",value:function(e,t,n){return this.for(e).tapPromise(t,n)}}]),e}();e.exports=u},function(e,t,n){n(58),n(31),n(37),n(194),n(195),n(196),n(197),e.exports=n(5).Map},function(e,t,n){"use strict";var r=n(132),o=n(102);e.exports=n(134)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(o(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(o(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(6);r(r.P+r.R,"Map",{toJSON:n(135)("Map")})},function(e,t,n){n(136)("Map")},function(e,t,n){n(137)("Map")},function(e,t,n){"use strict";var r=a(n(19)),o=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}n(28);var s=function(){function e(t){(0,o.default)(this,e),this.hooks=t}return(0,i.default)(e,[{key:"tap",value:function(e,t){var n=!0,o=!1,i=void 0;try{for(var a,s=(0,r.default)(this.hooks);!(n=(a=s.next()).done);n=!0){a.value.tap(e,t)}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}}},{key:"tapAsync",value:function(e,t){var n=!0,o=!1,i=void 0;try{for(var a,s=(0,r.default)(this.hooks);!(n=(a=s.next()).done);n=!0){a.value.tapAsync(e,t)}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}}},{key:"tapPromise",value:function(e,t){var n=!0,o=!1,i=void 0;try{for(var a,s=(0,r.default)(this.hooks);!(n=(a=s.next()).done);n=!0){a.value.tapPromise(e,t)}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}}},{key:"isUsed",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,i=(0,r.default)(this.hooks);!(e=(o=i.next()).done);e=!0){if(o.value.isUsed())return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"intercept",value:function(e){var t=!0,n=!1,o=void 0;try{for(var i,a=(0,r.default)(this.hooks);!(t=(i=a.next()).done);t=!0){i.value.intercept(e)}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"withOptions",value:function(t){return new e(this.hooks.map((function(e){return e.withOptions(t)})))}}]),e}();e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(9)),o=h(n(2)),i=h(n(0)),a=h(n(1)),s=h(n(3)),u=h(n(4)),c=h(n(11)),l=n(22),d=n(142),f=h(n(82));function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="move",e.points=[],e.activate=!1,e.description="移动操作工具。内部使用，不提供对外接口",e.idsBeenMoved=[],e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("MousedownPlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseup.tap("MouseupPlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default){if(this.activate)return this.points.push([t,n]),this.dispatch(this.getSnapshot(!0,this.idsBeenMoved)),!0;if(!this.isMouseDown&&"nwse-resize"!==document.body.style.cursor&&"nesw-resize"!==document.body.style.cursor)if(this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds)||this.opsManager.inProgressSelectedOpIds.length>0)document.body.style.cursor="move";else{var r=(0,d.findOpsUnderMouse)([[t,n]],this.drawOpsOfPage,this.opsManager);(0,d.arrayDeduce)(r,this.opsManager.selectedOpIds.concat(this.opsManager.inProgressSelectedOpIds)).length>0?document.body.style.cursor="move":document.body.style.cursor="default"}}}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default){var r=this.mouseInSelectedEleBoundary(t,n,this.opsManager.inProgressSelectedOpIds),o=this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds);if(r){var i=this.opsManager.inProgressSelectedOpIds.slice();return this.dispatch(this.opsManager.selectOp.getSnapshot(i)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=i.slice(),this.points=[[t,n]],this.activate=!0,!0}if(o)return this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=this.opsManager.selectedOpIds,this.points=[[t,n]],this.activate=!0,!0;var a=(0,d.findOpsUnderMouse)([[t,n]],this.drawOpsOfPage,this.opsManager);if(a.length>0)return this.dispatch(this.opsManager.selectOp.getSnapshot(a)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=a.slice(),this.points=[[t,n]],this.activate=!0,!0}this.activate=!1}},{key:"handleMouseUp",value:function(e,t,n){if(this.activate)return this.activate=!1,this.points.push([t,n]),this.dispatch(this.getSnapshot(!1,this.idsBeenMoved)),!0}},{key:"getSnapshot",value:function(e,t){return{type:this.type,points:this.points.slice(),selectedOpIds:t.slice(),dependOn:t.slice(),inProgress:e}}},{key:"mouseInSelectedEleBoundary",value:function(e,t,n){var r=this;if(0===(n=n.filter((function(e){return r.drawOpsOfPage.hasOwnProperty(e)}))).length)return!1;var o=this.opsManager.selectOp.eleContainerPadding,i=n.map((function(e){var t=r.drawOpsOfPage[e];return(0,l.getTransformedBoundary)(t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,l.combineBoundary)(e,t)}));return(0,l.pointInRect)({sx:i.sx-o,sy:i.sy-o,w:i.w+2*o,h:i.h+2*o},[e,t])}},{key:"transformOp",value:function(e,t){var n=t.data,o=n.points[n.points.length-1][0]-n.points[0][0],i=n.points[n.points.length-1][1]-n.points[0][1],a=(0,r.default)({},e.data,{dx:o+(e.data.dx||0),dy:i+(e.data.dy||0),inProgress:n.inProgress});return(0,r.default)({},e,{data:a})}}]),t}(c.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(9)),o=h(n(47)),i=h(n(2)),a=h(n(0)),s=h(n(1)),u=h(n(3)),c=h(n(4)),l=h(n(11)),d=h(n(82)),f=n(22);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,a.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="scale",e.scaleList=[],e.coordinateX=0,e.coordinateY=0,e.boundaryW=1,e.boundaryH=1,e.activate=!1,e.description="缩放操作工具。内部使用，不提供对外接口",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MouseMovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mousedown.tap("MouseMovePlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mouseup.tap("MouseMovePlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof d.default){var r=this.mousePosTest(t,n);if(document.body.style.cursor=r.cursorSuggestion,!0===r.value)return this.beginBatch(),this.activate=!0,this.coordinateX=r.coordinateX,this.coordinateY=r.coordinateY,this.boundaryW=0===r.w?1:r.w,this.boundaryH=0===r.h?1:r.h,!0}this.activate=!1}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof d.default){if(this.activate)return this.scaleList.push({scaleX:{coordinate:this.coordinateX,factor:(t-this.coordinateX)/this.boundaryW},scaleY:{coordinate:this.coordinateY,factor:(n-this.coordinateY)/this.boundaryH}}),this.dispatch(this.getSnapshot(!0)),!0;if(this.opsManager.currOp instanceof d.default&&!this.isMouseDown&&this.opsManager.currOp.selectedOpIds.length>0){var r=this.mousePosTest(t,n);document.body.style.cursor=r.cursorSuggestion}else document.body.style.cursor="default"}}},{key:"handleMouseUp",value:function(e,t,n){if(this.activate)return this.activate=!1,this.dispatch(this.getSnapshot(!1)),this.scaleList=[],!0}},{key:"mousePosTest",value:function(e,t){var n=this,r=this.opsManager.selectedOpIds;if(0===(r=r.filter((function(e){return n.drawOpsOfPage.hasOwnProperty(e)}))).length)return{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:1,h:1};var o=this.opsManager.selectedOpIds.map((function(e){var t=n.drawOpsOfPage[e];return(0,f.getTransformedBoundary)(t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,f.combineBoundary)(e,t)})),i=15;return["ios","android","pad"].includes(this.app.platform)&&(i*=2.2),(0,f.pointCollideWithPoint)([e,t],[o.sx,o.sy],i)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:o.sx+o.w,coordinateY:o.sy+o.h,w:-o.w,h:-o.h}:(0,f.pointCollideWithPoint)([e,t],[o.sx+o.w,o.sy],i)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:o.sx,coordinateY:o.sy+o.h,w:o.w,h:-o.h}:(0,f.pointCollideWithPoint)([e,t],[o.sx,o.sy+o.h],i)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:o.sx+o.w,coordinateY:o.sy,w:-o.w,h:o.h}:(0,f.pointCollideWithPoint)([e,t],[o.sx+o.w,o.sy+o.h],i)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:o.sx,coordinateY:o.sy,w:o.w,h:o.h}:{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:o.w,h:o.h}}},{key:"getSnapshot",value:function(e){return{type:this.type,inProgress:e,scaleList:this.scaleList,selectedOpIds:this.opsManager.selectedOpIds.slice(),dependOn:this.opsManager.selectedOpIds.slice()}}},{key:"getScaleParameterBySnapshot",value:function(e){var t=e.data,n=1,r=1,o=0,i=0,a=t.scaleList[t.scaleList.length-1],s=a.scaleX.factor,u=a.scaleY.factor;return n*=s,r*=u,{dx:o=s*(o-a.scaleX.coordinate)+a.scaleX.coordinate,dy:i=u*(i-a.scaleY.coordinate)+a.scaleY.coordinate,factorX:n,factorY:r}}},{key:"transformOp",value:function(e,t){var n,i,a=t.data,s=(null===(n=e.data.scaleX)||void 0===n?void 0:n.factor)||1,u=(null===(i=e.data.scaleY)||void 0===i?void 0:i.factor)||1,c=s,l=u,d=e.data.boundary.sx,h=e.data.boundary.sy,p=(0,f.getTransformedPoint)([d,h],e.data.dx,e.data.dy,e.data.scaleX,e.data.scaleY),v=(0,o.default)(p,2),y=v[0],g=v[1],m=a.scaleList[a.scaleList.length-1],b=m.scaleX.factor,w=m.scaleY.factor;if(c*=b,l*=w,"text"===e.data.type){var _=Math.abs(c)/2+Math.abs(l)/2;b=(c*=_/Math.abs(c))/s,w=(l*=_/Math.abs(l))/u}var x=(y=b*(y-m.scaleX.coordinate)+m.scaleX.coordinate)-c*d,k=(g=w*(g-m.scaleY.coordinate)+m.scaleY.coordinate)-l*h,O=(0,r.default)({},e.data,{scaleX:{factor:c,coordinate:0},scaleY:{factor:l,coordinate:0},dx:x,dy:k});return"text"!==e.data.type||(O.fontSize=Math.abs(e.data.fontSize*c/s)),(0,r.default)({},e,{data:O})}}]),t}(l.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(9)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="delete",e.description="删除元素。",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"删除当前选中的元素"}}}}},{key:"handleKeyDown",value:function(e){var t=e.key.toLocaleLowerCase();if(["backspace","delete"].includes(t))return this.execCommand(),!0}},{key:"execCommand",value:function(){this.opsManager.selectedOpIds.length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type,deleteOpIds:this.opsManager.selectedOpIds.slice(),dependOn:this.opsManager.selectedOpIds.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{hidden:!0});return(0,r.default)({},e,{data:n})}}]),t}(c(n(11)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(99)),o=d(n(2)),i=d(n(0)),a=d(n(1)),s=d(n(3)),u=d(n(4)),c=d(n(11)),l=n(119);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="undo",e.description="撤销操作",e.undoCount=0,e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.addOpSnapshot.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"z"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.undoCount=0,this.emit("remain",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.undoCount=0;else{if(e.data.skipUndo||e.data.inProgress||l.snapshotOutOfNormalFlowTypes.includes(e.data.type))return;"undo"===e.data.type&&this.undoCount>0?this.undoCount--:"undo"!==e.data.type&&this.undoCount++}this.emit("remain",this.undoCount)}},{key:"eventsToEmit",value:function(){return{remain:{args:"remaining: number",message:"当可undo数量发生变化时，应用会发射该事件。"}}}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.undoCount&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",n=new r.default,o=e.length-1;o>=0;o--){var i=e[o],a=i.data.inProgress||i.data.skipUndo||l.snapshotOutOfNormalFlowTypes.includes(i.data.type);if("undo"!==i.data.type&&!a&&!n.has(i.opId)){t=i.opId;break}"undo"===i.data.type&&n.add(i.data.undoOpId)}return{type:this.type,undoOpId:t}}}]),t}(c.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),o=l(n(0)),i=l(n(1)),a=l(n(3)),s=l(n(4)),u=l(n(11)),c=n(119);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="redo",e.description="重做操作",e.redoCount=0,e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.addOpSnapshot.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"y"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.redoCount=0,this.emit("remain",0)}},{key:"onOpAdded",value:function(e,t){if("pageOp"===e.category||"boardOp"===e.category)this.redoCount=0;else{if(!t||e.data.skipUndo||c.snapshotOutOfNormalFlowTypes.includes(e.data.type))return;"redo"===e.data.type&&this.redoCount>0?this.redoCount--:"undo"===e.data.type?this.redoCount++:this.redoCount=0}this.emit("remain",this.redoCount)}},{key:"eventsToEmit",value:function(){return{remain:{args:"remaining: number",message:"当可redo数量发生变化时，应用会发射该事件。"}}}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.redoCount&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",n=0,r=e.length-1;r>=0;r--){var o=e[r];if("undo"===o.data.type&&0===n){t=o.opId;break}"undo"===o.data.type?n--:"redo"===o.data.type?n++:o.data.skipUndo&&!c.snapshotOutOfNormalFlowTypes.includes(o.data.type)||console.warn("白板--\x3e","redo操作之前有非undo操作。请查看具体细节",e)}return{type:this.type,redoOpId:t}}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(17)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="clear",e.description="清空操作",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.refresh.tap("RefreshPlugin",this.onRefresh.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"eventsToEmit",value:function(){return{available:{args:"available: boolean",message:"白板发送变化时，发送该事件说明白板上是否有元素可以清空"}}}},{key:"execCommand",value:function(){(0,r.default)(this.drawOpsOfPage).length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"onRefresh",value:function(){var e=(0,r.default)(this.drawOpsOfPage).length>0;this.emit("available",e)}}]),t}(c(n(11)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),o=u(n(0)),i=u(n(1)),a=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="eraser",e.eraserColor="rgba(230, 100, 100, .4)",e.width=20,e.points=[],e.description="橡皮擦。\n首先使用op:eraser:activate设置画布为橡皮擦模式。具体用法如下：",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"eraser:width":{value:this.setWidth.bind(this),information:{args:"width: number",message:"设置橡皮擦宽度"}},"eraser:color":{value:this.setColor.bind(this),information:{args:"color: Color",message:"设置橡皮擦聚光灯颜色"}}}}},{key:"handleMouseMove",value:function(e,t,n){this.isMouseDown&&(this.points.push([t,n]),this.dispatch(this.getSnapshot()))}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.points=[],this.points.push([t,n])}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&(this.dispatch(this.getSnapshot()),this.points=[])}},{key:"getSnapshot",value:function(){return{type:this.type,points:this.points.slice(),width:this.width,"non-selectable":!0}}},{key:"draw",value:function(e,t){t.save(),t.fillStyle="rgb(0, 0, 0)";var n=e.data.points;t.beginPath(),t.globalCompositeOperation="destination-out";for(var r=1;r<n.length;r++)t.moveTo(n[r][0],n[r][1]),t.arc(n[r][0],n[r][1],this.width,0,2*Math.PI,!0);t.fill(),t.restore(),this.drawEraserSignpost(t)}},{key:"drawEraserSignpost",value:function(e){this.opsManager.currOp instanceof t&&this.isMouseDown&&(e.beginPath(),e.arc(this.points[this.points.length-1][0],this.points[this.points.length-1][1],this.width,0,2*Math.PI,!0),e.fillStyle=this.eraserColor,e.fill())}},{key:"setWidth",value:function(e){this.width=e}},{key:"setColor",value:function(e){this.eraserColor=e}}]),t}(u(n(11)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(9)),o=f(n(2)),i=f(n(0)),a=f(n(1)),s=f(n(3)),u=f(n(4)),c=f(n(11)),l=n(77),d=n(22);function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="rect",e.lineWidth=1,e.isFill=!1,e.stroke="black",e.movedDuringMouseDown=!1,e.sp=[0,0],e.ep=[0,0],e.description="绘制矩形。\n首先使用op:rect:activate设置画布为矩形模式。通过op:rect:lineWidth, op:rect:stroke, op:rect:fill设置矩形的宽度和颜色。然后画布会监听鼠标动作，生成矩形。具体用法如下：",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"rect:isFill":{value:this.setIsFill.bind(this),information:{args:"isFill: boolean",message:"设置是否为填充"}},"rect:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置矩形边框线段宽度"}},"rect:stroke:color":{value:this.setStrokeColor.bind(this),information:{args:"color: ColorString",message:"设置矩形边框颜色"}},"rect:fill:color":{value:this.setFillColor.bind(this),information:{args:"color: ColorString",message:"设置矩形填充颜色"}}}}},{key:"handleMouseMove",value:function(e,t,r){this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(81)+") -1 17, auto":document.body.style.cursor="auto",this.isMouseDown&&(this.ep=this.sanityEp([t,r]),this.dispatch(this.getSnapshot(!0)),this.movedDuringMouseDown=!0)}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.sp=[t,n],this.ep=this.sanityEp([t,n]),this.movedDuringMouseDown=!1}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.movedDuringMouseDown&&(this.ep=this.sanityEp([t,n]),this.dispatch(this.getSnapshot(!1)))}},{key:"sanityEp",value:function(e){return e[0]-this.sp[0]>=0&&e[0]-this.sp[0]<1&&(e[0]=this.sp[0]+1),e[1]-this.sp[1]>=0&&e[1]-this.sp[1]<1&&(e[1]=this.sp[1]+1),e}},{key:"getSnapshot",value:function(e){var t={boundary:this.getBoundaryRect()};return(0,r.default)((0,r.default)({},t),{type:this.type,sp:this.sp,ep:this.ep,stroke:this.isFill?void 0:this.stroke,fill:this.isFill?this.fill:void 0,lineWidth:this.lineWidth,inProgress:e})}},{key:"getBoundaryRect",value:function(){var e=(0,l.min)(this.sp[0],this.ep[0]),t=(0,l.min)(this.sp[1],this.ep[1]);return{sx:e,sy:t,w:(0,l.max)(this.sp[0],this.ep[0])-e,h:(0,l.max)(this.sp[1],this.ep[1])-t}}},{key:"draw",value:function(e,t){var n=e.data,r=(0,d.getTransformedPoint)(n.sp,n.dx,n.dy,n.scaleX,n.scaleY),o=(0,d.getTransformedPoint)(n.ep,n.dx,n.dy,n.scaleX,n.scaleY);t.beginPath(),t.rect(r[0],r[1],o[0]-r[0],o[1]-r[1]),n.stroke&&(t.strokeStyle=n.stroke,t.lineWidth=n.lineWidth,t.stroke()),n.fill&&(t.fillStyle=n.fill,t.fill())}},{key:"setIsFill",value:function(e){this.isFill=e}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setStrokeColor",value:function(e){this.stroke=e}},{key:"setFillColor",value:function(e){this.fill=e}}]),t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(9)),o=f(n(2)),i=f(n(0)),a=f(n(1)),s=f(n(3)),u=f(n(4)),c=f(n(11)),l=n(77),d=n(22);function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="ellipse",e.lineWidth=1,e.isFill=!1,e.stroke="black",e.movedDuringMouseDown=!1,e.sp=[0,0],e.ep=[0,0],e.description="绘制椭圆形。\n首先使用op:ellipse:activate设置画布为椭圆形模式。通过op:ellipse:lineWidth, op:ellipse:stroke, op:ellipse:fill设置椭圆形的宽度和颜色。然后画布会监听鼠标动作，生成椭圆形。具体用法如下：",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"ellipse:isFill":{value:this.setIsFill.bind(this),information:{args:"isFill: boolean",message:"设置是否为填充"}},"ellipse:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置椭圆形边框线段宽度"}},"ellipse:stroke:color":{value:this.setStrokeColor.bind(this),information:{args:"color: ColorString",message:"设置椭圆形边框颜色"}},"ellipse:fill:color":{value:this.setFillColor.bind(this),information:{args:"color: ColorString",message:"设置椭圆形填充颜色"}}}}},{key:"handleMouseMove",value:function(e,t,r){this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(81)+") -1 17, auto":document.body.style.cursor="auto",this.isMouseDown&&(this.ep=[t,r],this.dispatch(this.getSnapshot(!0)),this.movedDuringMouseDown=!0)}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.sp=[t,n],this.ep=[t,n],this.movedDuringMouseDown=!1}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.movedDuringMouseDown&&(this.ep=[t,n],this.dispatch(this.getSnapshot(!1)))}},{key:"getSnapshot",value:function(e){var t={boundary:this.getBoundaryRect()};return(0,r.default)((0,r.default)({},t),{type:this.type,sp:this.sp,ep:this.ep,stroke:this.isFill?void 0:this.stroke,fill:this.isFill?this.fill:void 0,lineWidth:this.lineWidth,inProgress:e})}},{key:"getBoundaryRect",value:function(){var e=(0,l.min)(this.sp[0],this.ep[0]),t=(0,l.min)(this.sp[1],this.ep[1]);return{sx:e,sy:t,w:(0,l.max)(this.sp[0],this.ep[0])-e,h:(0,l.max)(this.sp[1],this.ep[1])-t}}},{key:"draw",value:function(e,t){var n=e.data,r=(0,d.getTransformedPoint)(n.sp,n.dx,n.dy,n.scaleX,n.scaleY),o=(0,d.getTransformedPoint)(n.ep,n.dx,n.dy,n.scaleX,n.scaleY),i=r[0]/2+o[0]/2,a=r[1]/2+o[1]/2,s=Math.abs(o[0]-r[0])/2,u=Math.abs(o[1]-r[1])/2;t.beginPath(),t.ellipse(i,a,s,u,0,0,2*Math.PI,!0),n.stroke&&(t.strokeStyle=n.stroke,t.lineWidth=n.lineWidth,t.stroke()),n.fill&&(t.fillStyle=n.fill,t.fill())}},{key:"ifMouseOnOp",value:function(e,t,n){var r=this.app.container.ctx,o=e.data,i=(0,d.getTransformedPoint)(o.sp,o.dx,o.dy,o.scaleX,o.scaleY),a=(0,d.getTransformedPoint)(o.ep,o.dx,o.dy,o.scaleX,o.scaleY),s=i[0]/2+a[0]/2,u=i[1]/2+a[1]/2,c=Math.abs(a[0]-i[0])/2,l=Math.abs(a[1]-i[1])/2;return r.beginPath(),r.ellipse(s,u,c,l,0,0,2*Math.PI,!0),r.fillStyle="rgba(0,0,0,0)",r.fill(),r.isPointInPath(t,n)}},{key:"setIsFill",value:function(e){this.isFill=e}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setStrokeColor",value:function(e){this.stroke=e}},{key:"setFillColor",value:function(e){this.fill=e}}]),t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=v(n(9)),o=v(n(2)),i=v(n(0)),a=v(n(1)),s=v(n(3)),u=v(n(4)),c=v(n(11)),l=n(22),d=v(n(82)),f=n(209),h=v(n(210)),p=n(83);function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));n.type="text",n.dependOn=void 0,n.blurAt=0,n.color="black",n.text="",n.textBeforeEdit="",n.fontSize=p.DEFAULT_FONTSIZE,n.isFocus=!1,n.isNewText=!0,n.description="绘制文字\n首先使用op:text:activate设置画布为文字模式。通过op:text:color, op:text:fontSize, 设置文字的颜色和字体大小。然后画布会监听鼠标动作，生成文本框。具体用法如下：",n.handleTextAreaChange=function(e){var t=e.target.value;t.endsWith("\n")&&(t+="\n"),n.text=t,n.pre.innerText=t||" ",(0,f.setElementsSize)(n.textAreaContainer,n.textArea,n.pre,n.fontSize),n.dispatch(n.getSnapshot(!0))},n.handleTextAreaBlur=function(e){setTimeout((function(){var e=n.opIdToDraw;n.dispatch(n.getSnapshot(!1,n.text===n.textBeforeEdit)),n.isFocus=!1,n.text=" ",(0,f.clearTextArea)(n.textAreaContainer,n.textArea),n.blurAt=(new Date).valueOf(),n.opsManager.setCurrOp("select"),n.opsManager.selectOp.dispatch(n.opsManager.selectOp.getSnapshot([e]))}),0)},n.registerToolbar(new h.default);var r=(0,f.createElements)(),a=r.textAreaContainer,u=r.textArea,c=r.pre;return n.textAreaContainer=a,n.textArea=u,n.pre=c,n.app.on("container:set",(function(){n.app.container.textAreaEl.appendChild(a),n.app.container.textAreaEl.appendChild(c)})),n.app.on("container:resize",(function(){var e;null===(e=n.toolbar)||void 0===e||e.resize(1/n.app.camera.scale)})),n.textArea.oninput=n.handleTextAreaChange,n.textArea.onblur=n.handleTextAreaBlur,(0,f.setElementsSize)(n.textAreaContainer,n.textArea,n.pre,n.fontSize),n}return(0,u.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.click.tap("ClickPlugin",this.handleClickExistText.bind(this)),this.opsManager.hooks.selectChange.tap("SelectChangePlugin",this.handleSelectChange.bind(this))}},{key:"getIdPrefix",value:function(e,t){return(e+"-"+t).replace(/[\W_]+/g,"-")}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"register:toolbar":{value:this.registerToolbar.bind(this),information:{args:"toolbar: IToolbar",message:"自定义工具栏"}},"text:color":{value:this.setColor.bind(this),information:{args:"color: string",message:"设置文本颜色"}},"text:fontsize":{value:this.setFontSize.bind(this),information:{args:"size: number",message:"设置矩形边框颜色"}}}}},{key:"handleSelectChange",value:function(e,t){var n,r,o=1===e.length&&"text"===this.getOpTypeByOpId(e[0])?e[0]:void 0,i=1===t.length&&"text"===this.getOpTypeByOpId(t[0])?t[0]:void 0;if(o!==i&&i&&this.opsManager.currOp instanceof d.default){var a=this.drawOpsOfPage[i].data,s=(0,l.getTransformedBoundary)(a.boundary,a.dx,a.dy,a.scaleX,a.scaleY);return this.color=a.color,this.fontSize=a.fontSize,this.text=a.text,this.isFocus=!1,(0,f.clearTextArea)(this.textAreaContainer,this.textArea),this.isNewText=!1,this.lastSnapshotData=a,this.dependOn=i,null===(n=this.toolbar)||void 0===n?void 0:n.show({left:s.sx,top:s.sy,container:this.app.container.textAreaEl,fontSize:a.fontSize,scale:1/this.app.camera.scale,color:a.color})}null===(r=this.toolbar)||void 0===r||r.hide()}},{key:"handleClickExistText",value:function(e,t,n){var o,i;if(this.opsManager.currOp instanceof d.default){var a=this.detectIfClickOnText(t,n);if(a){this.opsManager.selectedOpIds.length>0&&this.opsManager.currOp.dispatch(this.opsManager.currOp.getSnapshot([])),this.opsManager.setCurrOp("text");var s=document.getElementById(this.getIdPrefix(a.board,a.page.toString())+"-"+a.opId+"-pre");null===(o=null==s?void 0:s.parentNode)||void 0===o||o.removeChild(s);var u=a.data;this.isFocus=!0,this.isNewText=!1,this.lastSnapshotData=u,this.dependOn=a.opId,this.text=u.text,this.textBeforeEdit=this.text,this.textArea.value=this.text,this.pre.innerText=this.text,this.fontSize=u.fontSize,this.color=u.color;var c=(0,l.getTransformedBoundary)(u.boundary,u.dx,u.dy,u.scaleX,u.scaleY);return(0,f.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,(0,r.default)({fontSize:u.fontSize,color:u.color},c)),null===(i=this.toolbar)||void 0===i||i.show({left:c.sx,top:c.sy,container:this.app.container.textAreaEl,fontSize:u.fontSize,scale:1/this.app.camera.scale,color:u.color}),this.textArea.focus(),this.beginBatch(),!0}}}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.handleClick(e,t,n)}},{key:"handleMouseMove",value:function(e){this.isFocus?document.body.style.cursor="auto":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="text":document.body.style.cursor="auto"}},{key:"handleClick",value:function(e,t,n){var r;this.isFocus||(this.isNewText=!0,this.isFocus=!0,this.dependOn=void 0,this.text=" ",this.textBeforeEdit=this.text,this.pre.innerText=this.text,(0,f.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,{fontSize:this.fontSize,color:this.color,sx:t,sy:n}),this.beginBatch(),null===(r=this.toolbar)||void 0===r||r.show({left:t,top:n,container:this.app.container.textAreaEl,fontSize:this.fontSize,scale:1/this.app.camera.scale,color:this.color}),this.textArea.focus())}},{key:"getSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.isNewText?{boundary:this.getBoundaryRect(this.isNewText),type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,inProgress:e,skipUndo:e||t}:{type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,boundary:this.getBoundaryRect(this.isNewText),dependOn:this.dependOn,inProgress:e,skipUndo:e||t}}},{key:"getBoundaryRect",value:function(e){var t=this.workingPre.getBoundingClientRect(),n=t.width,r=t.height;n/=this.app.camera.scale,r/=this.app.camera.scale;var o=void 0;if(e){var i=t.x-this.app.container.left,a=t.y-this.app.container.top;o=this.app.camera.convertToPointInWorld(i,a)}else{var s=this.lastSnapshotData,u=(0,l.getTransformedBoundary)(s.boundary,s.dx,s.dy,s.scaleX,s.scaleY);o=[u.sx,u.sy]}return{sx:o[0],sy:o[1],w:n,h:r}}},{key:"draw",value:function(e,t,n){var r=n.div,o=e.opId===this.dependOn||e.opId===this.opIdToDraw;if(!this.isFocus||!o){var i=this.app.room.currIndex,a=this.app.room.currBoard.currIndex,s=this.getIdPrefix(i,a.toString())+"-"+e.opId+"-pre";if(!r.querySelector("[id='"+s+"']")){var u=document.createElement("pre");u.id=s,r.appendChild(u)}var c=r.querySelector("[id='"+s+"']");c?this.drawSnapshot(e.data,c,e.opId):console.error("白板--\x3e","找不到id为: "+s+" 的pre")}}},{key:"preview",value:function(e,t){var n=e.data,r=(0,l.getTransformedBoundary)(n.boundary,n.dx,n.dy,n.scaleX,n.scaleY),o=r.sx,i=r.sy,a=f.PADDING*n.fontSize/p.DEFAULT_FONTSIZE;t.save(),t.fillStyle=n.color,t.font=n.fontSize+"px sans-serif",t.textAlign="left",t.textBaseline="top",t.fillText(n.text,o+a,i+a),t.restore()}},{key:"hide",value:function(e,t,n){var r,o=document.getElementById(this.getIdPrefix(e.board,e.page.toString())+"-"+e.opId+"-pre");null===(r=null==o?void 0:o.parentNode)||void 0===r||r.removeChild(o)}},{key:"drawSnapshot",value:function(e,t,n){var r,o,i,a=(0,l.getTransformedBoundary)(e.boundary,e.dx,e.dy,e.scaleX,e.scaleY),s=a.sx,u=a.sy;(0,f.drawTextSnapshot)(t,{text:e.text,sx:s,sy:u,fontSize:e.fontSize,color:e.color}),1===this.opsManager.selectedOpIds.length&&this.opsManager.selectedOpIds[0]===n&&(this.fontSize=e.fontSize,this.color=e.color,null===(r=this.toolbar)||void 0===r||r.setFontsize(e.fontSize),null===(o=this.toolbar)||void 0===o||o.setColor(e.color),null===(i=this.toolbar)||void 0===i||i.updatePosition({left:s,top:u}))}},{key:"detectIfClickOnText",value:function(e,t){for(var n in this.drawOpsOfPage)if("text"===this.drawOpsOfPage[n].data.type){var r=this.drawOpsOfPage[n].data,o=(0,l.getTransformedBoundary)(r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);if((0,l.pointInRect)(o,[e,t]))return this.drawOpsOfPage[n]}}},{key:"setFontSize",value:function(e){this.fontSize!==e&&(this.fontSize=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,(0,f.setElementsSize)(this.textAreaContainer,this.textArea,this.workingPre,this.fontSize),this.dispatch(this.getSnapshot(!1)))}},{key:"setColor",value:function(e){this.color!==e&&(this.color=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,this.dispatch(this.getSnapshot(!1)))}},{key:"registerToolbar",value:function(e){this.toolbar=e,this.toolbar.onFontSizeChange(this.setFontSize.bind(this)),this.toolbar.onColorChange(this.setColor.bind(this))}},{key:"transformOp",value:function(e,t){var n=t.data,o=(0,r.default)({},e.data);for(var i in n)"dependOn"!==i&&(o[i]=n[i]);return o.dx=0,o.dy=0,o.scaleX={coordinate:0,factor:1},o.scaleY={coordinate:0,factor:1},(0,r.default)({},e,{data:o})}},{key:"opIdToDraw",get:function(){return this.isNewText?this.opIdForseen(this.type,this.dependOn):this.dependOn}},{key:"workingPre",get:function(){if(this.isFocus)return this.pre;var e=this.app.room.currIndex,t=this.app.room.currBoard.currIndex.toString();return document.getElementById(this.getIdPrefix(e,t)+"-"+this.dependOn+"-pre")}}]),t}(c.default);t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PADDING=t.MIN_WIDTH=void 0,t.createElements=function(){var e=document.createElement("textarea"),t=document.createElement("pre"),n=document.createElement("div");return n.style.position="absolute",n.style.display="none",n.style.outline="1px dashed black",e.style.resize="none",e.style.overflow="hidden",e.style["white-space"]="nowrap",e.style.background="transparent",e.style.fontFamily="monospace",e.style.fontSize=r.DEFAULT_FONTSIZE+"px",e.style.transformOrigin="left top",e.style.padding=i+"px",e.style.border="none",e.style.outline="none",e.style.boxSizing="content-box",t.style.width="fit-content",t.style.position="absolute",t.style.userSelect="none",t.style.pointerEvents="none",t.style.visibility="hidden",t.style.fontFamily="monospace",t.style.fontSize=r.DEFAULT_FONTSIZE+"px",t.style.transformOrigin="left top",t.style.padding=i+"px",t.style.margin="0",t.style.boxSizing="border-box",n.appendChild(e),{textAreaContainer:n,textArea:e,pre:t}},t.setElementsStyle=function(e,t,n,s){e.style.display="block",e.style.left=s.sx+"px",e.style.top=s.sy+"px",n.style.left=s.sx+"px",n.style.top=s.sy+"px",t.style.color=s.color,t.style.width=(s.w||o)*r.DEFAULT_FONTSIZE/s.fontSize-2*i+"px",t.style.height=(s.h||s.fontSize+12)*r.DEFAULT_FONTSIZE/s.fontSize-2*i+"px",a(e,t,n,s.fontSize)},t.setElementsSize=a,t.drawTextSnapshot=function(e,t){e.innerText=t.text,e.style.color=t.color,e.style.left=t.sx+"px",e.style.top=t.sy+"px",e.style.position="absolute",e.style.fontFamily="monospace",e.style.fontSize=r.DEFAULT_FONTSIZE+"px",e.style.margin="0",e.style.transform="scale("+t.fontSize/r.DEFAULT_FONTSIZE+")",e.style.userSelect="none",e.style.transformOrigin="left top",e.style.padding=i+"px",e.style.pointerEvents="none"},t.clearTextArea=function(e,t){t.value="",e.style.display="none"};var r=n(83),o=t.MIN_WIDTH=20,i=t.PADDING=4;function a(e,t,n,o){n.style.transform="scale("+o/r.DEFAULT_FONTSIZE+")",t.style.transform="scale("+o/r.DEFAULT_FONTSIZE+")",t.style.width=n.clientWidth-2*i+"px",t.style.height=n.clientHeight-2*i+"px",e.style.width=n.clientWidth*o/r.DEFAULT_FONTSIZE+"px",e.style.height=n.clientHeight*o/r.DEFAULT_FONTSIZE+"px"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),o=s(n(1)),i=n(83),a=n(211);function s(e){return e&&e.__esModule?e:{default:e}}n(212);var u="iower-23nsdf090sd",c=function(){function e(){(0,r.default)(this,e),this.fontSize=i.DEFAULT_FONTSIZE,this.color="black",this.fonts=[8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88],this.colors=["rgb(224,32,32)","rgb(250,100,0)","rgb(247,181,0)","rgb(109,212,0)","rgb(68,215,182)","rgb(50,197,255)","rgb(0,145,255)","rgb(98,54,255)","rgb(182,32,224)","rgb(109,114,120)","rgb(0,0,0)","rgb(255,255,255)"],this.fontInputPrevValue="",this.colorCells=[],this.colorPlatteOpen=!1,this.toolbarContainer=document.createElement("div"),this.toolbarContainer.className="text-toolbar",this.toolbarContainer.id=u,this.colorBtn=document.createElement("div"),this.colorBtn.innerText="",this.colorBtn.className="color flex-cell";var t=document.createElement("span");this.colorBtn.appendChild(t),this.colorPlatteContainer=document.createElement("div"),this.colorPlatteContainer.className="platte-container",this.colorPlatteContainer.onmousemove=function(e){e.stopPropagation()};for(var n=0;n<this.colors.length;n++){var o=document.createElement("div");o.className="color-cell",o.style.backgroundColor=this.colors[n],"rgb(255,255,255)"===this.colors[n]&&(o.style.border="1px solid #D9D9DB"),this.colorPlatteContainer.appendChild(o),this.colorCells.push(o)}this.fontInput=document.createElement("input"),this.fontInput.className="fontsize input",this.fontIncBtn=document.createElement("div"),this.fontIncBtn.className="fontsize inc flex-cell";var a=document.createElement("span");a.innerText="+",this.fontIncBtn.appendChild(a),this.fontDecBtn=document.createElement("div"),this.fontDecBtn.className="fontsize dec flex-cell";var s=document.createElement("span");s.innerText="-",this.fontDecBtn.appendChild(s),this.toolbarContainer.appendChild(this.fontInput),this.toolbarContainer.appendChild(this.fontIncBtn),this.toolbarContainer.appendChild(this.fontDecBtn),this.toolbarContainer.appendChild(this.colorBtn),this.toolbarContainer.appendChild(this.colorPlatteContainer),this._registerEvents(),this._stopPropagation()}return(0,o.default)(e,[{key:"show",value:function(e){var t=e.left,n=e.top,r=e.container,o=e.fontSize,i=e.color,a=e.scale;this.setFontsize(o),this.setColor(i),document.getElementById(u)||r.appendChild(this.toolbarContainer),this.toolbarContainer.style.display="flex",this.toolbarContainer.style.transformOrigin="left bottom",this.toolbarContainer.style.transform="scale("+a+")",this.colorPlatteContainer.style.display="none",this.updatePosition({left:t,top:n})}},{key:"resize",value:function(e){this.toolbarContainer.style.transform="scale("+e+")"}},{key:"updatePosition",value:function(e){var t=e.left,n=e.top;this.toolbarContainer.style.left=t-23+"px",this.toolbarContainer.style.top=n-78+"px"}},{key:"hide",value:function(){this.toolbarContainer.style.display="none"}},{key:"setFontsize",value:function(e){this.fontSize=e,this.fontInputPrevValue=Math.round(e).toString(),this.fontInput.value=this.fontInputPrevValue}},{key:"setColor",value:function(e){this.color=e,this.colorBtn.firstChild.style.backgroundColor=this.color,this.setColorPlatteState(!1)}},{key:"setColorPlatteState",value:function(e){this.colorPlatteOpen=e,this.colorPlatteContainer.style.display=e?"flex":"none"}},{key:"onFontSizeChange",value:function(e){this.fontSizeCb=e}},{key:"onColorChange",value:function(e){this.colorCb=e}},{key:"_registerEvents",value:function(){for(var e=this,t=function(t){e.colorCells[t].onclick=function(n){e.setColor(e.colors[t]),e.colorCb&&e.colorCb(e.color)}},n=0;n<this.colorCells.length;n++)t(n);this.colorBtn.onclick=function(t){e.setColorPlatteState(!e.colorPlatteOpen)},this.fontIncBtn.onclick=function(t){e.fontSize<a.MAX_FONT_SIZE&&e._sendFontChangeCommand(Math.min(e.fontSize+8,a.MAX_FONT_SIZE))},this.fontDecBtn.onclick=function(t){e.fontSize>a.MIN_FONT_SIZE&&e._sendFontChangeCommand(Math.max(e.fontSize-8,a.MIN_FONT_SIZE))};var r=function(t){var n=e.fontInput.value;if(""!==n){var r=(0,a.testFontSizeText)(n),o=void 0;o="exceed_max"===r?a.MAX_FONT_SIZE:"exceed_min"===r?a.MIN_FONT_SIZE:Number(n),e.fontInput.value=o,e.fontInputPrevValue=o.toString(),e._sendFontChangeCommand(e.fontInput.value),t&&e.fontInput.blur()}};this.fontInput.onkeydown=function(e){e.stopPropagation(),"Enter"===e.key&&r(!0)},this.fontInput.onblur=function(){r(!1)},this.fontInput.oninput=function(t){var n=t.target.value;n=n.replace(/\D/g,""),e.fontInput.value=n}}},{key:"_sendFontChangeCommand",value:function(e){var t="string"==typeof e?Number(e):e;this.setFontsize(t),this.fontSizeCb&&this.fontSizeCb(this.fontSize)}},{key:"_stopPropagation",value:function(){this.toolbarContainer.onmousedown=function(e){e.stopPropagation()},this.toolbarContainer.ontouchstart=function(e){e.stopPropagation()}}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testFontSizeText=function(e){var t=Number(e);return isNaN(t)?"nan":t>r?"exceed_max":t<=o?"exceed_min":"valid"};var r=t.MAX_FONT_SIZE=999,o=t.MIN_FONT_SIZE=12},function(e,t,n){var r=n(213);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(70)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(69)(!1)).push([e.i,".text-toolbar {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-around;\n\n    position: absolute;\n\n    box-sizing: border-box;\n    height: 48px;\n    margin: 12px 12px 24px;\n\n    -webkit-user-select: none;\n\n       -moz-user-select: none;\n\n        -ms-user-select: none;\n\n            user-select: none;\n    background-color: white;\n    border-radius: 4px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n    z-index: 7;\n}\n\n    .text-toolbar .flex-cell {\n        display: flex;\n        flex: 1;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        border: none;\n        width: 40px;\n        height: 40px;\n    }\n\n    .text-toolbar .color {\n        border-radius: 12px;\n    }\n\n    .text-toolbar .color span {\n            width: 18px;\n            height: 18px;\n            border-radius: 9px;\n        }\n\n    .text-toolbar .fontsize.input {\n        height: 24px;\n        vertical-align: top;\n        box-sizing: border-box;\n        width: 40px;\n        outline: none;\n        border: 1px solid rgba(0, 0, 0, 0.3);\n        margin: 0 6px 0 8px;\n        text-align: center;\n    }\n\n    .text-toolbar .fontsize.inc, .text-toolbar .fontsize.dec {\n        border-radius: 12px;\n        font-size: 32px;\n        line-height: 24px;\n        text-align: center;\n        vertical-align: top;\n        position: relative;\n        top: -3px;\n    }\n\n    .text-toolbar .platte-container {\n        position: absolute;\n        display: none;\n        flex-direction: row;\n        flex-wrap: wrap;\n\n        align-items: center;\n        justify-content: space-around;\n        box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n        bottom: 56px;\n        right: 0;\n        background-color: white;\n        width: 100%;\n    }\n\n    .text-toolbar .platte-container .color-cell {\n            width: 20px;\n            height: 20px;\n            border-radius: 10px;\n            margin: 10px;\n            display: inline-block;\n            box-sizing: border-box\n        }\n\n    .text-toolbar .platte-container .color-cell:hover {\n                cursor: pointer;\n            }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(17)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="page",e.description="页面相关操作",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("pageChangePlugin",this.onPageChange.bind(this))}},{key:"onPageChange",value:function(){return this.emit("info",{pageNames:this.opsManager.currBoard.pageNames.slice(),currPage:this.opsManager.currBoard.currIndex})}},{key:"eventsToEmit",value:function(){return{info:{args:"pageInfo: {pageNames: Array<string>, currPage: <string>}",message:"Page信息发生变化时调用此函数通知开发者"}}}},{key:"eventsToListen",value:function(){return{"page:goto":{value:this.goto.bind(this),information:{args:"page: number",message:"跳转至页面"}},"page:add":{value:this.add.bind(this),information:{args:"insertAfter?: number",message:"添加页面。默认添加至当前board最后"}},"page:delete":{value:this.delete.bind(this),information:{args:"page: number",message:"删除页面。只有当页面数量大于1时可以删除页面"}}}}},{key:"add",value:function(e){this.dispatch({type:this.type,action:"add",insertAfter:e})}},{key:"goto",value:function(e){e!==this.opsManager.currBoard.currIndex&&this.opsManager.currBoard.pageNames.includes(e.toString())&&this.dispatch({type:this.type,action:"goto",page:e})}},{key:"delete",value:function(e){var t=this.opsManager.currBoard.pages;e in t&&(0,r.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",page:e})}}]),t}(c(n(11)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),o=d(n(0)),i=d(n(1)),a=d(n(3)),s=d(n(4)),u=d(n(11)),c=n(143),l=n(22);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="image",e.description="图片操作",e.dispatchImage=function(t,n,r,o){var i=(0,c.getImageProperPosition)(e,n,r),a=i.sx,s=i.sy,u=i.width,l=i.height;o?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:a,sy:s,w:u,h:l}},o):e.dispatch({type:e.type,url:t,boundary:{sx:a,sy:s,w:u,h:l}})},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"image:upload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number\n                    }",message:"上传图片"}}}}},{key:"addImage",value:function(e,t){return(0,c.addImage)(this,e,t)}},{key:"preview",value:function(e,t,n){var r=e.data,o=(0,l.getTransformedBoundary)(r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);return(0,c.draw)(t,r.url,o,{page:n.page,preview:!0})}},{key:"draw",value:function(e,t,n){var r=e.data,o=(0,l.getTransformedBoundary)(r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);return(0,c.draw)(t,r.url,o,{page:n.page,div:n.div,id:e.opId})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(17)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="board",e.description="board相关操作",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"onBoardChange",value:function(){return this.emit("info",{boardNames:(0,r.default)(this.app.room.boards),currBoard:this.app.room.currIndex})}},{key:"eventsToEmit",value:function(){return{info:{args:"boardInfo: {boardNames: Array<string>, currBoard: <string>}",message:"Board信息发生变化时调用此函数通知开发者"}}}},{key:"eventsToListen",value:function(){return{"board:goto":{value:this.goto.bind(this),information:{args:"boardName: string",message:"跳转至board。若board不存在，则创建board"}},"board:delete":{value:this.delete.bind(this),information:{args:"boardName: string",message:"删除board。只有当board数量大于1时可以删除board"}}}}},{key:"goto",value:function(e){e!==this.app.room.currIndex&&this.dispatch({type:this.type,action:"goto",boardName:e})}},{key:"delete",value:function(e){var t=this.app.room.boards;e in t&&(0,r.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",boardName:e})}}]),t}(c(n(11)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COPY_PASTE_SHIFT=void 0;var r=l(n(2)),o=l(n(0)),i=l(n(1)),a=l(n(3)),s=l(n(4)),u=l(n(11)),c=l(n(218));function l(e){return e&&e.__esModule?e:{default:e}}var d=t.COPY_PASTE_SHIFT=50,f=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="duplicate",e.description="拷贝drawable快照",e.copiedSnapshotArray=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"复制当前选中的元素"}}}}},{key:"handleKeyDown",value:function(e){var t=this,n=e.key.toLocaleLowerCase();if("c"===n&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.opsManager.selectedOpIds.length>0){e.preventDefault();var r=this.opsManager.selectedOpIds.filter((function(e){return t.drawOpsOfPage.hasOwnProperty(e)}));return this.copiedSnapshotArray=(0,c.default)(r.map((function(e){return t.drawOpsOfPage[e]}))),!0}if("v"===n&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.copiedSnapshotArray.length>0)return e.preventDefault(),this.execCommand(this.copiedSnapshotArray.slice()),!0}},{key:"execCommand",value:function(e){if(this.opsManager.selectedOpIds.length>0||e&&e.length>0){var t=this.getSnapshot(e);this.dispatch(t);var n=t.duplicates.map((function(e){return e.opId}));this.opsManager.selectOp.dispatch(this.opsManager.selectOp.getSnapshot(n))}}},{key:"getSnapshot",value:function(e){var t=this,n=!!e;if(!e){var r=this.opsManager.selectedOpIds;e=[];for(var o=0;o<r.length;o++){var i=r[o];if(this.drawOpsOfPage.hasOwnProperty(i)){var a=this.drawOpsOfPage[i];e.push(a)}}}return e=e.map((function(e){return(e=(0,c.default)(e)).data.dx=(e.data.dx?e.data.dx:0)+d,e.data.dy=(e.data.dy?e.data.dy:0)+d,e.opId=t.opsManager.currPage.getNextOpId(!0),e})),n&&(this.copiedSnapshotArray=e.slice()),{type:this.type,duplicates:e}}}]),t}(u.default);t.default=f},function(e,t,n){(function(e,n){var r="[object Arguments]",o="[object Function]",i="[object GeneratorFunction]",a="[object Map]",s="[object Set]",u=/\w*$/,c=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,d={};d[r]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[a]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[s]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[o]=d["[object WeakMap]"]=!1;var f="object"==typeof e&&e&&e.Object===Object&&e,h="object"==typeof self&&self&&self.Object===Object&&self,p=f||h||Function("return this")(),v=t&&!t.nodeType&&t,y=v&&"object"==typeof n&&n&&!n.nodeType&&n,g=y&&y.exports===v;function m(e,t){return e.set(t[0],t[1]),e}function b(e,t){return e.add(t),e}function w(e,t,n,r){var o=-1,i=e?e.length:0;for(r&&i&&(n=e[++o]);++o<i;)n=t(n,e[o],o,e);return n}function _(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function x(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function k(e,t){return function(n){return e(t(n))}}function O(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var M,S=Array.prototype,P=Function.prototype,I=Object.prototype,C=p["__core-js_shared__"],T=(M=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+M:"",E=P.toString,j=I.hasOwnProperty,A=I.toString,D=RegExp("^"+E.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=g?p.Buffer:void 0,L=p.Symbol,R=p.Uint8Array,B=k(Object.getPrototypeOf,Object),z=Object.create,F=I.propertyIsEnumerable,U=S.splice,W=Object.getOwnPropertySymbols,H=N?N.isBuffer:void 0,Y=k(Object.keys,Object),Q=ye(p,"DataView"),X=ye(p,"Map"),Z=ye(p,"Promise"),G=ye(p,"Set"),q=ye(p,"WeakMap"),K=ye(Object,"create"),J=_e(Q),V=_e(X),$=_e(Z),ee=_e(G),te=_e(q),ne=L?L.prototype:void 0,re=ne?ne.valueOf:void 0;function oe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ae(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function se(e){this.__data__=new ie(e)}function ue(e,t){var n=ke(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Oe(e)}(e)&&j.call(e,"callee")&&(!F.call(e,"callee")||A.call(e)==r)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],o=n.length,i=!!o;for(var a in e)!t&&!j.call(e,a)||i&&("length"==a||be(a,o))||n.push(a);return n}function ce(e,t,n){var r=e[t];j.call(e,t)&&xe(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function le(e,t){for(var n=e.length;n--;)if(xe(e[n][0],t))return n;return-1}function de(e,t,n,c,l,f,h){var p;if(c&&(p=f?c(e,l,f,h):c(e)),void 0!==p)return p;if(!Pe(e))return e;var v=ke(e);if(v){if(p=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&j.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,p)}else{var y=me(e),g=y==o||y==i;if(Me(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if("[object Object]"==y||y==r||g&&!f){if(_(e))return f?e:{};if(p=function(e){return"function"!=typeof e.constructor||we(e)?{}:(t=B(e),Pe(t)?z(t):{});var t}(g?{}:e),!t)return function(e,t){return pe(e,ge(e),t)}(e,function(e,t){return e&&pe(t,Ie(t),e)}(p,e))}else{if(!d[y])return f?e:{};p=function(e,t,n,r){var o=e.constructor;switch(t){case"[object ArrayBuffer]":return he(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return function(e,t){var n=t?he(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var n=t?he(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case a:return function(e,t,n){return w(t?n(x(e),!0):x(e),m,new e.constructor)}(e,r,n);case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,u.exec(e));return t.lastIndex=e.lastIndex,t}(e);case s:return function(e,t,n){return w(t?n(O(e),!0):O(e),b,new e.constructor)}(e,r,n);case"[object Symbol]":return i=e,re?Object(re.call(i)):{}}var i}(e,y,de,t)}}h||(h=new se);var k=h.get(e);if(k)return k;if(h.set(e,p),!v)var M=n?function(e){return function(e,t,n){var r=t(e);return ke(e)?r:function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}(r,n(e))}(e,Ie,ge)}(e):Ie(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(M||e,(function(r,o){M&&(r=e[o=r]),ce(p,o,de(r,t,n,c,o,e,h))})),p}function fe(e){return!(!Pe(e)||(t=e,T&&T in t))&&(Se(e)||_(e)?D:c).test(_e(e));var t}function he(e){var t=new e.constructor(e.byteLength);return new R(t).set(new R(e)),t}function pe(e,t,n,r){n||(n={});for(var o=-1,i=t.length;++o<i;){var a=t[o],s=r?r(n[a],e[a],a,n,e):void 0;ce(n,a,void 0===s?e[a]:s)}return n}function ve(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function ye(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return fe(n)?n:void 0}oe.prototype.clear=function(){this.__data__=K?K(null):{}},oe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},oe.prototype.get=function(e){var t=this.__data__;if(K){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return j.call(t,e)?t[e]:void 0},oe.prototype.has=function(e){var t=this.__data__;return K?void 0!==t[e]:j.call(t,e)},oe.prototype.set=function(e,t){return this.__data__[e]=K&&void 0===t?"__lodash_hash_undefined__":t,this},ie.prototype.clear=function(){this.__data__=[]},ie.prototype.delete=function(e){var t=this.__data__,n=le(t,e);return!(n<0)&&(n==t.length-1?t.pop():U.call(t,n,1),!0)},ie.prototype.get=function(e){var t=this.__data__,n=le(t,e);return n<0?void 0:t[n][1]},ie.prototype.has=function(e){return le(this.__data__,e)>-1},ie.prototype.set=function(e,t){var n=this.__data__,r=le(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},ae.prototype.clear=function(){this.__data__={hash:new oe,map:new(X||ie),string:new oe}},ae.prototype.delete=function(e){return ve(this,e).delete(e)},ae.prototype.get=function(e){return ve(this,e).get(e)},ae.prototype.has=function(e){return ve(this,e).has(e)},ae.prototype.set=function(e,t){return ve(this,e).set(e,t),this},se.prototype.clear=function(){this.__data__=new ie},se.prototype.delete=function(e){return this.__data__.delete(e)},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ie){var r=n.__data__;if(!X||r.length<199)return r.push([e,t]),this;n=this.__data__=new ae(r)}return n.set(e,t),this};var ge=W?k(W,Object):function(){return[]},me=function(e){return A.call(e)};function be(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function we(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||I)}function _e(e){if(null!=e){try{return E.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function xe(e,t){return e===t||e!=e&&t!=t}(Q&&"[object DataView]"!=me(new Q(new ArrayBuffer(1)))||X&&me(new X)!=a||Z&&"[object Promise]"!=me(Z.resolve())||G&&me(new G)!=s||q&&"[object WeakMap]"!=me(new q))&&(me=function(e){var t=A.call(e),n="[object Object]"==t?e.constructor:void 0,r=n?_e(n):void 0;if(r)switch(r){case J:return"[object DataView]";case V:return a;case $:return"[object Promise]";case ee:return s;case te:return"[object WeakMap]"}return t});var ke=Array.isArray;function Oe(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!Se(e)}var Me=H||function(){return!1};function Se(e){var t=Pe(e)?A.call(e):"";return t==o||t==i}function Pe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ie(e){return Oe(e)?ue(e):function(e){if(!we(e))return Y(e);var t=[];for(var n in Object(e))j.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}n.exports=function(e){return de(e,!0,!0)}}).call(this,n(219),n(220)(e))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(51)),o=d(n(9)),i=d(n(2)),a=d(n(0)),s=d(n(1)),u=d(n(3)),c=d(n(4)),l=n(22);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="pen-arrow",e.description="带箭头的涂鸦操作工具。\n首先使用op:pen-arrow:activate设置画布为涂鸦模式。通过op:pen-arrow:lineWidth, op:pen-arrow:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"pen-arrow:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置涂鸦线段宽度"}},"pen-arrow:color":{value:this.setColor.bind(this),information:{args:"color: ColorString",message:"设置涂鸦颜色"}}}}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.movedDuringMouseDown&&(this.points.push([t,n]),this.points.length>2&&this.dispatch(this.getSnapshot(!1,!0)),this.points=[])}},{key:"getSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];if(this.points.length>1&&t){var r=this.points.length>2?[this.points[this.points.length-3],this.points[this.points.length-1]]:this.points.slice(this.points.length-2),i=(0,l.getLineCoef)(r);if((0,l.dist)(r[0],r[1])>1){var a=r[1][0]-r[0][0]>0?(0,l.getXFromCoefAndOffset)(r[1],i,1):2*r[1][0]-(0,l.getXFromCoefAndOffset)(r[1],i,1),s=r[1][0]-r[0][0]==0?r[1][1]+(r[1][1]-r[0][1]>0?1:-1):(0,l.getLineFromPointsY)(r,a);this.points.push([a,s])}n=(0,l.getArrowPoints)(this.lineWidth+1,r)}var u={boundary:this.getBoundaryRect()};return(0,o.default)((0,o.default)({},u),{type:this.type,points:this.points.slice(),color:this.color,lineWidth:this.lineWidth,arrowPoints:n,inProgress:e})}},{key:"draw",value:function(e,t){var n=e.data,o=n.points;t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(o[0],n.dx,n.dy,n.scaleX,n.scaleY)));for(var i=1;i<o.length;i++)t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(o[i],n.dx,n.dy,n.scaleX,n.scaleY)));t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke();var a=n.arrowPoints;3===a.length&&(t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(a[0],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(a[1],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(a[2],n.dx,n.dy,n.scaleX,n.scaleY))),t.fillStyle=n.color,t.fill())}}]),t}(d(n(139)).default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(51)),o=d(n(9)),i=d(n(2)),a=d(n(0)),s=d(n(1)),u=d(n(3)),c=d(n(4)),l=n(22);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="line-arrow",e.description="绘制带箭头线段。\n首先使用op:line-arrow:activate设置画布为线段模式。通过op:line-arrow:lineWidth, op:line-arrow:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{event:"op:"+this.type+":activate",args:"",message:"设置工具栏状态为："+this.type}},"line-arrow:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置线段宽度"}},"line-arrow:color":{value:this.setColor.bind(this),information:{args:"color: ColorString",message:"设置线段颜色"}}}}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.movedDuringMouseDown&&(this.points.push([t,n]),this.points.length>2&&this.dispatch(this.getSnapshot(!1,!0)),this.points=[])}},{key:"getSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];if(this.points.length>1&&t){var r=[this.points[0],this.points[this.points.length-1]];n=(0,l.getArrowPoints)(this.lineWidth+1,r)}var i={boundary:this.getBoundaryRect()};return(0,o.default)((0,o.default)({},i),{type:this.type,points:this.points,color:this.color,lineWidth:this.lineWidth,arrowPoints:n,inProgress:e})}},{key:"draw",value:function(e,t){var n=e.data,o=n.points;t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(o[0],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(o[o.length-1],n.dx,n.dy,n.scaleX,n.scaleY))),t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.stroke();var i=n.arrowPoints;3===i.length&&(t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(i[0],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(i[1],n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,l.getTransformedPoint)(i[2],n.dx,n.dy,n.scaleX,n.scaleY))),t.fillStyle=n.color,t.fill())}}]),t}(d(n(140)).default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(9)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="element-eraser",e.description="删除元素。",e.lastSelectedOpIds=[],e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"postMouseMove",value:function(e){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(224)+") -1 17, auto":document.body.style.cursor="auto"}},{key:"postMouseUp",value:function(e){this.postClick(e)}},{key:"postClick",value:function(e){this.dispatch(this.getSelectionSnapshot(!1,[])),e.length>0&&this.dispatch(this.getSnapshot(e)),this.lastSelectedOpIds=[]}},{key:"getSnapshot",value:function(e){var t=e.slice();return{type:"element-eraser",deleteOpIds:t,dependOn:t}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{hidden:!0});return(0,r.default)({},e,{data:n})}}]),t}(c(n(141)).default);t.default=l},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEuNDQyMjkiIHdpZHRoPSI4LjM4OTY3IiBoZWlnaHQ9IjE0LjY4MTkiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSAxMiAxLjQ0MjI5KSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuNTg0NSA4Ljg1Nzc5TDEwLjUxNjkgMTQuNzkwMiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuMjI0NjQgMTcuNjgxOEgxNS43NjA0IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),o=u(n(0)),i=u(n(1)),a=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="laser",e.description="镭射灯",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this))}},{key:"handleOpChange",value:function(e){var t;"laser"!==e&&"laser"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&(document.body.style.cursor="default",this.dispatch(this.getSnapshot(!1)))}},{key:"handleMouseLeave",value:function(e,t,n){this.dispatch(this.getSnapshot(!1))}},{key:"handleMouseMove",value:function(e,t,n){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="none":document.body.style.cursor="auto",this.dispatch(this.getSnapshot(!0,[t,n]))}},{key:"getSnapshot",value:function(e,t){return{type:this.type,point:t,inProgress:e,skipUndo:!0}}},{key:"draw",value:function(e,t){var n=e.data,r=6/this.app.camera.scale;e.data.inProgress&&n.point&&(t.save(),t.beginPath(),t.arc(n.point[0],n.point[1],r,0,2*Math.PI,!0),t.shadowColor="rgba(255, 0, 0, 0.5)",t.shadowBlur=8,t.fillStyle="#ff0000",t.fill(),t.restore())}}]),t}(u(n(11)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(9)),o=c(n(2)),i=c(n(0)),a=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="lock",e.description="锁定元素。",e}return(0,u.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{lock:{value:this.lockOps.bind(this),information:{args:"opIds",message:"锁定元素"}},unlock:{value:this.unlockOps.bind(this),information:{args:"opIds",message:"解锁元素"}}}}},{key:"lockOps",value:function(e){this.dispatch(this.getSnapshot(e,"lock"))}},{key:"unlockOps",value:function(e){this.dispatch(this.getSnapshot(e,"unlock"))}},{key:"getSnapshot",value:function(e,t){return{type:this.type,action:t,dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{locked:"lock"===t.data.action});return(0,r.default)({},e,{data:n})}}]),t}(c(n(11)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),o=l(n(0)),i=l(n(1)),a=l(n(3)),s=l(n(4)),u=l(n(11)),c=n(143);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="background",e.description="设置背景操作",e.dispatchImage=function(t,n,r,o){o?e.dispatchFromPage({type:e.type,url:t,imgWidth:n,imgHeight:r},o):e.dispatch({type:e.type,url:t,imgWidth:n,imgHeight:r})},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"background:imageUpload":{value:this.addImage.bind(this),information:{args:"url: string",message:"上传背景图片"}}}}},{key:"addImage",value:function(e){return(0,c.addImage)(this,e)}},{key:"preview",value:function(e,t,n){var r=(0,c.getImageProperPosition)(this,e.data.imgWidth,e.data.imgHeight),o=r.sx,i=r.sy,a=r.width,s=r.height;return(0,c.draw)(t,e.data.url,{sx:o,sy:i,w:a,h:s},{page:n.page,preview:!0})}},{key:"draw",value:function(e,t,n){var r=(0,c.getImageProperPosition)(this,e.data.imgWidth,e.data.imgHeight),o=r.sx,i=r.sy,a=r.width,s=r.height;return(0,c.draw)(t,e.data.url,{sx:o,sy:i,w:a,h:s},{page:n.page,div:n.div,id:e.opId})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),o=u(n(0)),i=u(n(1)),a=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return(0,o.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"subMany",value:function(e){for(var t in e)this.on(t,e[t])}},{key:"destroy",value:function(){var e=this;this.eventNames().forEach((function(t){e.removeAllListeners(t)}))}}]),t}(u(n(38)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(17)),o=s(n(0)),i=s(n(1)),a=s(n(230));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,n){(0,o.default)(this,e),this.currIndex="whiteboard",this.boards={},this.opQueue=[],this.opQueueHist=[],this.app=t,this.connector=n,this.init(),this.app.opsManager.hooks.pageReady.tap("PageReadyPlugin",this.onPageReady.bind(this))}return(0,i.default)(e,[{key:"getPage",value:function(e,t){var n=this.boards[e];if(!n)throw new Error("找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,r.default)(this.app.room.boards).join(","));var o=n.pages[t];if(!o)throw new Error("找不到索引为"+t+"的白板页，当前房间白板页码为: "+n.pageNames.join(","));return o}},{key:"onPageReady",value:function(e,t){this.currIndex===e&&this.currBoard.currIndex.toString()===t&&this.currBoard.currPage.refresh()}},{key:"allSnapshots",value:function(){return this.opQueueHist.slice()}},{key:"init",value:function(){var e=new a.default(this.app,"whiteboard");this.boards={whiteboard:e},this.currIndex="whiteboard",this.opQueue=[],this.opQueueHist=[]}},{key:"addToOpQueueHist",value:function(e){e.data.hasOwnProperty("inProgress")&&e.data.inProgress||-1!==["select","laser"].indexOf(e.data.type)||this.opQueueHist.push(e)}},{key:"reset",value:function(){var e,t,n,r;this.init(),null===(t=null===(e=this.currBoard)||void 0===e?void 0:e.currPage)||void 0===t||t.cleanNonCanvasElements(),null===(r=null===(n=this.currBoard)||void 0===n?void 0:n.currPage)||void 0===r||r.refresh()}},{key:"addOpSnapshot",value:function(e){this.opQueue.push(e);var t=e.data,n=t.action,r=t.boardName;"goto"===n&&this.gotoBoard(r,e),"delete"===n&&this.deleteBoard(r,e),this.app.opsManager.hooks.addOpSnapshot.call(e,!0)}},{key:"gotoBoard",value:function(e,t){this.boards.hasOwnProperty(e)||(this.boards[e]=new a.default(this.app,e)),this.currIndex=e;var n=this.boards[this.currIndex];this.app.opsManager.hooks.boardChange.call(),n.gotoPage(n.currIndex,t)}},{key:"deleteBoard",value:function(e,t){if(this.boards.hasOwnProperty(e))if(1===(0,r.default)(this.boards).length)0;else{var n=(0,r.default)(this.boards),o=n.indexOf(e);delete this.boards[e];var i=o;o===n.length-1&&(i=o-1),this.currIndex=(0,r.default)(this.boards)[i];var a=this.boards[this.currIndex];this.app.opsManager.hooks.boardChange.call(),a.gotoPage(a.currIndex,t)}else 0}},{key:"dispatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t||this.app.editable)if(this.addToOpQueueHist(e),this.app.dispatcher.emit("event:add:snapshot",{local:t,snapshot:e}),t&&this.connector.sendSnapshot(e),"inPageOp"===e.category){var n=this.getPage(e.board,e.page.toString());n.addOpSnapshot(e)}else if("pageOp"===e.category){var r=this.boards[e.board];r&&r.addOpSnapshot(e)}else this.addOpSnapshot(e)}},{key:"currBoard",get:function(){return this.boards[this.currIndex]}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(17)),o=s(n(0)),i=s(n(1)),a=s(n(231));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,n){(0,o.default)(this,e),this.pages={},this.pageNames=[],this.opQueue=[],this.newPageIndex=1,this.app=t,this.dispatch=t.dispatcher,this.boardName=n,this.pages={0:new a.default(t,n,"0")},this.pageNames=["0"],this.currIndex=0}return(0,i.default)(e,[{key:"addOpSnapshot",value:function(e){this.opQueue.push(e);var t=e.data,n=t.action,r=t.page,o=t.insertAfter;"add"===n&&this.addPage(o,e),"goto"===n&&this.gotoPage(r,e),"delete"===n&&this.deletePage(r,e),this.app.opsManager.hooks.addOpSnapshot.call(e,!0)}},{key:"addPage",value:function(e,t){this.pages[this.currIndex].cleanNonCanvasElements(),this.pages[this.newPageIndex]=new a.default(this.app,this.boardName,this.newPageIndex.toString()),e=void 0===e?this.pageNames.length-1:e,this.pageNames.splice(e+1,0,this.newPageIndex.toString()),this.pages[this.newPageIndex].calcDrawOpQueue(),this.pages[this.newPageIndex].refresh(),this.currIndex=this.newPageIndex,this.newPageIndex+=1,this.app.opsManager.hooks.pageChange.call(t)}},{key:"gotoPage",value:function(e,t){if(!this.pages.hasOwnProperty(e))throw new Error("跳转至不存在的页面");this.pages[this.currIndex].cleanNonCanvasElements(),this.currIndex=Number(e),this.app.opsManager.hooks.pageChange.call(t),this.pages[e].calcDrawOpQueue(),this.pages[e].refresh()}},{key:"deletePage",value:function(e,t){if(this.pages.hasOwnProperty(e))if(1===(0,r.default)(this.pages).length)0;else{this.pages[this.currIndex].cleanNonCanvasElements(),delete this.pages[e];var n=this.pageNames.indexOf(e.toString());-1!==n&&this.pageNames.splice(n,1);var o=n;n===this.pageNames.length&&(o=n-1),this.currIndex=Number((0,r.default)(this.pages)[o]),this.app.opsManager.hooks.pageChange.call(t),this.pages[this.currIndex].calcDrawOpQueue(),this.pages[this.currIndex].refresh()}else 0}},{key:"currPage",get:function(){return this.pages[this.currIndex]}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(17)),o=l(n(19)),i=l(n(0)),a=l(n(1)),s=n(119),u=n(144),c=n(251);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,n,r){(0,i.default)(this,e),this.opQueue=[],this.drawOpQueue={},this.hiddenOpQueue={},this.lastInProgressSnapshotOfUser={},this.blockedResourceList=[],this._currOpId=(0,c.v4)(),this._nextOpId=(0,c.v4)(),this.app=t,this.opsManager=t.opsManager,this.boardName=n,this.pageIndex=r,window.page=this}return(0,a.default)(e,[{key:"prepareNewOpId",value:function(){this._currOpId=this._nextOpId,this._nextOpId=(0,c.v4)()}},{key:"getOpId",value:function(){return this.app.account+"-"+this._currOpId}},{key:"getNextOpId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?(this.prepareNewOpId(),this.getOpId()):this.app.account+"-"+this._nextOpId}},{key:"addWaitingResource",value:function(e){this.blockedResourceList.includes(e)||(0,u.resourceLoaded)(e)||this.blockedResourceList.push(e)}},{key:"removeWaitingResource",value:function(e){var t=this.blockedResourceList.indexOf(e);t>-1&&(this.blockedResourceList.splice(t,1),this.blocked||this.app.opsManager.hooks.pageReady.call(this.boardName,this.pageIndex))}},{key:"lastOpOfUser",value:function(e,t){for(var n=this.opQueue.length-1;n>=0;n--)if(this.opQueue[n].uid===e&&this.opQueue[n].opId===t)return{snapshot:this.opQueue[n],index:n};return null}},{key:"opNeedRefresh",value:function(e){return"text"!==e.data.type&&(!["pen","laser","pen-arrow","line","line-arrow","rect","ellipse","text"].includes(e.data.type)||!e.data.inProgress)}},{key:"addOpSnapshot",value:function(e){if("none"!==e.opId){this.lastInProgressSnapshotOfUser.hasOwnProperty(e.uid)&&(e.data.inProgress&&e.opId===this.lastInProgressSnapshotOfUser[e.uid].snapshot.opId||delete this.lastInProgressSnapshotOfUser[e.uid]);var t=this.lastOpOfUser(e.uid,e.opId);null===t||t.snapshot.data.type===e.data.type?(null!==t?this.opQueue[t.index]=e:this.opQueue.push(e),this.opNeedRefresh(e)?this.addOpSnapshotAndRefresh(e):"text"===e.data.type?this.addTextSnapshot(e):this.addSnapshotAndDrawOnlyIt(e),this.opsManager.hooks.addOpSnapshot.call(e,null===t)):console.error("白板--\x3e","异常，两个不同类型的快照共用一个id",t.snapshot,e)}else console.error("白板--\x3e","snapshot no opid",e)}},{key:"addOpSnapshotAndRefresh",value:function(e){this.calcDrawOpQueue(),["undo","redo","clear"].includes(e.data.type)&&this.cleanNonCanvasElements(!1),this.boardName===this.app.room.currIndex&&this.pageIndex===this.app.room.currBoard.currIndex.toString()&&this.refresh()}},{key:"addTextSnapshot",value:function(e){if(this.boardName===this.app.room.currIndex&&this.pageIndex===this.app.room.currBoard.currIndex.toString())if(e.data.dependOn){var t=e.data.dependOn,n=this.drawOpQueue[t];n&&(n=this.transformOp(n,e),this.drawOpQueue[t]=n,this.drawText(n),this.lastSelectSnapshot&&Array.isArray(this.lastSelectSnapshot.data.selectedOpIds)&&1===this.lastSelectSnapshot.data.selectedOpIds.length&&this.lastSelectSnapshot.data.selectedOpIds[0]===n.opId&&(this.setInprogressSnapshot(this.lastSelectSnapshot),this.drawInProgressSnapshots()))}else this.drawOpQueue[e.opId]=e,this.drawText(e)}},{key:"addSnapshotAndDrawOnlyIt",value:function(e){this.setInprogressSnapshot(e),this.boardName===this.app.room.currIndex&&this.pageIndex===this.app.room.currBoard.currIndex.toString()&&("laser"===e.data.type?this.drawInProgressSnapshots(this.app.container.laserCtx):(this.drawOpQueue[e.opId]=e,this.drawInProgressSnapshots()))}},{key:"setInprogressSnapshot",value:function(e){this.lastInProgressSnapshotOfUser.hasOwnProperty(e.uid)&&this.lastInProgressSnapshotOfUser[e.uid].snapshot.opId===e.opId?this.lastInProgressSnapshotOfUser[e.uid]={snapshot:e,beginAt:this.lastInProgressSnapshotOfUser[e.uid].beginAt}:this.lastInProgressSnapshotOfUser[e.uid]={snapshot:e,beginAt:Date.now()}}},{key:"calcDrawOpQueue",value:function(){this.drawOpQueue={},this.hiddenOpQueue={};var e=this.separateNormalQueue(this.opQueue),t=e.normalQueue,n=e.abNormalQueue,r=this.removeHistoryOpQueue(t),o=this.removeClearOpQueue(r),i=this.removeDuplicateOpQueue(o);this.handleNormalQueue(i),this.handleAbNormalQueue(n)}},{key:"handleAbNormalQueue",value:function(e){this.backgroundSnapshot=void 0;for(var t=0;t<e.length;t++){var n=e[t];"background"===n.data.type&&(this.backgroundSnapshot=n)}}},{key:"handleNormalQueue",value:function(e){var t=this,n={},r=!0,i=!1,a=void 0;try{for(var s,u=(0,o.default)(e);!(r=(s=u.next()).done);r=!0){var c=s.value;if(this.lastInProgressSelect=void 0,"select"===c.data.type)c.data.inProgress?this.lastInProgressSelect=c:(this.lastInProgressSelect=void 0,this.lastSelectSnapshot=c);else if("laser"===c.data.type);else if(Array.isArray(c.data.dependOn)){var l=!0,d=!1,f=void 0;try{for(var h,p=(0,o.default)(c.data.dependOn);!(l=(h=p.next()).done);l=!0){var v=h.value;n.hasOwnProperty(v)&&n[v].push(c)}}catch(e){d=!0,f=e}finally{try{!l&&p.return&&p.return()}finally{if(d)throw f}}}else"string"==typeof c.data.dependOn?n.hasOwnProperty(c.data.dependOn)&&n[c.data.dependOn].push(c):n[c.opId]=[c]}}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}for(var y in n){var g=this.getDrawOpFromSnapshotQueue(y,n);g.data.hidden?this.hiddenOpQueue[y]=g:this.drawOpQueue[y]=g}if(this.lastSelectSnapshot){var m=this.lastSelectSnapshot.data.selectedOpIds.filter((function(e){return t.drawOpQueue.hasOwnProperty(e)&&!t.drawOpQueue[e].data.locked}));this.opsManager.selectOp.setSelectedOpIds(m)}else this.opsManager.selectOp.setSelectedOpIds([]);this.lastInProgressSelect?this.opsManager.selectOp.setInProgressSelectedOpIds(this.lastInProgressSelect.data.selectedOpIds):this.opsManager.selectOp.setInProgressSelectedOpIds([])}},{key:"getDrawOpFromSnapshotQueue",value:function(e,t){for(var n=t[e][0],r=1;r<t[e].length;r++)n=this.transformOp(n,t[e][r]);return n}},{key:"transformOp",value:function(e,t){var n=this.opsManager.opMap[t.data.type];return"transformOp"in n?n.transformOp(e,t):e}},{key:"separateNormalQueue",value:function(e){var t=[],n=[],r=!0,i=!1,a=void 0;try{for(var u,c=(0,o.default)(e);!(r=(u=c.next()).done);r=!0){var l=u.value;s.snapshotOutOfNormalFlowTypes.includes(l.data.type)?n.push(l):t.push(l)}}catch(e){i=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw a}}return{normalQueue:t,abNormalQueue:n}}},{key:"removeHistoryOpQueue",value:function(e){for(var t=e.slice(),n=t.length-1;n>=0;n--){var r=t[n];if("undo"===r.data.type||"redo"===r.data.type)for(var o=r.data.undoOpId||r.data.redoOpId,i=n-1;i>=0;i--)t[i].opId===o&&(t.splice(n,1),t.splice(i,1),n--)}return t}},{key:"removeClearOpQueue",value:function(e){for(var t=e.slice(),n=t.length-1;n>=0;n--){if("clear"===t[n].data.type)return t=t.slice(n+1)}return t}},{key:"removeDuplicateOpQueue",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"duplicate"===r.data.type?t=t.concat(r.data.duplicates):t.push(e[n])}return t}},{key:"cleanNonCanvasElements",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.app.container&&this.app.container.domEl&&(this.app.container.domEl.innerHTML=""),e&&this.app.container&&this.app.container.backgroundEl&&(this.app.container.backgroundEl.innerHTML="")}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ctx,n=e.preview,r=e.cleanNonCanvasElements;t||(t=this.ctx);var o=n?t:this.frontCtx;if(this.opsManager.hooks.refresh.call(),r&&this.cleanNonCanvasElements(),t.save(),t.clearRect(0,0,this.width,this.height),this.app.camera.convertCanvas(t),n||(o.save(),o.clearRect(0,0,this.width,this.height),this.laserCtx.clearRect(0,0,this.width,this.height),this.app.camera.convertCanvas(o)),this.backgroundSnapshot&&!n?this.opsManager.draw(this.backgroundSnapshot,t,{div:this.app.container.backgroundEl,page:this}):this.backgroundSnapshot&&this.opsManager.preview(this.backgroundSnapshot,t,{page:this}),this.lastSelectSnapshot&&this.opsManager.draw(this.lastSelectSnapshot,o),this.lastInProgressSelect&&this.opsManager.draw(this.lastInProgressSelect,o),n)for(var i in this.drawOpQueue)this.opsManager.preview(this.drawOpQueue[i],t,{page:this});else{for(var a in this.drawOpQueue)this.opsManager.draw(this.drawOpQueue[a],t,{div:this.app.container.domEl,page:this});for(var s in this.hiddenOpQueue)this.opsManager.hide(this.hiddenOpQueue[s],t,this.app.container.domEl)}t.restore(),this.frontCtx.restore()}},{key:"drawText",value:function(e,t){(t=t||this.frontCtx).save(),this.app.camera.convertCanvas(t),this.opsManager.draw(e,t,{div:this.app.container.domEl,page:this}),t.restore()}},{key:"drawInProgressSnapshots",value:function(e){var t=this;(e=e||this.frontCtx).save(),e.clearRect(0,0,this.width,this.height),this.app.camera.convertCanvas(e),(0,r.default)(this.lastInProgressSnapshotOfUser).map((function(e){return t.lastInProgressSnapshotOfUser[e]})).sort((function(e,t){return e.beginAt-t.beginAt})).forEach((function(n){t.opsManager.draw(n.snapshot,e,{div:t.app.container.domEl,page:t})})),e.restore()}},{key:"ctx",get:function(){return this.app.container.ctx}},{key:"frontCtx",get:function(){return this.app.container.frontCtx}},{key:"laserCtx",get:function(){return this.app.container.laserCtx}},{key:"width",get:function(){return this.app.container.width}},{key:"height",get:function(){return this.app.container.height}},{key:"blocked",get:function(){return this.blockedResourceList.length>0}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(50)),o=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,n){(0,o.default)(this,e),this.app=t,this.handler=n,this.bindEvents()}return(0,i.default)(e,[{key:"bindEvents",value:function(){this.handler.on("data",this.onData.bind(this))}},{key:"onData",value:function(e){var t=this,n=e.data,r=n.type,o=n.value;if("snapshot"===r)this.room.dispatch(o,!1);else if("sync_request"===r)this.sendData({toAccount:e.account,data:{type:"sync_request_response",value:{snapshots:this.room.allSnapshots(),ownerWorldRect:this.app.camera.getContainerWorldRect()}}});else if("sync_request_response"===r||"force_sync_request"===r){0;var i=void 0,a=void 0;Array.isArray(o)?i=o:(i=o.snapshots,a=o.ownerWorldRect),this.room.reset(),void 0!==a&&this.app.camera.setCameraBound(a),i.forEach((function(e){t.room.dispatch(e,!1)})),"force_sync_request"===r&&this.app.opsManager.resetUndoRedoCount(),this.app.isSynchronizing=!1,this.app.emit("event:editable:change",this.app.editable),this.app.dispatcher.emit("event:sync_finished")}}},{key:"sendSyncRequest",value:function(){this.sendData({toAccount:this.app.ownerAccount,data:{type:"sync_request"}})}},{key:"sendForceSyncRequest",value:function(e){this.sendData({toAccount:"0",data:{type:"force_sync_request",value:{snapshots:e,ownerWorldRect:this.app.camera.getContainerWorldRect()}}})}},{key:"sendSnapshot",value:function(e){this.sendData({toAccount:"0",data:{type:"snapshot",value:e}})}},{key:"sendData",value:function(e){this.handler.sendData({toAccount:e.toAccount,data:(0,r.default)(e.data)})}},{key:"room",get:function(){return this.app.room}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(59)),o=s(n(0)),i=s(n(1)),a=s(n(53));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e,t,n,r){return new(n||(n=a.default))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},c=function(){function e(t){(0,o.default)(this,e),this.previewCache={},this.task=[],this.isLoopBusy=!1,this.container=document.createElement("div"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.app=t,this.app.opsManager.hooks.pageReady.tap("PageReadyPlugin",this.onPageReady.bind(this)),this.app.opsManager.hooks.addOpSnapshot.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.setupPreviewElements(),this.resizeElements()}return(0,i.default)(e,[{key:"setupPreviewElements",value:function(){var e=document.createElement("div");e.style.position="relative",e.style.visibility="hidden",document.body.appendChild(e),this.container=e,this.setBackgroundColor(),this.canvas=document.createElement("canvas"),e.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")}},{key:"setBackgroundColor",value:function(){this.container.style.backgroundColor=this.app.appConfig.canvas_bg_color}},{key:"resizeElements",value:function(){this.container.style.width=this.app.container.width+"px",this.container.style.height=this.app.container.height+"px";var e=this.container.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height}},{key:"onOpAdded",value:function(e){if("inPageOp"===e.category&&!e.data.inProgress&&"laser"!==e.data.type){var t=e.board,n=e.page;this.invalidatePreview(n.toString(),t),this.getPreviews([{pageIndex:n.toString(),boardName:t}])}}},{key:"onPageReady",value:function(e,t){this.invalidatePreview(t.toString(),e),this.getPreviews([{pageIndex:t.toString(),boardName:e}])}},{key:"getPreviews",value:function(e){var t=this,n=[],r=e.map((function(e){var r=t.getCacheKey(e.pageIndex.toString(),e.boardName);return t.previewCache.hasOwnProperty(r)?t.previewCache[r]:(n.push(e),"")}));return this.addPreviewTask(n),r}},{key:"startLoop",value:function(){return u(this,void 0,void 0,r.default.mark((function e(){var t,n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoopBusy){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,new a.default((function(e){setTimeout(e,0)}));case 4:this.isLoopBusy=!0,t=r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.shiftNextReadyTask();case 2:t=e.sent;case 3:if(null!==t){e.next=11;break}return e.next=6,n.delay(1e3);case 6:return e.next=8,n.shiftNextReadyTask();case 8:t=e.sent,e.next=3;break;case 11:return e.next=13,new a.default((function(e,r){try{var o=n.generatePreview(t);n.app.dispatcher.emit("event:preview:update",{pageIndex:t.pageIndex,boardName:t.boardName,data:o}),e()}catch(e){console.error("白板--\x3e","Error when generating preview: ",e),r()}}));case 13:return e.next=15,n.delay(1e3);case 15:case"end":return e.stop()}}),e,n)}));case 6:if(!(this.task.length>0)){e.next=10;break}return e.delegateYield(t(),"t0",8);case 8:e.next=6;break;case 10:this.isLoopBusy=!1;case 11:case"end":return e.stop()}}),e,this)})))}},{key:"shiftNextReadyTask",value:function(){return u(this,void 0,void 0,r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<this.task.length)){e.next=9;break}if("ready"!==this.task[t].state){e.next=6;break}return n=this.task[t],this.task.splice(t,1),e.abrupt("return",n);case 6:t++,e.next=1;break;case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"delay",value:function(e){return u(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new a.default((function(t){setTimeout((function(){t()}),e)})));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"generatePreview",value:function(e){var t=this.app.room.getPage(e.boardName,e.pageIndex);t.calcDrawOpQueue(),t.refresh({ctx:this.ctx,preview:!0});var n=this.getCacheKey(e.pageIndex,e.boardName),r=this.canvas.toDataURL();return this.previewCache[n]=r,r}},{key:"getCacheKey",value:function(e,t){return t+"-129*&^ljdfh893-"+e}},{key:"addPreviewTask",value:function(e){var t=this;setTimeout((function(){e.forEach((function(e){var n=t.getCacheKey(e.pageIndex,e.boardName),r=t.previewCache.hasOwnProperty(n),o=t.getTaskIndexOfPage(e.pageIndex,e.boardName);if(-1!==o&&t.task.splice(o,1),!r){var i=t.app.room.boards[e.boardName];if(i){var a=i.pages[e.pageIndex];a&&t.task.push({pageIndex:e.pageIndex,boardName:e.boardName,state:a.blocked?"waiting":"ready"})}}})),t.startLoop()}),0)}},{key:"getTaskIndexOfPage",value:function(e,t){for(var n=0;n<this.task.length;n++)if(this.task[n].pageIndex===e&&this.task[n].boardName===t)return n;return-1}},{key:"invalidatePreview",value:function(e,t){delete this.previewCache[this.getCacheKey(e,t)]}}]),e}();t.default=c},function(e,t,n){var r=function(){return this}()||Function("return this")(),o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(235),o)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=v;var l={},d={};d[i]=function(){return this};var f=Object.getPrototypeOf,h=f&&f(f(S([])));h&&h!==n&&r.call(h,i)&&(d=h);var p=b.prototype=g.prototype=Object.create(d);m.prototype=p.constructor=b,b.constructor=m,b[s]=m.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(p),e},c.awrap=function(e){return{__await:e}},w(_.prototype),_.prototype[a]=function(){return this},c.AsyncIterator=_,c.async=function(e,t,n,r){var o=new _(v(e,t,n,r));return c.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(p),p[s]="Generator",p[i]=function(){return this},p.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=S,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function v(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,i=Object.create(o.prototype),a=new M(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return P()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=y(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),i}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function g(){}function m(){}function b(){}function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(n,o){function i(){return new Promise((function(t,i){!function t(n,o,i,a){var s=y(e[n],e,o);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,i,a)}),(function(e){t("throw",e,i,a)})):Promise.resolve(c).then((function(e){u.value=e,i(u)}),a)}a(s.arg)}(n,o,t,i)}))}return t=t?t.then(i,i):i()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=y(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){n(58),n(31),n(37),n(237),n(241),n(242),e.exports=n(5).Promise},function(e,t,n){"use strict";var r,o,i,a,s=n(26),u=n(7),c=n(23),l=n(75),d=n(6),f=n(13),h=n(39),p=n(101),v=n(66),y=n(145),g=n(146).set,m=n(239)(),b=n(122),w=n(147),_=n(240),x=n(148),k=u.TypeError,O=u.process,M=O&&O.versions,S=M&&M.v8||"",P=u.Promise,I="process"==l(O),C=function(){},T=o=b.f,E=!!function(){try{var e=P.resolve(1),t=(e.constructor={})[n(8)("species")]=function(e){e(C,C)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t&&0!==S.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),j=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},A=function(e,t){if(!e._n){e._n=!0;var n=e._c;m((function(){for(var r=e._v,o=1==e._s,i=0,a=function(t){var n,i,a,s=o?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(o||(2==e._h&&L(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),a=!0)),n===t.promise?c(k("Promise-chain cycle")):(i=j(n))?i.call(n,u,c):u(n)):c(r)}catch(e){l&&!a&&l.exit(),c(e)}};n.length>i;)a(n[i++]);e._c=[],e._n=!1,t&&!e._h&&D(e)}))}},D=function(e){g.call(u,(function(){var t,n,r,o=e._v,i=N(e);if(i&&(t=w((function(){I?O.emit("unhandledRejection",o,e):(n=u.onunhandledrejection)?n({promise:e,reason:o}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",o)})),e._h=I||N(e)?2:1),e._a=void 0,i&&t.e)throw t.v}))},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){g.call(u,(function(){var t;I?O.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},R=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},B=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw k("Promise can't be resolved itself");(t=j(e))?m((function(){var r={_w:n,_d:!1};try{t.call(e,c(B,r,1),c(R,r,1))}catch(e){R.call(r,e)}})):(n._v=e,n._s=1,A(n,!1))}catch(e){R.call({_w:n,_d:!1},e)}}};E||(P=function(e){p(this,P,"Promise","_h"),h(e),r.call(this);try{e(c(B,this,1),c(R,this,1))}catch(e){R.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(100)(P.prototype,{then:function(e,t){var n=T(y(this,P));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=I?O.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&A(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new r;this.promise=e,this.resolve=c(B,e,1),this.reject=c(R,e,1)},b.f=T=function(e){return e===P||e===a?new i(e):o(e)}),d(d.G+d.W+d.F*!E,{Promise:P}),n(32)(P,"Promise"),n(133)("Promise"),a=n(5).Promise,d(d.S+d.F*!E,"Promise",{reject:function(e){var t=T(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!E),"Promise",{resolve:function(e){return x(s&&this===a?P:this,e)}}),d(d.S+d.F*!(E&&n(130)((function(e){P.all(e).catch(C)}))),"Promise",{all:function(e){var t=this,n=T(t),r=n.resolve,o=n.reject,i=w((function(){var n=[],i=0,a=1;v(e,!1,(function(e){var s=i++,u=!1;n.push(void 0),a++,t.resolve(e).then((function(e){u||(u=!0,n[s]=e,--a||r(n))}),o)})),--a||r(n)}));return i.e&&o(i.v),n.promise},race:function(e){var t=this,n=T(t),r=n.reject,o=w((function(){v(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return o.e&&r(o.v),n.promise}})},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(7),o=n(146).set,i=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,u="process"==n(35)(a);e.exports=function(){var e,t,n,c=function(){var r,o;for(u&&(r=a.domain)&&r.exit();e;){o=e.fn,e=e.next;try{o()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){a.nextTick(c)};else if(!i||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(c)}}else n=function(){o.call(r,c)};else{var d=!0,f=document.createTextNode("");new i(c).observe(f,{characterData:!0}),n=function(){f.data=d=!d}}return function(r){var o={fn:r,next:void 0};t&&(t.next=o),e||(e=o,n()),t=o}}},function(e,t,n){var r=n(7).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(6),o=n(5),i=n(7),a=n(145),s=n(148);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,o.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){"use strict";var r=n(6),o=n(122),i=n(147);r(r.S,"Promise",{try:function(e){var t=o.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(19)),o=u(n(50)),i=u(n(17)),a=u(n(0)),s=u(n(1));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,n){(0,a.default)(this,e),this.app=t,n=n||"local",this.channel=n,localStorage&&(this.removeObsoleteCache(),this.opsManager.hooks.addOpSnapshot.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)))}return(0,s.default)(e,[{key:"removeObsoleteCache",value:function(){try{var e=localStorage.getItem("whiteboard-cache-metadata");if(e)JSON.parse(e).channel!==this.channel&&(localStorage.removeItem("whiteboard-cache-metadata"),localStorage.removeItem("whiteboard-cache-data"))}catch(e){console.error("白板--\x3e","解析localstorage中whiteboard-cache-metadata出错")}}},{key:"recover",value:function(){try{var e=localStorage.getItem("whiteboard-cache-data");return e?JSON.parse(e):[]}catch(e){return console.error("白板--\x3e","恢复数据出错"),[]}}},{key:"onOpAdded",value:function(e){var t=!1;"pageOp"===e.category||"boardOp"===e.category?t=!0:e.data.inProgress||e.data.skipUndo||(t=!0),t&&this.cacheData()}},{key:"cacheData",value:function(){var e=[],t=(0,i.default)(this.app.room.boards);e=this.app.room.opQueue.slice();var n=!0,a=!1,s=void 0;try{for(var u,c=(0,r.default)(t);!(n=(u=c.next()).done);n=!0){var l=u.value,d=this.app.room.boards[l];e=e.concat(d.opQueue.slice());var f=!0,h=!1,p=void 0;try{for(var v,y=(0,r.default)(d.pageNames);!(f=(v=y.next()).done);f=!0){var g=v.value,m=d.pages[g];for(var b in m.drawOpQueue)e.push(m.drawOpQueue[b]);m.backgroundSnapshot&&e.push(m.backgroundSnapshot)}}catch(e){h=!0,p=e}finally{try{!f&&y.return&&y.return()}finally{if(h)throw p}}}}catch(e){a=!0,s=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw s}}localStorage.setItem("whiteboard-cache-metadata",(0,o.default)({channel:this.channel})),localStorage.setItem("whiteboard-cache-data",(0,o.default)(e))}},{key:"opsManager",get:function(){return this.app.opsManager}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(47)),o=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,o.default)(this,e),this.app=t,this.centerX=0,this.centerY=0,this.translateX=0,this.translateY=0,this.scale=1,this.width=1920,this.height=1080}return(0,i.default)(e,[{key:"getContainerWorldRect",value:function(){var e=this.container.el.getBoundingClientRect(),t=e.width,n=e.height,o=this.convertToPointInWorld(0,0),i=(0,r.default)(o,2),a=i[0],s=i[1],u=this.convertToPointInWorld(t,n),c=(0,r.default)(u,2),l=c[0],d=c[1];return{centerX:a/2+l/2,centerY:s/2+d/2,width:l-a,height:d-s}}},{key:"convertToPointInWorld",value:function(e,t){return[e=(e-this.translateX)/this.scale,t=(t-this.translateY)/this.scale]}},{key:"convertDom",value:function(e){e.style.transform="translate("+this.translateX+"px, "+this.translateY+"px) scale("+this.scale+")"}},{key:"convertCanvas",value:function(e){e.translate(this.translateX,this.translateY),e.scale(this.scale,this.scale)}},{key:"setCameraBound",value:function(e){this.centerX=e.centerX,this.centerY=e.centerY,this.width=e.width,this.height=e.height,this.updateTransformParams()}},{key:"updateTransformParams",value:function(){var e,t,n,r=this.width/this.height;this.clientWidth/this.clientHeight>r?this.scale=this.clientHeight/this.height:this.scale=this.clientWidth/this.width,this.translateX=this.clientWidth/2-this.centerX*this.scale,this.translateY=this.clientHeight/2-this.centerY*this.scale,this.convertDom(this.container.backgroundEl),this.convertDom(this.container.domEl),this.convertDom(this.container.textAreaEl),null===(n=null===(t=null===(e=this.app.room)||void 0===e?void 0:e.currBoard)||void 0===t?void 0:t.currPage)||void 0===n||n.refresh(),this.app.previewFactory.resizeElements()}},{key:"clientWidth",get:function(){return this.app.container.width}},{key:"clientHeight",get:function(){return this.app.container.height}},{key:"container",get:function(){return this.app.container}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(0)),o=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t){(0,r.default)(this,e),this.records=[],this.nextRecordIndex=0,this.lastTime=0,this.offsetBegin=0,this.app=t}return(0,o.default)(e,[{key:"addRecordData",value:function(e){this.records=e.sort((function(e,t){return e.time-t.time}))}},{key:"seekTo",value:function(e){var t=this,n=e>this.lastTime;this.lastTime=e;for(var r=n?this.nextRecordIndex:0,o=r;o<this.records.length;o++){if(this.records[o].time+this.offsetBegin>e)break}var i=this.records.slice(r,o);this.nextRecordIndex=o,n||this.app.resetState(),i.forEach((function(e){"snapshot"===e.record.type&&t.app.room.dispatch(e.record.value,!1)}))}}]),e}();t.default=a},,,,,,function(e,t,n){"use strict";var r;n.r(t),n.d(t,"v1",(function(){return v})),n.d(t,"v3",(function(){return M})),n.d(t,"v4",(function(){return S})),n.d(t,"v5",(function(){return C})),n.d(t,"NIL",(function(){return T})),n.d(t,"version",(function(){return E})),n.d(t,"validate",(function(){return s})),n.d(t,"stringify",(function(){return f})),n.d(t,"parse",(function(){return y}));var o=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var s=function(e){return"string"==typeof e&&a.test(e)},u=[],c=0;c<256;++c)u.push((c+256).toString(16).substr(1));var l,d,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n},h=0,p=0;var v=function(e,t,n){var r=t&&n||0,o=t||new Array(16),a=(e=e||{}).node||l,s=void 0!==e.clockseq?e.clockseq:d;if(null==a||null==s){var u=e.random||(e.rng||i)();null==a&&(a=l=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==s&&(s=d=16383&(u[6]<<8|u[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:p+1,y=c-h+(v-p)/1e4;if(y<0&&void 0===e.clockseq&&(s=s+1&16383),(y<0||c>h)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=c,p=v,d=s;var g=(1e4*(268435455&(c+=122192928e5))+v)%4294967296;o[r++]=g>>>24&255,o[r++]=g>>>16&255,o[r++]=g>>>8&255,o[r++]=255&g;var m=c/4294967296*1e4&268435455;o[r++]=m>>>8&255,o[r++]=255&m,o[r++]=m>>>24&15|16,o[r++]=m>>>16&255,o[r++]=s>>>8|128,o[r++]=255&s;for(var b=0;b<6;++b)o[r+b]=a[b];return t||f(o)};var y=function(e){if(!s(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};var g=function(e,t,n){function r(e,r,o,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=y(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),(a=n(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,o){i=i||0;for(var s=0;s<16;++s)o[i+s]=a[s];return o}return f(a)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r};function m(e){return 14+(e+64>>>9<<4)+1}function b(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function w(e,t,n,r,o,i){return b((a=b(b(t,e),b(r,i)))<<(s=o)|a>>>32-s,n);var a,s}function _(e,t,n,r,o,i,a){return w(t&n|~t&r,e,t,o,i,a)}function x(e,t,n,r,o,i,a){return w(t&r|n&~r,e,t,o,i,a)}function k(e,t,n,r,o,i,a){return w(t^n^r,e,t,o,i,a)}function O(e,t,n,r,o,i,a){return w(n^(t|~r),e,t,o,i,a)}var M=g("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r=0;r<n;r+=8){var o=e[r>>5]>>>r%32&255,i=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var n=1732584193,r=-271733879,o=-1732584194,i=271733878,a=0;a<e.length;a+=16){var s=n,u=r,c=o,l=i;n=_(n,r,o,i,e[a],7,-680876936),i=_(i,n,r,o,e[a+1],12,-389564586),o=_(o,i,n,r,e[a+2],17,606105819),r=_(r,o,i,n,e[a+3],22,-1044525330),n=_(n,r,o,i,e[a+4],7,-176418897),i=_(i,n,r,o,e[a+5],12,1200080426),o=_(o,i,n,r,e[a+6],17,-1473231341),r=_(r,o,i,n,e[a+7],22,-45705983),n=_(n,r,o,i,e[a+8],7,1770035416),i=_(i,n,r,o,e[a+9],12,-1958414417),o=_(o,i,n,r,e[a+10],17,-42063),r=_(r,o,i,n,e[a+11],22,-1990404162),n=_(n,r,o,i,e[a+12],7,1804603682),i=_(i,n,r,o,e[a+13],12,-40341101),o=_(o,i,n,r,e[a+14],17,-1502002290),r=_(r,o,i,n,e[a+15],22,1236535329),n=x(n,r,o,i,e[a+1],5,-165796510),i=x(i,n,r,o,e[a+6],9,-1069501632),o=x(o,i,n,r,e[a+11],14,643717713),r=x(r,o,i,n,e[a],20,-373897302),n=x(n,r,o,i,e[a+5],5,-701558691),i=x(i,n,r,o,e[a+10],9,38016083),o=x(o,i,n,r,e[a+15],14,-660478335),r=x(r,o,i,n,e[a+4],20,-405537848),n=x(n,r,o,i,e[a+9],5,568446438),i=x(i,n,r,o,e[a+14],9,-1019803690),o=x(o,i,n,r,e[a+3],14,-187363961),r=x(r,o,i,n,e[a+8],20,1163531501),n=x(n,r,o,i,e[a+13],5,-1444681467),i=x(i,n,r,o,e[a+2],9,-51403784),o=x(o,i,n,r,e[a+7],14,1735328473),r=x(r,o,i,n,e[a+12],20,-1926607734),n=k(n,r,o,i,e[a+5],4,-378558),i=k(i,n,r,o,e[a+8],11,-2022574463),o=k(o,i,n,r,e[a+11],16,1839030562),r=k(r,o,i,n,e[a+14],23,-35309556),n=k(n,r,o,i,e[a+1],4,-1530992060),i=k(i,n,r,o,e[a+4],11,1272893353),o=k(o,i,n,r,e[a+7],16,-155497632),r=k(r,o,i,n,e[a+10],23,-1094730640),n=k(n,r,o,i,e[a+13],4,681279174),i=k(i,n,r,o,e[a],11,-358537222),o=k(o,i,n,r,e[a+3],16,-722521979),r=k(r,o,i,n,e[a+6],23,76029189),n=k(n,r,o,i,e[a+9],4,-640364487),i=k(i,n,r,o,e[a+12],11,-421815835),o=k(o,i,n,r,e[a+15],16,530742520),r=k(r,o,i,n,e[a+2],23,-995338651),n=O(n,r,o,i,e[a],6,-198630844),i=O(i,n,r,o,e[a+7],10,1126891415),o=O(o,i,n,r,e[a+14],15,-1416354905),r=O(r,o,i,n,e[a+5],21,-57434055),n=O(n,r,o,i,e[a+12],6,1700485571),i=O(i,n,r,o,e[a+3],10,-1894986606),o=O(o,i,n,r,e[a+10],15,-1051523),r=O(r,o,i,n,e[a+1],21,-2054922799),n=O(n,r,o,i,e[a+8],6,1873313359),i=O(i,n,r,o,e[a+15],10,-30611744),o=O(o,i,n,r,e[a+6],15,-1560198380),r=O(r,o,i,n,e[a+13],21,1309151649),n=O(n,r,o,i,e[a+4],6,-145523070),i=O(i,n,r,o,e[a+11],10,-1120210379),o=O(o,i,n,r,e[a+2],15,718787259),r=O(r,o,i,n,e[a+9],21,-343485551),n=b(n,s),r=b(r,u),o=b(o,c),i=b(i,l)}return[n,r,o,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(m(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}));var S=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return f(r)};function P(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function I(e,t){return e<<t|e>>>32-t}var C=g("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var o=0;o<r.length;++o)e.push(r.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,a=Math.ceil(i/16),s=new Array(a),u=0;u<a;++u){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=e[64*u+4*l]<<24|e[64*u+4*l+1]<<16|e[64*u+4*l+2]<<8|e[64*u+4*l+3];s[u]=c}s[a-1][14]=8*(e.length-1)/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var f=new Uint32Array(80),h=0;h<16;++h)f[h]=s[d][h];for(var p=16;p<80;++p)f[p]=I(f[p-3]^f[p-8]^f[p-14]^f[p-16],1);for(var v=n[0],y=n[1],g=n[2],m=n[3],b=n[4],w=0;w<80;++w){var _=Math.floor(w/20),x=I(v,5)+P(_,y,g,m)+b+t[_]+f[w]>>>0;b=m,m=g,g=I(y,30)>>>0,y=v,v=x}n[0]=n[0]+v>>>0,n[1]=n[1]+y>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),T="00000000-0000-0000-0000-000000000000";var E=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},,,,,,,,function(e,t,n){e.exports=n(157)}]).default}));